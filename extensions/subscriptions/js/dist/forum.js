(()=>{var o={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return o.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)o.o(n,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},t={};(()=>{"use strict";o.r(t),o.d(t,{extend:()=>X});const n=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/app"];var r=o.n(s);const i=flarum.core.compat["common/Model"];var e=o.n(i);const a=flarum.core.compat["common/models/Discussion"];var c=o.n(a);const l=flarum.core.compat["forum/components/NotificationGrid"];var u=o.n(l);const f=flarum.core.compat["common/components/Badge"];var p=o.n(f);const b=flarum.core.compat["common/components/Button"];var d=o.n(b);const _=flarum.core.compat["forum/components/DiscussionPage"];var g=o.n(_);const w=flarum.core.compat["forum/utils/DiscussionControls"];var y=o.n(w);function v(){return v=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(o[s]=n[s])}return o},v.apply(this,arguments)}function h(o,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},h(o,t)}function x(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,h(o,t)}const P=flarum.core.compat["common/components/Dropdown"];var S=o.n(P);const N=flarum.core.compat["common/components/Tooltip"];var O=o.n(N);const j=flarum.core.compat["common/helpers/icon"];var k=o.n(j);const M=flarum.core.compat["common/utils/extractText"];var B=o.n(M);const D=flarum.core.compat["common/utils/classList"];var I=o.n(D);const A=flarum.core.compat["common/Component"];var R=function(o){function t(){return o.apply(this,arguments)||this}return x(t,o),t.prototype.view=function(){return m("button",{className:"SubscriptionMenuItem hasIcon",onclick:this.attrs.onclick},this.attrs.active?k()("fas fa-check",{className:"Button-icon"}):"",m("span",{className:"SubscriptionMenuItem-label"},k()(this.attrs.icon,{className:"Button-icon"}),m("strong",null,this.attrs.label),m("span",{className:"SubscriptionMenuItem-description"},this.attrs.description)))},t}(o.n(A)()),T=function(o){function t(){return o.apply(this,arguments)||this}x(t,o);var n=t.prototype;return n.oninit=function(t){o.prototype.oninit.call(this,t),this.options=[{subscription:null,icon:"far fa-star",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.not_following_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.not_following_text")},{subscription:"follow",icon:"fas fa-star",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.following_text")},{subscription:"ignore",icon:"far fa-eye-slash",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_text")}]},n.view=function(){var o=this,t=this.attrs.discussion,n=t.subscription(),s=r().translator.trans("flarum-subscriptions.forum.sub_controls.follow_button"),i="far fa-star",e="SubscriptionMenu-button--"+n;switch(n){case"follow":s=r().translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),i="fas fa-star";break;case"ignore":s=r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_button"),i="far fa-eye-slash"}var a=r().session.user.preferences(),c=a.notify_newPost_email,l=a.notify_newPost_alert,u=B()(r().translator.trans(c?"flarum-subscriptions.forum.sub_controls.notify_email_tooltip":"flarum-subscriptions.forum.sub_controls.notify_alert_tooltip")),f=(c||l)&&null===n,p=m(d(),{className:I()("Button","SubscriptionMenu-button",e),icon:i,onclick:this.saveSubscription.bind(this,t,-1!==["follow","ignore"].indexOf(n)?null:"follow")},s);return m("div",{className:"Dropdown ButtonGroup SubscriptionMenu"},f?m(O(),{text:u,position:"bottom"},p):p,m("button",{className:I()("Dropdown-toggle Button Button--icon",e),"data-toggle":"dropdown"},k()("fas fa-caret-down",{className:"Button-icon"})),m("ul",{className:"Dropdown-menu dropdown-menu Dropdown-menu--right"},this.options.map((function(s){return m("li",null,R.component(v({},s,{onclick:o.saveSubscription.bind(o,t,s.subscription),active:n===s.subscription})))}))))},n.saveSubscription=function(o,t){o.save({subscription:t}),this.$(".SubscriptionMenu-button").tooltip("hide")},t}(S());const L=flarum.core.compat["common/components/LinkButton"];var C=o.n(L);const q=flarum.core.compat["forum/components/IndexPage"];var F=o.n(q);const G=flarum.core.compat["forum/states/DiscussionListState"];var z=o.n(G);const U=flarum.core.compat["forum/states/GlobalSearchState"];var $=o.n(U);const E=flarum.core.compat["forum/components/SettingsPage"];var H=o.n(E);const J=flarum.core.compat["common/components/Switch"];var K=o.n(J);const Q=flarum.core.compat["forum/components/Notification"];var V=function(o){function t(){return o.apply(this,arguments)||this}x(t,o);var n=t.prototype;return n.icon=function(){return"fas fa-star"},n.href=function(){var o=this.attrs.notification,t=o.subject(),n=o.content()||{};return r().route.discussion(t,n.postNumber)},n.content=function(){return r().translator.trans("flarum-subscriptions.forum.notifications.new_post_text",{user:this.attrs.notification.fromUser()})},t}(o.n(Q)());const W=flarum.core.compat["common/extenders"],X=[(new(o.n(W)().Routes)).add("following","/following",F())];r().initializers.add("subscriptions",(function(){r().notificationComponents.newPost=V,c().prototype.subscription=e().attribute("subscription"),(0,n.extend)(c().prototype,"badges",(function(o){var t;switch(this.subscription()){case"follow":t=p().component({label:r().translator.trans("flarum-subscriptions.forum.badge.following_tooltip"),icon:"fas fa-star",type:"following"});break;case"ignore":t=p().component({label:r().translator.trans("flarum-subscriptions.forum.badge.ignoring_tooltip"),icon:"far fa-eye-slash",type:"ignoring"})}t&&o.add("subscription",t)})),(0,n.extend)(y(),"userControls",(function(o,t,n){if(r().session.user&&!(n instanceof g())){var s={none:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.follow_button"),icon:"fas fa-star",save:"follow"},follow:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.unfollow_button"),icon:"far fa-star",save:null},ignore:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.unignore_button"),icon:"fas fa-eye",save:null}},i=t.subscription()||"none";o.add("subscription",d().component({icon:s[i].icon,onclick:t.save.bind(t,{subscription:s[i].save})},s[i].label))}})),(0,n.extend)(g().prototype,"sidebarItems",(function(o){if(r().session.user){var t=this.discussion;o.add("subscription",T.component({discussion:t}),80)}})),(0,n.extend)(F().prototype,"navItems",(function(o){if(r().session.user){var t=r().search.stickyParams();o.add("following",C().component({href:r().route("following",t),icon:"fas fa-star"},r().translator.trans("flarum-subscriptions.forum.index.following_link")),50)}})),(0,n.extend)(F().prototype,"setTitle",(function(){"following"===r().current.get("routeName")&&r().setTitle(r().translator.trans("flarum-subscriptions.forum.following.meta_title_text"))})),(0,n.extend)($().prototype,"params",(function(o){o.onFollowing="following"===r().current.get("routeName")})),(0,n.extend)(z().prototype,"requestParams",(function(o){this.params.onFollowing&&(o.filter||(o.filter={}),o.filter.q?o.filter.q+=" is:following":o.filter.subscription="following")})),(0,n.extend)(H().prototype,"notificationsItems",(function(o){var t,n=this;o.add("followAfterReply",K().component({state:this.user.preferences().followAfterReply,onchange:function(o){n.followAfterReplyLoading=!0,n.user.savePreferences({followAfterReply:o}).then((function(){n.followAfterReplyLoading=!1,m.redraw()}))},loading:this.followAfterReplyLoading},r().translator.trans("flarum-subscriptions.forum.settings.follow_after_reply_label"))),o.add("notifyForAllPosts",m(K(),{id:"flarum_subscriptions__notify_for_all_posts",state:!(null==(t=this.user.preferences())||!t["flarum-subscriptions.notify_for_all_posts"]),onchange:function(o){n.user.savePreferences({"flarum-subscriptions.notify_for_all_posts":o})}},r().translator.trans("flarum-subscriptions.forum.settings.notify_for_all_posts_label")))})),(0,n.extend)(u().prototype,"notificationTypes",(function(o){o.add("newPost",{name:"newPost",icon:"fas fa-star",label:r().translator.trans("flarum-subscriptions.forum.settings.notify_new_post_label")})}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map