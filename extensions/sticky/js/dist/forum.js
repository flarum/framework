(()=>{var t={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return t.d(s,{a:s}),s},d:(o,s)=>{for(var c in s)t.o(s,c)&&!t.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:s[c]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{extend:()=>L});const s=flarum.core.compat["forum/app"];var c=t.n(s);const e=flarum.core.compat["common/extend"],n=flarum.core.compat["common/models/Discussion"];var r=t.n(n);const a=flarum.core.compat["common/components/Badge"];var i=t.n(a);const u=flarum.core.compat["forum/utils/DiscussionControls"];var l=t.n(u);const d=flarum.core.compat["forum/components/DiscussionPage"];var f=t.n(d);const p=flarum.core.compat["common/components/Button"];var y=t.n(p);const k=flarum.core.compat["forum/states/DiscussionListState"];var v=t.n(k);const b=flarum.core.compat["forum/components/DiscussionListItem"];var h=t.n(b);const S=flarum.core.compat["forum/components/IndexPage"];var x=t.n(S);const P=flarum.core.compat["common/utils/string"],_=flarum.core.compat["common/utils/classList"];var g=t.n(_);const D=flarum.core.compat["common/extenders"];var O=t.n(D);const j=flarum.core.compat["forum/components/EventPost"];var w=t.n(j);class I extends(w()){icon(){return"fas fa-thumbtack"}descriptionKey(){return this.attrs.post.content().sticky?"flarum-sticky.forum.post_stream.discussion_stickied_text":"flarum-sticky.forum.post_stream.discussion_unstickied_text"}}const L=[(new(O().PostTypes)).add("discussionStickied",I),new(O().Model)(r()).attribute("isSticky").attribute("canSticky")];c().initializers.add("flarum-sticky",(()=>{(0,e.extend)(r().prototype,"badges",(function(t){this.isSticky()&&t.add("sticky",m(i(),{type:"sticky",label:c().translator.trans("flarum-sticky.forum.badge.sticky_tooltip"),icon:"fas fa-thumbtack"}),10)})),(0,e.extend)(l(),"moderationControls",(function(t,o){o.canSticky()&&t.add("sticky",m(y(),{icon:"fas fa-thumbtack",onclick:this.stickyAction.bind(o)},c().translator.trans("flarum-sticky.forum.discussion_controls.".concat(o.isSticky()?"unsticky":"sticky","_button"))))})),l().stickyAction=function(){this.save({isSticky:!this.isSticky()}).then((()=>{c().current.matches(f())&&c().current.get("stream").update(),m.redraw()}))},(0,e.extend)(v().prototype,"requestParams",(function(t){(c().current.matches(x())||c().current.matches(f()))&&t.include.push("firstPost")})),(0,e.extend)(h().prototype,"infoItems",(function(t){const o=this.attrs.discussion;if(o.isSticky()&&!this.attrs.params.q&&!o.lastReadPostNumber()){const s=o.firstPost();if(s){const o=(0,P.truncate)(s.contentPlain(),175);t.add("excerpt",m("div",null,o),-100)}}})),(0,e.extend)(h().prototype,"elementAttrs",(function(t){this.attrs.discussion.isSticky()&&(t.className=g()(t.className,"DiscussionListItem--sticky"))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map