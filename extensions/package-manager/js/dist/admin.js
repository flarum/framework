(()=>{var t={3:function(t){t.exports=function(){"use strict";var t,n,e=1e3,a=6e4,s=36e5,r=864e5,o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,l=2592e6,u=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,m={years:i,months:l,days:r,hours:s,minutes:a,seconds:e,milliseconds:1,weeks:6048e5},c=function(t){return t instanceof b},d=function(t,n,e){return new b(t,e,n.$l)},p=function(t){return n.p(t)+"s"},f=function(t){return t<0},h=function(t){return f(t)?Math.ceil(t):Math.floor(t)},g=function(t){return Math.abs(t)},x=function(t,n){return t?f(t)?{negative:!0,format:""+g(t)+n}:{negative:!1,format:""+t+n}:{negative:!1,format:""}},b=function(){function f(t,n,e){var a=this;if(this.$d={},this.$l=e,void 0===t&&(this.$ms=0,this.parseFromMilliseconds()),n)return d(t*m[p(n)],this);if("number"==typeof t)return this.$ms=t,this.parseFromMilliseconds(),this;if("object"==typeof t)return Object.keys(t).forEach((function(n){a.$d[p(n)]=t[n]})),this.calMilliseconds(),this;if("string"==typeof t){var s=t.match(u);if(s){var r=s.slice(2).map((function(t){return null!=t?Number(t):0}));return this.$d.years=r[0],this.$d.months=r[1],this.$d.weeks=r[2],this.$d.days=r[3],this.$d.hours=r[4],this.$d.minutes=r[5],this.$d.seconds=r[6],this.calMilliseconds(),this}}return this}var g=f.prototype;return g.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce((function(n,e){return n+(t.$d[e]||0)*m[e]}),0)},g.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=h(t/i),t%=i,this.$d.months=h(t/l),t%=l,this.$d.days=h(t/r),t%=r,this.$d.hours=h(t/s),t%=s,this.$d.minutes=h(t/a),t%=a,this.$d.seconds=h(t/e),t%=e,this.$d.milliseconds=t},g.toISOString=function(){var t=x(this.$d.years,"Y"),n=x(this.$d.months,"M"),e=+this.$d.days||0;this.$d.weeks&&(e+=7*this.$d.weeks);var a=x(e,"D"),s=x(this.$d.hours,"H"),r=x(this.$d.minutes,"M"),o=this.$d.seconds||0;this.$d.milliseconds&&(o+=this.$d.milliseconds/1e3);var i=x(o,"S"),l=t.negative||n.negative||a.negative||s.negative||r.negative||i.negative,u=s.format||r.format||i.format?"T":"",m=(l?"-":"")+"P"+t.format+n.format+a.format+u+s.format+r.format+i.format;return"P"===m||"-P"===m?"P0D":m},g.toJSON=function(){return this.toISOString()},g.format=function(t){var e=t||"YYYY-MM-DDTHH:mm:ss",a={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return e.replace(o,(function(t,n){return n||String(a[t])}))},g.as=function(t){return this.$ms/m[p(t)]},g.get=function(t){var n=this.$ms,e=p(t);return"milliseconds"===e?n%=1e3:n="weeks"===e?h(n/m[e]):this.$d[e],0===n?0:n},g.add=function(t,n,e){var a;return a=n?t*m[p(n)]:c(t)?t.$ms:d(t,this).$ms,d(this.$ms+a*(e?-1:1),this)},g.subtract=function(t,n){return this.add(t,n,!0)},g.locale=function(t){var n=this.clone();return n.$l=t,n},g.clone=function(){return d(this.$ms,this)},g.humanize=function(n){return t().add(this.$ms,"ms").locale(this.$l).fromNow(!n)},g.milliseconds=function(){return this.get("milliseconds")},g.asMilliseconds=function(){return this.as("milliseconds")},g.seconds=function(){return this.get("seconds")},g.asSeconds=function(){return this.as("seconds")},g.minutes=function(){return this.get("minutes")},g.asMinutes=function(){return this.as("minutes")},g.hours=function(){return this.get("hours")},g.asHours=function(){return this.as("hours")},g.days=function(){return this.get("days")},g.asDays=function(){return this.as("days")},g.weeks=function(){return this.get("weeks")},g.asWeeks=function(){return this.as("weeks")},g.months=function(){return this.get("months")},g.asMonths=function(){return this.as("months")},g.years=function(){return this.get("years")},g.asYears=function(){return this.as("years")},f}();return function(e,a,s){t=s,n=s().$utils(),s.duration=function(t,n){var e=s.locale();return d(t,{$l:e},n)},s.isDuration=c;var r=a.prototype.add,o=a.prototype.subtract;a.prototype.add=function(t,n){return c(t)&&(t=t.asMilliseconds()),r.bind(this)(t,n)},a.prototype.subtract=function(t,n){return c(t)&&(t=t.asMilliseconds()),o.bind(this)(t,n)}}}()}},n={};function e(a){var s=n[a];if(void 0!==s)return s.exports;var r=n[a]={exports:{}};return t[a].call(r.exports,r,r.exports,e),r.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";e.r(a);const t=flarum.core.compat["common/extend"],n=flarum.core.compat["admin/app"];var s=e.n(n);const r=flarum.core.compat["admin/components/ExtensionPage"];var o=e.n(r);const i=flarum.core.compat["common/components/Button"];var l=e.n(i);const u=flarum.core.compat["admin/components/LoadingModal"];var c=e.n(u);const d=flarum.core.compat["admin/utils/isExtensionEnabled"];var p=e.n(d);function f(t,n){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},f(t,n)}function h(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,f(t,n)}function g(t,n){if(null==t)return{};var e,a,s={},r=Object.keys(t);for(a=0;a<r.length;a++)e=r[a],n.indexOf(e)>=0||(s[e]=t[e]);return s}const x=flarum.core.compat["common/Component"];var b=e.n(x);const v=flarum.core.compat["common/components/LoadingIndicator"];var y=e.n(v);const _=flarum.core.compat["common/components/Tooltip"];var k=e.n(_);const N=flarum.core.compat["common/helpers/icon"];var M=e.n(N);const w=flarum.core.compat["common/utils/ItemList"];var E=e.n(w);const U=flarum.core.compat["common/utils/extractText"];var B=e.n(U);const S=flarum.core.compat["common/components/Link"];var q=e.n(S);const j=flarum.core.compat["common/utils/classList"];var $=e.n(j),P=["className","type"],T=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.view=function(t){var n=this.attrs,e=n.className,a=(n.type,g(n,P));return m("span",Object.assign({className:$()(["Label","Label--"+this.attrs.type,e])},a),t.children)},n}(b());const C=flarum.core.compat["common/components/Modal"];var O=e.n(C),F=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.className=function(){return"Modal--large QuickModal"},e.title=function(){return s().translator.trans("flarum-extension-manager.admin.sections.queue.operations."+this.attrs.task.operation())},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"TaskOutputModal-data"},"failure"===this.attrs.task.status()&&m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.sections.queue.output_modal.guessed_cause")),m("div",{className:"FormControl TaskOutputModal-data-guessed-cause"},this.attrs.task.guessedCause()&&s().translator.trans("flarum-extension-manager.admin.exceptions.guessed_cause."+this.attrs.task.guessedCause())||s().translator.trans("flarum-extension-manager.admin.sections.queue.output_modal.cause_unknown"))),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.sections.queue.output_modal.command")),m("div",{className:"FormControl TaskOutputModal-data-command"},m("code",null,"$ composer ",this.attrs.task.command()))),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.sections.queue.output_modal.output")),m("div",{className:"FormControl TaskOutputModal-data-output"},m("code",null,m("pre",null,this.attrs.task.output()))))))},n}(O()),A=e(3),L=e.n(A),D=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.view=function(){var t=this;return m("nav",{className:"Pagination UserListPage-gridPagination"},m(l(),{disabled:!this.attrs.list.hasPrev()||s().extensionManager.control.isLoading(),title:s().translator.trans("core.admin.users.pagination.back_button"),onclick:function(){return t.attrs.list.prev()},icon:"fas fa-chevron-left",className:"Button Button--icon UserListPage-backBtn"}),m("span",{className:"UserListPage-pageNumber"},s().translator.trans("core.admin.users.pagination.page_counter",{current:this.attrs.list.pageNumber()+1,total:this.attrs.list.getTotalPages()})),m(l(),{disabled:!this.attrs.list.hasNext()||s().extensionManager.control.isLoading(),title:s().translator.trans("core.admin.users.pagination.next_button"),onclick:function(){return t.attrs.list.next()},icon:"fas fa-chevron-right",className:"Button Button--icon UserListPage-nextBtn"}))},n}(b()),Y=["label","content"],I=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),s().extensionManager.queue.load()},e.view=function(){return m("section",{id:"ExtensionManager-queueSection",className:"ExtensionPage-permissions ExtensionManager-queueSection"},m("div",{className:"ExtensionPage-permissions-header ExtensionManager-queueSection-header"},m("div",{className:"container"},m("h2",{className:"ExtensionTitle"},s().translator.trans("flarum-extension-manager.admin.sections.queue.title")),m(l(),{className:"Button Button--icon",icon:"fas fa-sync-alt",onclick:function(){return s().extensionManager.queue.load()},"aria-label":s().translator.trans("flarum-extension-manager.admin.sections.queue.refresh"),disabled:s().extensionManager.control.isLoading()}))),m("div",{className:"container"},this.queueTable()))},e.columns=function(){var t=this,n=new(E());return n.add("operation",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.operation")),content:function(n){return m("div",{className:"ExtensionManager-queueTable-operation"},m("span",{className:"ExtensionManager-queueTable-operation-icon"},t.operationIcon(n.operation())),m("span",{className:"ExtensionManager-queueTable-operation-name"},s().translator.trans("flarum-extension-manager.admin.sections.queue.operations."+n.operation())))}},80),n.add("package",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.package")),content:function(t){var n,e=s().data.extensions[null==(n=t.package())?void 0:n.replace(/(\/flarum-|\/flarum-ext-|\/)/g,"-")];return e?m(q(),{className:"ExtensionManager-queueTable-package",href:s().route("extension",{id:e.id})},m("div",{className:"ExtensionManager-queueTable-package-icon ExtensionIcon",style:e.icon},!!e.icon&&M()(e.icon.name)),m("div",{className:"ExtensionManager-queueTable-package-details"},m("span",{className:"ExtensionManager-queueTable-package-title"},e.extra["flarum-extension"].title),m("span",{className:"ExtensionManager-queueTable-package-name"},t.package()))):t.package()}},75),n.add("status",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.status")),content:function(t){return m("[",null,m(T,{className:"ExtensionManager-queueTable-status",type:{running:"neutral",failure:"error",pending:"warning",success:"success"}[t.status()]},s().translator.trans("flarum-extension-manager.admin.sections.queue.statuses."+t.status())),["pending","running"].includes(t.status())&&m(y(),{size:"small",display:"inline"}))}},70),n.add("elapsedTime",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.elapsed_time")),content:function(t){return t.startedAt()&&t.finishedAt()?m(k(),{text:dayjs(t.startedAt()).format("LL LTS")+"  "+dayjs(t.finishedAt()).format("LL LTS")},m("span",null,function(t,n){dayjs.extend(L());var e=dayjs(n).diff(t);return dayjs.duration(e).humanize()}(t.startedAt(),t.finishedAt()))):s().translator.trans("flarum-extension-manager.admin.sections.queue.task_just_started")}},65),n.add("memoryUsed",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.peak_memory_used")),content:function(t){return m("span",null,t.peakMemoryUsed())}},60),n.add("details",{label:B()(s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.details")),content:function(t){return m(l(),{className:"Button Button--icon Table-controls-item",icon:"fas fa-file-alt","aria-label":s().translator.trans("flarum-extension-manager.admin.sections.queue.columns.details"),onclick:function(){return s().modal.show(F,{task:t})},disabled:["pending","running"].includes(t.status())})},className:"Table-controls"},55),n},e.queueTable=function(){var t=s().extensionManager.queue.getItems();if(!t)return m(y(),null);if(t&&!t.length)return m("h3",{className:"ExtensionPage-subHeader"},s().translator.trans("flarum-extension-manager.admin.sections.queue.none"));var n=this.columns();return m("[",null,m("table",{className:"Table ExtensionManager-queueTable"},m("thead",null,m("tr",null,n.toArray().map((function(t,n){return m("th",{key:n},t.label)})))),m("tbody",null,t.map((function(t,e){return m("tr",{key:e},n.toArray().map((function(n,e){n.label;var a=n.content,s=g(n,Y);return m("td",Object.assign({key:e},s),a(t))})))})))),m(D,{list:s().extensionManager.queue}))},e.operationIcon=function(t){return M()({update_check:"fas fa-sync-alt",update_major:"fas fa-play",update_minor:"fas fa-play",update_global:"fas fa-play",extension_install:"fas fa-download",extension_remove:"fas fa-times",extension_update:"fas fa-arrow-alt-circle-up",why_not:"fas fa-exclamation-circle"}[t])},n}(b());const R=flarum.core.compat["common/components/Alert"];var G=e.n(R);const H=flarum.core.compat["common/utils/Stream"];var W=e.n(H),V=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).packageName=void 0,n}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.packageName=W()("")},e.view=function(){return m("div",{className:"Form-group ExtensionManager-installer"},m("label",{htmlFor:"install-extension"},s().translator.trans("flarum-extension-manager.admin.extensions.install")),m("p",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.extensions.install_help",{extiverse:m("a",{href:"https://extiverse.com"},"extiverse.com"),semantic_link:m("a",{href:"https://devhints.io/semver"}),code:m("code",null)})),m("div",{className:"FormControl-container"},m("input",{className:"FormControl",id:"install-extension",placeholder:"vendor/package-name",bidi:this.packageName}),m(l(),{className:"Button",icon:"fas fa-download",onclick:this.onsubmit.bind(this),loading:s().extensionManager.control.isLoading("extension-install"),disabled:s().extensionManager.control.hasOperationRunning()},s().translator.trans("flarum-extension-manager.admin.extensions.proceed"))))},e.data=function(){return{package:this.packageName()}},e.onsubmit=function(){s().extensionManager.control.requirePackage(this.data())},n}(b());const J=flarum.core.compat["common/helpers/humanTime"];var Z=e.n(J);function z(t){s().extensionManager.control.setLoading(null);var n=t.response.errors[0];if(!["composer_command_failure","extension_already_installed","extension_not_installed"].includes(n.code))throw t;switch(s().alerts.clear(),n.code){case"composer_command_failure":n.guessed_cause?(s().alerts.show({type:"error"},s().translator.trans("flarum-extension-manager.admin.exceptions.guessed_cause."+n.guessed_cause)),s().modal.close()):s().alerts.show({type:"error"},s().translator.trans("flarum-extension-manager.admin.exceptions.composer_command_failure"));break;case"extension_already_installed":s().alerts.show({type:"error"},s().translator.trans("flarum-extension-manager.admin.exceptions.extension_already_installed")),s().modal.close();break;case"extension_not_installed":s().alerts.show({type:"error"},s().translator.trans("flarum-extension-manager.admin.exceptions.extension_not_installed")),s().modal.close()}}var Q=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).loading=!0,n.whyNot=null,n}h(n,t);var e=n.prototype;return e.className=function(){return"Modal--large WhyNotModal"},e.title=function(){return s().translator.trans("flarum-extension-manager.admin.why_not_modal.title")},e.oncreate=function(n){t.prototype.oncreate.call(this,n),this.requestWhyNot()},e.content=function(){return m("div",{className:"Modal-body"},this.loading?m(y(),null):m("pre",{className:"WhyNotModal-contents"},this.whyNot))},e.requestWhyNot=function(){var t=this;s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/why-not",body:{data:{package:this.attrs.package}}}).then((function(n){t.loading=!1,t.whyNot=n.data.reason,m.redraw()})).catch(z)},n}(O());const K=flarum.core.compat["common/components/Dropdown"];var X=e.n(K),tt=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.view=function(t){var n,e=this.attrs,a=e.extension,r=e.updates,o=e.onClickUpdate,i=e.whyNotWarning,u=e.isCore,c=e.isDanger,d=null!=(n=r["latest-minor"])?n:r["latest-major"]&&!u?r["latest-major"]:null;return m("div",{className:$()({"ExtensionManager-extension":!0,"ExtensionManager-extension--core":u,"ExtensionManager-extension--danger":c})},m("div",{className:"ExtensionManager-extension-icon ExtensionIcon",style:a.icon},a.icon?M()(a.icon.name):""),m("div",{className:"ExtensionManager-extension-info"},m("div",{className:"ExtensionManager-extension-name"},a.extra["flarum-extension"].title),m("div",{className:"ExtensionManager-extension-version"},m("span",{className:"ExtensionManager-extension-version-current"},this.version(r.version)),d?m(T,{className:"ExtensionManager-extension-version-latest",type:r["latest-minor"]?"success":"warning"},this.version(d)):null)),m("div",{className:"ExtensionManager-extension-controls"},o&&"function"==typeof o?m(k(),{text:s().translator.trans("flarum-extension-manager.admin.extensions.update")},m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button Button--icon Button--flat",onclick:o,"aria-label":s().translator.trans("flarum-extension-manager.admin.extensions.update")})):o?m(X(),{buttonClassName:"Button Button--icon Button--flat",icon:"fas fa-arrow-alt-circle-up",label:s().translator.trans("flarum-extension-manager.admin.extensions.update")},m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button",onclick:o.soft},s().translator.trans("flarum-extension-manager.admin.extensions.update_soft_label")),m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button",onclick:o.hard,disabled:!r["direct-dependency"]},s().translator.trans("flarum-extension-manager.admin.extensions.update_hard_label"))):null,i?m(k(),{text:s().translator.trans("flarum-extension-manager.admin.extensions.check_why_it_failed_updating")},m(l(),{icon:"fas fa-exclamation-circle",className:"Button Button--icon Button--flat Button--danger",onclick:function(){return s().modal.show(Q,{package:a.name})},"aria-label":s().translator.trans("flarum-extension-manager.admin.extensions.check_why_it_failed_updating")})):null))},e.version=function(t){return"v"===t.charAt(0)?t.substring(1):t},n}(b()),nt=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).updateState=void 0,n}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.updateState=this.attrs.updateState},e.view=function(){return m("div",{className:$()("Form-group Form-group--danger ExtensionManager-majorUpdate",{"ExtensionManager-majorUpdate--failed":"failure"===this.updateState.status,"ExtensionManager-majorUpdate--incompatibleExtensions":this.updateState.incompatibleExtensions.length})},m("img",{alt:"flarum logo",src:s().forum.attribute("baseUrl")+"/assets/extensions/flarum-extension-manager/flarum.svg"}),m("label",null,s().translator.trans("flarum-extension-manager.admin.major_updater.title",{version:this.attrs.coreUpdate["latest-major"]})),m("p",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.major_updater.description")),m("div",{className:"ExtensionManager-updaterControls"},m(k(),{text:s().translator.trans("flarum-extension-manager.admin.major_updater.dry_run_help")},m(l(),{className:"Button",icon:"fas fa-vial",onclick:this.update.bind(this,!0),disabled:s().extensionManager.control.hasOperationRunning()},s().translator.trans("flarum-extension-manager.admin.major_updater.dry_run"))),m(l(),{className:"Button Button--danger",icon:"fas fa-play",onclick:this.update.bind(this,!1),disabled:s().extensionManager.control.hasOperationRunning()},s().translator.trans("flarum-extension-manager.admin.major_updater.update"))),this.updateState.incompatibleExtensions.length?m("div",{className:"ExtensionManager-majorUpdate-incompatibleExtensions ExtensionManager-extensions-grid"},this.updateState.incompatibleExtensions.map((function(t){return m(tt,{extension:s().data.extensions[t.replace("flarum-","").replace("flarum-ext-","").replace("/","-")],updates:{},onClickUpdate:null,isDanger:!0})}))):null,"failure"===this.updateState.status?m(G(),{type:"error",className:"ExtensionManager-majorUpdate-failure",dismissible:!1,controls:[m(l(),{className:"Button Button--text ExtensionManager-majorUpdate-failure-details",icon:"fas fa-question-circle",onclick:function(){return s().modal.show(Q,{package:"flarum/core"})}},s().translator.trans("flarum-extension-manager.admin.major_updater.failure.why"))]},m("p",{className:"ExtensionManager-majorUpdate-failure-desc"},s().translator.trans("flarum-extension-manager.admin.major_updater.failure.desc"))):null)},e.update=function(t){s().extensionManager.control.majorUpdate({dryRun:t})},n}(b()),et=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.view=function(){var t=s().extensionManager.control.coreUpdate;return[m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.updater.updater_title")),m("p",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.updater.updater_help")),this.lastUpdateCheckView(),m("div",{className:"ExtensionManager-updaterControls"},this.controlItems().toArray()),this.availableUpdatesView()),t&&t.package["latest-major"]?m(nt,{coreUpdate:t.package,updateState:s().extensionManager.control.lastUpdateRun.major}):null]},e.lastUpdateCheckView=function(){var t;return(null==(t=s().extensionManager.control.lastUpdateCheck)?void 0:t.checkedAt)&&m("p",{className:"ExtensionManager-lastUpdatedAt"},m("span",{className:"ExtensionManager-lastUpdatedAt-label"},s().translator.trans("flarum-extension-manager.admin.updater.last_update_checked_at")),m("span",{className:"ExtensionManager-lastUpdatedAt-value"},Z()(s().extensionManager.control.lastUpdateCheck.checkedAt)))||null},e.availableUpdatesView=function(){var t=s().extensionManager.control;if(s().extensionManager.control.isLoading("check")||s().extensionManager.control.isLoading("global-update"))return m("div",{className:"ExtensionManager-extensions"},m(y(),null));var n=t.coreUpdate&&t.coreUpdate.package["latest-minor"];return t.extensionUpdates.length||n?m("div",{className:"ExtensionManager-extensions"},m("div",{className:"ExtensionManager-extensions-grid"},n?m(tt,{extension:t.coreUpdate.extension,updates:t.coreUpdate.package,isCore:!0,onClickUpdate:function(){return t.updateCoreMinor()},whyNotWarning:t.lastUpdateRun.limitedPackages().includes("flarum/core")}):null,t.extensionUpdates.map((function(n){return m(tt,{extension:n,updates:t.packageUpdates[n.id],onClickUpdate:{soft:function(){return t.updateExtension(n,"soft")},hard:function(){return t.updateExtension(n,"hard")}},whyNotWarning:t.lastUpdateRun.limitedPackages().includes(n.name)})})))):m("div",{className:"ExtensionManager-extensions"},m("span",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.updater.up_to_date")))},e.controlItems=function(){var t=new(E());return t.add("updateCheck",m(l(),{className:"Button",icon:"fas fa-sync-alt",onclick:function(){return s().extensionManager.control.checkForUpdates()},loading:s().extensionManager.control.isLoading("check"),disabled:s().extensionManager.control.hasOperationRunning()},s().translator.trans("flarum-extension-manager.admin.updater.check_for_updates")),100),t.add("globalUpdate",m(l(),{className:"Button",icon:"fas fa-play",onclick:function(){return s().extensionManager.control.updateGlobally()},loading:s().extensionManager.control.isLoading("global-update"),disabled:s().extensionManager.control.hasOperationRunning()},s().translator.trans("flarum-extension-manager.admin.updater.run_global_update"))),t},n}(b()),at=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n)},e.view=function(){return m("div",{className:"ExtensionPage-permissions ExtensionManager-controlSection"},m("div",{className:"ExtensionPage-permissions-header"},m("div",{className:"container"},m("h2",{className:"ExtensionTitle"},s().translator.trans("flarum-extension-manager.admin.sections.control.title")))),m("div",{className:"container"},s().data["flarum-extension-manager.writable_dirs"]?m("[",null,m(V,null),m(et,null)):m("div",{className:"Form-group"},m(G(),{type:"warning",dismissible:!1},s().translator.trans("flarum-extension-manager.admin.file_permissions")))))},n}(b());function st(){return st=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},st.apply(this,arguments)}const rt=flarum.core.compat["admin/components/AdminPage"];var ot=e.n(rt),it=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).settings={},n.initialSettings=null,n.loading=!1,n.type=void 0,n}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.submit(!0)},e.className=function(){return""},e.view=function(){return m("div",{className:$()("Form",this.className())},m("label",null,this.title()),this.content(),m("div",{className:"Form-group Form--controls"},this.submitButton()))},e.submitButton=function(){var t=this;return[m(l(),{className:"Button Button--primary",loading:this.loading,onclick:function(){return t.submit(!1)},disabled:!this.isDirty()},s().translator.trans("core.admin.settings.submit_button"))]},e.customSettingComponents=function(){return ot().prototype.customSettingComponents()},e.setting=function(t){var n;return null!=(n=this.settings[t])?n:this.settings[t]=W()()},e.submit=function(t){var n=this;this.loading=!0;var e={};Object.keys(this.settings).forEach((function(t){e[t]=n.settings[t]()})),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/composer",body:{type:this.type,data:t?null:e}}).then((function(t){var e=t.data;Object.keys(e).forEach((function(t){n.settings[t]=W()(e[t])})),n.initialSettings=Array.isArray(e)?{}:e})).finally((function(){n.loading=!1,m.redraw()}))},e.isDirty=function(){return JSON.stringify(this.initialSettings)!==JSON.stringify(this.settings)},n}(b());const lt=flarum.core.compat["common/components/Select"];var ut=e.n(lt),mt=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).name=void 0,n.repository=void 0,n}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.name=W()(this.attrs.name||""),this.repository=W()(this.attrs.repository||{type:"composer",url:""})},e.className=function(){return"RepositoryModal Modal--small"},e.title=function(){var t=this.attrs.repository?"edit":"add";return s().translator.trans("flarum-extension-manager.admin.composer."+t+"_repository_label")},e.content=function(){var t=this,n={composer:s().translator.trans("flarum-extension-manager.admin.composer.repositories.types.composer"),vcs:s().translator.trans("flarum-extension-manager.admin.composer.repositories.types.vcs"),path:s().translator.trans("flarum-extension-manager.admin.composer.repositories.types.path")};return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.composer.repositories.add_modal.name_label")),m("input",{className:"FormControl",bidi:this.name})),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.composer.repositories.add_modal.type_label")),m(ut(),{options:n,value:this.repository().type,onchange:function(n){return t.repository(st({},t.repository(),{type:n}))}})),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.composer.repositories.add_modal.url")),m("input",{className:"FormControl",onchange:function(n){return t.repository(st({},t.repository(),{url:n.target.value}))},value:this.repository().url})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",onclick:this.submit.bind(this)},s().translator.trans("flarum-extension-manager.admin.composer.repositories.add_modal.submit_button"))))},e.submit=function(){this.attrs.onsubmit(this.repository(),this.name()),this.hide()},n}(O()),ct=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).type="composer",n}h(n,t);var e=n.prototype;return e.title=function(){return s().translator.trans("flarum-extension-manager.admin.composer.title")},e.className=function(){return"ConfigureComposer"},e.content=function(){var t=this;return m("div",{className:"ExtensionManager-SettingsGroups-content"},this.attrs.buildSettingComponent.call(this,{setting:"minimum-stability",label:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.label"),help:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.help"),type:"select",options:{stable:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.options.stable"),RC:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.options.rc"),beta:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.options.beta"),alpha:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.options.alpha"),dev:s().translator.trans("flarum-extension-manager.admin.composer.minimum_stability.options.dev")}}),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.composer.repositories.label")),m("div",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.composer.repositories.help")),m("div",{className:"ConfigureComposer-repositories"},Object.keys(this.setting("repositories")()||{}).map((function(n){var e=t.setting("repositories")()[n];return m("div",{className:"ButtonGroup ButtonGroup--full"},m(l(),{className:"Button",icon:{composer:"fas fa-cubes",vcs:"fas fa-code-branch",path:"fas fa-folder"}[e.type],onclick:function(){return s().modal.show(mt,{name:n,repository:e,onsubmit:function(e,a){var s=t.setting("repositories")();delete s[n],t.setting("repositories")(s),t.onchange(e,a)}})}},n," (",e.type,")"),m(l(),{className:"Button Button--icon",icon:"fas fa-trash","aria-label":s().translator.trans("flarum-extension-manager.admin.composer.delete_repository_label"),onclick:function(){if(confirm(B()(s().translator.trans("flarum-extension-manager.admin.composer.delete_repository_confirmation")))){var e=st({},t.setting("repositories")());delete e[n],t.setting("repositories")(e)}}}))})))))},e.submitButton=function(){var n=this,e=t.prototype.submitButton.call(this);return e.push(m(l(),{className:"Button",onclick:function(){return s().modal.show(mt,{onsubmit:n.onchange.bind(n)})}},s().translator.trans("flarum-extension-manager.admin.composer.add_repository_label"))),e},e.onchange=function(t,n){var e;this.setting("repositories")(st({},this.setting("repositories")(),((e={})[n]=t,e)))},n}(it);const dt=flarum.core.compat["common/helpers/listItems"];var pt=e.n(dt),ft=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).type=void 0,n.host=void 0,n.token=void 0,n}h(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.type=W()(this.attrs.type||"bearer"),this.host=W()(this.attrs.host||""),this.token=W()(this.attrs.token||"")},e.className=function(){return"AuthMethodModal Modal--small"},e.title=function(){var t=this.attrs.host?"edit":"add";return s().translator.trans("flarum-extension-manager.admin.auth_config."+t+"_label")},e.content=function(){var t=this,n={"github-oauth":s().translator.trans("flarum-extension-manager.admin.auth_config.types.github-oauth"),"gitlab-oauth":s().translator.trans("flarum-extension-manager.admin.auth_config.types.gitlab-oauth"),"gitlab-token":s().translator.trans("flarum-extension-manager.admin.auth_config.types.gitlab-token"),bearer:s().translator.trans("flarum-extension-manager.admin.auth_config.types.bearer")};return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.type_label")),m(ut(),{options:n,value:this.type(),onchange:this.type})),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.host_label")),m("input",{className:"FormControl",bidi:this.host,placeholder:s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.host_placeholder")})),m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.token_label")),m("textarea",{className:"FormControl",oninput:function(n){return t.token(n.target.value)},rows:"6",placeholder:this.token().startsWith("unchanged:")?B()(s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.unchanged_token_placeholder")):""},this.token().startsWith("unchanged:")?"":this.token())),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",onclick:this.submit.bind(this)},s().translator.trans("flarum-extension-manager.admin.auth_config.add_modal.submit_button"))))},e.submit=function(){this.attrs.onsubmit(this.type(),this.host(),this.token()),this.hide()},n}(O()),ht=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return(n=t.call.apply(t,[this].concat(a))||this).type="auth",n}h(n,t);var e=n.prototype;return e.title=function(){return s().translator.trans("flarum-extension-manager.admin.auth_config.title")},e.className=function(){return"ConfigureAuth"},e.content=function(){var t=this,n=Object.keys(this.settings),e=n.length&&n.every((function(n){var e=t.settings[n]();return Array.isArray(e)?e.length:Object.keys(e).length}));return m("div",{className:"ExtensionManager-SettingsGroups-content"},e?n.map((function(n){var e=t.settings[n]();return m("div",{className:"Form-group"},m("label",null,s().translator.trans("flarum-extension-manager.admin.auth_config.types."+n)),m("div",{className:"ConfigureAuth-hosts"},Object.keys(e).map((function(a){var r=e[a];return m("div",{className:"ButtonGroup ButtonGroup--full"},m(l(),{className:"Button",icon:"fas fa-key",onclick:function(){return s().modal.show(ft,{type:n,host:a,token:r,onsubmit:t.onchange.bind(t,a)})}},a),m(l(),{className:"Button Button--icon",icon:"fas fa-trash","aria-label":s().translator.trans("flarum-extension-manager.admin.auth_config.delete_label"),onclick:function(){if(confirm(B()(s().translator.trans("flarum-extension-manager.admin.auth_config.delete_confirmation")))){var e=st({},t.setting(n)());delete e[a],Object.keys(e).length?t.setting(n)(e):delete t.settings[n]}}}))}))))})):m("span",{className:"helpText"},s().translator.trans("flarum-extension-manager.admin.auth_config.no_auth_methods_configured")))},e.submitButton=function(){var n=this,e=t.prototype.submitButton.call(this);return e.push(m(l(),{className:"Button",loading:this.loading,onclick:function(){return s().modal.show(ft,{onsubmit:n.onchange.bind(n,null)})}},s().translator.trans("flarum-extension-manager.admin.auth_config.add_label"))),e},e.onchange=function(t,n,e,a){var s=st({},this.setting(n)());t&&delete s[t],s[e]=a,this.setting(n)(s)},n}(it),gt=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.content=function(){var t=s().extensionData.getSettings(this.extension.id),n=[s().translator.trans("flarum-extension-manager.admin.settings.access_warning")];return s().data.debugEnabled&&n.push(s().translator.trans("flarum-extension-manager.admin.settings.debug_mode_warning")),m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"Form-group"},m(G(),{className:"ExtensionManager-primaryWarning",type:"warning",dismissible:!1},m("ul",null,pt()(n)))),t?m("div",{className:"ExtensionManager-SettingsGroups"},m("div",{className:"Form"},m("label",null,s().translator.trans("flarum-extension-manager.admin.settings.title")),m("div",{className:"SettingsGroups-content"},t.map(this.buildSettingComponent.bind(this))),m("div",{className:"Form-group Form--controls"},this.submitButton())),m(ct,{buildSettingComponent:this.buildSettingComponent}),m(ht,{buildSettingComponent:this.buildSettingComponent})):m("h3",{className:"ExtensionPage-subHeader"},s().translator.trans("core.admin.extension.no_settings"))))},e.sections=function(n){var e=t.prototype.sections.call(this,n);return e.setPriority("content",10),e.add("control",m(at,null),8),"0"!==s().data.settings["flarum-extension-manager.queue_jobs"]&&s().data.settings["flarum-extension-manager.queue_jobs"]&&e.add("queue",m(I,null),5),e.remove("permissions"),e},e.onsaved=function(){t.prototype.onsaved.call(this),m.redraw()},n}(o());const xt=flarum.core.compat["common/Model"];var bt=e.n(xt),vt=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],yt=["B","kiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],_t=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],kt=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],Nt=function(t,n,e){var a=t;return"string"==typeof n||Array.isArray(n)?a=t.toLocaleString(n,e):!0!==n&&void 0===e||(a=t.toLocaleString(void 0,e)),a},Mt=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var e=n.prototype;return e.status=function(){return bt().attribute("status").call(this)},e.operation=function(){return bt().attribute("operation").call(this)},e.command=function(){return bt().attribute("command").call(this)},e.package=function(){return bt().attribute("package").call(this)},e.output=function(){return bt().attribute("output").call(this)},e.guessedCause=function(){return bt().attribute("guessedCause").call(this)},e.createdAt=function(){return bt().attribute("createdAt",bt().transformDate).call(this)},e.startedAt=function(){return bt().attribute("startedAt",bt().transformDate).call(this)},e.finishedAt=function(){return bt().attribute("finishedAt",bt().transformDate).call(this)},e.peakMemoryUsed=function(){return function(t,n){if(!Number.isFinite(t))throw new TypeError("Expected a finite number, got "+typeof t+": "+t);var e=(n=st({bits:!1,binary:!1},n)).bits?n.binary?kt:_t:n.binary?yt:vt;if(n.signed&&0===t)return" 0 "+e[0];var a,s=t<0,r=s?"-":n.signed?"+":"";if(s&&(t=-t),void 0!==n.minimumFractionDigits&&(a={minimumFractionDigits:n.minimumFractionDigits}),void 0!==n.maximumFractionDigits&&(a=st({maximumFractionDigits:n.maximumFractionDigits},a)),t<1)return r+Nt(t,n.locale,a)+" "+e[0];var o=Math.min(Math.floor(n.binary?Math.log(t)/Math.log(1024):Math.log10(t)/3),e.length-1);return t/=Math.pow(n.binary?1024:1e3,o),a||(t=t.toPrecision(3)),r+Nt(Number(t),n.locale,a)+" "+e[o]}(1024*bt().attribute("peakMemoryUsed").call(this))},n}(bt());function wt(){s().modal.close(),m.route.set(s().route("extension",{id:"flarum-extension-manager"})),s().extensionManager.queue.load({},!0),setTimeout((function(){var t;null==(t=document.getElementById("ExtensionManager-queueSection"))||t.scrollIntoView({block:"nearest"})}),200)}window.jumpToQueue=wt;var Et=function(){function t(){this.polling=null,this.tasks=null,this.limit=20,this.offset=0,this.total=0}var n=t.prototype;return n.load=function(t,n){var e,a=this;return void 0===n&&(n=!1),this.tasks=null,t=st({page:st({limit:this.limit,offset:this.offset},null==(e=t)?void 0:e.page)},t),s().store.find("extension-manager-tasks",t||{}).then((function(t){var e;return a.tasks=t,a.total=null==(e=t.payload.meta)?void 0:e.total,m.redraw(),(null==t?void 0:t.find((function(t){return"pending"===t.status()||"running"===t.status()})))?a.pollQueue(n):n?(s().extensionManager.control.setLoading(null),window.location.reload()):s().extensionManager.control.isLoading()&&s().extensionManager.control.setLoading(null),t}))},n.getItems=function(){return this.tasks},n.getTotalPages=function(){return Math.ceil(this.total/this.limit)},n.pageNumber=function(){return Math.ceil(this.offset/this.limit)},n.hasPrev=function(){return 0!==this.pageNumber()},n.hasNext=function(){return this.offset+this.limit<this.total},n.prev=function(){this.hasPrev()&&(this.offset-=this.limit,this.load())},n.next=function(){this.hasNext()&&(this.offset+=this.limit,this.load())},n.pollQueue=function(t){var n=this;void 0===t&&(t=!1),this.polling&&clearTimeout(this.polling),this.polling=setTimeout((function(){n.load({},t)}),6e3)},n.hasPending=function(){var t;return!(null==(t=this.tasks)||!t.find((function(t){return"pending"===t.status()||"running"===t.status()})))},t}();function Ut(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var Bt=function(){function t(){this.loading=null,this.packageUpdates={},this.lastUpdateCheck=void 0,this.extensionUpdates=void 0,this.coreUpdate=null,this.lastUpdateCheck=JSON.parse(s().data.settings["flarum-extension-manager.last_update_check"]),this.extensionUpdates=this.formatExtensionUpdates(this.lastUpdateCheck),this.coreUpdate=this.formatCoreUpdate(this.lastUpdateCheck)}var n,e,a=t.prototype;return a.isLoading=function(t){return void 0===t&&(t=null),t&&this.loading===t||!t&&null!==this.loading},a.hasOperationRunning=function(){return this.isLoading()||s().extensionManager.queue.hasPending()},a.setLoading=function(t){this.loading=t},a.requirePackage=function(t){s().extensionManager.control.setLoading("extension-install"),s().modal.show(c()),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/extensions",body:{data:t}}).then((function(t){if(t.processing)wt();else{var n=t.id;s().alerts.show({type:"success"},s().translator.trans("flarum-extension-manager.admin.extensions.successful_install",{extension:n})),window.location.href=s().forum.attribute("adminUrl")+"#/extension/"+n,window.location.reload()}})).catch(z).finally((function(){s().modal.close(),m.redraw()}))},a.checkForUpdates=function(){var t=this;this.setLoading("check"),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/check-for-updates"}).then((function(n){n.processing?wt():(t.lastUpdateCheck=n,t.extensionUpdates=t.formatExtensionUpdates(n),t.coreUpdate=t.formatCoreUpdate(n),t.setLoading(null),m.redraw())})).catch(z).finally((function(){m.redraw()}))},a.updateCoreMinor=function(){confirm(B()(s().translator.trans("flarum-extension-manager.admin.minor_update_confirmation.content")))&&(s().modal.show(c()),this.setLoading("minor-update"),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/minor-update"}).then((function(t){null!=t&&t.processing?wt():(s().alerts.show({type:"success"},s().translator.trans("flarum-extension-manager.admin.update_successful")),window.location.reload())})).catch(z).finally((function(){s().modal.close(),m.redraw()})))},a.updateExtension=function(t,n){s().modal.show(c()),this.setLoading("extension-update"),s().request({method:"PATCH",url:s().forum.attribute("apiUrl")+"/extension-manager/extensions/"+t.id,body:{data:{updateMode:n}}}).then((function(n){null!=n&&n.processing?wt():(s().alerts.show({type:"success"},s().translator.trans("flarum-extension-manager.admin.extensions.successful_update",{extension:t.extra["flarum-extension"].title})),window.location.reload())})).catch(z).finally((function(){s().modal.close(),m.redraw()}))},a.updateGlobally=function(){s().modal.show(c()),this.setLoading("global-update"),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/global-update"}).then((function(t){null!=t&&t.processing?wt():(s().alerts.show({type:"success"},s().translator.trans("flarum-extension-manager.admin.updater.global_update_successful")),window.location.reload())})).catch(z).finally((function(){s().modal.close(),m.redraw()}))},a.formatExtensionUpdates=function(t){var n,e,a=this;return this.packageUpdates={},null==t||null==(n=t.updates)||null==(e=n.installed)||e.filter((function(t){var n=t.name.replace("/","-").replace(/(flarum-ext-)|(flarum-)/,""),e=s().data.extensions[n],r=["semver-safe-update","update-possible"].includes(t["latest-status"]);return e&&r&&(a.packageUpdates[e.id]=t),e&&r})),Object.values(s().data.extensions).filter((function(t){return a.packageUpdates[t.id]}))},a.formatCoreUpdate=function(t){var n,e,a=null==t||null==(n=t.updates)||null==(e=n.installed)?void 0:e.filter((function(t){return"flarum/core"===t.name})).pop();return a?{package:a,extension:{id:"flarum-core",name:"flarum/core",version:s().data.settings.version,icon:{backgroundImage:"url("+s().data.resources[0].attributes.baseUrl+"/assets/extensions/flarum-extension-manager/flarum.svg"},extra:{"flarum-extension":{title:B()(s().translator.trans("flarum-extension-manager.admin.updater.flarum"))}}}}:null},a.majorUpdate=function(t){var n=t.dryRun;s().extensionManager.control.setLoading(n?"major-update-dry-run":"major-update"),s().modal.show(c());var e=this.lastUpdateRun.major;s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/extension-manager/major-update",body:{data:{dryRun:n}}}).then((function(t){null!=t&&t.processing?wt():(s().alerts.show({type:"success"},s().translator.trans("flarum-extension-manager.admin.update_successful")),window.location.reload())})).catch(z).catch((function(t){var n,a,r;s().modal.close(),e.status="failure",e.incompatibleExtensions=null==(n=t.response)||null==(a=n.errors)||null==(r=a.pop())?void 0:r.incompatible_extensions})).finally((function(){m.redraw()}))},n=t,(e=[{key:"lastUpdateRun",get:function(){var t=JSON.parse(s().data.settings["flarum-extension-manager.last_update_run"]);return t.limitedPackages=function(){return[].concat(t.major.limitedPackages,t.minor.limitedPackages,t.global.limitedPackages)},t}}])&&Ut(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),t}(),St=function(){this.queue=new Et,this.control=new Bt};s().initializers.add("flarum-extension-manager",(function(n){n.store.models["extension-manager-tasks"]=Mt,n.extensionManager=new St,n.data["flarum-extension-manager.using_sync_queue"]&&(n.data.settings["flarum-extension-manager.queue_jobs"]="0"),n.extensionData.for("flarum-extension-manager").registerSetting({setting:"flarum-extension-manager.queue_jobs",label:n.translator.trans("flarum-extension-manager.admin.settings.queue_jobs"),help:m.trust(B()(n.translator.trans("flarum-extension-manager.admin.settings.queue_jobs_help",{basic_impl_link:"https://discuss.flarum.org/d/28151-database-queue-the-simplest-queue-even-for-shared-hosting",adv_impl_link:"https://discuss.flarum.org/d/21873-redis-sessions-cache-queues",php_version:"<strong>"+n.data.phpVersion+"</strong>",folder_perms_link:"https://docs.flarum.org/install#folder-ownership"}))),type:"boolean",disabled:n.data["flarum-extension-manager.using_sync_queue"]}).registerSetting({setting:"flarum-extension-manager.task_retention_days",label:n.translator.trans("flarum-extension-manager.admin.settings.task_retention_days"),help:n.translator.trans("flarum-extension-manager.admin.settings.task_retention_days_help"),type:"number"}).registerPage(gt),(0,t.extend)(o().prototype,"topItems",(function(t){var e=this;"flarum-extension-manager"===this.extension.id||p()(this.extension.id)||t.add("remove",m(l(),{className:"Button Button--danger",icon:"fas fa-times",onclick:function(){n.modal.show(c()),n.request({url:n.forum.attribute("apiUrl")+"/extension-manager/extensions/"+e.extension.id,method:"DELETE"}).then((function(t){null!=t&&t.processing?wt():(n.alerts.show({type:"success"},n.translator.trans("flarum-extension-manager.admin.extensions.successful_remove")),window.location=n.forum.attribute("adminUrl"))})).finally((function(){n.modal.close()}))}},n.translator.trans("flarum-extension-manager.admin.extensions.remove")))}))}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map