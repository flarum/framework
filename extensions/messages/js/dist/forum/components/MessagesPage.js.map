{"version":3,"file":"forum/components/MessagesPage.js","mappings":"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","sources":["webpack://@flarum/messages/./src/forum/components/DialogListItem.tsx","webpack://@flarum/messages/./src/forum/components/DialogList.tsx","webpack://@flarum/messages/./src/forum/components/MessagesSidebar.tsx","webpack://@flarum/messages/./src/forum/components/Message.tsx","webpack://@flarum/messages/./src/forum/components/MessageStream.tsx","webpack://@flarum/messages/./src/forum/states/MessageStreamState.ts","webpack://@flarum/messages/./src/forum/components/DetailsModal.tsx","webpack://@flarum/messages/./src/forum/components/DialogSection.tsx","webpack://@flarum/messages/./src/forum/components/MessagesPage.tsx"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport classList from 'flarum/common/utils/classList';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport Avatar from 'flarum/common/components/Avatar';\nimport username from 'flarum/common/helpers/username';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogListItem extends Component {\n  view(vnode) {\n    var _lastMessage$contentP;\n    const dialog = this.attrs.dialog;\n    const recipient = dialog.recipient();\n    const lastMessage = dialog.lastMessage();\n    return m(\"li\", {\n      className: classList('DialogListItem', {\n        'DialogListItem--unread': dialog.unreadCount(),\n        active: this.attrs.active\n      })\n    }, m(Link, {\n      href: app.route.dialog(dialog),\n      className: classList('DialogListItem-button', {\n        active: this.attrs.active\n      })\n    }, m(\"div\", {\n      className: \"DialogListItem-avatar\"\n    }, m(Avatar, {\n      user: recipient\n    }), !!dialog.unreadCount() && m(\"div\", {\n      className: \"Bubble Bubble--primary\"\n    }, dialog.unreadCount())), m(\"div\", {\n      className: \"DialogListItem-content\"\n    }, m(\"div\", {\n      className: \"DialogListItem-title\"\n    }, username(recipient), humanTime(dialog.lastMessageAt()), this.attrs.actions && m(\"div\", {\n      className: \"DialogListItem-actions\"\n    }, this.actionItems().toArray())), m(\"div\", {\n      className: \"DialogListItem-lastMessage\"\n    }, lastMessage ? (_lastMessage$contentP = lastMessage.contentPlain()) == null ? void 0 : _lastMessage$contentP.slice(0, 80) : ''))));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('markAsRead', m(Button, {\n      className: \"Notification-action Button Button--link\",\n      icon: \"fas fa-check\",\n      \"aria-label\": app.translator.trans('flarum-messages.forum.dialog_list.mark_as_read_tooltip'),\n      onclick: e => {\n        var _this$attrs$dialog$da;\n        e.preventDefault();\n        e.stopPropagation();\n        this.attrs.dialog.save({\n          lastReadMessageId: ((_this$attrs$dialog$da = this.attrs.dialog.data.relationships) == null ? void 0 : _this$attrs$dialog$da.lastMessage.data).id\n        }).finally(() => {\n          if (this.attrs.dialog.unreadCount() === 0) {\n            var _attribute;\n            app.session.user.pushAttributes({\n              messageCount: ((_attribute = app.session.user.attribute('messageCount')) != null ? _attribute : 1) - 1\n            });\n          }\n          m.redraw();\n        });\n      }\n    }), 100);\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogListItem', DialogListItem);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport DialogListItem from './DialogListItem';\nexport default class DialogList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  view() {\n    return m(\"div\", {\n      className: \"DialogList\"\n    }, m(\"ul\", {\n      className: \"DialogList-list\"\n    }, this.attrs.state.getAllItems().map(dialog => {\n      var _this$attrs$activeDia;\n      return m(DialogListItem, {\n        dialog: dialog,\n        active: ((_this$attrs$activeDia = this.attrs.activeDialog) == null ? void 0 : _this$attrs$activeDia.id()) === dialog.id(),\n        actions: this.attrs.itemActions\n      });\n    })), this.attrs.state.hasNext() && !this.attrs.hideMore && m(\"div\", {\n      className: \"DialogList-loadMore\"\n    }, m(Button, {\n      className: \"Button\",\n      onclick: this.attrs.state.loadNext.bind(this.attrs.state)\n    }, app.translator.trans('flarum-messages.forum.dialog_list.load_more_button'))));\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogList', DialogList);","import app from 'flarum/forum/app';\nimport IndexSidebar from 'flarum/forum/components/IndexSidebar';\nimport Button from 'flarum/common/components/Button';\nexport default class MessagesSidebar extends IndexSidebar {\n  static initAttrs(attrs) {\n    attrs.className = 'MessagesPage-nav';\n  }\n  items() {\n    const items = super.items();\n    const canSendAnyMessage = app.session.user.attribute('canSendAnyMessage');\n    items.remove('newDiscussion');\n    items.add('newMessage', m(Button, {\n      icon: \"fas fa-edit\",\n      className: \"Button Button--primary IndexPage-newDiscussion MessagesPage-newMessage\",\n      itemClassName: \"App-primaryControl\",\n      onclick: () => {\n        return this.newMessageAction();\n      },\n      disabled: !canSendAnyMessage\n    }, app.translator.trans('flarum-messages.forum.messages_page.new_message_button')), 10);\n    return items;\n  }\n\n  /**\n   * Open the composer for a new message.\n   */\n  newMessageAction() {\n    return flarum.reg.asyncModuleImport('flarum/forum/components/ComposerBody').then(() => {\n      app.composer.load(() => import(/* webpackChunkName: 'forum/components/MessageComposer', webpackMode: 'lazy-once' */ './MessageComposer'), {\n        user: app.session.user,\n        onsubmit: () => {\n          app.dialogs.refresh();\n        }\n      }).then(() => app.composer.show());\n      return app.composer;\n    });\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessagesSidebar', MessagesSidebar);flarum.reg.addChunkModule('514', '118', 'flarum-messages', 'forum/components/MessageComposer');","import ItemList from 'flarum/common/utils/ItemList';\nimport AbstractPost from 'flarum/forum/components/AbstractPost';\nimport Avatar from 'flarum/common/components/Avatar';\nimport Comment from 'flarum/forum/components/Comment';\nimport PostUser from 'flarum/forum/components/PostUser';\nimport PostMeta from 'flarum/forum/components/PostMeta';\nimport classList from 'flarum/common/utils/classList';\n/**\n * The `Post` component displays a single post. The basic post template just\n * includes a controls dropdown; subclasses must implement `content` and `attrs`\n * methods.\n */\nexport default class Message extends AbstractPost {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  user() {\n    return this.attrs.message.user();\n  }\n  controls() {\n    return [];\n  }\n  freshness() {\n    return this.attrs.message.freshness;\n  }\n  createdByStarter() {\n    return false;\n  }\n  onbeforeupdate(vnode) {\n    return super.onbeforeupdate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  elementAttrs() {\n    const message = this.attrs.message;\n    const attrs = super.elementAttrs();\n    attrs.className = classList(attrs.className || null, 'Message', {\n      'Post--renderFailed': message.renderFailed(),\n      revealContent: false,\n      editing: false\n    });\n    return attrs;\n  }\n  header() {\n    return super.header();\n  }\n  content() {\n    return super.content().concat([m(Comment, {\n      headerItems: this.headerItems(),\n      cardVisible: false,\n      isEditing: false,\n      isHidden: false,\n      contentHtml: this.attrs.message.contentHtml(),\n      user: this.attrs.message.user()\n    })]);\n  }\n  classes(existing) {\n    return super.classes(existing);\n  }\n  actionItems() {\n    return super.actionItems();\n  }\n  footerItems() {\n    return super.footerItems();\n  }\n  sideItems() {\n    return super.sideItems();\n  }\n  avatar() {\n    return this.attrs.message.user() ? m(Avatar, {\n      user: this.attrs.message.user()\n    }) : '';\n  }\n  headerItems() {\n    const items = new ItemList();\n    const message = this.attrs.message;\n    items.add('user', m(PostUser, {\n      post: message\n    }), 100);\n    items.add('meta', m(PostMeta, {\n      post: message\n    }));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/Message', Message);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Stream from 'flarum/common/utils/Stream';\nimport Button from 'flarum/common/components/Button';\nimport ScrollListener from 'flarum/common/utils/ScrollListener';\nimport Message from './Message';\nexport default class MessageStream extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"replyPlaceholderComponent\", Stream(null));\n    _defineProperty(this, \"loadingPostComponent\", Stream(null));\n    _defineProperty(this, \"scrollListener\", void 0);\n    _defineProperty(this, \"initialToBottomScroll\", false);\n    _defineProperty(this, \"lastTime\", null);\n    _defineProperty(this, \"checkedRead\", false);\n    _defineProperty(this, \"markingAsRead\", false);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    // We need the lazy ReplyPlaceholder and LoadingPost components to be loaded.\n    Promise.all([flarum.reg.asyncModuleImport('flarum/forum/components/ReplyPlaceholder'), flarum.reg.asyncModuleImport('flarum/forum/components/LoadingPost')]).then(_ref => {\n      let [ReplyPlaceholder, LoadingPost] = _ref;\n      this.replyPlaceholderComponent(ReplyPlaceholder.default);\n      this.loadingPostComponent(LoadingPost.default);\n    });\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    this.scrollListener = new ScrollListener(this.onscroll.bind(this), this.element);\n    setTimeout(() => {\n      this.scrollListener.start();\n      this.element.addEventListener('scrollend', this.markAsRead.bind(this));\n    });\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n\n    // @todo: for future versions, consider using the post stream scrubber to scroll through the messages. (big task..)\n    // @todo: introduce read status, to jump to the first unread message instead.\n    if (!this.initialToBottomScroll && !this.attrs.state.isLoading()) {\n      this.scrollToBottom();\n      this.initialToBottomScroll = true;\n    }\n    if (this.initialToBottomScroll && !this.checkedRead) {\n      this.markAsRead();\n      this.checkedRead = true;\n    }\n  }\n  onremove(vnode) {\n    super.onremove(vnode);\n    this.scrollListener.stop();\n  }\n  view() {\n    return m(\"div\", {\n      className: \"MessageStream\"\n    }, this.attrs.state.isLoading() ? m(LoadingIndicator, null) : this.content());\n  }\n  content() {\n    var _this$attrs$dialog$da;\n    const items = [];\n    const messages = this.attrs.state.getAllItems().sort((a, b) => a.createdAt().getTime() - b.createdAt().getTime());\n    const ReplyPlaceholder = this.replyPlaceholderComponent();\n    const LoadingPost = this.loadingPostComponent();\n    if (messages[0].id() !== ((_this$attrs$dialog$da = this.attrs.dialog.data.relationships) == null ? void 0 : _this$attrs$dialog$da.firstMessage.data).id) {\n      items.push(m(\"div\", {\n        className: \"MessageStream-item\",\n        key: \"loadPrevious\"\n      }, m(Button, {\n        onclick: () => this.whileMaintainingScroll(() => this.attrs.state.loadNext()),\n        type: \"button\",\n        className: \"Button Button--block MessageStream-loadPrev\"\n      }, app.translator.trans('flarum-messages.forum.messages_page.stream.load_previous_button'))));\n      if (LoadingPost) {\n        items.push(m(\"div\", {\n          className: \"MessageStream-item\",\n          key: \"loading-prev\"\n        }, m(LoadingPost, null)));\n      }\n    }\n    messages.forEach((message, index) => items.push(this.messageItem(message, index)));\n    if (ReplyPlaceholder) {\n      items.push(m(\"div\", {\n        className: \"MessageStream-item\",\n        key: \"reply\" /*data-index={this.attrs.state.count()}*/\n      }, m(ReplyPlaceholder, {\n        discussion: this.attrs.dialog,\n        onclick: () => {\n          flarum.reg.asyncModuleImport('flarum/forum/components/ComposerBody').then(() => {\n            app.composer.load(() => import(/* webpackChunkName: 'forum/components/MessageComposer', webpackMode: 'lazy-once' */ './MessageComposer'), {\n              user: app.session.user,\n              replyingTo: this.attrs.dialog,\n              onsubmit: message => {\n                this.attrs.state.push(message);\n                setTimeout(() => this.scrollToBottom(), 50);\n              }\n            }).then(() => app.composer.show());\n          });\n        },\n        composingReply: () => app.composer.composingMessageTo(this.attrs.dialog)\n      })));\n    }\n    return items;\n  }\n  messageItem(message, index) {\n    return m(\"div\", {\n      className: \"MessageStream-item\",\n      key: index,\n      \"data-id\": message.id()\n    }, this.timeGap(message), m(Message, {\n      message: message\n    }));\n  }\n  timeGap(message) {\n    var _this$attrs$dialog$da2;\n    if (message.id() === ((_this$attrs$dialog$da2 = this.attrs.dialog.data.relationships) == null ? void 0 : _this$attrs$dialog$da2.firstMessage.data).id) {\n      this.lastTime = message.createdAt();\n      return m(\"div\", {\n        class: \"PostStream-timeGap\"\n      }, m(\"span\", null, app.translator.trans('flarum-messages.forum.messages_page.stream.start_of_the_conversation')));\n    }\n    const lastTime = this.lastTime;\n    const dt = message.createdAt().getTime() - ((lastTime == null ? void 0 : lastTime.getTime()) || 0);\n    this.lastTime = message.createdAt();\n    if (lastTime && dt > 1000 * 60 * 60 * 24 * 4) {\n      return m(\"div\", {\n        className: \"PostStream-timeGap\"\n      }, m(\"span\", null, app.translator.trans('flarum-messages.forum.messages_page.stream.time_lapsed_text', {\n        period: dayjs().add(dt, 'ms').fromNow(true)\n      })));\n    }\n    return null;\n  }\n  onscroll() {\n    this.whileMaintainingScroll(() => {\n      if (this.element.scrollTop <= 80 && this.attrs.state.hasNext()) {\n        return this.attrs.state.loadNext();\n      }\n      if (this.element.scrollTop + this.element.clientHeight === this.element.scrollHeight && this.attrs.state.hasPrev()) {\n        return this.attrs.state.loadPrev();\n      }\n      return null;\n    });\n  }\n  scrollToBottom() {\n    this.element.scrollTop = this.element.scrollHeight;\n  }\n  whileMaintainingScroll(callback) {\n    const scrollTop = this.element.scrollTop;\n    const scrollHeight = this.element.scrollHeight;\n    const result = callback();\n    if (result instanceof Promise) {\n      result.then(() => {\n        requestAnimationFrame(() => {\n          this.element.scrollTop = this.element.scrollHeight - scrollHeight + scrollTop;\n        });\n      });\n    }\n  }\n  markAsRead() {\n    const lastVisibleId = Number(this.$('.MessageStream-item[data-id]').filter((_, $el) => {\n      if (this.element.scrollHeight <= this.element.clientHeight) {\n        return true;\n      }\n      return this.$().offset().top + this.element.clientHeight > $($el).offset().top;\n    }).last().data('id'));\n    if (lastVisibleId && app.session.user && lastVisibleId > (this.attrs.dialog.lastReadMessageId() || 0) && !this.markingAsRead) {\n      this.markingAsRead = true;\n      this.attrs.dialog.save({\n        lastReadMessageId: lastVisibleId\n      }).finally(() => {\n        this.markingAsRead = false;\n        if (this.attrs.dialog.unreadCount() === 0) {\n          var _attribute;\n          app.session.user.pushAttributes({\n            messageCount: ((_attribute = app.session.user.attribute('messageCount')) != null ? _attribute : 1) - 1\n          });\n        }\n        m.redraw();\n      });\n    }\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessageStream', MessageStream);","import PaginatedListState from 'flarum/common/states/PaginatedListState';\nexport default class MessageStreamState extends PaginatedListState {\n  constructor(params, page) {\n    if (page === void 0) {\n      page = 1;\n    }\n    super(params, page, null);\n  }\n  get type() {\n    return 'dialog-messages';\n  }\n  getAllItems() {\n    return super.getAllItems();\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/states/MessageStreamState', MessageStreamState);","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Avatar from 'flarum/common/components/Avatar';\nimport fullTime from 'flarum/common/helpers/fullTime';\nimport username from 'flarum/common/helpers/username';\nimport Link from 'flarum/common/components/Link';\nimport listItems from 'flarum/common/helpers/listItems';\nexport default class DetailsModal extends Modal {\n  className() {\n    return 'Modal--small Modal--flat DetailsModal';\n  }\n  title() {\n    return app.translator.trans('flarum-messages.forum.dialog_section.details_modal.title');\n  }\n  content() {\n    let recipients = (this.attrs.dialog.users() || []).filter(Boolean);\n    return m(\"div\", {\n      className: \"Modal-body DetailsModal-infoGroups\"\n    }, m(\"div\", {\n      className: \"DetailsModal-recipients DetailsModal-info\"\n    }, m(\"div\", {\n      className: \"DetailsModal-info-title\"\n    }, app.translator.trans('flarum-messages.forum.dialog_section.details_modal.recipients')), m(\"div\", {\n      className: \"DetailsModal-recipients-list\"\n    }, recipients == null ? void 0 : recipients.map(recipient => {\n      return m(\"div\", {\n        className: \"DetailsModal-recipient\"\n      }, m(Avatar, {\n        user: recipient\n      }), m(Link, {\n        href: app.route('user', {\n          username: recipient.slug()\n        })\n      }, m(\"span\", {\n        className: \"DetailsModal-recipient-username\"\n      }, username(recipient))), m(\"div\", {\n        className: \"badges\"\n      }, listItems(recipient.badges().toArray())));\n    }))), this.infoItems().toArray());\n  }\n  infoItems() {\n    const items = new ItemList();\n    items.add('created', m(\"div\", {\n      className: \"DetailsModal-createdAt DetailsModal-info\"\n    }, m(\"div\", {\n      className: \"DetailsModal-info-title\"\n    }, app.translator.trans('flarum-messages.forum.dialog_section.details_modal.created_at')), m(\"div\", {\n      className: \"DetailsModal-info-content\"\n    }, fullTime(this.attrs.dialog.createdAt()))));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DetailsModal', DetailsModal);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport Component from 'flarum/common/Component';\nimport MessageStream from './MessageStream';\nimport username from 'flarum/common/helpers/username';\nimport MessageStreamState from '../states/MessageStreamState';\nimport Avatar from 'flarum/common/components/Avatar';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport DetailsModal from './DetailsModal';\nimport listItems from 'flarum/common/helpers/listItems';\nexport default class DialogSection extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"loading\", false);\n    _defineProperty(this, \"messages\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.messages = new MessageStreamState({\n      filter: {\n        dialog: this.attrs.dialog.id()\n      },\n      sort: '-createdAt'\n    });\n    this.messages.refresh();\n  }\n  view() {\n    const recipient = this.attrs.dialog.recipient();\n    return m(\"div\", {\n      className: \"DialogSection\"\n    }, m(\"div\", {\n      className: \"DialogSection-header\"\n    }, m(Avatar, {\n      user: recipient\n    }), m(\"div\", {\n      className: \"DialogSection-header-info\"\n    }, recipient && m(Link, {\n      href: app.route.user(recipient)\n    }, m(\"h2\", null, username(recipient))) || m(\"h2\", null, username(recipient)), m(\"div\", {\n      className: \"badges\"\n    }, listItems((recipient == null ? void 0 : recipient.badges().toArray()) || []))), m(\"div\", {\n      className: \"DialogSection-header-actions\"\n    }, this.actionItems().toArray())), m(MessageStream, {\n      dialog: this.attrs.dialog,\n      state: this.messages\n    }));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('details', m(Dropdown, {\n      icon: \"fas fa-ellipsis-h\",\n      className: \"DialogSection-controls\",\n      buttonClassName: \"Button Button--icon\",\n      accessibleToggleLabel: app.translator.trans('flarum-messages.forum.dialog_section.controls_toggle_label'),\n      label: app.translator.trans('flarum-messages.forum.dialog_section.controls_toggle_label')\n    }, this.controlItems().toArray()));\n    return items;\n  }\n  controlItems() {\n    const items = new ItemList();\n    items.add('details', m(Button, {\n      icon: \"fas fa-info-circle\",\n      onclick: () => app.modal.show(DetailsModal, {\n        dialog: this.attrs.dialog\n      })\n    }, app.translator.trans('flarum-messages.forum.dialog_section.controls.details_button')));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogSection', DialogSection);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Page from 'flarum/common/components/Page';\nimport PageStructure from 'flarum/forum/components/PageStructure';\nimport Icon from 'flarum/common/components/Icon';\nimport DialogList from './DialogList';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Stream from 'flarum/common/utils/Stream';\nimport InfoTile from 'flarum/common/components/InfoTile';\nimport MessagesSidebar from './MessagesSidebar';\nimport DialogSection from './DialogSection';\nimport listItems from 'flarum/common/helpers/listItems';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport Button from 'flarum/common/components/Button';\nexport default class MessagesPage extends Page {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"selectedDialog\", Stream(null));\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    if (!app.session.user) {\n      m.route.set(app.route('index'));\n      return;\n    }\n    app.current.set('noTagsList', true);\n    if (!app.dialogs.hasItems()) {\n      app.dialogs.refresh().then(async () => {\n        if (app.dialogs.hasItems()) {\n          await this.initDialog();\n        }\n      });\n    } else {\n      this.initDialog();\n    }\n  }\n  dialogRequestParams() {\n    return {\n      include: 'users.groups'\n    };\n  }\n  async initDialog() {\n    const dialogId = m.route.param('id');\n    const title = app.translator.trans('flarum-messages.forum.messages_page.title', {}, true);\n    let dialog;\n    if (dialogId) {\n      dialog = app.store.getById('dialogs', dialogId) || (await app.store.find('dialogs', dialogId, this.dialogRequestParams()));\n    } else {\n      dialog = app.dialogs.getAllItems()[0];\n    }\n    this.selectedDialog(dialog);\n    if (dialog) {\n      app.setTitle(dialog.title());\n      app.history.push('dialog', dialog.title());\n    } else {\n      app.setTitle(title);\n      app.history.push('messages', title);\n    }\n    m.redraw();\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n\n    // Scroll the dialog list to the active dialog item if present and not visible.\n    const dialogElement = this.element.querySelector('.DialogListItem.active');\n    const container = this.element.querySelector('.DialogList');\n    if (dialogElement && $(container).offset().top + container.clientHeight <= $(dialogElement).offset().top) {\n      dialogElement.scrollIntoView();\n    }\n  }\n  view() {\n    return m(PageStructure, {\n      className: \"MessagesPage Page--vertical\",\n      loading: false,\n      hero: this.hero.bind(this),\n      sidebar: () => m(MessagesSidebar, null)\n    }, app.dialogs.isLoading() ? m(LoadingIndicator, null) : !app.dialogs.hasItems() ? m(InfoTile, {\n      icon: \"far fa-envelope-open\"\n    }, app.translator.trans('flarum-messages.forum.messages_page.empty_text')) : m(\"div\", {\n      className: \"MessagesPage-content\"\n    }, m(\"div\", {\n      className: \"MessagesPage-sidebar\",\n      key: \"sidebar\"\n    }, m(\"div\", {\n      className: \"IndexPage-toolbar\",\n      key: \"toolbar\"\n    }, m(\"ul\", {\n      className: \"IndexPage-toolbar-view\"\n    }, listItems(this.viewItems().toArray())), m(\"ul\", {\n      className: \"IndexPage-toolbar-action\"\n    }, listItems(this.actionItems().toArray()))), m(DialogList, {\n      key: \"list\",\n      state: app.dialogs,\n      activeDialog: this.selectedDialog()\n    })), this.selectedDialog() ? m(DialogSection, {\n      key: \"dialog\",\n      dialog: this.selectedDialog()\n    }) : m(LoadingIndicator, {\n      key: \"loading\",\n      display: \"block\"\n    })));\n  }\n  hero() {\n    return m(\"header\", {\n      className: \"Hero MessagesPageHero\"\n    }, m(\"div\", {\n      className: \"container\"\n    }, m(\"div\", {\n      className: \"containerNarrow\"\n    }, m(\"h1\", {\n      className: \"Hero-title\"\n    }, m(Icon, {\n      name: \"fas fa-envelope\"\n    }), \" \", app.translator.trans('flarum-messages.forum.messages_page.hero.title')), m(\"div\", {\n      className: \"Hero-subtitle\"\n    }, app.translator.trans('flarum-messages.forum.messages_page.hero.subtitle')))));\n  }\n\n  /**\n   * Build an item list for the part of the toolbar which is concerned with how\n   * the results are displayed. By default this is just a select box to change\n   * the way discussions are sorted.\n   */\n  viewItems() {\n    var _app$dialogs$getParam;\n    const items = new ItemList();\n    const sortMap = app.dialogs.sortMap();\n    const sortOptions = Object.keys(sortMap).reduce((acc, sortId) => {\n      const sort = sortMap[sortId];\n      acc[sortId] = typeof sort !== 'string' ? sort.label : app.translator.trans(\"flarum-messages.forum.index_sort.\".concat(sortId, \"_button\"));\n      return acc;\n    }, {});\n    items.add('sort', m(Dropdown, {\n      buttonClassName: \"Button\",\n      label: sortOptions[((_app$dialogs$getParam = app.dialogs.getParams()) == null ? void 0 : _app$dialogs$getParam.sort) || 0] || Object.values(sortOptions)[0],\n      accessibleToggleLabel: app.translator.trans('core.forum.index_sort.toggle_dropdown_accessible_label')\n    }, Object.keys(sortOptions).map(value => {\n      const label = sortOptions[value];\n      const active = (app.dialogs.getParams().sort || Object.keys(sortMap)[0]) === value;\n      return m(Button, {\n        icon: active ? 'fas fa-check' : true,\n        onclick: () => app.dialogs.changeSort(value),\n        active: active\n      }, label);\n    })));\n    return items;\n  }\n\n  /**\n   * Build an item list for the part of the toolbar which is about taking action\n   * on the results. By default this is just a \"mark all as read\" button.\n   */\n  actionItems() {\n    const items = new ItemList();\n    items.add('refresh', m(Button, {\n      title: app.translator.trans('flarum-messages.forum.messages_page.refresh_tooltip'),\n      \"aria-label\": app.translator.trans('flarum-messages.forum.messages_page.refresh_tooltip'),\n      icon: \"fas fa-sync\",\n      className: \"Button Button--icon\",\n      onclick: () => {\n        app.dialogs.refresh();\n      }\n    }));\n    if (app.session.user) {\n      items.add('markAllAsRead', m(Button, {\n        title: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        \"aria-label\": app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        icon: \"fas fa-check\",\n        className: \"Button Button--icon\",\n        onclick: () => app.dialogs.markAllAsRead()\n      }));\n    }\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessagesPage', MessagesPage);"],"names":["DialogListItem","view","vnode","_lastMessage$contentP","dialog","this","attrs","recipient","lastMessage","m","className","unreadCount","active","href","user","lastMessageAt","actions","actionItems","toArray","contentPlain","slice","items","add","icon","onclick","e","_this$attrs$dialog$da","preventDefault","stopPropagation","save","lastReadMessageId","data","relationships","id","finally","_attribute","messageCount","redraw","flarum","reg","DialogList","oninit","super","oncreate","onupdate","state","getAllItems","map","_this$attrs$activeDia","activeDialog","itemActions","hasNext","hideMore","loadNext","bind","MessagesSidebar","static","canSendAnyMessage","remove","itemClassName","newMessageAction","disabled","asyncModuleImport","then","onsubmit","addChunkModule","Message","message","controls","freshness","createdByStarter","onbeforeupdate","elementAttrs","renderFailed","revealContent","editing","header","content","concat","headerItems","cardVisible","isEditing","isHidden","contentHtml","classes","existing","footerItems","sideItems","avatar","post","MessageStream","constructor","arguments","Promise","all","_ref","ReplyPlaceholder","LoadingPost","replyPlaceholderComponent","default","loadingPostComponent","scrollListener","onscroll","element","setTimeout","start","addEventListener","markAsRead","initialToBottomScroll","isLoading","scrollToBottom","checkedRead","onremove","stop","messages","sort","a","b","createdAt","getTime","firstMessage","push","key","whileMaintainingScroll","type","forEach","index","messageItem","discussion","replyingTo","composingReply","timeGap","_this$attrs$dialog$da2","lastTime","class","dt","period","dayjs","fromNow","scrollTop","clientHeight","scrollHeight","hasPrev","loadPrev","callback","result","requestAnimationFrame","lastVisibleId","Number","$","filter","_","$el","offset","top","last","markingAsRead","MessageStreamState","params","page","DetailsModal","title","recipients","users","Boolean","username","slug","badges","infoItems","DialogSection","refresh","buttonClassName","accessibleToggleLabel","label","controlItems","MessagesPage","initDialog","async","route","set","dialogRequestParams","include","dialogId","param","selectedDialog","dialogElement","querySelector","container","scrollIntoView","loading","hero","sidebar","viewItems","display","name","_app$dialogs$getParam","sortMap","sortOptions","Object","keys","reduce","acc","sortId","values","value"],"sourceRoot":""}