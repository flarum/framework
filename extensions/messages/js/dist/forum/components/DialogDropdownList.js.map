{"version":3,"file":"forum/components/DialogDropdownList.js","mappings":"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","sources":["webpack://@flarum/messages/./src/forum/components/DialogDropdownList.tsx","webpack://@flarum/messages/./src/forum/components/DialogListItem.tsx","webpack://@flarum/messages/./src/forum/components/DialogList.tsx"],"sourcesContent":["import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport HeaderList from 'flarum/forum/components/HeaderList';\nimport DialogList from './DialogList';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogDropdownList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  view() {\n    const state = this.attrs.state;\n    return m(HeaderList, {\n      className: \"DialogDropdownList\",\n      title: app.translator.trans('flarum-messages.forum.dialog_list.title'),\n      controls: this.controlItems(),\n      hasItems: state.hasItems(),\n      loading: state.isLoading(),\n      emptyText: app.translator.trans('flarum-messages.forum.messages_page.empty_text'),\n      loadMore: () => state.hasNext() && !state.isLoadingNext() && state.loadNext(),\n      footer: () => m(\"h4\", null, m(LinkButton, {\n        href: app.route('messages'),\n        className: \"Button Button--link\",\n        icon: \"fas fa-inbox\"\n      }, app.translator.trans('flarum-messages.forum.dialog_list.view_all')))\n    }, m(\"div\", {\n      className: \"HeaderListGroup-content\"\n    }, this.content()));\n  }\n  controlItems() {\n    const items = new ItemList();\n    const state = this.attrs.state;\n    if (app.session.user.attribute('messageCount') > 0) {\n      items.add('mark_all_as_read', m(Tooltip, {\n        text: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip')\n      }, m(Button, {\n        className: \"Button Button--link\",\n        \"data-container\": \".DialogDropdownList\",\n        icon: \"fas fa-check\",\n        title: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        onclick: state.markAllAsRead.bind(state)\n      })), 70);\n    }\n    return items;\n  }\n  content() {\n    return m(DialogList, {\n      state: this.attrs.state,\n      hideMore: true,\n      itemActions: true\n    });\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogDropdownList', DialogDropdownList);","import Component from 'flarum/common/Component';\nimport classList from 'flarum/common/utils/classList';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport Avatar from 'flarum/common/components/Avatar';\nimport username from 'flarum/common/helpers/username';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogListItem extends Component {\n  view(vnode) {\n    var _lastMessage$contentP;\n    const dialog = this.attrs.dialog;\n    const recipient = dialog.recipient();\n    const lastMessage = dialog.lastMessage();\n    return m(\"li\", {\n      className: classList('DialogListItem', {\n        'DialogListItem--unread': dialog.unreadCount(),\n        active: this.attrs.active\n      })\n    }, m(Link, {\n      href: app.route.dialog(dialog),\n      className: classList('DialogListItem-button', {\n        active: this.attrs.active\n      })\n    }, m(\"div\", {\n      className: \"DialogListItem-avatar\"\n    }, m(Avatar, {\n      user: recipient\n    }), !!dialog.unreadCount() && m(\"div\", {\n      className: \"Bubble Bubble--primary\"\n    }, dialog.unreadCount())), m(\"div\", {\n      className: \"DialogListItem-content\"\n    }, m(\"div\", {\n      className: \"DialogListItem-title\"\n    }, username(recipient), humanTime(dialog.lastMessageAt()), this.attrs.actions && m(\"div\", {\n      className: \"DialogListItem-actions\"\n    }, this.actionItems().toArray())), m(\"div\", {\n      className: \"DialogListItem-lastMessage\"\n    }, lastMessage ? (_lastMessage$contentP = lastMessage.contentPlain()) == null ? void 0 : _lastMessage$contentP.slice(0, 80) : ''))));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('markAsRead', m(Button, {\n      className: \"Notification-action Button Button--link\",\n      icon: \"fas fa-check\",\n      \"aria-label\": app.translator.trans('flarum-messages.forum.dialog_list.mark_as_read_tooltip'),\n      onclick: e => {\n        var _this$attrs$dialog$da;\n        e.preventDefault();\n        e.stopPropagation();\n        this.attrs.dialog.save({\n          lastReadMessageId: ((_this$attrs$dialog$da = this.attrs.dialog.data.relationships) == null ? void 0 : _this$attrs$dialog$da.lastMessage.data).id\n        }).finally(() => {\n          if (this.attrs.dialog.unreadCount() === 0) {\n            var _attribute;\n            app.session.user.pushAttributes({\n              messageCount: ((_attribute = app.session.user.attribute('messageCount')) != null ? _attribute : 1) - 1\n            });\n          }\n          m.redraw();\n        });\n      }\n    }), 100);\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogListItem', DialogListItem);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport DialogListItem from './DialogListItem';\nexport default class DialogList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  view() {\n    return m(\"div\", {\n      className: \"DialogList\"\n    }, m(\"ul\", {\n      className: \"DialogList-list\"\n    }, this.attrs.state.getAllItems().map(dialog => {\n      var _this$attrs$activeDia;\n      return m(DialogListItem, {\n        dialog: dialog,\n        active: ((_this$attrs$activeDia = this.attrs.activeDialog) == null ? void 0 : _this$attrs$activeDia.id()) === dialog.id(),\n        actions: this.attrs.itemActions\n      });\n    })), this.attrs.state.hasNext() && !this.attrs.hideMore && m(\"div\", {\n      className: \"DialogList-loadMore\"\n    }, m(Button, {\n      className: \"Button\",\n      onclick: this.attrs.state.loadNext.bind(this.attrs.state)\n    }, app.translator.trans('flarum-messages.forum.dialog_list.load_more_button'))));\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogList', DialogList);"],"names":["DialogDropdownList","oninit","vnode","super","view","state","this","attrs","m","className","title","trans","controls","controlItems","hasItems","loading","isLoading","emptyText","loadMore","hasNext","isLoadingNext","loadNext","footer","href","icon","content","items","user","attribute","add","text","onclick","markAllAsRead","bind","hideMore","itemActions","flarum","reg","DialogListItem","_lastMessage$contentP","dialog","recipient","lastMessage","unreadCount","active","lastMessageAt","actions","actionItems","toArray","contentPlain","slice","e","_this$attrs$dialog$da","preventDefault","stopPropagation","save","lastReadMessageId","data","relationships","id","finally","_attribute","pushAttributes","messageCount","redraw","DialogList","oncreate","onupdate","getAllItems","map","_this$attrs$activeDia","activeDialog"],"sourceRoot":""}