{"version":3,"file":"forum/components/DialogDropdownList.js","mappings":"sRAQe,MAAMA,UAA2B,KAC9C,MAAAC,CAAOC,GACLC,MAAMF,OAAOC,EACf,CACA,IAAAE,GACE,MAAMC,EAAQC,KAAKC,MAAMF,MACzB,OAAOG,EAAE,IAAY,CACnBC,UAAW,qBACXC,MAAO,eAAeC,MAAM,2CAC5BC,SAAUN,KAAKO,eACfC,SAAUT,EAAMS,WAChBC,QAASV,EAAMW,YACfC,UAAW,eAAeN,MAAM,kDAChCO,SAAU,IAAMb,EAAMc,YAAcd,EAAMe,iBAAmBf,EAAMgB,WACnEC,OAAQ,IAAMd,EAAE,KAAM,KAAMA,EAAE,IAAY,CACxCe,KAAM,UAAU,YAChBd,UAAW,sBACXe,KAAM,gBACL,eAAeb,MAAM,iDACvBH,EAAE,MAAO,CACVC,UAAW,2BACVH,KAAKmB,WACV,CACA,YAAAZ,GACE,MAAMa,EAAQ,IAAI,KACZrB,EAAQC,KAAKC,MAAMF,MAYzB,OAXI,YAAYsB,KAAKC,UAAU,gBAAkB,GAC/CF,EAAMG,IAAI,mBAAoBrB,EAAE,IAAS,CACvCsB,KAAM,eAAenB,MAAM,iEAC1BH,EAAE,IAAQ,CACXC,UAAW,sBACX,iBAAkB,sBAClBe,KAAM,eACNd,MAAO,eAAeC,MAAM,gEAC5BoB,QAAS1B,EAAM2B,cAAcC,KAAK5B,MAC/B,IAEAqB,CACT,CACA,OAAAD,GACE,OAAOjB,EAAE,IAAY,CACnBH,MAAOC,KAAKC,MAAMF,MAClB6B,UAAU,EACVC,aAAa,GAEjB,EAEFC,OAAOC,IAAIR,IAAI,kBAAmB,sCAAuC7B,E,sMC9C1D,MAAMsC,UAAuB,KAC1C,IAAAlC,CAAKF,GACH,MAAMqC,EAASjC,KAAKC,MAAMgC,OACpBC,EAAYD,EAAOC,YACnBC,EAAcF,EAAOE,cAC3B,OAAOjC,EAAE,KAAM,CACbC,UAAW,IAAU,iBAAkB,CACrC,yBAA0B8B,EAAOG,cACjCC,OAAQrC,KAAKC,MAAMoC,UAEpBnC,EAAE,IAAM,CACTe,KAAM,UAAUgB,OAAOA,GACvB9B,UAAW,IAAU,wBAAyB,CAC5CkC,OAAQrC,KAAKC,MAAMoC,UAEpBnC,EAAE,MAAO,CACVC,UAAW,yBACVD,EAAE,IAAQ,CACXmB,KAAMa,MACFD,EAAOG,eAAiBlC,EAAE,MAAO,CACrCC,UAAW,0BACV8B,EAAOG,gBAAiBlC,EAAE,MAAO,CAClCC,UAAW,0BACVD,EAAE,MAAO,CACVC,UAAW,wBACV,IAAS+B,GAAY,IAAUD,EAAOK,iBAAkBtC,KAAKC,MAAMsC,SAAWrC,EAAE,MAAO,CACxFC,UAAW,0BACVH,KAAKwC,cAAcC,YAAavC,EAAE,MAAO,CAC1CC,UAAW,8BACVgC,EAAcA,EAAYO,gBAAgBC,MAAM,EAAG,IAAM,MAC9D,CACA,WAAAH,GACE,MAAMpB,EAAQ,IAAI,KAoBlB,OAnBAA,EAAMG,IAAI,aAAcrB,EAAE,IAAQ,CAChCC,UAAW,0CACXe,KAAM,eACN,aAAc,eAAeb,MAAM,0DACnCoB,QAASmB,IACPA,EAAEC,iBACFD,EAAEE,kBACF9C,KAAKC,MAAMgC,OAAOc,KAAK,CACrBC,mBAAoBhD,KAAKC,MAAMgC,OAAOgB,KAAKC,eAAef,YAAYc,MAAME,KAC3EC,SAAQ,KAC+B,IAApCpD,KAAKC,MAAMgC,OAAOG,eACpB,YAAYf,KAAKgC,eAAe,CAC9BC,cAAe,YAAYjC,KAAKC,UAAU,iBAAmB,GAAK,IAGtEpB,EAAEqD,QAAQ,GACV,IAEF,KACGnC,CACT,EAEFU,OAAOC,IAAIR,IAAI,kBAAmB,kCAAmCS,GC5DtD,MAAMwB,UAAmB,KACtC,MAAA7D,CAAOC,GACLC,MAAMF,OAAOC,EACf,CACA,QAAA6D,CAAS7D,GACPC,MAAM4D,SAAS7D,EACjB,CACA,QAAA8D,CAAS9D,GACPC,MAAM6D,SAAS9D,EACjB,CACA,IAAAE,GACE,OAAOI,EAAE,MAAO,CACdC,UAAW,cACVD,EAAE,KAAM,CACTC,UAAW,mBACVH,KAAKC,MAAMF,MAAM4D,cAAcC,KAAI3B,GAAU/B,EAAE8B,EAAgB,CAChEC,OAAQA,EACRI,OAAQrC,KAAKC,MAAM4D,cAAcV,OAASlB,EAAOkB,KACjDZ,QAASvC,KAAKC,MAAM4B,iBAChB7B,KAAKC,MAAMF,MAAMc,YAAcb,KAAKC,MAAM2B,UAAY1B,EAAE,MAAO,CACnEC,UAAW,uBACVD,EAAE,IAAQ,CACXC,UAAW,SACXsB,QAASzB,KAAKC,MAAMF,MAAMgB,SAASY,KAAK3B,KAAKC,MAAMF,QAClD,eAAeM,MAAM,wDAC1B,EAEFyB,OAAOC,IAAIR,IAAI,kBAAmB,8BAA+BiC,E","sources":["webpack://@flarum/messages/./src/forum/components/DialogDropdownList.tsx","webpack://@flarum/messages/./src/forum/components/DialogListItem.tsx","webpack://@flarum/messages/./src/forum/components/DialogList.tsx"],"sourcesContent":["import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport HeaderList from 'flarum/forum/components/HeaderList';\nimport DialogList from './DialogList';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogDropdownList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  view() {\n    const state = this.attrs.state;\n    return m(HeaderList, {\n      className: \"DialogDropdownList\",\n      title: app.translator.trans('flarum-messages.forum.dialog_list.title'),\n      controls: this.controlItems(),\n      hasItems: state.hasItems(),\n      loading: state.isLoading(),\n      emptyText: app.translator.trans('flarum-messages.forum.messages_page.empty_text'),\n      loadMore: () => state.hasNext() && !state.isLoadingNext() && state.loadNext(),\n      footer: () => m(\"h4\", null, m(LinkButton, {\n        href: app.route('messages'),\n        className: \"Button Button--link\",\n        icon: \"fas fa-inbox\"\n      }, app.translator.trans('flarum-messages.forum.dialog_list.view_all')))\n    }, m(\"div\", {\n      className: \"HeaderListGroup-content\"\n    }, this.content()));\n  }\n  controlItems() {\n    const items = new ItemList();\n    const state = this.attrs.state;\n    if (app.session.user.attribute('messageCount') > 0) {\n      items.add('mark_all_as_read', m(Tooltip, {\n        text: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip')\n      }, m(Button, {\n        className: \"Button Button--link\",\n        \"data-container\": \".DialogDropdownList\",\n        icon: \"fas fa-check\",\n        title: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        onclick: state.markAllAsRead.bind(state)\n      })), 70);\n    }\n    return items;\n  }\n  content() {\n    return m(DialogList, {\n      state: this.attrs.state,\n      hideMore: true,\n      itemActions: true\n    });\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogDropdownList', DialogDropdownList);","import Component from 'flarum/common/Component';\nimport classList from 'flarum/common/utils/classList';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport Avatar from 'flarum/common/components/Avatar';\nimport username from 'flarum/common/helpers/username';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogListItem extends Component {\n  view(vnode) {\n    const dialog = this.attrs.dialog;\n    const recipient = dialog.recipient();\n    const lastMessage = dialog.lastMessage();\n    return m(\"li\", {\n      className: classList('DialogListItem', {\n        'DialogListItem--unread': dialog.unreadCount(),\n        active: this.attrs.active\n      })\n    }, m(Link, {\n      href: app.route.dialog(dialog),\n      className: classList('DialogListItem-button', {\n        active: this.attrs.active\n      })\n    }, m(\"div\", {\n      className: \"DialogListItem-avatar\"\n    }, m(Avatar, {\n      user: recipient\n    }), !!dialog.unreadCount() && m(\"div\", {\n      className: \"Bubble Bubble--primary\"\n    }, dialog.unreadCount())), m(\"div\", {\n      className: \"DialogListItem-content\"\n    }, m(\"div\", {\n      className: \"DialogListItem-title\"\n    }, username(recipient), humanTime(dialog.lastMessageAt()), this.attrs.actions && m(\"div\", {\n      className: \"DialogListItem-actions\"\n    }, this.actionItems().toArray())), m(\"div\", {\n      className: \"DialogListItem-lastMessage\"\n    }, lastMessage ? lastMessage.contentPlain()?.slice(0, 80) : ''))));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('markAsRead', m(Button, {\n      className: \"Notification-action Button Button--link\",\n      icon: \"fas fa-check\",\n      \"aria-label\": app.translator.trans('flarum-messages.forum.dialog_list.mark_as_read_tooltip'),\n      onclick: e => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.attrs.dialog.save({\n          lastReadMessageId: (this.attrs.dialog.data.relationships?.lastMessage.data).id\n        }).finally(() => {\n          if (this.attrs.dialog.unreadCount() === 0) {\n            app.session.user.pushAttributes({\n              messageCount: (app.session.user.attribute('messageCount') ?? 1) - 1\n            });\n          }\n          m.redraw();\n        });\n      }\n    }), 100);\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogListItem', DialogListItem);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport DialogListItem from './DialogListItem';\nexport default class DialogList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  view() {\n    return m(\"div\", {\n      className: \"DialogList\"\n    }, m(\"ul\", {\n      className: \"DialogList-list\"\n    }, this.attrs.state.getAllItems().map(dialog => m(DialogListItem, {\n      dialog: dialog,\n      active: this.attrs.activeDialog?.id() === dialog.id(),\n      actions: this.attrs.itemActions\n    }))), this.attrs.state.hasNext() && !this.attrs.hideMore && m(\"div\", {\n      className: \"DialogList-loadMore\"\n    }, m(Button, {\n      className: \"Button\",\n      onclick: this.attrs.state.loadNext.bind(this.attrs.state)\n    }, app.translator.trans('flarum-messages.forum.dialog_list.load_more_button'))));\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogList', DialogList);"],"names":["DialogDropdownList","oninit","vnode","super","view","state","this","attrs","m","className","title","trans","controls","controlItems","hasItems","loading","isLoading","emptyText","loadMore","hasNext","isLoadingNext","loadNext","footer","href","icon","content","items","user","attribute","add","text","onclick","markAllAsRead","bind","hideMore","itemActions","flarum","reg","DialogListItem","dialog","recipient","lastMessage","unreadCount","active","lastMessageAt","actions","actionItems","toArray","contentPlain","slice","e","preventDefault","stopPropagation","save","lastReadMessageId","data","relationships","id","finally","pushAttributes","messageCount","redraw","DialogList","oncreate","onupdate","getAllItems","map","activeDialog"],"sourceRoot":""}