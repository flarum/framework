{"version":3,"file":"forum/components/DialogDropdownList.js","mappings":"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","sources":["webpack://@flarum/messages/./src/forum/components/DialogDropdownList.tsx","webpack://@flarum/messages/./src/forum/components/DialogListItem.tsx","webpack://@flarum/messages/./src/forum/components/DialogList.tsx"],"sourcesContent":["import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport HeaderList from 'flarum/forum/components/HeaderList';\nimport DialogList from './DialogList';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogDropdownList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  view() {\n    const state = this.attrs.state;\n    return m(HeaderList, {\n      className: \"DialogDropdownList\",\n      title: app.translator.trans('flarum-messages.forum.dialog_list.title'),\n      controls: this.controlItems(),\n      hasItems: state.hasItems(),\n      loading: state.isLoading(),\n      emptyText: app.translator.trans('flarum-messages.forum.messages_page.empty_text'),\n      loadMore: () => state.hasNext() && !state.isLoadingNext() && state.loadNext(),\n      footer: () => m(\"h4\", null, m(LinkButton, {\n        href: app.route('messages'),\n        className: \"Button Button--link\",\n        icon: \"fas fa-inbox\"\n      }, app.translator.trans('flarum-messages.forum.dialog_list.view_all')))\n    }, m(\"div\", {\n      className: \"HeaderListGroup-content\"\n    }, this.content()));\n  }\n  controlItems() {\n    const items = new ItemList();\n    const state = this.attrs.state;\n    if (app.session.user.attribute('messageCount') > 0) {\n      items.add('mark_all_as_read', m(Tooltip, {\n        text: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip')\n      }, m(Button, {\n        className: \"Button Button--link\",\n        \"data-container\": \".DialogDropdownList\",\n        icon: \"fas fa-check\",\n        title: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        onclick: state.markAllAsRead.bind(state)\n      })), 70);\n    }\n    return items;\n  }\n  content() {\n    return m(DialogList, {\n      state: this.attrs.state,\n      hideMore: true,\n      itemActions: true\n    });\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogDropdownList', DialogDropdownList);","import Component from 'flarum/common/Component';\nimport classList from 'flarum/common/utils/classList';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport Avatar from 'flarum/common/components/Avatar';\nimport username from 'flarum/common/helpers/username';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogListItem extends Component {\n  view(vnode) {\n    var _lastMessage$contentP;\n    const dialog = this.attrs.dialog;\n    const recipient = dialog.recipient();\n    const lastMessage = dialog.lastMessage();\n    return m(\"li\", {\n      className: classList('DialogListItem', {\n        'DialogListItem--unread': dialog.unreadCount(),\n        active: this.attrs.active\n      })\n    }, m(Link, {\n      href: app.route.dialog(dialog),\n      className: classList('DialogListItem-button', {\n        active: this.attrs.active\n      })\n    }, m(\"div\", {\n      className: \"DialogListItem-avatar\"\n    }, m(Avatar, {\n      user: recipient\n    }), !!dialog.unreadCount() && m(\"div\", {\n      className: \"Bubble Bubble--primary\"\n    }, dialog.unreadCount())), m(\"div\", {\n      className: \"DialogListItem-content\"\n    }, m(\"div\", {\n      className: \"DialogListItem-title\"\n    }, username(recipient), humanTime(dialog.lastMessageAt()), this.attrs.actions && m(\"div\", {\n      className: \"DialogListItem-actions\"\n    }, this.actionItems().toArray())), m(\"div\", {\n      className: \"DialogListItem-lastMessage\"\n    }, lastMessage ? (_lastMessage$contentP = lastMessage.contentPlain()) == null ? void 0 : _lastMessage$contentP.slice(0, 80) : ''))));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('markAsRead', m(Button, {\n      className: \"Notification-action Button Button--link\",\n      icon: \"fas fa-check\",\n      \"aria-label\": app.translator.trans('flarum-messages.forum.dialog_list.mark_as_read_tooltip'),\n      onclick: e => {\n        var _this$attrs$dialog$da;\n        e.preventDefault();\n        e.stopPropagation();\n        this.attrs.dialog.save({\n          lastReadMessageId: ((_this$attrs$dialog$da = this.attrs.dialog.data.relationships) == null ? void 0 : _this$attrs$dialog$da.lastMessage.data).id\n        }).finally(() => {\n          if (this.attrs.dialog.unreadCount() === 0) {\n            var _attribute;\n            app.session.user.pushAttributes({\n              messageCount: ((_attribute = app.session.user.attribute('messageCount')) != null ? _attribute : 1) - 1\n            });\n          }\n          m.redraw();\n        });\n      }\n    }), 100);\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogListItem', DialogListItem);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport DialogListItem from './DialogListItem';\nexport default class DialogList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  view() {\n    return m(\"div\", {\n      className: \"DialogList\"\n    }, m(\"ul\", {\n      className: \"DialogList-list\"\n    }, this.attrs.state.getAllItems().map(dialog => {\n      var _this$attrs$activeDia;\n      return m(DialogListItem, {\n        dialog: dialog,\n        active: ((_this$attrs$activeDia = this.attrs.activeDialog) == null ? void 0 : _this$attrs$activeDia.id()) === dialog.id(),\n        actions: this.attrs.itemActions\n      });\n    })), this.attrs.state.hasNext() && !this.attrs.hideMore && m(\"div\", {\n      className: \"DialogList-loadMore\"\n    }, m(Button, {\n      className: \"Button\",\n      onclick: this.attrs.state.loadNext.bind(this.attrs.state)\n    }, app.translator.trans('flarum-messages.forum.dialog_list.load_more_button'))));\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogList', DialogList);"],"names":["DialogDropdownList","oninit","vnode","super","view","state","this","attrs","m","className","title","controls","controlItems","hasItems","loading","isLoading","emptyText","loadMore","hasNext","isLoadingNext","loadNext","footer","href","icon","content","items","add","text","onclick","markAllAsRead","bind","hideMore","itemActions","flarum","reg","DialogListItem","_lastMessage$contentP","dialog","recipient","lastMessage","unreadCount","active","user","lastMessageAt","actions","actionItems","toArray","contentPlain","slice","e","_this$attrs$dialog$da","preventDefault","stopPropagation","save","lastReadMessageId","data","relationships","id","finally","_attribute","messageCount","redraw","DialogList","oncreate","onupdate","getAllItems","map","_this$attrs$activeDia","activeDialog"],"sourceRoot":""}