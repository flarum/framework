{"version":3,"file":"forum/components/MessageComposer.js","mappings":"ySAce,MAAMA,UAAwB,KAC3C,WAAAC,GACEC,SAASC,YACT,OAAgBC,KAAM,kBAAc,EACtC,CACA,gBAAOC,CAAUC,GACfJ,MAAMG,UAAUC,GAChBA,EAAMC,YAAcD,EAAMC,aAAe,IAAY,eAAeC,MAAM,6CAA8C,CAAC,GAAG,IAC5HF,EAAMG,YAAcH,EAAMG,aAAe,eAAeD,MAAM,+CAAgD,CAAC,GAAG,GAClHF,EAAMI,YAAcJ,EAAMI,aAAe,IAAY,eAAeF,MAAM,sDAAuD,CAAC,GAAG,IACrIF,EAAMK,UAAY,uBACpB,CACA,MAAAC,CAAOC,GACL,IAAIC,EACJZ,MAAMU,OAAOC,GACb,IAAIE,GAA4D,OAAlDD,EAAwBV,KAAKE,MAAMU,iBAAsB,EAASF,EAAsBC,UAAYX,KAAKE,MAAMW,YAAc,GACvIF,IACFA,EAAQA,EAAMG,QAAOC,GAAQA,GAAQA,EAAKC,OAAS,YAAYD,KAAKC,QAEtEhB,KAAKiB,SAASC,OAAOL,WAAab,KAAKiB,SAASC,OAAOL,YAAc,IAAOF,GAC5EX,KAAKa,WAAab,KAAKiB,SAASC,OAAOL,UACzC,CACA,WAAAM,GACE,MAAMC,EAAQtB,MAAMqB,cAwBpB,OAvBAC,EAAMC,IAAI,aAAcC,EAAE,MAAO,CAC/Bf,UAAW,+BACTP,KAAKE,MAAMU,YAAcU,EAAE,IAAQ,CACrCC,KAAM,SACNhB,UAAW,yCACXiB,QAAS,IAAM,UAAUC,KAAK,IAAoB,CAChDC,MAAO,eAAetB,MAAM,wDAAyD,CAAC,GAAG,GACzFuB,SAAU3B,KAAKa,aACfe,SAAU,EACVC,SAAU,CAAC,YAAYd,KAAKC,MAC5Bc,SAAUnB,IACRX,KAAKa,WAAWF,EAAM,KAGzB,eAAeP,MAAM,gDAAiDJ,KAAKa,aAAakB,QAAUT,EAAE,MAAO,CAC5Gf,UAAW,oCACV,eAAeH,MAAM,sCAAuCkB,EAAE,KAAM,CACrEf,UAAW,mCACVP,KAAKa,aAAamB,KAAIjB,GAAQO,EAAE,KAAM,KAAMA,EAAE,IAAS,CACxDW,KAAMlB,EAAKmB,YACVZ,EAAE,IAAQ,CACXP,KAAMA,UACC,KACFK,CACT,CAKA,IAAAe,GACE,MAAMA,EAAO,CACXC,QAASpC,KAAKiB,SAASC,OAAOkB,WAgBhC,OAdIpC,KAAKE,MAAMU,WACbuB,EAAKE,cAAgB,CACnBC,OAAQ,CACNH,KAAM,CACJnB,GAAIhB,KAAKE,MAAMU,WAAWI,KAC1BO,KAAM,aAKZY,EAAKxB,MAAQX,KAAKa,aAAamB,KAAIjB,IAAQ,CACzCC,GAAID,EAAKC,SAGNmB,CACT,CACA,QAAAL,GACE9B,KAAKuC,SAAU,EACf,MAAMJ,EAAOnC,KAAKmC,OAClB,UAAUK,aAAa,mBAAmBC,KAAKN,EAAM,CACnDO,OAAQ,CACNC,QAAS,CAAC,aAEXC,MAAKC,IACN,IAAIC,EAAsBC,EAC1B/C,KAAKiB,SAAS+B,OAGd1B,EAAE2B,MAAMC,IAAI,UAAU,SAAU,CAC9BlC,GAAI6B,EAAQV,KAAKE,cAAcC,OAAOH,KAAKnB,MAEmB,OAA/D8B,GAAwBC,EAAc/C,KAAKE,OAAO4B,WAAqBgB,EAAqBK,KAAKJ,EAAaF,EAAQ,GACtH7C,KAAKoD,OAAOC,KAAKrD,MACtB,GAEF,OAAgBJ,EAAiB,mBAAmB,IAAM,uBAC1D0D,OAAOC,IAAIlC,IAAI,kBAAmB,mCAAoCzB,E","sources":["webpack://@flarum/messages/./src/forum/components/MessageComposer.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport ComposerBody from 'flarum/forum/components/ComposerBody';\nimport extractText from 'flarum/common/utils/extractText';\nimport Stream from 'flarum/common/utils/Stream';\nimport Button from 'flarum/common/components/Button';\nimport UserSelectionModal from 'flarum/common/components/UserSelectionModal';\nimport Avatar from 'flarum/common/components/Avatar';\nimport Tooltip from 'flarum/common/components/Tooltip';\n/**\n * The `MessageComposer` component displays the composer content for sending\n * a new message. It adds a selection field as a header control so the user can\n * enter the recipient(s) of their message.\n */\nexport default class MessageComposer extends ComposerBody {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"recipients\", void 0);\n  }\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n    attrs.placeholder = attrs.placeholder || extractText(app.translator.trans('flarum-messages.forum.composer.placeholder', {}, true));\n    attrs.submitLabel = attrs.submitLabel || app.translator.trans('flarum-messages.forum.composer.submit_button', {}, true);\n    attrs.confirmExit = attrs.confirmExit || extractText(app.translator.trans('flarum-messages.forum.composer.discard_confirmation', {}, true));\n    attrs.className = 'ComposerBody--message';\n  }\n  oninit(vnode) {\n    var _this$attrs$replyingT;\n    super.oninit(vnode);\n    let users = ((_this$attrs$replyingT = this.attrs.replyingTo) == null ? void 0 : _this$attrs$replyingT.users()) || this.attrs.recipients || [];\n    if (users) {\n      users = users.filter(user => user && user.id() !== app.session.user.id());\n    }\n    this.composer.fields.recipients = this.composer.fields.recipients || Stream(users);\n    this.recipients = this.composer.fields.recipients;\n  }\n  headerItems() {\n    const items = super.headerItems();\n    items.add('recipients', m(\"div\", {\n      className: \"MessageComposer-recipients\"\n    }, !this.attrs.replyingTo && m(Button, {\n      type: \"button\",\n      className: \"Button Button--outline Button--compact\",\n      onclick: () => app.modal.show(UserSelectionModal, {\n        title: app.translator.trans('flarum-messages.forum.recipient_selection_modal.title', {}, true),\n        selected: this.recipients(),\n        maxItems: 1,\n        excluded: [app.session.user.id()],\n        onsubmit: users => {\n          this.recipients(users);\n        }\n      })\n    }, app.translator.trans('flarum-messages.forum.composer.recipients')), !!this.recipients().length && m(\"div\", {\n      className: \"MessageComposer-recipients-label\"\n    }, app.translator.trans('flarum-messages.forum.composer.to')), m(\"ul\", {\n      className: \"MessageComposer-recipients-list\"\n    }, this.recipients().map(user => m(\"li\", null, m(Tooltip, {\n      text: user.username()\n    }, m(Avatar, {\n      user: user\n    })))))), 100);\n    return items;\n  }\n\n  /**\n   * Get the data to submit to the server when the discussion is saved.\n   */\n  data() {\n    const data = {\n      content: this.composer.fields.content()\n    };\n    if (this.attrs.replyingTo) {\n      data.relationships = {\n        dialog: {\n          data: {\n            id: this.attrs.replyingTo.id(),\n            type: 'dialogs'\n          }\n        }\n      };\n    } else {\n      data.users = this.recipients().map(user => ({\n        id: user.id()\n      }));\n    }\n    return data;\n  }\n  onsubmit() {\n    this.loading = true;\n    const data = this.data();\n    app.store.createRecord('dialog-messages').save(data, {\n      params: {\n        include: ['dialog']\n      }\n    }).then(message => {\n      var _this$attrs$onsubmit, _this$attrs;\n      this.composer.hide();\n      // @todo: app.dialogs.refresh();\n      // @ts-ignore\n      m.route.set(app.route('dialog', {\n        id: message.data.relationships.dialog.data.id\n      }));\n      (_this$attrs$onsubmit = (_this$attrs = this.attrs).onsubmit) == null || _this$attrs$onsubmit.call(_this$attrs, message);\n    }, this.loaded.bind(this));\n  }\n}\n_defineProperty(MessageComposer, \"focusOnSelector\", () => '.TextEditor-editor');\nflarum.reg.add('flarum-messages', 'forum/components/MessageComposer', MessageComposer);"],"names":["MessageComposer","constructor","super","arguments","this","initAttrs","attrs","placeholder","trans","submitLabel","confirmExit","className","oninit","vnode","_this$attrs$replyingT","users","replyingTo","recipients","filter","user","id","composer","fields","headerItems","items","add","m","type","onclick","show","title","selected","maxItems","excluded","onsubmit","length","map","text","username","data","content","relationships","dialog","loading","createRecord","save","params","include","then","message","_this$attrs$onsubmit","_this$attrs","hide","route","set","call","loaded","bind","flarum","reg"],"sourceRoot":""}