(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>q});const s=flarum.reg.get("core","common/extend"),o=flarum.reg.get("core","forum/app");var r=t.n(o);const n=flarum.reg.get("core","common/components/Button");var a=t.n(n);const i=flarum.reg.get("core","forum/components/CommentPost");var l=t.n(i);const u=flarum.reg.get("core","common/components/Link");var c=t.n(u);const f=flarum.reg.get("core","common/helpers/punctuateSeries");var d=t.n(f);const p=flarum.reg.get("core","common/helpers/username");var g=t.n(p);const k=flarum.reg.get("core","common/helpers/icon");var h=t.n(k);const v=flarum.reg.get("core","common/components/Modal");var b=t.n(v);const y=flarum.reg.get("core","common/helpers/avatar");var _=t.n(y);const x=flarum.reg.get("core","common/states/PaginatedListState");var L=t.n(x);class P extends(L()){constructor(t,e){void 0===e&&(e=1),t.page={...t.page||{},limit:10},super(t,e,10)}get type(){return"users"}}flarum.reg.add("flarum-likes","forum/states/PostLikesModalState",P);const N=flarum.reg.get("core","common/components/LoadingIndicator");var M=t.n(N);class B extends(b()){oninit(t){super.oninit(t),this.state=new P({filter:{liked:this.attrs.post.id()}}),this.state.refresh()}className(){return"PostLikesModal Modal--small"}title(){return r().translator.trans("flarum-likes.forum.post_likes.title")}content(){return m("[",null,m("div",{className:"Modal-body"},this.state.isInitialLoading()?m(M(),null):m("ul",{className:"PostLikesModal-list"},this.state.getPages().map((t=>t.items.map((t=>m("li",null,m(c(),{href:r().route.user(t)},_()(t)," ",g()(t))))))))),this.state.hasNext()?m("div",{className:"Modal-footer"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m(a(),{className:"Button Button--block",onclick:()=>this.state.loadNext(),loading:this.state.isLoadingNext()},r().translator.trans("flarum-likes.forum.post_likes.load_more_button"))))):null)}}flarum.reg.add("flarum-likes","forum/components/PostLikesModal",B);const S=flarum.reg.get("core","forum/components/Notification");var j=t.n(S);const w=flarum.reg.get("core","common/utils/string");class C extends(j()){icon(){return"far fa-thumbs-up"}href(){return r().route.post(this.attrs.notification.subject())}content(){const t=this.attrs.notification.fromUser();return r().translator.trans("flarum-likes.forum.notifications.post_liked_text",{user:t,count:1})}excerpt(){return(0,w.truncate)(this.attrs.notification.subject().contentPlain(),200)}}flarum.reg.add("flarum-likes","forum/components/PostLikedNotification",C);const I=flarum.reg.get("core","forum/components/UserPage");var O=t.n(I);const U=flarum.reg.get("core","common/components/LinkButton");var F=t.n(U);const T=flarum.reg.get("core","common/extenders");var R=t.n(T);const z=flarum.reg.get("core","common/models/Post");var A=t.n(z);const D=flarum.reg.get("core","forum/components/PostsUserPage");var G=t.n(D);class H extends(G()){loadResults(t){return r().store.find("posts",{filter:{type:"comment",likedBy:this.user.id()},page:{offset:t,limit:this.loadLimit},sort:"-createdAt"})}}flarum.reg.add("flarum-likes","forum/components/LikesUserPage",H);const q=[(new(R().Routes)).add("user.likes","/u/:username/likes",H),new(R().Model)(A()).hasMany("likes").attribute("likesCount").attribute("canLike")];r().initializers.add("flarum-likes",(()=>{r().notificationComponents.postLiked=C,(0,s.extend)(l().prototype,"actionItems",(function(t){const e=this.attrs.post;if(e.isHidden()||!e.canLike())return;const s=e.likes();let o=r().session.user&&s&&s.some((t=>t===r().session.user));t.add("like",m(a(),{className:"Button Button--link",onclick:()=>{o=!o,e.save({isLiked:o});const t=e.data.relationships.likes.data;t.some(((e,s)=>{if(e.id===r().session.user.id())return t.splice(s,1),!0})),o&&t.unshift({type:"users",id:r().session.user.id()})}},r().translator.trans(o?"flarum-likes.forum.post.unlike_link":"flarum-likes.forum.post.like_link")))})),(0,s.extend)(l().prototype,"footerItems",(function(t){const e=this.attrs.post,s=e.likes();if(s&&s.length){const o=4,n=e.likesCount()>o,i=s.sort((t=>t===r().session.user?-1:1)).slice(0,n?o-1:o).map((t=>m(c(),{href:r().route.user(t)},t===r().session.user?r().translator.trans("flarum-likes.forum.post.you_text"):g()(t))));if(n){const t=e.likesCount()-i.length,s=r().translator.trans("flarum-likes.forum.post.others_link",{count:t});r().forum.attribute("canSearchUsers")?i.push(m(a(),{className:"Button Button--ua-reset Button--text",onclick:t=>{t.preventDefault(),r().modal.show(B,{post:e})}},s)):i.push(m("span",null,s))}t.add("liked",m("div",{className:"Post-likedBy"},h()("far fa-thumbs-up"),r().translator.trans("flarum-likes.forum.post.liked_by".concat(s[0]===r().session.user?"_self":"","_text"),{count:i.length,users:d()(i)})))}})),(0,s.extend)(O().prototype,"navItems",(function(t){const e=this.user;t.add("likes",m(F(),{href:r().route("user.likes",{username:null==e?void 0:e.slug()}),icon:"far fa-thumbs-up"},r().translator.trans("flarum-likes.forum.user.likes_link")),88)})),(0,s.extend)("flarum/forum/components/NotificationGrid","notificationTypes",(function(t){t.add("postLiked",{name:"postLiked",icon:"far fa-thumbs-up",label:r().translator.trans("flarum-likes.forum.settings.notify_post_liked_label")})}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map