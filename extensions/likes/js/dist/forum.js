(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>nt});const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/app"];var i=t.n(r);const o=flarum.core.compat["forum/components/NotificationGrid"];var a=t.n(o);const s=flarum.core.compat["common/components/Button"];var u=t.n(s);const l=flarum.core.compat["forum/components/CommentPost"];var c=t.n(l);const f=flarum.core.compat["common/components/Link"];var p=t.n(f);const d=flarum.core.compat["common/helpers/punctuateSeries"];var h=t.n(d);const g=flarum.core.compat["common/helpers/username"];var v=t.n(g);const b=flarum.core.compat["common/helpers/icon"];var y=t.n(b);function k(t,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},k(t,e)}function N(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,k(t,e)}const P=flarum.core.compat["common/components/Modal"];var x=t.n(P);const L=flarum.core.compat["common/helpers/avatar"];var _=t.n(L);function j(){return j=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},j.apply(this,arguments)}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var O=window;const A=new Proxy({},{get:function(t,e){return Reflect.get(O.app,e,O.app)},set:function(t,e,n){return Reflect.set(O.app,e,n,O.app)}});var B=function(t){function e(e,n){return void 0===n&&(n=1),e.page=j({},e.page||{},{limit:10}),t.call(this,e,n,10)||this}var n,r;return N(e,t),n=e,(r=[{key:"type",get:function(){return"users"}}])&&w(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}(function(){function t(t,e,n){void 0===t&&(t={}),void 0===e&&(e=1),void 0===n&&(n=20),this.location=void 0,this.pageSize=void 0,this.pages=[],this.params={},this.initialLoading=!1,this.loadingPrev=!1,this.loadingNext=!1,this.params=t,this.location={page:e},this.pageSize=n}var e=t.prototype;return e.clear=function(){this.pages=[],m.redraw()},e.loadPrev=function(){var t=this;if(this.loadingPrev||1===this.getLocation().page)return Promise.resolve();this.loadingPrev=!0;var e=this.getPrevPageNumber();return this.loadPage(e).then(this.parseResults.bind(this,e)).finally((function(){return t.loadingPrev=!1}))},e.loadNext=function(){var t=this;if(this.loadingNext)return Promise.resolve();this.loadingNext=!0;var e=this.getNextPageNumber();return this.loadPage(e).then(this.parseResults.bind(this,e)).finally((function(){return t.loadingNext=!1}))},e.parseResults=function(t,e){var n,r=Number(t),i=null==(n=e.payload)?void 0:n.links,o={number:r,items:e,hasNext:!(null==i||!i.next),hasPrev:!(null==i||!i.prev)};this.isEmpty()||r>this.getNextPageNumber()-1?this.pages.push(o):this.pages.unshift(o),this.location={page:r},m.redraw()},e.loadPage=function(t){void 0===t&&(t=1);var e=this.requestParams(),n=Array.isArray(e.include)?e.include.join(","):e.include,r=j({},e,{page:j({},e.page,{offset:this.pageSize*(t-1)}),include:n});return A.store.find(this.type,r)},e.requestParams=function(){return this.params},e.refreshParams=function(t,e){return this.isEmpty()||this.paramsChanged(t)?(this.params=t,this.refresh(e)):Promise.resolve()},e.refresh=function(t){var e=this;return void 0===t&&(t=1),this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1,this.clear(),this.location={page:t},this.loadPage().then((function(t){e.pages=[],e.parseResults(e.location.page,t)})).finally((function(){return e.initialLoading=!1}))},e.getPages=function(){return this.pages},e.getLocation=function(){return this.location},e.isLoading=function(){return this.initialLoading||this.loadingNext||this.loadingPrev},e.isInitialLoading=function(){return this.initialLoading},e.isLoadingPrev=function(){return this.loadingPrev},e.isLoadingNext=function(){return this.loadingNext},e.hasItems=function(){return!!this.getAllItems().length},e.isEmpty=function(){return!this.isInitialLoading()&&!this.hasItems()},e.hasPrev=function(){var t;return!(null==(t=this.pages[0])||!t.hasPrev)},e.hasNext=function(){var t;return!(null==(t=this.pages[this.pages.length-1])||!t.hasNext)},e.getParams=function(){return this.params},e.getNextPageNumber=function(){var t,e=null==(t=this.pages[this.pages.length-1])?void 0:t.number;return e&&!isNaN(e)?e+1:this.location.page},e.getPrevPageNumber=function(){var t,e=null==(t=this.pages[0])?void 0:t.number;return e&&!isNaN(e)?Math.max(e-1,1):this.location.page},e.paramsChanged=function(t){var e=this;return Object.keys(t).some((function(n){return e.getParams()[n]!==t[n]}))},e.getAllItems=function(){return this.getPages().map((function(t){return t.items})).flat()},t}());function I(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}var S=function(){function t(){this.element=void 0,this.attrs=void 0,this.state=void 0}var e=t.prototype;return e.oninit=function(t){this.setAttrs(t.attrs)},e.oncreate=function(t){this.element=t.dom},e.onbeforeupdate=function(t){this.setAttrs(t.attrs)},e.onupdate=function(t){},e.onbeforeremove=function(t){},e.onremove=function(t){},e.$=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=$(this.element);return t?e.find(t):e})),t.component=function(t,e){void 0===t&&(t={}),void 0===e&&(e=null);var n=j({},t);return m(this,n,e)},e.setAttrs=function(t){if(void 0===t&&(t={}),this.constructor.initAttrs(t),t){if("children"in t)throw new Error("["+this.constructor.name+'] The "children" attribute of attrs should never be used. Either pass children in as the vnode children or rename the attribute');if("tag"in t)throw new Error("["+this.constructor.name+'] You cannot use the "tag" attribute name with Mithril 2.')}this.attrs=t},t.initAttrs=function(t){},t}();function M(t){var e,n,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t)if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=M(t[e]))&&(r&&(r+=" "),r+=n);else for(e in t)t[e]&&(r&&(r+=" "),r+=e);return r}const C=function(){for(var t,e,n=0,r="";n<arguments.length;)(t=arguments[n++])&&(e=M(t))&&(r&&(r+=" "),r+=e);return r};function z(t){return t instanceof Array?t.map((function(t){return z(t)})).join(""):"object"==typeof t&&null!==t?t.children?z(t.children):String(t.text):String(t)}var R=["display","size","containerClassName","className"],E=function(t){function e(){return t.apply(this,arguments)||this}return N(e,t),e.prototype.view=function(){var t=this.attrs,e=t.display,n=void 0===e?"block":e,r=t.size,i=void 0===r?"medium":r,o=t.containerClassName,a=t.className,s=I(t,R),u=C("LoadingIndicator",a),l=C("LoadingIndicator-container","unset"!==n&&"LoadingIndicator-container--"+n,i&&"LoadingIndicator-container--"+i,o);return m("div",Object.assign({"aria-label":A.translator.trans("core.lib.loading_indicator.accessible_label"),role:"status"},s.containerAttrs,{"data-size":i,className:l}),m("div",Object.assign({"aria-hidden":"true",className:u},s)))},e}(S),T=["type","title","aria-label","icon","disabled","loading","className","class"],F=function(t){function e(){return t.apply(this,arguments)||this}N(e,t);var n=e.prototype;return n.view=function(t){var e=this.attrs,n=e.type,r=e.title,i=e["aria-label"],o=e.icon,a=e.disabled,s=e.loading,u=e.className,l=e.class,c=I(e,T);n||(n="button"),i||(i=r),"object"==typeof i&&(i=z(i)),(a||s)&&delete c.onclick;var f=j({disabled:a,className:u=C(l,u,{hasIcon:o,disabled:a||s,loading:s}),type:n,"aria-label":i},c);return m("button",f,this.getButtonContent(t.children))},n.oncreate=function(n){var r;t.prototype.oncreate.call(this,n);var i=this.attrs["aria-label"];this.view!==e.prototype.view||i||z(n.children)||null!=(r=this.element)&&null!=r.getAttribute&&r.getAttribute("aria-label")||function(){var t;A.forum.attribute("debug")&&(t=console).warn.apply(t,arguments)}('[Flarum Accessibility Warning] Button has no content and no accessible label. This means that screen-readers will not be able to interpret its meaning and just read "Button". Consider providing accessible text via the `aria-label` attribute. https://web.dev/button-name',this.element)},n.getButtonContent=function(t){var e,n,r=this.attrs.icon;return[r&&(e=r,n={className:"Button-icon"},void 0===n&&(n={}),n.className="icon "+e+" "+(n.className||""),m("i",Object.assign({"aria-hidden":"true"},n))),t&&m("span",{className:"Button-label"},t),this.attrs.loading&&m(E,{size:"small",display:"inline"})]},e}(S),U=function(t){function e(){return t.apply(this,arguments)||this}N(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state=new B({filter:{liked:this.attrs.post.id()}}),this.state.refresh()},n.className=function(){return"PostLikesModal Modal--small"},n.title=function(){return i().translator.trans("flarum-likes.forum.post_likes.title")},n.content=function(){var t=this;return m("[",null,m("div",{className:"Modal-body"},this.state.isInitialLoading()?m(E,null):m("ul",{className:"PostLikesModal-list"},this.state.getPages().map((function(t){return t.items.map((function(t){return m("li",null,m(p(),{href:i().route.user(t)},_()(t)," ",v()(t)))}))})))),this.state.hasNext()?m("div",{className:"Modal-footer"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m(F,{className:"Button Button--block",onclick:function(){return t.state.loadNext()},loading:this.state.isLoadingNext()},i().translator.trans("flarum-likes.forum.post_likes.load_more_button"))))):null)},e}(x());const q=flarum.core.compat["forum/components/Notification"];var D=t.n(q);const G=flarum.core.compat["common/utils/string"];var H=function(t){function e(){return t.apply(this,arguments)||this}N(e,t);var n=e.prototype;return n.icon=function(){return"far fa-thumbs-up"},n.href=function(){return i().route.post(this.attrs.notification.subject())},n.content=function(){var t=this.attrs.notification.fromUser();return i().translator.trans("flarum-likes.forum.notifications.post_liked_text",{user:t,count:1})},n.excerpt=function(){return(0,G.truncate)(this.attrs.notification.subject().contentPlain(),200)},e}(D());const W=flarum.core.compat["forum/components/UserPage"];var Y=t.n(W);const J=flarum.core.compat["common/components/LinkButton"];var K=t.n(J);const Q=flarum.core.compat["common/extenders"];var V=t.n(Q);const X=flarum.core.compat["common/models/Post"];var Z=t.n(X);const tt=flarum.core.compat["forum/components/PostsUserPage"];var et=function(t){function e(){return t.apply(this,arguments)||this}return N(e,t),e.prototype.loadResults=function(t){return i().store.find("posts",{filter:{type:"comment",likedBy:this.user.id()},page:{offset:t,limit:this.loadLimit},sort:"-createdAt"})},e}(t.n(tt)());const nt=[(new(V().Routes)).add("user.likes","/u/:username/likes",et),new(V().Model)(Z()).hasMany("likes").attribute("likesCount").attribute("canLike")];i().initializers.add("flarum-likes",(function(){i().notificationComponents.postLiked=H,(0,n.extend)(c().prototype,"actionItems",(function(t){var e=this.attrs.post;if(!e.isHidden()&&e.canLike()){var n=e.likes(),r=i().session.user&&n&&n.some((function(t){return t===i().session.user}));t.add("like",u().component({className:"Button Button--link",onclick:function(){r=!r,e.save({isLiked:r});var t=e.data.relationships.likes.data;t.some((function(e,n){if(e.id===i().session.user.id())return t.splice(n,1),!0})),r&&t.unshift({type:"users",id:i().session.user.id()})}},i().translator.trans(r?"flarum-likes.forum.post.unlike_link":"flarum-likes.forum.post.like_link")))}})),(0,n.extend)(c().prototype,"footerItems",(function(t){var e=this.attrs.post,n=e.likes();if(n&&n.length){var r=e.likesCount()>4,o=n.sort((function(t){return t===i().session.user?-1:1})).slice(0,r?3:4).map((function(t){return m(p(),{href:i().route.user(t)},t===i().session.user?i().translator.trans("flarum-likes.forum.post.you_text"):v()(t))}));if(r){var a=e.likesCount()-o.length,s=i().translator.trans("flarum-likes.forum.post.others_link",{count:a});i().forum.attribute("canSearchUsers")?o.push(m(F,{className:"Button Button--ua-reset Button--text",onclick:function(t){t.preventDefault(),i().modal.show(U,{post:e})}},s)):o.push(m("span",null,s))}t.add("liked",m("div",{className:"Post-likedBy"},y()("far fa-thumbs-up"),i().translator.trans("flarum-likes.forum.post.liked_by"+(n[0]===i().session.user?"_self":"")+"_text",{count:o.length,users:h()(o)})))}})),(0,n.extend)(Y().prototype,"navItems",(function(t){var e=this.user;t.add("likes",m(K(),{href:i().route("user.likes",{username:null==e?void 0:e.slug()}),icon:"far fa-thumbs-up"},i().translator.trans("flarum-likes.forum.user.likes_link")),88)})),(0,n.extend)(a().prototype,"notificationTypes",(function(t){t.add("postLiked",{name:"postLiked",icon:"far fa-thumbs-up",label:i().translator.trans("flarum-likes.forum.settings.notify_post_liked_label")})}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map