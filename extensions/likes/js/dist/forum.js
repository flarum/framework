(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{extend:()=>Q});const r=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","forum/app");var o=e.n(s);const n=flarum.reg.get("core","common/components/Button");var a=e.n(n);const i=flarum.reg.get("core","forum/components/CommentPost");var l=e.n(i);const u=flarum.reg.get("core","common/components/Link");var c=e.n(u);const f=flarum.reg.get("core","common/helpers/punctuateSeries");var d=e.n(f);const p=flarum.reg.get("core","common/helpers/username");var g=e.n(p);const k=flarum.reg.get("core","common/components/Icon");var h=e.n(k);const v=flarum.reg.get("core","common/components/Modal");var y=e.n(v);const b=flarum.reg.get("core","common/components/Avatar");var x=e.n(b);const N=flarum.reg.get("core","common/states/PaginatedListState");var _=e.n(N);class L extends(_()){constructor(e,t){void 0===t&&(t=1),e.page={...e.page||{},limit:10},super(e,t,10)}get type(){return"users"}}flarum.reg.add("flarum-likes","forum/states/PostLikesModalState",L);const P=flarum.reg.get("core","common/components/LoadingIndicator");var B=e.n(P);const M=flarum.reg.get("core","common/components/Form");var S=e.n(M);class w extends(y()){oninit(e){super.oninit(e),this.state=new L({filter:{liked:this.attrs.post.id()}}),this.state.refresh()}className(){return"PostLikesModal Modal--small"}title(){return o().translator.trans("flarum-likes.forum.post_likes.title")}content(){return m("[",null,m("div",{className:"Modal-body"},this.state.isInitialLoading()?m(B(),null):m("ul",{className:"PostLikesModal-list"},this.state.getPages().map((e=>e.items.map((e=>m("li",null,m(c(),{href:o().route.user(e)},m(x(),{user:e})," ",g()(e))))))))),this.state.hasNext()?m("div",{className:"Modal-footer"},m(S(),{className:"Form--centered"},m("div",{className:"Form-group"},m(a(),{className:"Button Button--block",onclick:()=>this.state.loadNext(),loading:this.state.isLoadingNext()},o().translator.trans("flarum-likes.forum.post_likes.load_more_button"))))):null)}}flarum.reg.add("flarum-likes","forum/components/PostLikesModal",w);const I=flarum.reg.get("core","forum/components/UserPage");var j=e.n(I);const O=flarum.reg.get("core","common/components/LinkButton");var U=e.n(O);const C=flarum.reg.get("core","common/extenders");var F=e.n(C);const G=flarum.reg.get("core","common/models/Post");var T=e.n(G);const q=flarum.reg.get("core","forum/components/PostsUserPage");var A=e.n(q);class K extends(A()){params(e){return{filter:{type:"comment",likedBy:e.id()}}}}flarum.reg.add("flarum-likes","forum/components/LikesUserPage",K);const z=flarum.reg.get("core","forum/components/Notification");var D=e.n(z);const H=flarum.reg.get("core","common/utils/string");class R extends(D()){icon(){return"far fa-thumbs-up"}href(){return o().route.post(this.attrs.notification.subject())}content(){const e=this.attrs.notification.fromUser();return o().translator.trans("flarum-likes.forum.notifications.post_liked_text",{user:e,count:1})}excerpt(){return(0,H.truncate)(this.attrs.notification.subject().contentPlain(),200)}}flarum.reg.add("flarum-likes","forum/components/PostLikedNotification",R);const V=flarum.reg.get("core","common/query/IGambit"),$=flarum.reg.get("core","common/app");var E=e.n($);class J extends V.KeyValueGambit{key(){return E().translator.trans("flarum-likes.lib.gambits.posts.likedBy.key",{},!0)}hint(){return E().translator.trans("flarum-likes.lib.gambits.posts.likedBy.hint",{},!0)}filterKey(){return"likedBy"}}flarum.reg.add("flarum-likes","common/query/posts/LikedByGambit",J);const Q=[(new(F().Search)).gambit("posts",J),(new(F().Routes)).add("user.likes","/u/:username/likes",K),(new(F().Notification)).add("postLiked",R),new(F().Model)(T()).hasMany("likes").attribute("likesCount").attribute("canLike")];o().initializers.add("flarum-likes",(()=>{(0,r.extend)(l().prototype,"actionItems",(function(e){const t=this.attrs.post;if(t.isHidden()||!t.canLike())return;const r=t.likes();let s=o().session.user&&r&&r.some((e=>e===o().session.user));e.add("like",m(a(),{className:"Button Button--link",onclick:()=>{s=!s,t.save({isLiked:s});const e=t.data.relationships.likes.data;e.some(((t,r)=>{if(t.id===o().session.user.id())return e.splice(r,1),!0})),s&&e.unshift({type:"users",id:o().session.user.id()})}},o().translator.trans(s?"flarum-likes.forum.post.unlike_link":"flarum-likes.forum.post.like_link")))})),(0,r.extend)(l().prototype,"footerItems",(function(e){const t=this.attrs.post,r=t.likes();if(r&&r.length){const s=4,n=t.likesCount()>s,i=r.sort((e=>e===o().session.user?-1:1)).slice(0,n?s-1:s).map((e=>m(c(),{href:o().route.user(e)},e===o().session.user?o().translator.trans("flarum-likes.forum.post.you_text"):g()(e))));if(n){const e=t.likesCount()-i.length,r=o().translator.trans("flarum-likes.forum.post.others_link",{count:e});o().forum.attribute("canSearchUsers")?i.push(m(a(),{className:"Button Button--ua-reset Button--text",onclick:e=>{e.preventDefault(),o().modal.show(w,{post:t})}},r)):i.push(m("span",null,r))}e.add("liked",m("div",{className:"Post-likedBy"},m(h(),{name:"far fa-thumbs-up"}),o().translator.trans(`flarum-likes.forum.post.liked_by${r[0]===o().session.user?"_self":""}_text`,{count:i.length,users:d()(i)})))}})),(0,r.extend)(j().prototype,"navItems",(function(e){const t=this.user;e.add("likes",m(U(),{href:o().route("user.likes",{username:t?.slug()}),icon:"far fa-thumbs-up"},o().translator.trans("flarum-likes.forum.user.likes_link")),88)})),(0,r.extend)("flarum/forum/components/NotificationGrid","notificationTypes",(function(e){e.add("postLiked",{name:"postLiked",icon:"far fa-thumbs-up",label:o().translator.trans("flarum-likes.forum.settings.notify_post_liked_label")})})),(0,r.override)("flarum/forum/components/SearchModal","defaultActiveSource",(function(e){const t=e();return!t&&o().current.data.routeName&&o().current.data.routeName.includes("user.likes")&&o().current.data.user?"posts":t})),(0,r.extend)("flarum/forum/components/SearchModal","defaultFilters",(function(e){o().current.data.routeName&&o().current.data.routeName.includes("user.likes")&&o().current.data.user&&(e.posts.likedBy=o().current.data.user.username())}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map