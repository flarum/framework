{"version":3,"sources":["webpack://@flarum/markdown/webpack/bootstrap","webpack://@flarum/markdown/external \"flarum.core.compat['extend']\"","webpack://@flarum/markdown/external \"flarum.core.compat['components/TextEditor']\"","webpack://@flarum/markdown/external \"flarum.core.compat['Component']\"","webpack://@flarum/markdown/external \"flarum.core.compat['helpers/icon']\"","webpack://@flarum/markdown/./node_modules/mdarea/dist/index.min.js","webpack://@flarum/markdown/external \"flarum.core.compat['utils/BasicEditorDriver']\"","webpack://@flarum/markdown/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flarum/markdown/./src/forum/components/MarkdownToolbar.js","webpack://@flarum/markdown/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flarum/markdown/./src/forum/util/insertText.js","webpack://@flarum/markdown/./src/forum/util/styles.js","webpack://@flarum/markdown/./src/forum/util/apply.js","webpack://@flarum/markdown/./src/forum/components/MarkdownButton.js","webpack://@flarum/markdown/./src/forum/util/MarkdownEditorDriver.js","webpack://@flarum/markdown/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","e","u","a","h","f","enter","lastIndexOf","substring","exec","line","offset","prefix","charAt","length","shiftKey","indent","test","replace","parseInt","v","outdent","reOutdent","inline","slice","y","this","options","keyMap","find","action","navigator","platform","g","userAgent","x","k","b","Array","isArray","toString","trim","split","push","apply","map","E","forEach","ctrlKey","altKey","metaKey","toLowerCase","K","document","createElement","setAttribute","tabIndex","contentEditable","textContent","addEventListener","setTimeout","blur","style","position","overflow","left","top","width","height","opacity","w","selectionStart","selectionEnd","scrollLeft","scrollTop","L","lock","elem","T","A","defaultPrevented","extensions","handleKey","preventDefault","C","type","execCommand","O","idx","helper","state","history","S","I","$","splice","focus","assign","scrollTo","D","join","RegExp","ed","onKeyDown","onInput","onUndo","body","appendChild","setElement","cleanup","removeEventListener","init","removeChild","destroy","version","_inheritsLoose","subClass","superClass","constructor","__proto__","modifierKey","match","MarkdownToolbar","oncreate","vnode","attrs","setShortcutHandler","shortcut","view","id","data-for","for","display","children","event","button","element","querySelector","click","Component","_extends","target","arguments","source","canInsertText","isMultipleLines","string","repeat","wordSelectionStart","text","index","wordSelectionEnd","multiline","breakpoint","newlinesToSurroundSelectedText","textarea","newlinesToAppend","newlinesToPrepend","beforeSelection","afterSelection","breaksBefore","breaksAfter","newlinesBeforeSelection","newlinesAfterSelection","blockStyle","arg","suffix","blockPrefix","blockSuffix","replaceNext","prefixSpace","scanFor","surroundWithNewlines","originalSelectionStart","originalSelectionEnd","selectedText","prefixToUse","suffixToUse","undefined","expandedSelectionStart","expandedSelectionEnd","beginsWithPrefix","endsWithSuffix","expandSelectedText","hasReplaceNext","indexOf","ref","startsWith","endsWith","replacementText","Math","max","min","whitespaceEdges","trimFirst","leadingWhitespace","trailingWhitespace","styleSelectedText","styleArgs","result","orderedList","startOfLine","endOfLine","orderedListRegex","noInitialSelection","textToUnstyle","lines","linesBefore","linesToUnstyle","every","lengthDiff","len","results","multilineStyle","before","after","error","createEvent","initEvent","dispatchEvent","setSelectionRange","insertText","MarkdownButton","tooltip","className","title","data-hotkey","hotkey","onclick","onkeydown","keydown","icon","stylesToApply","toolbar","parentElement","field","getElementById","dataset","MarkdownEditorFlarumExtension","oninput","callInputListeners","onsubmit","selection","postfix","evt","MarkdownEditorDriver","build","dom","params","app","forum","attribute","el","classNames","disabled","placeholder","append","inputListeners","listener","redraw","CustomEvent","mdarea","MarkdownArea","textareaId","shortcutHandler","BasicEditorDriver","initializers","add","extend","TextEditor","override","_","buildEditorParams","items","translator","trans","handler"],"mappings":"2BACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,gBClFrDhC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAe,Q,cCA5CnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,0B,eCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAkB,W,cCA/CnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,iB,gBCAgCnC,EAAOD,QAAyI,WAAY,aAAa,MAAMqC,EAAE,0EAA0EjB,EAAE,2CAA2CO,EAAE,iBAAiBzB,EAAE,UAAU+B,EAAE,qBAAqBtB,EAAE,wEAAwEK,EAAE,OAAOb,EAAE,+BAA+BmC,EAAE,YAAY/B,EAAE,WAAWC,EAAE,CAAC,IAAI,QAAQ,IAAI,SAAS+B,EAAE,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAAKC,EAAE,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAAKC,EAAE,CAACC,MAAM,CAACf,EAAEzB,EAAEc,EAAEb,EAAEI,KAAK,MAAMC,EAAEQ,EAAE,KAAK,SAASI,GAAG,MAAMO,EAAEP,EAAEuB,YAAY,MAAM,EAAEzC,EAAEkB,EAAEwB,UAAUjB,GAAGM,EAAEI,EAAEQ,KAAK3C,GAAG,MAAM,CAAC4C,KAAK5C,EAAE6C,OAAOpB,EAAEqB,OAAOf,GAAGA,EAAE,IAA1G,CAA+G/B,GAAG,GAAGM,EAAE,GAAGA,EAAEsC,MAAMtC,EAAEsC,KAAKG,OAAOzC,EAAEsC,KAAKI,OAAO,KAAKX,EAAE,CAAC,MAAMF,EAAE7B,EAAEwC,OAAOhB,EAAExB,EAAEwC,QAAO,GAAI,GAAG7C,EAAE,KAAKkC,EAAElC,EAAEI,EAAE4C,WAAWjD,GAAG,KAAKmC,EAAEV,EAAEyB,aAAa5C,EAAEwC,QAAQzC,EAAE4C,UAAU3C,EAAEwC,SAASxC,EAAEsC,MAAMR,EAAEe,KAAKlD,GAAGD,EAAEA,EAAE0C,UAAU,EAAEpC,EAAEuC,QAAQ,SAASV,GAAG,OAAOA,EAAEiB,QAAQ3C,EAAE,IAA/B,CAAoCH,EAAEwC,SAASzC,EAAE4C,UAAU,SAASd,GAAG,OAAOjB,EAAEiC,KAAKhB,GAA1B,CAA8B7B,EAAEwC,QAAQ9C,GAAG,KAAK,SAASmC,GAAG,OAAOA,EAAEiB,QAAQrB,GAAE,SAAUI,EAAEjB,GAAG,OAAOmC,SAASnC,GAAG,EAAE,OAAnE,CAA2EZ,EAAEwC,QAAQ9C,GAAG,KAAK8B,EAAExB,EAAEwC,OAAOzC,EAAE4C,UAAUjD,GAAG,UAAUA,GAAG,KAAK,MAAM,CAACsD,EAAEtD,EAAEC,EAAE8B,EAAE/B,EAAEgD,SAASE,OAAO,CAACf,EAAEjB,EAAEO,EAAEzB,KAAK,IAAI+B,EAAEb,EAAE8B,OAAOvC,EAAES,EAAEuB,YAAY,MAAM,EAAE,OAAOhC,EAAEsB,IAAIN,EAAEP,EAAEwB,UAAUjC,GAAGgB,EAAEP,EAAEA,EAAEwB,UAAU,EAAEjC,KAAKA,EAAEsB,IAAIN,KAAKM,GAAGI,EAAEe,OAAOF,QAAQvB,EAAEA,EAAEA,EAAE2B,QAAQ/C,EAAE8B,EAAEe,QAAQhC,GAAGiB,EAAEe,OAAO,CAACI,EAAEpC,EAAEO,EAAEzB,EAAE+B,EAAEA,EAAEI,EAAEV,EAAEhB,EAAEgB,EAAEuB,OAAOjB,IAAIwB,QAAQ,CAACpB,EAAEjB,EAAEO,EAAEzB,KAAK,IAAI+B,EAAEb,EAAE8B,OAAOvC,EAAES,EAAEuB,YAAY,MAAM,EAAE,OAAOhC,EAAEsB,IAAIN,EAAEP,EAAEwB,UAAUjC,GAAGgB,EAAEP,EAAEA,EAAEwB,UAAU,EAAEjC,GAAGgB,EAAEiB,UAAU,EAAEP,EAAEe,OAAOF,UAAUb,EAAEe,SAASnB,GAAGI,EAAEe,OAAOF,SAAS,CAACM,EAAEpC,GAAGO,EAAEA,EAAE2B,QAAQjB,EAAEqB,UAAU,KAAKxD,EAAE+B,EAAEA,EAAEI,EAAE1B,EAAEgB,EAAEuB,SAASS,OAAO,CAACtB,EAAEjB,EAAEO,EAAEzB,EAAE+B,IAAIN,GAAGM,EAAER,OAAOc,GAAGrC,EAAE+C,OAAO,KAAKhB,EAAER,IAAIE,IAAI,MAAMM,EAAER,KAAKtB,EAAEkD,KAAKjC,OAAOa,EAAER,OAAOe,IAAIb,GAAGM,EAAER,OAAOjB,GAAGA,EAAEyB,EAAER,KAAK4B,KAAKjC,GAAG,CAACoC,EAAEpC,EAAEa,EAAER,IAAI,aAAaQ,EAAER,IAAIQ,EAAER,IAAIQ,EAAER,KAAK,OAAOvB,EAAE+C,OAAO,GAAG,KAAK,IAAI/C,EAAE+B,EAAEb,EAAE8B,OAAO,EAAEb,EAAEjB,EAAE8B,OAAO,GAAGjB,EAAER,MAAML,EAAEwC,OAAO,IAAI3B,EAAER,MAAMvB,EAAE0D,MAAM,EAAE,GAAG,CAACJ,EAAEpC,EAAEwC,MAAM,GAAG,GAAGjC,EAAEzB,EAAE0D,MAAM,GAAG3B,EAAEb,EAAE8B,OAAO,EAAEb,EAAEjB,EAAE8B,OAAO,EAAEvB,EAAEuB,QAAQ,CAACM,EAAEpC,GAAGoB,EAAEP,EAAER,MAAMQ,EAAER,KAAKE,GAAGY,EAAEN,EAAER,MAAMQ,EAAER,KAAKvB,EAAE+B,EAAEb,EAAE8B,OAAO,EAAEb,EAAEjB,EAAE8B,OAAO,EAAEvB,EAAEuB,QAAQ,CAACM,EAAEpC,EAAEa,EAAER,IAAIvB,EAAE+B,EAAEb,EAAE8B,OAAO,GAAG,CAACM,EAAEpC,GAAGJ,EAAEqC,KAAKpB,EAAER,KAAKQ,EAAER,IAAIQ,EAAER,IAAI,IAAIvB,EAAE+B,EAAEb,EAAE8B,OAAO,IAAI,MAAMW,EAAE,YAAYxB,GAAGyB,KAAKC,QAAQ1B,EAAE,UAAUA,EAAEjB,EAAEO,EAAEzB,GAAG,MAAM+B,EAAE6B,KAAKC,QAAQC,OAAOC,KAAM5B,GAAG,SAASA,EAAEjB,GAAG,IAAI,MAAMO,KAAKP,EAAE,GAAGA,EAAEW,eAAeJ,IAAIU,EAAEV,KAAKP,EAAEO,GAAG,OAAM,EAAG,OAAM,EAAlF,CAAsFzB,EAAEmC,EAAEZ,MAAO,GAAGQ,GAAGQ,EAAER,EAAEiC,QAAQ,OAAOzB,EAAER,EAAEiC,QAAQJ,KAAKC,QAAQ1B,EAAEjB,EAAEO,EAAEzB,IAAI,SAAS8B,EAAEK,EAAEjB,GAAG,OAAOiB,EAAEiB,QAAQlC,EAAElB,EAAEyB,EAAE,KAAK,MAAMrB,EAAE,wBAAwB+C,KAAKc,UAAUC,UAAUC,EAAE,WAAWhB,KAAKc,UAAUG,WAAWC,EAAEjE,EAAE,UAAU,UAAUkE,EAAE,CAAC9B,MAAM,CAAC,QAAQ,eAAeU,OAAO,CAAC,MAAM,SAASK,QAAQ,CAAC,YAAY,eAAeE,OAAO,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,MAAgQ,SAASc,EAAEpC,EAAE,IAAI,MAAMjB,EAAE,GAAGO,EAAE,GAAG,IAAI,IAAIzB,KAAKsE,EAAE,GAAGA,EAAEzC,eAAe7B,GAAG,CAAC,IAAI+B,EAAEI,EAAEnC,IAAIsE,EAAEtE,GAAGwE,MAAMC,QAAQ1C,KAAKA,EAAEA,EAAE2C,WAAWC,OAAOC,MAAM,gBAAgBnD,EAAEoD,KAAKC,MAAMrD,EAAEM,EAAEgD,IAAK5C,IAAI,MAAMV,EAAEuD,EAAE7C,GAAG,OAAOV,EAAEF,OAAOL,IAAIA,EAAEO,EAAEF,KAAK,KAAKL,EAAEO,EAAEF,KAAK,CAACA,IAAIE,EAAEuC,OAAOhE,MAAO,OAAOyB,EAAEwD,QAAS9C,IAAI,IAAIV,EAAEP,EAAEiB,EAAEZ,IAAIA,KAAK,IAAI,YAAYE,EAAEU,EAAEZ,OAAOE,EAAEyD,SAAQ,GAAI,WAAWzD,IAAIA,EAAE0D,QAAO,GAAI,aAAa1D,IAAIA,EAAEwB,UAAS,GAAI,YAAYxB,IAAIA,EAAE2D,SAAQ,MAAQ3D,EAAE,SAASuD,EAAE7C,GAAG,MAAMjB,EAAE,GAAG,OAAOiB,EAAEwC,OAAOC,MAAM,aAAaK,SAAQ,SAAU9C,GAAG,OAAOA,EAAEkD,eAAe,IAAI,MAAMnE,EAAEmD,IAAG,EAAG,MAAM,IAAI,OAAO,IAAI,MAAM,IAAI,QAAQ,IAAI,OAAOnD,EAAEiB,EAAEkD,cAAc,QAAO,EAAG,MAAM,QAAQnE,EAAEK,IAAIY,MAAMjB,EAAE,SAASoE,IAAI,MAAMnD,EAAEoD,SAASC,cAAc,OAAO,OAAOrD,EAAEsD,aAAa,cAAc,QAAQtD,EAAEuD,UAAU,EAAEvD,EAAEwD,iBAAgB,EAAGxD,EAAEyD,YAAY,IAAIzD,EAAE0D,iBAAiB,QAAQ,IAAKC,WAAW,IAAK3D,EAAE4D,OAAQ,IAAK5D,EAAE6D,MAAMC,SAAS,QAAQ9D,EAAE6D,MAAME,SAAS,SAAS/D,EAAE6D,MAAMG,KAAK,UAAUhE,EAAE6D,MAAMI,IAAI,MAAMjE,EAAE6D,MAAMK,MAAMlE,EAAE6D,MAAMM,OAAO,MAAMnE,EAAE6D,MAAMO,QAAQ,IAAIpE,EAAE,SAASqE,EAAErE,EAAEjB,GAAE,GAAI,MAAM,CAACa,EAAEI,EAAEsE,eAAetE,EAAEA,EAAEuE,aAAarC,EAAElC,EAAEwE,WAAWhD,EAAExB,EAAEyE,UAAUtD,EAAEnB,EAAElB,MAAMmC,QAAQ,UAAU,KAAK/C,EAAEa,GAAG,SAAS2F,EAAE1E,EAAEjB,GAAGiB,EAAE2E,MAAK,EAAG,MAAMrF,OAAE,IAASP,EAAEiB,EAAEjB,EAAEa,EAAEb,EAAEiB,EAAEnC,OAAE,IAASkB,EAAEmD,EAAElC,EAAE4E,KAAKJ,WAAWzF,EAAEmD,EAAEtC,OAAE,IAASb,EAAEyC,EAAExB,EAAE4E,KAAKH,UAAU1F,EAAEyC,EAAEqD,EAAE7E,EAAE,IAAIjB,EAAEiB,EAAEV,EAAE4C,EAAErE,EAAE2D,EAAE5B,EAAE1B,GAAE,IAAI,GAAI8B,EAAE2E,MAAK,EAAG,SAASG,EAAE9E,EAAEjB,GAAG,IAAIiB,EAAE4E,MAAM7F,EAAEgG,iBAAiB,OAAO,GAAG/C,GAAGjD,EAAEmD,IAAI,MAAMnD,EAAEK,IAAI,YAAYY,EAAE4E,KAAKhB,OAAO,MAAMtE,EAAE+E,EAAErE,EAAE4E,MAAM/G,EAAEyB,EAAE6B,EAAEZ,UAAU,EAAEjB,EAAEM,GAAGA,EAAEN,EAAE6B,EAAEZ,UAAUjB,EAAEM,EAAEN,EAAEU,GAAG1B,EAAEgB,EAAE6B,EAAEZ,UAAUjB,EAAEU,GAAG,IAAI,IAAIV,EAAE,EAAEX,EAAEqB,EAAE0B,QAAQsD,WAAWnE,OAAOvB,EAAEX,EAAEW,IAAI,CAAC,MAAMX,EAAEqB,EAAE0B,QAAQsD,WAAW1F,GAAG2F,UAAUpH,EAAE+B,EAAEtB,EAAES,GAAG,GAAGJ,EAAE,CAACI,EAAEmG,iBAAiBR,EAAE1E,EAAErB,GAAG,QAAQ,SAASwG,EAAEnF,EAAEjB,GAAG,GAAGiB,EAAE2E,MAAM,oBAAoB5F,EAAEqG,KAAK,OAAOpF,EAAE2E,MAAK,EAAG,MAAMrF,EAAE+E,EAAErE,EAAE4E,MAAMxB,SAASiC,YAAY,QAAQR,EAAE7E,EAAEV,GAAGU,EAAE2E,MAAK,EAAG,SAASW,EAAEtF,GAAGA,EAAE2E,OAAO3E,EAAE2E,MAAK,EAAG3E,EAAEuF,MAAMvF,EAAEwF,OAAO/B,aAAa,KAAKzD,EAAEyF,MAAMzF,EAAE0F,QAAQ1F,EAAEuF,KAAKI,EAAE3F,EAAE4E,KAAK5E,EAAEyF,OAAOzF,EAAE2E,MAAK,GAAI,SAASiB,EAAE5F,GAAGA,EAAEwF,OAAO/B,YAAY,IAAIzD,EAAEyF,MAAMpB,EAAErE,EAAE4E,MAAM5E,EAAE0F,QAAQ,CAAC1F,EAAEyF,OAAOzF,EAAEuF,IAAI,EAAE,SAASV,EAAE7E,EAAEjB,EAAEO,GAAE,IAAKU,EAAEuF,IAAI,GAAGjG,IAAIU,EAAEyF,MAAMvH,IAAI2H,EAAE7F,EAAEqE,EAAErE,EAAE4E,MAAK,IAAK5E,EAAEyF,MAAMvH,EAAE,SAAS8B,EAAEjB,GAAGiB,EAAE0F,QAAQI,SAAS9F,EAAEuF,IAAIvF,EAAE0F,QAAQ7E,OAAO9B,GAAGiB,EAAEyF,MAAM1G,EAAEiB,EAAEwF,OAAOO,QAAQ3C,SAASiC,YAAY,aAAajC,SAASiC,YAAY,cAAa,EAAGrF,EAAEuF,IAAIhD,YAAnK,CAAgLvC,EAAEjB,GAAG8G,EAAE7F,EAAEjB,GAAG4G,EAAE3F,EAAE4E,KAAK5E,EAAEyF,OAAO,SAASI,EAAE7F,EAAEjB,GAAGR,OAAOyH,OAAOhG,EAAEyF,MAAM1G,GAAG,SAAS4G,EAAE3F,EAAEjB,GAAGiB,EAAElB,MAAMC,EAAEoC,EAAEnB,EAAEsE,eAAevF,EAAEa,EAAEI,EAAEuE,aAAaxF,EAAEiB,EAAEA,EAAEiG,SAASlH,EAAEmD,EAAEnD,EAAEyC,GAAGxB,EAAE+F,QAAQ,MAAMG,EAAE,YAAYlG,EAAEjB,GAAG,MAAMO,EAAzoF,SAAWU,EAAE,IAAI,MAAMjB,EAAE,SAASiB,EAAE,GAAyC,MAAtC,iBAAiBA,IAAIA,GAAGA,EAAE,IAAIa,QAAe,IAAIwB,MAAMrC,EAAE,GAAGmG,KAAK,KAA/E,CAAqFnG,EAAEe,QAAQzB,EAAE,CAACyB,OAAOhC,EAAEsC,UAAU,IAAI+E,OAAO,IAAIrH,EAAE,MAAM4C,OAAOS,EAAEpC,EAAE2B,QAAQqD,WAAWhF,EAAEgF,YAAY,IAAI,OAAO1F,EAAE0F,WAAWtC,KAAK,IAAIlB,EAAElC,IAAIA,EAAm5E6B,CAAEpC,GAAGlB,EAAE4D,KAAK4E,GAAG,CAACzB,KAAK5E,EAAE0B,QAAQpC,EAAEkG,OAAOrC,IAAIuC,QAAQ,GAAGD,WAAM,EAAOF,KAAK,EAAEZ,MAAK,GAAI9G,EAAEyI,UAAUxB,EAAEzF,KAAK,KAAKxB,GAAGA,EAAE0I,QAAQpB,EAAE9F,KAAK,KAAKxB,GAAGA,EAAE2I,OAAOlB,EAAEjG,KAAK,KAAKxB,GAAGA,EAAE2H,OAAO9B,iBAAiB,QAAQ7F,EAAE2I,QAAQpD,SAASqD,KAAKC,YAAY7I,EAAE2H,QAAQ/D,KAAKkF,WAAW3G,GAAG,aAAa,OAAOyB,KAAK4E,GAAGzB,KAAK,WAAW5E,GAAGyB,KAAK4E,GAAGzB,OAAOnD,KAAK4E,GAAG3E,QAAQsD,WAAWlC,QAAS9C,GAAGA,EAAE4G,SAAS5G,EAAE4G,QAAQnF,OAAQA,KAAK4E,GAAGzB,KAAKiC,oBAAoB,QAAQpF,KAAK4E,GAAGE,SAAS9E,KAAK4E,GAAGzB,KAAKiC,oBAAoB,UAAUpF,KAAK4E,GAAGC,YAAY7E,KAAK4E,GAAGzB,KAAK5E,EAAEA,EAAE0D,iBAAiB,UAAUjC,KAAK4E,GAAGC,WAAWtG,EAAE0D,iBAAiB,QAAQjC,KAAK4E,GAAGE,SAASX,EAAEnE,KAAK4E,IAAI5E,KAAK4E,GAAG3E,QAAQsD,WAAWlC,QAAS9C,GAAGA,EAAE8G,MAAM9G,EAAE8G,KAAKrF,OAAQ,WAAW,OAAOA,KAAK4E,GAAGzB,KAAK9F,MAAMmC,QAAQ,UAAU,KAAK,SAASjB,EAAEjB,GAAE,GAAI0C,KAAK4E,GAAGzB,KAAK9F,MAAMkB,EAAEjB,GAAG6G,EAAEnE,KAAK4E,IAAI,UAAUrG,GAAG0E,EAAEjD,KAAK4E,GAAGrG,GAAG,UAAU,OAAOyB,KAAK4E,GAAG3E,QAAQsD,WAAWlC,QAAS9C,GAAGA,EAAE4G,SAAS5G,EAAE4G,QAAQnF,OAAQA,KAAK4E,GAAGzB,KAAKiC,oBAAoB,UAAUpF,KAAK4E,GAAGC,WAAW7E,KAAK4E,GAAGzB,KAAKiC,oBAAoB,QAAQpF,KAAK4E,GAAGE,SAAS9E,KAAK4E,GAAGb,OAAOqB,oBAAoB,QAAQpF,KAAK4E,GAAGG,QAAQpD,SAASqD,KAAKM,YAAYtF,KAAK4E,GAAGb,QAAQ/D,KAAK4E,GAAG3E,QAAQsD,WAAWlC,QAAS9C,GAAGA,EAAEgH,SAAShH,EAAEgH,WAAYzI,OAAOyH,OAAOvE,KAAK4E,GAAG,CAACzB,KAAK,KAAKY,OAAO,KAAK9D,QAAQ,KAAKL,UAAU,KAAKiF,UAAU,KAAKC,QAAQ,KAAKC,OAAO,KAAKd,QAAQ,OAAOnH,OAAOyH,OAAOvE,KAAK,CAAC4E,GAAG,OAAO,MAAM,OAAO,SAASrG,GAAGA,EAAEiH,QAAQ,SAAtB,CAAgCf,IAAIA,EAAE,KAAKA,EAAprNnH,I,cCAnFnB,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,4B,+DCArB,SAASmH,EAAeC,EAAUC,GAC/CD,EAAS1H,UAAYlB,OAAOY,OAAOiI,EAAW3H,WAC9C0H,EAAS1H,UAAU4H,YAAcF,EACjCA,EAASG,UAAYF,E,oBCDjBG,EAAczF,UAAUG,UAAUuF,MAAM,aAAe,OAAS,UAEjDC,E,gGACnBC,SAAA,SAASC,GACP,YAAMD,SAAN,UAAeC,GAEflG,KAAKmG,MAAMC,mBAAmBpG,KAAKqG,SAASzI,KAAKoC,Q,EAGnDsG,KAAA,SAAKJ,GACH,OAAO,SAAKK,GAAG,kBAAkBC,WAAUxG,KAAKmG,MAAMM,IAAKrE,MAAO,CAAEsE,QAAS,iBAC1ER,EAAMS,W,EAIXN,SAAA,SAASO,GACP,GAAKA,EAAMpF,SAA2B,SAAhBsE,GAA4Bc,EAAMtF,SAA2B,YAAhBwE,EAA4B,CAC7F,IAAMe,EAAS7G,KAAK8G,QAAQC,cAAb,iBAA4CH,EAAMjJ,IAAlD,MAEXkJ,IACFA,EAAOG,QACPJ,EAAMnD,oB,GAnB+BwD,K,gBCJ9B,SAASC,IAetB,OAdAA,EAAWpK,OAAOyH,QAAU,SAAU4C,GACpC,IAAK,IAAI/K,EAAI,EAAGA,EAAIgL,UAAUhI,OAAQhD,IAAK,CACzC,IAAIiL,EAASD,UAAUhL,GAEvB,IAAK,IAAIuB,KAAO0J,EACVvK,OAAOkB,UAAUC,eAAe1B,KAAK8K,EAAQ1J,KAC/CwJ,EAAOxJ,GAAO0J,EAAO1J,IAK3B,OAAOwJ,IAGOjG,MAAMlB,KAAMoH,WCVvB,IAAIE,EAAgB,KCApB,SAASC,EAAgBC,GAC9B,OAAOA,EAAOzG,OAAOC,MAAM,MAAM5B,OAAS,EAGrC,SAASqI,EAAOD,EAAQ3J,GAC7B,OAAO+C,MAAM/C,EAAI,GAAG6G,KAAK8C,GAGpB,SAASE,EAAmBC,EAAMvL,GAGvC,IAFA,IAAIwL,EAAQxL,EAELuL,EAAKC,IAA6B,MAAnBD,EAAKC,EAAQ,KAAeD,EAAKC,EAAQ,GAAG7B,MAAM,OACtE6B,IAGF,OAAOA,EAGF,SAASC,EAAiBF,EAAMvL,EAAG0L,GAIxC,IAHA,IAAIF,EAAQxL,EACN2L,EAAaD,EAAY,KAAO,KAE/BH,EAAKC,KAAWD,EAAKC,GAAO7B,MAAMgC,IACvCH,IAGF,OAAOA,EAwBF,SAASI,EAA+BC,GAC7C,IAMIC,EACAC,EAPEC,EAAkBH,EAAS5K,MAAMyC,MAAM,EAAGmI,EAASpF,gBACnDwF,EAAiBJ,EAAS5K,MAAMyC,MAAMmI,EAASnF,cAC/CwF,EAAeF,EAAgBrC,MAAM,QACrCwC,EAAcF,EAAetC,MAAM,QACnCyC,EAA0BF,EAAeA,EAAa,GAAGlJ,OAAS,EAClEqJ,EAAyBF,EAAcA,EAAY,GAAGnJ,OAAS,EAoBrE,OAhBIgJ,EAAgBrC,MAAM,OAASyC,EAA0B,IAC3DN,EAAmBT,EAAO,KAAM,EAAIe,IAGlCH,EAAetC,MAAM,OAAS0C,EAAyB,IACzDN,EAAoBV,EAAO,KAAM,EAAIgB,IAGf,MAApBP,IACFA,EAAmB,IAGI,MAArBC,IACFA,EAAoB,IAGf,CACLD,mBACAC,qBAIG,IAAMO,EAAa,SAACT,EAAUU,GACnC,IAEQzJ,EAAsGyJ,EAAtGzJ,OAAQ0J,EAA8FD,EAA9FC,OAAQC,EAAsFF,EAAtFE,YAAaC,EAAyEH,EAAzEG,YAAaC,EAA4DJ,EAA5DI,YAAaC,EAA+CL,EAA/CK,YAAaC,EAAkCN,EAAlCM,QAASC,EAAyBP,EAAzBO,qBAC/EC,EAAyBlB,EAASpF,eAClCuG,EAAuBnB,EAASnF,aAClCuG,EAAepB,EAAS5K,MAAMyC,MAAMmI,EAASpF,eAAgBoF,EAASnF,cACtEwG,EAAc/B,EAAgB8B,IAAiBR,EAAYzJ,OAAS,EAAOyJ,EAA7D,KAA+E3J,EAC7FqK,EAAchC,EAAgB8B,IAAiBP,EAAY1J,OAAS,EAAtD,KAA+D0J,EAAgBF,EAEjG,GAAII,EAAa,CACf,IAAMZ,EAAkBH,EAAS5K,MAAM4K,EAASpF,eAAiB,GACjC,IAA5BoF,EAASpF,gBAA2C,MAAnBuF,GAA4BA,EAAgBrC,MAAM,QACrFuD,EAAc,IAAIA,GAItBD,EAtEK,SAA4BpB,EAAUqB,EAAaC,GACxD,IAAIzB,EAAYV,UAAUhI,OAAS,QAAsBoK,IAAjBpC,UAAU,IAAmBA,UAAU,GAE/E,GAAIa,EAASpF,iBAAmBoF,EAASnF,aACvCmF,EAASpF,eAAiB6E,EAAmBO,EAAS5K,MAAO4K,EAASpF,gBACtEoF,EAASnF,aAAe+E,EAAiBI,EAAS5K,MAAO4K,EAASnF,aAAcgF,OAC3E,CACL,IAAM2B,EAAyBxB,EAASpF,eAAiByG,EAAYlK,OAC/DsK,EAAuBzB,EAASnF,aAAeyG,EAAYnK,OAC3DuK,EAAmB1B,EAAS5K,MAAMyC,MAAM2J,EAAwBxB,EAASpF,kBAAoByG,EAC7FM,EAAiB3B,EAAS5K,MAAMyC,MAAMmI,EAASnF,aAAc4G,KAA0BH,EAEzFI,GAAoBC,IACtB3B,EAASpF,eAAiB4G,EAC1BxB,EAASnF,aAAe4G,GAI5B,OAAOzB,EAAS5K,MAAMyC,MAAMmI,EAASpF,eAAgBoF,EAASnF,cAoD/C+G,CAAmB5B,EAAUqB,EAAaC,EAAaZ,EAAIb,WAC1E,IAAIjF,EAAiBoF,EAASpF,eAC1BC,EAAemF,EAASnF,aACtBgH,EAAiBf,EAAY3J,OAAS,GAAKmK,EAAYQ,QAAQhB,IAAgB,GAAKM,EAAajK,OAAS,EAEhH,GAAI8J,EAAsB,CACxB,IAAMc,EAAMhC,EAA+BC,GAG3CqB,EAFmBU,EAAI9B,iBAEUhJ,EACjCqK,GAFoBS,EAAI7B,kBAK1B,GAAIkB,EAAaY,WAAWX,IAAgBD,EAAaa,SAASX,GAAc,CAC9E,IAAMY,EAAkBd,EAAavJ,MAAMwJ,EAAYlK,OAAQiK,EAAajK,OAASmK,EAAYnK,QACjG,GAAI+J,IAA2BC,EAAsB,CACnD,IAAI/G,EAAW8G,EAAyBG,EAAYlK,OACpDiD,EAAW+H,KAAKC,IAAIhI,EAAUQ,GAE9BA,EAAiBC,EADjBT,EAAW+H,KAAKE,IAAIjI,EAAUQ,EAAiBsH,EAAgB/K,aAI/D0D,EAAeD,EAAiBsH,EAAgB/K,OAElD,MAAO,CAAEuI,KAAMwC,EAAiBtH,iBAAgBC,gBAE7C,GAAKgH,EAcL,OAAIb,EAAQ7J,OAAS,GAAKiK,EAAatD,MAAMkD,GAIzC,CAAEtB,KAFe2B,GADxBC,EAAcA,EAAY/J,QAAQuJ,EAAaM,IAGfxG,eADhCA,EAAiBC,EAAeD,EAAiByG,EAAYlK,OACb0D,gBAMzC,CAAE6E,KAHe2B,EAAcD,EAAeE,EAGrB1G,eAFhCA,EAAiBA,EAAiByG,EAAYlK,OAASiK,EAAajK,OAASmK,EAAYQ,QAAQhB,GAEjDjG,aADhDA,EAAeD,EAAiBkG,EAAY3J,QAtB5C,IAAI+K,EAAkBb,EAAcD,EAAeE,EACnD1G,EAAiBsG,EAAyBG,EAAYlK,OACtD0D,EAAesG,EAAuBE,EAAYlK,OAClD,IAAMmL,EAAkBlB,EAAatD,MAAM,cAC3C,GAAI4C,EAAI6B,WAAaD,EAAiB,CACpC,IAAME,EAAoBF,EAAgB,IAAM,GAC1CG,EAAqBH,EAAgB,IAAM,GACjDJ,EAAkBM,EAAoBnB,EAAcD,EAAatI,OAASwI,EAAcmB,EACxF7H,GAAkB4H,EAAkBrL,OACpC0D,GAAgB4H,EAAmBtL,OAErC,MAAO,CAAEuI,KAAMwC,EAAiBtH,iBAAgBC,iBCtIvC6H,EAAoB,SAAC1C,EAAU2C,GAC1C,IACIC,EADElD,EAAOM,EAAS5K,MAAMyC,MAAMmI,EAASpF,eAAgBoF,EAASnF,cAGlE+H,EADED,EAAUE,YD0KW,SAAC7C,GAC1B,IAEInF,EACAD,EAIAkI,EAAaC,EAPXC,EAAmB,YACnBC,EAAqBjD,EAASpF,iBAAmBoF,EAASnF,aAG5D6E,EAAOM,EAAS5K,MAAMyC,MAAMmI,EAASpF,eAAgBoF,EAASnF,cAC9DqI,EAAgBxD,EAChByD,EAAQzD,EAAK3G,MAAM,MAEvB,GAAIkK,EAAoB,CACtB,IAAMG,EAAcpD,EAAS5K,MAAMyC,MAAM,EAAGmI,EAASpF,gBAAgB7B,MAAM,MAC3E+J,EAAc9C,EAASpF,eAAiBwI,EAAYA,EAAYjM,OAAS,GAAGA,OAC5E4L,EAAYnD,EAAiBI,EAAS5K,MAAO4K,EAASpF,gBAAgB,GACtEsI,EAAgBlD,EAAS5K,MAAMyC,MAAMiL,EAAaC,GAEpD,IAAMM,EAAiBH,EAAcnK,MAAM,MAE3C,GADoBsK,EAAeC,OAAM,SAAAvM,GAAI,OAAIiM,EAAiB1L,KAAKP,OAIrE,GADA2I,GADAyD,EAAQE,EAAenK,KAAI,SAAAnC,GAAI,OAAIA,EAAKQ,QAAQyL,EAAkB,QACrDvG,KAAK,MACdwG,GAAsBH,GAAeC,EAAW,CAClD,IAAMQ,EAAaF,EAAe,GAAGlM,OAASgM,EAAM,GAAGhM,OACvDyD,EAAiBC,EAAemF,EAASpF,eAAiB2I,EAC1DvD,EAASpF,eAAiBkI,EAC1B9C,EAASnF,aAAekI,OAGvB,CAYHrD,GAXAyD,EAAS,WACP,IAAIhP,EACAqP,EACA7D,EACE8D,EAAU,GAChB,IAAK9D,EAAQxL,EAAI,EAAGqP,EAAML,EAAMhM,OAAQhD,EAAIqP,EAAK7D,IAAUxL,EAAG,CAC5D,IAAM4C,EAAOoM,EAAMxD,GACnB8D,EAAQzK,KAAQ2G,EAAQ,EAAxB,KAA8B5I,GAEhC,OAAO0M,EATA,IAWIhH,KAAK,MAZf,MAa6CsD,EAA+BC,GAAvEC,EAbL,EAaKA,iBAAkBC,EAbvB,EAauBA,kBAE1BrF,GADAD,EAAiBoF,EAASpF,eAAiBqF,EAAiB9I,QAC5BuI,EAAKvI,OACjC8L,IACFrI,EAAiBC,GACnB6E,EAAOO,EAAmBP,EAAOQ,EAEnC,MAAO,CAAER,OAAM9E,iBAAgBC,gBCxNpBgI,CAAY7C,GAEd2C,EAAU9C,WAAaP,EAAgBI,GDgJpB,SAACM,EAAUU,GAAQ,IACvCzJ,EAAyCyJ,EAAzCzJ,OAAQ0J,EAAiCD,EAAjCC,OAAQM,EAAyBP,EAAzBO,qBACpBvB,EAAOM,EAAS5K,MAAMyC,MAAMmI,EAASpF,eAAgBoF,EAASnF,cAC9DD,EAAiBoF,EAASpF,eAC1BC,EAAemF,EAASnF,aACtBsI,EAAQzD,EAAK3G,MAAM,MAEzB,GADkBoK,EAAMG,OAAM,SAAAvM,GAAI,OAAIA,EAAKiL,WAAW/K,IAAWF,EAAKkL,SAAStB,MAG7E9F,EAAeD,GADf8E,EAAOyD,EAAMjK,KAAI,SAAAnC,GAAI,OAAIA,EAAKc,MAAMZ,EAAOE,OAAQJ,EAAKI,OAASwJ,EAAOxJ,WAASsF,KAAK,OACjDtF,YAIrC,GADAuI,EAAOyD,EAAMjK,KAAI,SAAAnC,GAAI,OAAIE,EAASF,EAAO4J,KAAQlE,KAAK,MAClDwE,EAAsB,OACwBlB,EAA+BC,GAAvEC,EADgB,EAChBA,iBAAkBC,EADF,EACEA,kBAE1BrF,GADAD,GAAkBqF,EAAiB9I,QACHuI,EAAKvI,OACrCuI,EAAOO,EAAmBP,EAAOQ,EAGrC,MAAO,CAAER,OAAM9E,iBAAgBC,gBCnKpB6I,CAAe1D,EAAU2C,GAGzBlC,EAAWT,EAAU2C,GFXnB,SAAC3C,EAAD,GAAsD,IAAzCN,EAAyC,EAAzCA,KAAM9E,EAAmC,EAAnCA,eAAgBC,EAAmB,EAAnBA,aAC1CqG,EAAyBlB,EAASpF,eAClC+I,EAAS3D,EAAS5K,MAAMyC,MAAM,EAAGqJ,GACjC0C,EAAQ5D,EAAS5K,MAAMyC,MAAMmI,EAASnF,cAE5C,GAAsB,OAAlBwE,IAA4C,IAAlBA,EAAwB,CACpDW,EAASlG,gBAAkB,OAC3B,IACEuF,EAAgB3F,SAASiC,YAAY,cAAc,EAAO+D,GAE5D,MAAOmE,GACLxE,GAAgB,EAElBW,EAASlG,gBAAkB,QAK7B,GAHIuF,IAAkBW,EAAS5K,MAAMyC,MAAM,EAAGmI,EAASpF,gBAAgBqH,SAASvC,KAC9EL,GAAgB,IAEbA,EAAe,CAClB,IACE3F,SAASiC,YAAY,oBAEvB,MAAOrF,IAGP0J,EAAS5K,MAAQuO,EAASjE,EAAOkE,EACjC,IACElK,SAASiC,YAAY,kBAEvB,MAAOrF,IAKP,IAAMqI,EAAQjF,SAASoK,YAAY,SAEnCnF,EAAMoF,UAAU,SAAS,GAAM,GAE/B/D,EAASgE,cAAcrF,GAEH,MAAlB/D,GAA0C,MAAhBC,EAC5BmF,EAASiE,kBAAkBrJ,EAAgBC,GAG3CmF,EAASiE,kBAAkB/C,EAAwBlB,EAASnF,cE9B9DqJ,CAAWlE,EAAU4C,ICjBjB/E,EAAczF,UAAUG,UAAUuF,MAAM,aAAe,IAAM,OAE9CqG,E,gGACnBnG,SAAA,SAASC,GACP,YAAMD,SAAN,UAAeC,GAEflG,KAAKoE,IAAIiI,W,EAGX/F,KAAA,WACE,OACE,YAAQgG,UAAU,mCAAmCC,MAAOvM,KAAKuM,QAASC,cAAaxM,KAAKmG,MAAMsG,OAChGC,QAAS1M,KAAKgH,MAAMpJ,KAAKoC,MAAO2M,UAAW3M,KAAK4M,QAAQhP,KAAKoC,OAC5D6M,IAAK7M,KAAKmG,MAAM0G,Q,EAKvBD,QAAA,SAAQhG,GACY,MAAdA,EAAMjJ,KAA6B,UAAdiJ,EAAMjJ,MAC7BiJ,EAAMnD,iBACNzD,KAAKgH,U,EAITA,MAAA,WACE,ODNYH,ECMC7G,KAAK8G,QDNEgG,ECMO9M,KAAKmG,MAAM/D,MDLlC2K,EAAUlG,EAAOmG,cAgBjB5K,EAAQ,EAAc,GAdX,CACflD,OAAQ,GACR0J,OAAQ,GACRC,YAAa,GACbC,YAAa,GACbhB,WAAW,EACXiB,YAAa,GACbC,aAAa,EACbC,QAAS,GACTC,sBAAsB,EACtB4B,aAAa,EACbN,WAAW,GAG6BsC,SAEpCG,EAAQtL,SAASuL,eAAeH,EAAQI,QAAQ1G,QAGpDwG,EAAM3I,QACNqG,EAAkBsC,EAAO7K,KAvBd,IAACyE,EAAQiG,EAChBC,EAgBA3K,EAEA6K,G,ECVNV,MAAA,WACE,IAAIF,EAAUrM,KAAKmG,MAAMoG,MAIzB,OAFIvM,KAAKmG,MAAMsG,SAAQJ,GAAW,KAAKvG,EAAT,IAAwB9F,KAAKmG,MAAMsG,OAAnC,KAEvBJ,G,GAhCiCpF,K,gCCH/BmG,EAAb,WACE,WAAYC,EAASC,EAAoBC,GACvCvN,KAAKqN,QAAUA,EACfrN,KAAKsN,mBAAqBA,EAC1BtN,KAAKuN,SAAWA,EAJpB,mBAOE/J,UAAA,SACEtE,EACAsO,EACAC,EACAC,GACA,WAOAxL,YAAW,WAGT,GAFA,EAAKmL,QAAQK,EAAIvG,OAAO9J,QAEnBqQ,EAAIlM,SAAWkM,EAAIpM,UAAwB,UAAZoM,EAAI/P,IACtC,OAAO,EAAK4P,WAGd,EAAKD,mBAAmBI,KACvB,KA3BP,KA+BqBC,E,gGACnBC,MAAA,SAAMC,EAAKC,GACT,GAAIC,IAAIC,MAAMC,UAAU,0BAA2B,CACjDjO,KAAKkO,GAAG5B,UAAYwB,EAAOK,WAAWzJ,KAAK,KAC3C1E,KAAKkO,GAAGE,SAAWN,EAAOM,SAC1BpO,KAAKkO,GAAGG,YAAcP,EAAOO,YAC7BrO,KAAKkO,GAAG7Q,MAAQyQ,EAAOzQ,MAEvBwQ,EAAIS,OAAOtO,KAAKkO,IAEhB,IAAMZ,EAAqB,SAAC/O,GAC1BuP,EAAOS,eAAelN,SAAQ,SAACmN,GAC7BA,OAGFjQ,EAAEkQ,QAAS,GAKbzO,KAAKkO,GAAGjM,iBAAiB,SAAS,SAAU1D,GACtCA,aAAamQ,cACfZ,EAAOT,QAAQ9O,EAAE4I,OAAO9J,OACxBiQ,EAAmB/O,OAMvByB,KAAKkO,GAAGjM,iBAAiB,QAASqL,GAElCtN,KAAK2O,OAAS,IAAIC,IAAa5O,KAAKkO,GAAI,CACtChO,OAAQ,CACNZ,OAAQ,CAAC,UACTK,QAAS,CAAC,UACVE,OAAQ,IAEV0D,WAAY,CACV,IAAI6J,EAA8BU,EAAOT,QAASC,EAAoBQ,EAAOP,kBAIjF,YAAMK,MAAN,UAAYC,EAAKC,GAEnB9N,KAAKkO,GAAG3H,GAAKuH,EAAOe,WAIpB7O,KAAKkO,GAAGjM,iBAAiB,WAAW,SAAU1D,GAC5C,OAAOuP,EAAOgB,gBAAP,MAAAhB,EAA0B1G,e,EAIrC7B,QAAA,WACMwI,IAAIC,MAAMC,UAAU,2BACtBjO,KAAK2O,OAAOpJ,UAEd,YAAMA,QAAN,Y,GAzD8CwJ,KClB9CD,EAAkB,aAEtBf,IAAIiB,aAAaC,IAAI,mBAAmB,SAAUlB,GAChD,IAAInG,EAAQ,EAEZsH,iBAAOC,IAAWnR,UAAW,UAAU,WACrCgC,KAAK6O,WAAa,WAAcjH,OAGlCwH,mBAASD,IAAWnR,UAAW,eAAe,SAAUqR,EAAGxB,GACzD,OAAO,IAAIF,EAAqBE,EAAK7N,KAAKsP,wBAG5CJ,iBAAOC,IAAWnR,UAAW,qBAAqB,SAAU8P,GAC1DA,EAAOe,WAAa7O,KAAK6O,WACzBf,EAAOgB,gBAAkBA,KAG3BI,iBAAOC,IAAWnR,UAAW,gBAAgB,SAAUuR,GACrD,IAAMlD,EAAU,SAAA1P,GAAI,OAAIoR,EAAIyB,WAAWC,MAAf,kCAAuD9S,EAAvD,aAExB4S,EAAMN,IAAI,WACR,EAAC,EAAD,CAAiBxI,IAAKzG,KAAK6O,WAAYzI,mBAAoB,SAAAsJ,GAAO,OAAIZ,EAAkBY,IACtF,EAAC,EAAD,CAAgBnD,MAAOF,EAAQ,UAAWQ,KAAK,iBAAiBzK,MAAO,CAAElD,OAAQ,UACjF,EAAC,EAAD,CAAgBqN,MAAOF,EAAQ,QAASQ,KAAK,cAAczK,MAAO,CAAElD,OAAQ,KAAM0J,OAAQ,KAAM4B,WAAW,GAAQiC,OAAO,MAC1H,EAAC,EAAD,CAAgBF,MAAOF,EAAQ,UAAWQ,KAAK,gBAAgBzK,MAAO,CAAElD,OAAQ,IAAK0J,OAAQ,IAAK4B,WAAW,GAAQiC,OAAO,MAC5H,EAAC,EAAD,CAAgBF,MAAOF,EAAQ,SAAUQ,KAAK,oBAAoBzK,MAAO,CAAElD,OAAQ,KAAM4I,WAAW,EAAMoB,sBAAsB,KAChI,EAAC,EAAD,CAAgBqD,MAAOF,EAAQ,QAASQ,KAAK,cAAczK,MAAO,CAAElD,OAAQ,IAAK0J,OAAQ,IAAKC,YAAa,MAAOC,YAAa,SAC/H,EAAC,EAAD,CAAgByD,MAAOF,EAAQ,QAASQ,KAAK,cAAczK,MAAO,CAAElD,OAAQ,IAAK0J,OAAQ,cAAeG,YAAa,WAAYE,QAAS,eAC1I,EAAC,EAAD,CAAgBsD,MAAOF,EAAQ,SAAUQ,KAAK,eAAezK,MAAO,CAAElD,OAAQ,KAAM0J,OAAQ,cAAeG,YAAa,WAAYE,QAAS,eAC7I,EAAC,EAAD,CAAgBsD,MAAOF,EAAQ,kBAAmBQ,KAAK,iBAAiBzK,MAAO,CAAElD,OAAQ,KAAM4I,WAAW,EAAMoB,sBAAsB,KACtI,EAAC,EAAD,CAAgBqD,MAAOF,EAAQ,gBAAiBQ,KAAK,iBAAiBzK,MAAO,CAAElD,OAAQ,MAAO4I,WAAW,EAAMgD,aAAa,MAE7H","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['helpers/icon'];","!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).MarkdownArea=t()}(this,(function(){\"use strict\";const e=/^[ \\t]*(?:(?:[-+*]|\\d+\\.)[ \\t]+(?:\\[[ x]][ \\t]+)?|>[ \\t]*)*(?::[ \\t]*)?/,t=/(?:[-+*]|\\d+\\.)[ \\t]+(?:\\[[ x]][ \\t]+)?$/,n=/[-+*\\[\\]x\\d.]/g,i=/[^ \\t]/g,s=/(\\d+)\\.(?=[ \\t]+$)/,o=/(?:(?:^[ \\t]+)?(?:[-+*]|\\d+\\.|[>:])(?:[ \\t]+\\[[ x]])?[ \\t]*|^[ \\t]+)$/,r=/[*_]/,l=/[-=\\s\"'`<>\\[\\](){}+*^$\\\\.|]$/,u=/^(?:\\n|$)/,c=/^(?!$)/gm,d={\"`\":/^``$/m,\"~\":/^~~$/m},a={\"[\":\"]\",\"(\":\")\",\"{\":\"}\",\"<\":\">\"},h={\"]\":\"[\",\")\":\"(\",\"}\":\"{\",\">\":\"<\"},f={enter:(n,i,r,l,c)=>{const d=r?null:function(t){const n=t.lastIndexOf(\"\\n\")+1,i=t.substring(n),s=e.exec(i);return{line:i,offset:n,prefix:s&&s[0]}}(i);if(d)if(d.line&&d.line.charAt(d.line.length-1)in a){const e=d.prefix?p(d.prefix,!0):\"\";l=\"\\n\"+e+l,c.shiftKey||(i+=\"\\n\"+e+n.indent)}else d.prefix?!c.shiftKey&&d.prefix===d.line&&u.test(l)?i=i.substring(0,d.offset)+function(e){return e.replace(o,\"\")}(d.prefix):!c.shiftKey&&function(e){return t.test(e)}(d.prefix)?i+=\"\\n\"+function(e){return e.replace(s,(function(e,t){return parseInt(t)+1+\".\"}))}(d.prefix):i+=\"\\n\"+p(d.prefix,c.shiftKey):i+=\"\\n\";else i+=\"\\n\";return{v:i+l,s:i.length}},indent:(e,t,n,i)=>{let s=t.length,o=t.lastIndexOf(\"\\n\")+1;return o<s&&(n=t.substring(o)+n,t=t.substring(0,o)),(o<s||!n)&&(s+=e.indent.length),n?n=n.replace(c,e.indent):t+=e.indent,{v:t+n+i,s:s,e:n?o+n.length:s}},outdent:(e,t,n,i)=>{let s=t.length,o=t.lastIndexOf(\"\\n\")+1;return o<s&&(n=t.substring(o)+n,t=t.substring(0,o),n.substring(0,e.indent.length)===e.indent&&(s-=e.indent.length)),{v:t+(n=n.replace(e.reOutdent,\"\"))+i,s:s,e:o+n.length}},inline:(e,t,n,i,s)=>n||s.key in a||i.charAt(0)!==s.key?n||(\"'\"!==s.key||l.test(t))&&!(s.key in h)?!n&&s.key in d&&d[s.key].test(t)?{v:t+s.key+\"language\\n\"+s.key+s.key+s.key+(\"\\n\"!==i.charAt(0)?\"\\n\":\"\")+i,s:t.length+1,e:t.length+9}:s.key===t.slice(-1)&&s.key===i.slice(0,1)?{v:t.slice(0,-1)+n+i.slice(1),s:t.length-1,e:t.length-1+n.length}:{v:t+(h[s.key]||s.key)+n+(a[s.key]||s.key)+i,s:t.length+1,e:t.length+1+n.length}:{v:t+s.key+i,s:t.length+1}:{v:t+(r.test(s.key)?s.key+s.key:\"\")+i,s:t.length+1}};class y{constructor(e){this.options=e}handleKey(e,t,n,i){const s=this.options.keyMap.find((e=>function(e,t){for(const n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}(i,e.key)));if(s&&f[s.action])return f[s.action](this.options,e,t,n,i)}}function p(e,t){return e.replace(t?i:n,\" \")}const m=/mac|iphone|ipad|ipod/i.test(navigator.platform),g=/firefox/i.test(navigator.userAgent),x=m?\"metaKey\":\"ctrlKey\",k={enter:[\"Enter\",\"Shift+Enter\"],indent:[\"Tab\",\"Cmd+m\"],outdent:[\"Shift+Tab\",\"Cmd+Shift+m\"],inline:['\"',\"'\",\"`\",\"*\",\"_\",\"[\",\"]\",\"(\",\")\",\"{\",\"}\",\"<\",\">\"]};function v(e={}){const t=function(e=4){\"number\"!=typeof e&&(e=(e+\"\").length);return new Array(e+1).join(\" \")}(e.indent),n={indent:t,reOutdent:new RegExp(\"^\"+t,\"mg\"),keyMap:b(e.keyMap),extensions:e.extensions||[]};return n.extensions.push(new y(n)),n}function b(e={}){const t={},n=[];for(let i in k)if(k.hasOwnProperty(i)){let s=e[i]||k[i];Array.isArray(s)||(s=s.toString().trim().split(/\\s*[|,]\\s*/g)),n.push.apply(n,s.map((e=>{const n=E(e);return n.key in t||(t[n.key]=0),++t[n.key],{key:n,action:i}})))}return n.forEach((e=>{var n;t[e.key.key]>1&&(\"ctrlKey\"in(n=e.key)||(n.ctrlKey=!1),\"altKey\"in n||(n.altKey=!1),\"shiftKey\"in n||(n.shiftKey=!1),\"metaKey\"in n||(n.metaKey=!1))})),n}function E(e){const t={};return e.trim().split(/\\s*\\+\\s*/g).forEach((function(e){switch(e.toLowerCase()){case\"cmd\":t[x]=!0;break;case\"ctrl\":case\"alt\":case\"shift\":case\"meta\":t[e.toLowerCase()+\"Key\"]=!0;break;default:t.key=e}})),t}function K(){const e=document.createElement(\"div\");return e.setAttribute(\"aria-hidden\",\"true\"),e.tabIndex=-1,e.contentEditable=!0,e.textContent=\"0\",e.addEventListener(\"focus\",(()=>setTimeout((()=>e.blur()),0))),e.style.position=\"fixed\",e.style.overflow=\"hidden\",e.style.left=\"-1000px\",e.style.top=\"50%\",e.style.width=e.style.height=\"1px\",e.style.opacity=\"0\",e}function w(e,t=!1){return{s:e.selectionStart,e:e.selectionEnd,x:e.scrollLeft,y:e.scrollTop,v:e.value.replace(/\\u00A0/g,\" \"),c:t}}function L(e,t){e.lock=!0;const n=void 0===t.e?t.s:t.e,i=void 0===t.x?e.elem.scrollLeft:t.x,s=void 0===t.y?e.elem.scrollTop:t.y;T(e,{...t,e:n,x:i,y:s,c:!0},!0),e.lock=!1}function A(e,t){if(!e.elem||t.defaultPrevented)return;if(g&&t[x]&&\"z\"===t.key)return void e.elem.blur();const n=w(e.elem),i=n.v.substring(0,n.s),s=n.v.substring(n.s,n.e),o=n.v.substring(n.e);for(let n=0,r=e.options.extensions.length;n<r;n++){const r=e.options.extensions[n].handleKey(i,s,o,t);if(r){t.preventDefault(),L(e,r);break}}}function C(e,t){if(e.lock||\"insertFromPaste\"===t.type)return;e.lock=!0;const n=w(e.elem);document.execCommand(\"undo\"),T(e,n),e.lock=!1}function O(e){e.lock||(e.lock=!0,e.idx=+(e.helper.textContent||\"0\"),e.state=e.history[e.idx],S(e.elem,e.state),e.lock=!1)}function I(e){e.helper.textContent=\"0\",e.state=w(e.elem),e.history=[e.state],e.idx=0}function T(e,t,n=!1){(e.idx<1||n&&!e.state.c)&&$(e,w(e.elem,!0)),e.state.c?function(e,t){e.history.splice(++e.idx,e.history.length,t),e.state=t,e.helper.focus(),document.execCommand(\"selectAll\"),document.execCommand(\"insertText\",!1,e.idx.toString())}(e,t):$(e,t),S(e.elem,e.state)}function $(e,t){Object.assign(e.state,t)}function S(e,t){e.value=t.v,e.selectionStart=t.s,e.selectionEnd=t.e,e.scrollTo(t.x,t.y),e.focus()}class D{constructor(e,t){const n=v(t),i=this.ed={elem:e,options:n,helper:K(),history:[],state:void 0,idx:-1,lock:!1};i.onKeyDown=A.bind(null,i),i.onInput=C.bind(null,i),i.onUndo=O.bind(null,i),i.helper.addEventListener(\"input\",i.onUndo),document.body.appendChild(i.helper),this.setElement(e)}getElement(){return this.ed.elem}setElement(e){this.ed.elem&&(this.ed.options.extensions.forEach((e=>e.cleanup&&e.cleanup(this))),this.ed.elem.removeEventListener(\"input\",this.ed.onInput),this.ed.elem.removeEventListener(\"keydown\",this.ed.onKeyDown)),this.ed.elem=e,e.addEventListener(\"keydown\",this.ed.onKeyDown),e.addEventListener(\"input\",this.ed.onInput),I(this.ed),this.ed.options.extensions.forEach((e=>e.init&&e.init(this)))}getValue(){return this.ed.elem.value.replace(/\\u00A0/g,\" \")}setValue(e,t=!1){this.ed.elem.value=e,t||I(this.ed)}pushState(e){L(this.ed,e)}destroy(){return this.ed.options.extensions.forEach((e=>e.cleanup&&e.cleanup(this))),this.ed.elem.removeEventListener(\"keydown\",this.ed.onKeyDown),this.ed.elem.removeEventListener(\"input\",this.ed.onInput),this.ed.helper.removeEventListener(\"input\",this.ed.onUndo),document.body.removeChild(this.ed.helper),this.ed.options.extensions.forEach((e=>e.destroy&&e.destroy())),Object.assign(this.ed,{elem:null,helper:null,options:null,reOutdent:null,onKeyDown:null,onInput:null,onUndo:null,history:null}),Object.assign(this,{ed:null}),null}}return function(e){e.version=\"v2.0.9\"}(D||(D={})),D}));\n//# sourceMappingURL=index.min.js.map\n","module.exports = flarum.core.compat['utils/BasicEditorDriver'];","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Component from 'flarum/Component';\n\nconst modifierKey = navigator.userAgent.match(/Macintosh/) ? 'Meta' : 'Control';\n\nexport default class MarkdownToolbar extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.attrs.setShortcutHandler(this.shortcut.bind(this));\n  }\n\n  view(vnode) {\n    return <div id=\"MarkdownToolbar\" data-for={this.attrs.for} style={{ display: 'inline-block' }}>\n      {vnode.children}\n    </div>;\n  }\n\n  shortcut(event) {\n    if ((event.metaKey && modifierKey === 'Meta') || (event.ctrlKey && modifierKey === 'Control')) {\n      const button = this.element.querySelector(`[data-hotkey=\"${event.key}\"]`);\n\n      if (button) {\n        button.click();\n        event.preventDefault()\n      }\n    }\n  }\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","/*\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\n */\n\nexport let canInsertText = null;\n\nexport default (textarea, { text, selectionStart, selectionEnd }) => {\n  const originalSelectionStart = textarea.selectionStart;\n  const before = textarea.value.slice(0, originalSelectionStart);\n  const after = textarea.value.slice(textarea.selectionEnd);\n\n  if (canInsertText === null || canInsertText === true) {\n    textarea.contentEditable = 'true';\n    try {\n      canInsertText = document.execCommand('insertText', false, text);\n    }\n    catch (error) {\n      canInsertText = false;\n    }\n    textarea.contentEditable = 'false';\n  }\n  if (canInsertText && !textarea.value.slice(0, textarea.selectionStart).endsWith(text)) {\n    canInsertText = false;\n  }\n  if (!canInsertText) {\n    try {\n      document.execCommand('ms-beginUndoUnit');\n    }\n    catch (e) {\n      // Do nothing.\n    }\n    textarea.value = before + text + after;\n    try {\n      document.execCommand('ms-endUndoUnit');\n    }\n    catch (e) {\n      // Do nothing.\n    }\n\n    // fire custom event, works on IE\n    const event = document.createEvent('Event');\n\n    event.initEvent('input', true, true);\n\n    textarea.dispatchEvent(event);\n  }\n  if (selectionStart != null && selectionEnd != null) {\n    textarea.setSelectionRange(selectionStart, selectionEnd);\n  }\n  else {\n    textarea.setSelectionRange(originalSelectionStart, textarea.selectionEnd);\n  }\n};\n","/*\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\n */\n\nexport function isMultipleLines(string) {\n  return string.trim().split('\\n').length > 1;\n}\n\nexport function repeat(string, n) {\n  return Array(n + 1).join(string);\n}\n\nexport function wordSelectionStart(text, i) {\n  let index = i;\n\n  while (text[index] && text[index - 1] != null && !text[index - 1].match(/\\s/)) {\n    index--;\n  }\n\n  return index;\n}\n\nexport function wordSelectionEnd(text, i, multiline) {\n  let index = i;\n  const breakpoint = multiline ? /\\n/ : /\\s/;\n\n  while (text[index] && !text[index].match(breakpoint)) {\n    index++;\n  }\n\n  return index;\n}\n\nexport function expandSelectedText(textarea, prefixToUse, suffixToUse) {\n  let multiline = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n  if (textarea.selectionStart === textarea.selectionEnd) {\n    textarea.selectionStart = wordSelectionStart(textarea.value, textarea.selectionStart);\n    textarea.selectionEnd = wordSelectionEnd(textarea.value, textarea.selectionEnd, multiline);\n  } else {\n    const expandedSelectionStart = textarea.selectionStart - prefixToUse.length;\n    const expandedSelectionEnd = textarea.selectionEnd + suffixToUse.length;\n    const beginsWithPrefix = textarea.value.slice(expandedSelectionStart, textarea.selectionStart) === prefixToUse;\n    const endsWithSuffix = textarea.value.slice(textarea.selectionEnd, expandedSelectionEnd) === suffixToUse;\n\n    if (beginsWithPrefix && endsWithSuffix) {\n      textarea.selectionStart = expandedSelectionStart;\n      textarea.selectionEnd = expandedSelectionEnd;\n    }\n  }\n\n  return textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n}\n\nexport function newlinesToSurroundSelectedText(textarea) {\n  const beforeSelection = textarea.value.slice(0, textarea.selectionStart);\n  const afterSelection = textarea.value.slice(textarea.selectionEnd);\n  const breaksBefore = beforeSelection.match(/\\n*$/);\n  const breaksAfter = afterSelection.match(/^\\n*/);\n  const newlinesBeforeSelection = breaksBefore ? breaksBefore[0].length : 0;\n  const newlinesAfterSelection = breaksAfter ? breaksAfter[0].length : 0;\n  let newlinesToAppend;\n  let newlinesToPrepend;\n\n  if (beforeSelection.match(/\\S/) && newlinesBeforeSelection < 2) {\n    newlinesToAppend = repeat('\\n', 2 - newlinesBeforeSelection);\n  }\n\n  if (afterSelection.match(/\\S/) && newlinesAfterSelection < 2) {\n    newlinesToPrepend = repeat('\\n', 2 - newlinesAfterSelection);\n  }\n\n  if (newlinesToAppend == null) {\n    newlinesToAppend = '';\n  }\n\n  if (newlinesToPrepend == null) {\n    newlinesToPrepend = '';\n  }\n\n  return {\n    newlinesToAppend,\n    newlinesToPrepend\n  };\n}\n\nexport const blockStyle = (textarea, arg) => {\n  let newlinesToAppend;\n  let newlinesToPrepend;\n  const { prefix, suffix, blockPrefix, blockSuffix, replaceNext, prefixSpace, scanFor, surroundWithNewlines } = arg;\n  const originalSelectionStart = textarea.selectionStart;\n  const originalSelectionEnd = textarea.selectionEnd;\n  let selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n  let prefixToUse = isMultipleLines(selectedText) && blockPrefix.length > 0 ? `${blockPrefix}\\n` : prefix;\n  let suffixToUse = isMultipleLines(selectedText) && blockSuffix.length > 0 ? `\\n${blockSuffix}` : suffix;\n\n  if (prefixSpace) {\n    const beforeSelection = textarea.value[textarea.selectionStart - 1];\n    if (textarea.selectionStart !== 0 && beforeSelection != null && !beforeSelection.match(/\\s/)) {\n      prefixToUse = ` ${prefixToUse}`;\n    }\n  }\n\n  selectedText = expandSelectedText(textarea, prefixToUse, suffixToUse, arg.multiline);\n  let selectionStart = textarea.selectionStart;\n  let selectionEnd = textarea.selectionEnd;\n  const hasReplaceNext = replaceNext.length > 0 && suffixToUse.indexOf(replaceNext) > -1 && selectedText.length > 0;\n\n  if (surroundWithNewlines) {\n    const ref = newlinesToSurroundSelectedText(textarea);\n    newlinesToAppend = ref.newlinesToAppend;\n    newlinesToPrepend = ref.newlinesToPrepend;\n    prefixToUse = newlinesToAppend + prefix;\n    suffixToUse += newlinesToPrepend;\n  }\n\n  if (selectedText.startsWith(prefixToUse) && selectedText.endsWith(suffixToUse)) {\n    const replacementText = selectedText.slice(prefixToUse.length, selectedText.length - suffixToUse.length);\n    if (originalSelectionStart === originalSelectionEnd) {\n      let position = originalSelectionStart - prefixToUse.length;\n      position = Math.max(position, selectionStart);\n      position = Math.min(position, selectionStart + replacementText.length);\n      selectionStart = selectionEnd = position;\n    }\n    else {\n      selectionEnd = selectionStart + replacementText.length;\n    }\n    return { text: replacementText, selectionStart, selectionEnd };\n  }\n  else if (!hasReplaceNext) {\n    let replacementText = prefixToUse + selectedText + suffixToUse;\n    selectionStart = originalSelectionStart + prefixToUse.length;\n    selectionEnd = originalSelectionEnd + prefixToUse.length;\n    const whitespaceEdges = selectedText.match(/^\\s*|\\s*$/g);\n    if (arg.trimFirst && whitespaceEdges) {\n      const leadingWhitespace = whitespaceEdges[0] || '';\n      const trailingWhitespace = whitespaceEdges[1] || '';\n      replacementText = leadingWhitespace + prefixToUse + selectedText.trim() + suffixToUse + trailingWhitespace;\n      selectionStart += leadingWhitespace.length;\n      selectionEnd -= trailingWhitespace.length;\n    }\n    return { text: replacementText, selectionStart, selectionEnd };\n  }\n  else if (scanFor.length > 0 && selectedText.match(scanFor)) {\n    suffixToUse = suffixToUse.replace(replaceNext, selectedText);\n    const replacementText = prefixToUse + suffixToUse;\n    selectionStart = selectionEnd = selectionStart + prefixToUse.length;\n    return { text: replacementText, selectionStart, selectionEnd };\n  }\n  else {\n    const replacementText = prefixToUse + selectedText + suffixToUse;\n    selectionStart = selectionStart + prefixToUse.length + selectedText.length + suffixToUse.indexOf(replaceNext);\n    selectionEnd = selectionStart + replaceNext.length;\n    return { text: replacementText, selectionStart, selectionEnd };\n  }\n}\n\nexport const multilineStyle = (textarea, arg) => {\n  const { prefix, suffix, surroundWithNewlines } = arg;\n  let text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n  let selectionStart = textarea.selectionStart;\n  let selectionEnd = textarea.selectionEnd;\n  const lines = text.split('\\n');\n  const undoStyle = lines.every(line => line.startsWith(prefix) && line.endsWith(suffix));\n  if (undoStyle) {\n    text = lines.map(line => line.slice(prefix.length, line.length - suffix.length)).join('\\n');\n    selectionEnd = selectionStart + text.length;\n  }\n  else {\n    text = lines.map(line => prefix + line + suffix).join('\\n');\n    if (surroundWithNewlines) {\n      const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea);\n      selectionStart += newlinesToAppend.length;\n      selectionEnd = selectionStart + text.length;\n      text = newlinesToAppend + text + newlinesToPrepend;\n    }\n  }\n  return { text, selectionStart, selectionEnd };\n}\n\nexport const orderedList = (textarea) => {\n  const orderedListRegex = /^\\d+\\.\\s+/;\n  const noInitialSelection = textarea.selectionStart === textarea.selectionEnd;\n  let selectionEnd;\n  let selectionStart;\n  let text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n  let textToUnstyle = text;\n  let lines = text.split('\\n');\n  let startOfLine, endOfLine;\n  if (noInitialSelection) {\n    const linesBefore = textarea.value.slice(0, textarea.selectionStart).split(/\\n/);\n    startOfLine = textarea.selectionStart - linesBefore[linesBefore.length - 1].length;\n    endOfLine = wordSelectionEnd(textarea.value, textarea.selectionStart, true);\n    textToUnstyle = textarea.value.slice(startOfLine, endOfLine);\n  }\n  const linesToUnstyle = textToUnstyle.split('\\n');\n  const undoStyling = linesToUnstyle.every(line => orderedListRegex.test(line));\n  if (undoStyling) {\n    lines = linesToUnstyle.map(line => line.replace(orderedListRegex, ''));\n    text = lines.join('\\n');\n    if (noInitialSelection && startOfLine && endOfLine) {\n      const lengthDiff = linesToUnstyle[0].length - lines[0].length;\n      selectionStart = selectionEnd = textarea.selectionStart - lengthDiff;\n      textarea.selectionStart = startOfLine;\n      textarea.selectionEnd = endOfLine;\n    }\n  }\n  else {\n    lines = (function () {\n      let i;\n      let len;\n      let index;\n      const results = [];\n      for (index = i = 0, len = lines.length; i < len; index = ++i) {\n        const line = lines[index];\n        results.push(`${index + 1}. ${line}`);\n      }\n      return results;\n    })();\n    text = lines.join('\\n');\n    const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea);\n    selectionStart = textarea.selectionStart + newlinesToAppend.length;\n    selectionEnd = selectionStart + text.length;\n    if (noInitialSelection)\n      selectionStart = selectionEnd;\n    text = newlinesToAppend + text + newlinesToPrepend;\n  }\n  return { text, selectionStart, selectionEnd };\n}\n","/*\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\n */\n\nimport insertText from './insertText';\nimport { blockStyle, isMultipleLines, multilineStyle, orderedList } from './styles';\n\nexport const styleSelectedText = (textarea, styleArgs) => {\n  const text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n  let result;\n  if (styleArgs.orderedList) {\n    result = orderedList(textarea);\n  }\n  else if (styleArgs.multiline && isMultipleLines(text)) {\n    result = multilineStyle(textarea, styleArgs);\n  }\n  else {\n    result = blockStyle(textarea, styleArgs);\n  }\n\n  insertText(textarea, result);\n};\n\nexport default (button, stylesToApply) => {\n  const toolbar = button.parentElement;\n\n  const defaults = {\n    prefix: '',\n    suffix: '',\n    blockPrefix: '',\n    blockSuffix: '',\n    multiline: false,\n    replaceNext: '',\n    prefixSpace: false,\n    scanFor: '',\n    surroundWithNewlines: false,\n    orderedList: false,\n    trimFirst: false\n  };\n\n  const style = Object.assign({}, defaults, stylesToApply);\n\n  const field = document.getElementById(toolbar.dataset.for);\n\n  if (field) {\n    field.focus();\n    styleSelectedText(field, style);\n  }\n}\n","import Component from 'flarum/Component';\nimport icon from 'flarum/helpers/icon';\nimport apply from '../util/apply';\n\nconst modifierKey = navigator.userAgent.match(/Macintosh/) ? 'âŒ˜' : 'ctrl';\n\nexport default class MarkdownButton extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.$().tooltip();\n  }\n\n  view() {\n    return (\n      <button className=\"Button Button--icon Button--link\" title={this.title()} data-hotkey={this.attrs.hotkey}\n        onclick={this.click.bind(this)} onkeydown={this.keydown.bind(this)}>\n        {icon(this.attrs.icon)}\n      </button>\n    );\n  }\n\n  keydown(event) {\n    if (event.key === ' ' || event.key === 'Enter') {\n      event.preventDefault();\n      this.click();\n    }\n  }\n\n  click() {\n    return apply(this.element, this.attrs.style);\n  }\n\n  title() {\n    let tooltip = this.attrs.title;\n\n    if (this.attrs.hotkey) tooltip += ` <${modifierKey}-${this.attrs.hotkey}>`;\n\n    return tooltip;\n  }\n}\n","import MarkdownArea from 'mdarea';\nimport BasicEditorDriver from 'flarum/utils/BasicEditorDriver';\n\nexport class MarkdownEditorFlarumExtension {\n  constructor(oninput, callInputListeners, onsubmit) {\n    this.oninput = oninput;\n    this.callInputListeners = callInputListeners;\n    this.onsubmit = onsubmit;\n  }\n\n  handleKey(\n    prefix,\n    selection,\n    postfix,\n    evt\n  ) {\n    // setTimeout executes after the call stack has cleared,\n    // so any DOM changes originating from mdarea (e.g. executing an undo)\n    // will be finished by then. At that time, `e.target.value` will represent\n    // the updated value of the textarea in response to the keypress.\n    // Unfortunately, this doesn't work without a value for mobile safari,\n    // so we need to set 25ms as an arbitrary timeout.\n    setTimeout(() => {\n      this.oninput(evt.target.value);\n\n      if ((evt.metaKey || evt.ctrlKey) && evt.key === 'Enter') {\n        return this.onsubmit();\n      }\n\n      this.callInputListeners(evt);\n    }, 25);\n  }\n}\n\nexport default class MarkdownEditorDriver extends BasicEditorDriver {\n  build(dom, params) {\n    if (app.forum.attribute('flarum-markdown.mdarea')) {\n      this.el.className = params.classNames.join(' ');\n      this.el.disabled = params.disabled;\n      this.el.placeholder = params.placeholder;\n      this.el.value = params.value;\n\n      dom.append(this.el);\n\n      const callInputListeners = (e) => {\n        params.inputListeners.forEach((listener) => {\n          listener();\n        });\n\n        e.redraw = false;\n      };\n\n      // Our mdarea extension won't detect programmatic changes via\n      // the `app.composer.editor api.\n      this.el.addEventListener('input', function (e) {\n        if (e instanceof CustomEvent) {\n          params.oninput(e.target.value);\n          callInputListeners(e);\n        }\n      });\n\n      // This one can't be run through mdarea, but that doesn't matter\n      // because mdarea doesn't change value in response to clicks.\n      this.el.addEventListener('click', callInputListeners);\n\n      this.mdarea = new MarkdownArea(this.el, {\n        keyMap: {\n          indent: ['Ctrl+m'],\n          outdent: ['Ctrl+M'],\n          inline: []\n        },\n        extensions: [\n          new MarkdownEditorFlarumExtension(params.oninput, callInputListeners, params.onsubmit)\n        ]\n      });\n    } else {\n      super.build(dom, params);\n    }\n    this.el.id = params.textareaId;\n\n    // We can't bind shortcutHandler directly in case `build`\n    // runs before MarkdownToolbar's `oninit`.\n    this.el.addEventListener('keydown', function (e) {\n      return params.shortcutHandler(...arguments);\n    });\n  }\n\n  destroy() {\n    if (app.forum.attribute('flarum-markdown.mdarea')) {\n      this.mdarea.destroy();\n    }\n    super.destroy();\n  }\n}\n","/*!\n * Includes modified code from GitHub Markdown Toolbar Element\n * https://github.com/github/markdown-toolbar-element/\n *\n * Original Copyright GitHub, Inc.\n * Released under the MIT license\n * https://github.com/github/markdown-toolbar-element/blob/master/LICENSE\n */\n\nimport { extend, override } from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\n\nimport MarkdownToolbar from './components/MarkdownToolbar';\nimport MarkdownButton from './components/MarkdownButton';\nimport MarkdownEditorDriver from './util/MarkdownEditorDriver';\n\nlet shortcutHandler = () => { };\n\napp.initializers.add('flarum-markdown', function (app) {\n  let index = 1;\n\n  extend(TextEditor.prototype, 'oninit', function () {\n    this.textareaId = 'textarea' + (index++);\n  });\n\n  override(TextEditor.prototype, 'buildEditor', function (_, dom) {\n    return new MarkdownEditorDriver(dom, this.buildEditorParams());\n  });\n\n  extend(TextEditor.prototype, 'buildEditorParams', function (params) {\n    params.textareaId = this.textareaId;\n    params.shortcutHandler = shortcutHandler;\n  });\n\n  extend(TextEditor.prototype, 'toolbarItems', function (items) {\n    const tooltip = name => app.translator.trans(`flarum-markdown.forum.composer.${name}_tooltip`);\n\n    items.add('markdown', (\n      <MarkdownToolbar for={this.textareaId} setShortcutHandler={handler => shortcutHandler = handler}>\n        <MarkdownButton title={tooltip('header')} icon=\"fas fa-heading\" style={{ prefix: '### ' }} />\n        <MarkdownButton title={tooltip('bold')} icon=\"fas fa-bold\" style={{ prefix: '**', suffix: '**', trimFirst: true }} hotkey=\"b\" />\n        <MarkdownButton title={tooltip('italic')} icon=\"fas fa-italic\" style={{ prefix: '_', suffix: '_', trimFirst: true }} hotkey=\"i\" />\n        <MarkdownButton title={tooltip('quote')} icon=\"fas fa-quote-left\" style={{ prefix: '> ', multiline: true, surroundWithNewlines: true }} />\n        <MarkdownButton title={tooltip('code')} icon=\"fas fa-code\" style={{ prefix: '`', suffix: '`', blockPrefix: '```', blockSuffix: '```' }} />\n        <MarkdownButton title={tooltip('link')} icon=\"fas fa-link\" style={{ prefix: '[', suffix: '](https://)', replaceNext: 'https://', scanFor: 'https?://' }} />\n        <MarkdownButton title={tooltip('image')} icon=\"fas fa-image\" style={{ prefix: '![', suffix: '](https://)', replaceNext: 'https://', scanFor: 'https?://' }} />\n        <MarkdownButton title={tooltip('unordered_list')} icon=\"fas fa-list-ul\" style={{ prefix: '- ', multiline: true, surroundWithNewlines: true }} />\n        <MarkdownButton title={tooltip('ordered_list')} icon=\"fas fa-list-ol\" style={{ prefix: '1. ', multiline: true, orderedList: true }} />\n      </MarkdownToolbar>\n    ), 100);\n  });\n});\n"],"sourceRoot":""}