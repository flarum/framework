(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n),t.d(n,{extend:()=>Et,filterGroupMentions:()=>Wt,filterPostMentions:()=>Lt,filterUserMentions:()=>Ht});var e={};t.r(e),t.d(e,{default:()=>K,insertMention:()=>Y});var o={};t.r(o),t.d(o,{filterGroupMentions:()=>Wt,filterPostMentions:()=>Lt,filterUserMentions:()=>Ht});const r=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/app"];var i=t.n(s);const a=flarum.core.compat["forum/components/NotificationGrid"];var u=t.n(a);const c=flarum.core.compat["common/utils/string"],l=flarum.core.compat["common/helpers/textContrastClass"];var f=t.n(l);const d=flarum.core.compat["forum/components/Post"];var p=t.n(d);const h=flarum.core.compat["forum/components/CommentPost"];var v=t.n(h);const g=flarum.core.compat["forum/components/PostPreview"];var y=t.n(g);const b=flarum.core.compat["common/components/LoadingIndicator"];var w=t.n(b);const P=flarum.core.compat["common/components/Link"];var x=t.n(P);const M=flarum.core.compat["common/helpers/punctuateSeries"];var C=t.n(M);const _=flarum.core.compat["common/helpers/username"];var B=t.n(_);const N=flarum.core.compat["common/helpers/icon"];var T=t.n(N);const A=flarum.core.compat["common/components/Button"];var k=t.n(A);function j(t,n){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},j(t,n)}function S(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,j(t,n)}const D=flarum.core.compat["common/components/Modal"];var I=t.n(D);function O(){return O=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},O.apply(this,arguments)}function U(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const E=flarum.core.compat["common/states/PaginatedListState"];var H=function(t){function n(n,e){return void 0===e&&(e=1),n.page=O({},n.page||{},{limit:10}),t.call(this,n,e,10)||this}var e,o;return S(n,t),e=n,(o=[{key:"type",get:function(){return"posts"}}])&&U(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),n}(t.n(E)()),L=function(t){function n(){return t.apply(this,arguments)||this}S(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.state=new H({filter:{mentionedPost:this.attrs.post.id()},sort:"number"}),this.state.refresh()},e.className=function(){return"MentionedByModal"},e.title=function(){return i().translator.trans("flarum-mentions.forum.mentioned_by.title")},e.content=function(){var t=this;return m("[",null,m("div",{className:"Modal-body"},this.state.isInitialLoading()?m(w(),null):m("[",null,m("ul",{className:"MentionedByModal-list Dropdown-menu Dropdown-menu--inline Post-mentionedBy-preview"},this.state.getPages().map((function(t){return t.items.map((function(t){return m("li",{"data-number":t.number()},m(y(),{post:t,onclick:function(){return i().modal.close()}}))}))}))))),this.state.hasNext()&&m("div",{className:"Modal-footer"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m(k(),{className:"Button Button--block",onclick:function(){return t.state.loadNext()},loading:this.state.isLoadingNext()},i().translator.trans("flarum-mentions.forum.mentioned_by.load_more_button"))))))},n}(I());const W=flarum.core.compat["forum/utils/DiscussionControls"];var R=t.n(W);const G=flarum.core.compat["forum/components/EditPostComposer"];var F=t.n(G);const q=flarum.core.compat["common/utils/extractText"];var J=t.n(q),z=function(){return J()(i().translator.trans("core.lib.username.deleted_text"))};function Q(t,n){return void 0===n&&(n=!0),t?((n?t.displayName():t.username())||z()).replace(/"#[a-z]{0,3}[0-9]+/,"_"):z().replace(/"#[a-z]{0,3}[0-9]+/,"_")}function X(t,n,e){if(void 0!==t&&void 0===n)return i().forum.attribute("allowUsernameMentionFormat")?"@"+Q(t,!1):'@"'+Q(t)+'"#'+t.id();if(void 0!==t&&void 0!==n)return'@"'+Q(t)+'"#p'+n;if(void 0!==e)return'@"'+e.namePlural()+'"#g'+e.id();throw"No parameters were passed"}function Y(t,n,e){return new Promise((function(o){var r=X(t.user(),t.id())+" ";n.fields.content()||(n.body.attrs.originalContent=r);var s=n.editor.getSelectionRange()[0],i=n.fields.content().slice(0,s),a=0==i.length?0:3-i.match(/(\n{0,2})$/)[0].length;return n.editor.insertAtCursor(Array(a).join("\n")+(e?"> "+r+e.trim().replace(/\n/g,"\n> ")+"\n\n":r),!1),o(n)}))}function K(t,n){return i().composer.bodyMatches(F())&&i().composer.body.attrs.post.discussion()===t.discussion()?Y(t,i().composer,n):R().replyAction.call(t.discussion()).then((function(e){return Y(t,e,n)}))}const V=flarum.core.compat["common/Fragment"];var Z=t.n(V),tt=function(t){function n(n){var e;return(e=t.call(this)||this).post=n,e}S(n,t);var e=n.prototype;return e.view=function(){var t=this;return m("button",{class:"Button PostQuoteButton",onclick:function(){K(t.post,t.content)}},T()("fas fa-quote-left",{className:"Button-icon"}),i().translator.trans("flarum-mentions.forum.post.quote_button"))},e.show=function(t,n){var e=this.$().show(),o=e.offsetParent().offset();e.css("left",t-o.left).css("top",n-o.top),this.hideHandler=this.hide.bind(this),$(document).on("mouseup",this.hideHandler)},e.showStart=function(t,n){var e=this.$();this.show(t,$(window).scrollTop()+n-e.outerHeight()-5)},e.showEnd=function(t,n){var e=this.$();this.show(t-e.outerWidth(),$(window).scrollTop()+n+5)},e.hide=function(){this.$().hide(),$(document).off("mouseup",this.hideHandler)},n}(Z());function nt(t){var n=window.getSelection();if(!n.isCollapsed){var e=n.getRangeAt(0),o=e.commonAncestorContainer;if(t[0]===o||$.contains(t[0],o)){var r=$("<div>").append(e.cloneContents());return r.find("img.emoji").replaceWith((function(){return this.alt})),r.find("img").replaceWith((function(){return"![]("+this.src+")"})),r.find("a").replaceWith((function(){return"["+this.innerText+"]("+this.href+")"})),r.text()}}return""}const et=flarum.core.compat["common/components/TextEditor"];var ot=t.n(et);const rt=flarum.core.compat["common/components/TextEditorButton"];var st=t.n(rt);const it=flarum.core.compat["forum/components/ReplyComposer"];var at=t.n(it);const ut=flarum.core.compat["common/helpers/avatar"];var ct=t.n(ut);const mt=flarum.core.compat["common/helpers/highlight"];var lt=t.n(mt);const ft=flarum.core.compat["common/utils/KeyboardNavigatable"];var dt=t.n(ft);const pt=flarum.core.compat["common/utils/throttleDebounce"],ht=flarum.core.compat["common/components/Badge"];var vt=t.n(ht);const gt=flarum.core.compat["common/models/Group"];var yt=t.n(gt),bt=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return(n=t.call.apply(t,[this].concat(o))||this).items=[],n.active=!1,n.index=0,n.keyWasJustPressed=!1,n}S(n,t);var e=n.prototype;return e.view=function(){return m("ul",{className:"Dropdown-menu MentionsDropdown"},this.items.map((function(t){return m("li",null,t)})))},e.show=function(t,n){this.$().show().css({left:t+"px",top:n+"px"}),this.active=!0},e.hide=function(){this.$().hide(),this.active=!1},e.navigate=function(t){var n=this;this.keyWasJustPressed=!0,this.setIndex(this.index+t,!0),clearTimeout(this.keyWasJustPressedTimeout),this.keyWasJustPressedTimeout=setTimeout((function(){return n.keyWasJustPressed=!1}),500)},e.complete=function(){this.$("li").eq(this.index).find("button").click()},e.setIndex=function(t,n){if(!this.keyWasJustPressed||n){var e=this.$(),o=e.find("li"),r=t;r<0?r=o.length-1:r>=o.length&&(r=0),this.index=r;var s=o.removeClass("active").eq(r).addClass("active");if(n){var i,a=e.scrollTop(),u=e.offset().top,c=u+e.outerHeight(),m=s.offset().top,l=m+s.outerHeight();m<u?i=a-u+m-parseInt(e.css("padding-top"),10):l>c&&(i=a-c+l+parseInt(e.css("padding-bottom"),10)),void 0!==i&&e.stop(!0).animate({scrollTop:i},100)}}},n}(Z()),wt=(0,pt.throttle)(250,(function(t,n,e,o,r,s){var a=t.toLowerCase();n.includes(a)||(i().store.find("users",{filter:{q:t},page:{limit:5}}).then((function(t){t.forEach((function(t){o.has(t.id())||(o.add(t.id()),e.push(t))})),s()})),n.push(a))}));const Pt=flarum.core.compat["forum/components/Notification"];var xt=t.n(Pt),Mt=function(t){function n(){return t.apply(this,arguments)||this}S(n,t);var e=n.prototype;return e.icon=function(){return"fas fa-reply"},e.href=function(){var t=this.attrs.notification,n=t.subject(),e=t.content();return i().route.discussion(n.discussion(),e&&e.replyNumber)},e.content=function(){var t=this.attrs.notification.fromUser();return i().translator.trans("flarum-mentions.forum.notifications.post_mentioned_text",{user:t,count:1})},e.excerpt=function(){return(0,c.truncate)(this.attrs.notification.subject().contentPlain()||"",200)},n}(xt()),Ct=function(t){function n(){return t.apply(this,arguments)||this}S(n,t);var e=n.prototype;return e.icon=function(){return"fas fa-at"},e.href=function(){var t=this.attrs.notification.subject();return i().route.discussion(t.discussion(),t.number())},e.content=function(){var t=this.attrs.notification.fromUser();return i().translator.trans("flarum-mentions.forum.notifications.user_mentioned_text",{user:t})},e.excerpt=function(){return(0,c.truncate)(this.attrs.notification.subject().contentPlain(),200)},n}(xt()),$t=function(t){function n(){return t.apply(this,arguments)||this}S(n,t);var e=n.prototype;return e.icon=function(){return"fas fa-at"},e.href=function(){var t=this.attrs.notification.subject();return i().route.discussion(t.discussion(),t.number())},e.content=function(){var t=this.attrs.notification.fromUser();return i().translator.trans("flarum-mentions.forum.notifications.group_mentioned_text",{user:t})},e.excerpt=function(){return(0,c.truncate)(this.attrs.notification.subject().contentPlain(),200)},n}(xt());const _t=flarum.core.compat["forum/components/UserPage"];var Bt=t.n(_t);const Nt=flarum.core.compat["common/components/LinkButton"];var Tt=t.n(Nt);const At=flarum.core.compat["common/models/User"];var kt=t.n(At);flarum.core.compat["common/Model"];const jt=flarum.core.compat["common/extenders"];var St=t.n(jt);const Dt=flarum.core.compat["common/models/Post"];var It=t.n(Dt);const Ot=flarum.core.compat["forum/components/PostsUserPage"];var Ut=function(t){function n(){return t.apply(this,arguments)||this}return S(n,t),n.prototype.loadResults=function(t){return i().store.find("posts",{filter:{type:"comment",mentioned:this.user.id()},page:{offset:t,limit:this.loadLimit},sort:"-createdAt"})},n}(t.n(Ot)());const Et=[(new(St().Routes)).add("user.mentions","/u/:username/mentions",Ut),new(St().Model)(It()).hasMany("mentionedBy").attribute("mentionedByCount"),new(St().Model)(kt()).attribute("canMentionGroups")];function Ht(t){var n;if(i().forum.attribute("allowUsernameMentionFormat")&&t.hasAttribute("username")?n=i().store.getBy("users","username",t.getAttribute("username")):t.hasAttribute("id")&&(n=i().store.getById("users",t.getAttribute("id"))),n)return t.setAttribute("id",n.id()),t.setAttribute("slug",n.slug()),t.setAttribute("displayname",J()(B()(n))),!0;t.invalidate()}function Lt(t){var n=i().store.getById("posts",t.getAttribute("id"));if(n)return t.setAttribute("discussionid",n.discussion().id()),t.setAttribute("number",n.number()),t.setAttribute("displayname",J()(B()(n.user()))),!0}function Wt(t){var n,e;if(null!=(n=i().session)&&null!=(e=n.user)&&e.canMentionGroups()){var o=i().store.getById("groups",t.getAttribute("id"));if(o)return t.setAttribute("groupname",J()(o.namePlural())),t.setAttribute("icon",o.icon()),t.setAttribute("color",o.color()),!0}t.invalidate()}const Rt={"mentions/components/MentionsUserPage":Ut,"mentions/components/PostMentionedNotification":Mt,"mentions/components/UserMentionedNotification":Ct,"mentions/components/GroupMentionedNotification":$t,"mentions/fragments/AutocompleteDropdown":bt,"mentions/fragments/PostQuoteButton":tt,"mentions/utils/getCleanDisplayName":Q,"mentions/utils/getMentionText":X,"mentions/utils/reply":e,"mentions/utils/selectedText":nt,"mentions/utils/textFormatter":o},Gt=flarum.core;i().initializers.add("flarum-mentions",(function(){var t,n;!function(){function t(){var t=this.attrs.post.contentHtml();if(t!==this.oldPostContentHtml&&!this.isEditing()){this.oldPostContentHtml=t;var n=this.attrs.post,e=this.$();this.$().on("click",".UserMention:not(.UserMention--deleted), .PostMention:not(.PostMention--deleted)",(function(t){m.route.set(this.getAttribute("href")),t.preventDefault()})),this.$(".PostMention:not(.PostMention--deleted)").each((function(){var t,o=$(this),r=o.data("id"),s=$('<ul class="Dropdown-menu PostMention-preview fade"/>');e.append(s);var i=function(){return $('.PostStream-item[data-id="'+r+'"]')},a=function(){var t=i(),a=!1;if(t.length){var u=t.offset().top,c=window.pageYOffset;u>c&&u+t.height()<c+$(window).height()&&(t.addClass("pulsate"),a=!0)}if(!a){var l=function(){var t=s.outerHeight(!0),n=0;o.offset().top-t<$(window).scrollTop()+$("#header").outerHeight()?n+=o.outerHeight(!0):n-=t,s.show().css("top",o.offset().top-e.offset().top+n).css("left",o.offsetParent().offset().left-e.offset().left).css("max-width",o.offsetParent().width())},f=function(t){var e=t.discussion();m.render(s[0],[e!==n.discussion()?m("li",null,m("span",{className:"PostMention-preview-discussion"},e.title())):"",m("li",null,y().component({post:t}))]),l()},d=app.store.getById("posts",r);d&&d.discussion()?f(d):(m.render(s[0],w().component()),app.store.find("posts",r).then(f),l()),setTimeout((function(){return s.off("transitionend").addClass("in")}))}},u=function(){i().removeClass("pulsate"),s.hasClass("in")&&s.removeClass("in").one("transitionend",(function(){return s.hide()}))};o.on("touchend",(function(t){t.cancelable&&t.preventDefault()})),o.add(s).hover((function(){clearTimeout(t),t=setTimeout(a,250)}),(function(){clearTimeout(t),i().removeClass("pulsate"),t=setTimeout(u,250)})).on("touchend",(function(t){a(),t.stopPropagation()})),$(document).on("touchend",u)}))}}(0,r.extend)(v().prototype,"oncreate",t),(0,r.extend)(v().prototype,"onupdate",t)}(),function(){function t(){this.$(".Post-mentionedBy-preview").removeClass("in").one("transitionend",(function(){$(this).hide()}))}(0,r.extend)(v().prototype,"oncreate",(function(){var n,e=this,o=this.attrs.post,r=o.mentionedBy();if(r&&r.length){var s=$('<ul class="Dropdown-menu Post-mentionedBy-preview fade"/>');this.$().append(s);var a=this.$(),u=this.$(".Post-mentionedBy"),c=function(){!s.hasClass("in")&&s.is(":visible")||(m.render(s[0],m("[",null,r.map((function(n){return m("li",{"data-number":n.number()},y().component({post:n,onclick:t.bind(e)}))})),r.length<o.mentionedByCount()?m("li",{className:"Post-mentionedBy-preview-more"},m(k(),{className:"PostPreview Button",onclick:function(){t.call(e),i().modal.show(L,{post:o})}},m("span",{className:"PostPreview-content"},m("span",{className:"PostPreview-badge Avatar"},T()("fas fa-reply-all")),m("span",null,i().translator.trans("flarum-mentions.forum.post.mentioned_by_more_text",{count:o.mentionedByCount()-r.length}))))):null)),s.show().css("top",u.offset().top-a.offset().top+u.outerHeight(!0)).css("left",u.offsetParent().offset().left-a.offset().left).css("max-width",a.width()),setTimeout((function(){return s.off("transitionend").addClass("in")})))};u.add(s).hover((function(){clearTimeout(n),n=setTimeout(c,250)}),(function(){clearTimeout(n),n=setTimeout(t,250)})),this.$().find(".Post-mentionedBy-summary a").hover((function(){s.find('[data-number="'+$(this).data("number")+'"]').addClass("active")}),(function(){s.find("[data-number]").removeClass("active")}))}})),(0,r.extend)(v().prototype,"footerItems",(function(n){var e=this,o=this.attrs.post.mentionedBy();if(o&&o.length){var r=[],s=o.sort((function(t){return t.user()===i().session.user?-1:0})).filter((function(t){var n=t.user();if(-1===r.indexOf(n))return r.push(n),!0})),a=s.length>4,u=s.slice(0,a?3:4).map((function(n){var o=n.user();return m(x(),{href:i().route.post(n),onclick:t.bind(e),"data-number":n.number()},i().session.user===o?i().translator.trans("flarum-mentions.forum.post.you_text"):B()(o))}));if(a){var c=s.length-u.length;u.push(i().translator.trans("flarum-mentions.forum.post.others_text",{count:c}))}n.add("replies",m("div",{className:"Post-mentionedBy"},m("span",{className:"Post-mentionedBy-summary"},T()("fas fa-reply"),i().translator.trans("flarum-mentions.forum.post.mentioned_by"+(s[0].user()===i().session.user?"_self":"")+"_text",{count:u.length,users:C()(u)}))))}}))}(),(0,r.extend)(v().prototype,"actionItems",(function(t){var n=this.attrs.post;n.isHidden()||i().session.user&&!n.discussion().canReply()||t.add("reply",m(k(),{className:"Button Button--link",onclick:function(){return K(n)}},i().translator.trans("flarum-mentions.forum.post.reply_link")))})),(0,r.extend)(v().prototype,"oncreate",(function(){var t=this.attrs.post;if(!(t.isHidden()||i().session.user&&!t.discussion().canReply())){var n=this.$(".Post-body"),e=$('<div class="Post-quoteButtonContainer"></div>'),o=new tt(t),r=function(t){setTimeout((function(){var r=nt(n);if(r){o.content=r,m.render(e[0],o.render());var s=window.getSelection().getRangeAt(0).getClientRects(),i=s[0];if(t.clientY<i.bottom&&t.clientX-i.right<i.left-t.clientX)o.showStart(i.left,i.top);else{var a=s[s.length-1];o.showEnd(a.right,a.bottom)}}}),1)};this.$().after(e).on("mouseup",r),"ontouchstart"in window&&document.addEventListener("selectionchange",r,!1)}})),t=$('<div class="ComposerBody-mentionsDropdownContainer"></div>'),n=new bt,(0,r.extend)(ot().prototype,"oncreate",(function(){var e=this.$(".TextEditor-editor").wrap('<div class="ComposerBody-mentionsWrapper"></div>');this.navigator=new(dt()),this.navigator.when((function(){return n.active})).onUp((function(){return n.navigate(-1)})).onDown((function(){return n.navigate(1)})).onSelect(n.complete.bind(n)).onCancel(n.hide.bind(n)).bindTo(e),e.after(t)})),(0,r.extend)(ot().prototype,"buildEditorParams",(function(e){var o,r,s,a,u=this,l=[],f=Array.from(i().store.all("users")),d=new Set(f.map((function(t){return t.id()}))),p=Array.from(i().store.all("groups").filter((function(t){return t.id()!=yt().GUEST_ID&&t.id()!=yt().MEMBER_ID}))),h=function(t){u.attrs.composer.editor.replaceBeforeCursor(r-1,t+" "),n.hide()};e.inputListeners.push((function(){var e=u.attrs.composer.editor.getSelectionRange(),v=e[0];if(!(e[1]-v>0)){var g=u.attrs.composer.editor.getLastNChars(30);r=0;for(var y=g.length-1;y>=0;y--)if("@"===g.substr(y,1)&&(0==y||/\s/.test(g.substr(y-1,1)))){o=y+1,r=v-g.length+y+1;break}if(n.hide(),n.active=!1,r){s=g.substring(o).toLowerCase(),a=s.match(/^["|“]((?:(?!"#).)+)$/),s=a&&a[1]||s;var b=function(t,e,o,r){void 0===r&&(r="");var i=B()(t);return s&&(i.children=[lt()(i.text,s)],delete i.text),m("button",{className:"PostPreview "+r,onclick:function(){return h(e)},onmouseenter:function(){n.setIndex($(this).parent().index())}},m("span",{className:"PostPreview-content"},ct()(t),i," ",o))},w=function(t){return[t.username(),t.displayName()].some((function(t){return t.toLowerCase().substr(0,s.length)===s}))},P=function(){var e,o,a=[];if(s&&(f.forEach((function(t){w(t)&&a.push(b(t,X(t),"","MentionsDropdown-user"))})),null!=(e=i().session)&&null!=(o=e.user)&&o.canMentionGroups()&&p.forEach((function(t){(function(t){return[t.nameSingular(),t.namePlural()].some((function(t){return t.toLowerCase().substr(0,s.length)===s}))})(t)&&a.push(function(t,e,o,r){void 0===r&&(r="");var i=t.namePlural().toLowerCase();return s&&(i=lt()(i,s)),m("button",{className:"PostPreview "+r,onclick:function(){return h(e)},onmouseenter:function(){n.setIndex($(this).parent().index())}},m("span",{className:"PostPreview-content"},m(vt(),{class:"Avatar Badge Badge--group--"+t.id()+" Badge-icon ",color:t.color(),type:"group",icon:t.icon()}),m("span",{className:"username"},i)))}(t,X(void 0,void 0,t),0,"MentionsDropdown-group"))}))),u.attrs.composer.bodyMatches(at())||u.attrs.composer.bodyMatches(F())){var l=u.attrs.composer.body.attrs,d=l.post,v=d&&d.discussion()||l.discussion;v&&v.posts().filter((function(t){return t&&"comment"===t.contentType()&&(!d||t.number()<d.number())})).sort((function(t,n){return n.createdAt()-t.createdAt()})).filter((function(t){var n=t.user();return n&&w(n)})).splice(0,5).forEach((function(t){var n=t.user();a.push(b(n,X(n,t.id()),[i().translator.trans("flarum-mentions.forum.composer.reply_to_post_text",{number:t.number()})," — ",(0,c.truncate)(t.contentPlain(),200)],"MentionsDropdown-post"))}))}if(a.length){n.items=a,m.render(t[0],n.render()),n.show();var g=u.attrs.composer.editor.getCaretCoordinates(r),y=n.$().outerWidth(),P=n.$().outerHeight(),x=n.$().offsetParent(),M=g.left,C=g.top+15;C+P>x.height()&&(C=g.top-P-15),M+y>x.width()&&(M=x.width()-y),C=Math.max(-(x.offset().top-$(document).scrollTop()),C),M=Math.max(-x.offset().left,M),n.show(M,C)}else n.active=!1,n.hide()};n.active=!0,P(),n.setIndex(0),n.$().scrollTop(0),s.length>1&&i().forum.attribute("canSearchUsers")&&wt(s,l,f,d,n,P)}}}))})),(0,r.extend)(ot().prototype,"toolbarItems",(function(t){var n=this;t.add("mention",m(st(),{onclick:function(){return n.attrs.composer.editor.insertAtCursor(" @")},icon:"fas fa-at"},i().translator.trans("flarum-mentions.forum.composer.mention_tooltip")))})),i().notificationComponents.postMentioned=Mt,i().notificationComponents.userMentioned=Ct,i().notificationComponents.groupMentioned=$t,(0,r.extend)(u().prototype,"notificationTypes",(function(t){t.add("postMentioned",{name:"postMentioned",icon:"fas fa-reply",label:i().translator.trans("flarum-mentions.forum.settings.notify_post_mentioned_label")}),t.add("userMentioned",{name:"userMentioned",icon:"fas fa-at",label:i().translator.trans("flarum-mentions.forum.settings.notify_user_mentioned_label")}),t.add("groupMentioned",{name:"groupMentioned",icon:"fas fa-at",label:i().translator.trans("flarum-mentions.forum.settings.notify_group_mentioned_label")})})),(0,r.extend)(Bt().prototype,"navItems",(function(t){var n=this.user;t.add("mentions",Tt().component({href:i().route("user.mentions",{username:n.slug()}),name:"mentions",icon:"fas fa-at"},i().translator.trans("flarum-mentions.forum.user.mentions_link")),80)})),c.getPlainContent.removeSelectors.push("a.PostMention"),(0,r.extend)(p().prototype,"oncreate",(function(){this.$(".GroupMention--colored").each((function(){this.classList.add(f()(getComputedStyle(this).getPropertyValue("--group-color")))}))}))})),Object.assign(Gt.compat,Rt)})(),module.exports=n})();
//# sourceMappingURL=forum.js.map