{"version":3,"file":"forum/components/TagDiscussionModal.js","mappings":"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","sources":["webpack://@flarum/tags/./src/forum/components/ToggleButton.js","webpack://@flarum/tags/./src/common/components/TagSelectionModal.tsx","webpack://@flarum/tags/./src/forum/components/TagDiscussionModal.tsx"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport classList from 'flarum/common/utils/classList';\n\n/**\n * @TODO move to core\n */\nexport default class ToggleButton extends Component {\n  view(vnode) {\n    const {\n      className,\n      isToggled,\n      ...attrs\n    } = this.attrs;\n    const icon = isToggled ? 'far fa-check-circle' : 'far fa-circle';\n    return m(Button, Object.assign({}, attrs, {\n      icon: icon,\n      className: classList([className, isToggled && 'Button--toggled'])\n    }), vnode.children);\n  }\n}\nflarum.reg.add('flarum-tags', 'forum/components/ToggleButton', ToggleButton);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/common/app';\nimport Button from 'flarum/common/components/Button';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\nimport highlight from 'flarum/common/helpers/highlight';\nimport KeyboardNavigatable from 'flarum/common/utils/KeyboardNavigatable';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport FormModal from 'flarum/common/components/FormModal';\nimport Stream from 'flarum/common/utils/Stream';\nimport sortTags from '../utils/sortTags';\nimport tagLabel from '../helpers/tagLabel';\nimport tagIcon from '../helpers/tagIcon';\nimport ToggleButton from '../../forum/components/ToggleButton';\nexport default class TagSelectionModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"loading\", true);\n    _defineProperty(this, \"tags\", void 0);\n    _defineProperty(this, \"selected\", []);\n    _defineProperty(this, \"bypassReqs\", false);\n    _defineProperty(this, \"filter\", Stream(''));\n    _defineProperty(this, \"focused\", false);\n    _defineProperty(this, \"navigator\", new KeyboardNavigatable());\n    _defineProperty(this, \"indexTag\", void 0);\n  }\n  static initAttrs(attrs) {\n    var _attrs$allowResetting, _attrs$limits$min$tot, _attrs$limits, _attrs$limits$min, _attrs$limits$min$pri, _attrs$limits2, _attrs$limits2$min, _attrs$limits$min$sec, _attrs$limits3, _attrs$limits3$min, _attrs$limits$max$tot, _attrs$limits4, _attrs$limits4$max, _attrs$limits$max$pri, _attrs$limits5, _attrs$limits5$max, _attrs$limits$max$sec, _attrs$limits6, _attrs$limits6$max;\n    super.initAttrs(attrs);\n\n    // Default values for optional attributes.\n    attrs.title || (attrs.title = extractText(app.translator.trans('flarum-tags.lib.tag_selection_modal.title')));\n    attrs.canSelect || (attrs.canSelect = () => true);\n    (_attrs$allowResetting = attrs.allowResetting) != null ? _attrs$allowResetting : attrs.allowResetting = true;\n    attrs.limits = {\n      min: {\n        total: (_attrs$limits$min$tot = (_attrs$limits = attrs.limits) == null ? void 0 : (_attrs$limits$min = _attrs$limits.min) == null ? void 0 : _attrs$limits$min.total) != null ? _attrs$limits$min$tot : -Infinity,\n        primary: (_attrs$limits$min$pri = (_attrs$limits2 = attrs.limits) == null ? void 0 : (_attrs$limits2$min = _attrs$limits2.min) == null ? void 0 : _attrs$limits2$min.primary) != null ? _attrs$limits$min$pri : -Infinity,\n        secondary: (_attrs$limits$min$sec = (_attrs$limits3 = attrs.limits) == null ? void 0 : (_attrs$limits3$min = _attrs$limits3.min) == null ? void 0 : _attrs$limits3$min.secondary) != null ? _attrs$limits$min$sec : -Infinity\n      },\n      max: {\n        total: (_attrs$limits$max$tot = (_attrs$limits4 = attrs.limits) == null ? void 0 : (_attrs$limits4$max = _attrs$limits4.max) == null ? void 0 : _attrs$limits4$max.total) != null ? _attrs$limits$max$tot : Infinity,\n        primary: (_attrs$limits$max$pri = (_attrs$limits5 = attrs.limits) == null ? void 0 : (_attrs$limits5$max = _attrs$limits5.max) == null ? void 0 : _attrs$limits5$max.primary) != null ? _attrs$limits$max$pri : Infinity,\n        secondary: (_attrs$limits$max$sec = (_attrs$limits6 = attrs.limits) == null ? void 0 : (_attrs$limits6$max = _attrs$limits6.max) == null ? void 0 : _attrs$limits6$max.secondary) != null ? _attrs$limits$max$sec : Infinity\n      }\n    };\n\n    // Prevent illogical limits from being provided.\n    catchInvalidLimits(attrs.limits);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.navigator.onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true)).onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true)).onSelect(this.select.bind(this)).onRemove(() => this.selected.splice(this.selected.length - 1, 1));\n    app.tagList.load(['parent']).then(tags => {\n      this.loading = false;\n      if (this.attrs.selectableTags) {\n        tags = this.attrs.selectableTags(tags);\n      }\n      this.tags = sortTags(tags);\n      if (this.attrs.selectedTags) {\n        this.attrs.selectedTags.map(this.addTag.bind(this));\n      }\n      this.indexTag = tags[0];\n      m.redraw();\n    });\n  }\n  className() {\n    return classList('TagSelectionModal', this.attrs.className);\n  }\n  title() {\n    return this.attrs.title;\n  }\n  content() {\n    if (this.loading || !this.tags) {\n      return m(LoadingIndicator, null);\n    }\n    const filter = this.filter().toLowerCase();\n    const primaryCount = this.primaryCount();\n    const secondaryCount = this.secondaryCount();\n    const tags = this.getFilteredTags();\n    const inputWidth = Math.max(extractText(this.getInstruction(primaryCount, secondaryCount)).length, this.filter().length);\n    return [m(\"div\", {\n      className: \"Modal-body\"\n    }, m(\"div\", {\n      className: \"TagSelectionModal-form\"\n    }, m(\"div\", {\n      className: \"TagSelectionModal-form-input\"\n    }, m(\"div\", {\n      className: 'TagsInput FormControl ' + (this.focused ? 'focus' : ''),\n      onclick: () => this.$('.TagsInput input').focus()\n    }, m(\"span\", {\n      className: \"TagsInput-selected\"\n    }, this.selected.map(tag => m(\"span\", {\n      className: \"TagsInput-tag\",\n      onclick: () => {\n        this.removeTag(tag);\n        this.onready();\n      }\n    }, tagLabel(tag)))), m(\"input\", {\n      className: \"FormControl\",\n      placeholder: extractText(this.getInstruction(primaryCount, secondaryCount)),\n      bidi: this.filter,\n      style: {\n        width: inputWidth + 'ch'\n      },\n      onkeydown: this.navigator.navigate.bind(this.navigator),\n      onfocus: () => this.focused = true,\n      onblur: () => this.focused = false\n    }))), m(\"div\", {\n      className: \"TagSelectionModal-form-submit App-primaryControl\"\n    }, m(Button, {\n      type: \"submit\",\n      className: \"Button Button--primary\",\n      disabled: !this.meetsRequirements(primaryCount, secondaryCount),\n      icon: \"fas fa-check\"\n    }, app.translator.trans('flarum-tags.lib.tag_selection_modal.submit_button'))))), m(\"div\", {\n      className: \"Modal-footer\"\n    }, m(\"ul\", {\n      className: \"TagSelectionModal-list SelectTagList\"\n    }, tags.map(tag => m(\"li\", {\n      \"data-index\": tag.id(),\n      className: classList('SelectTagListItem', {\n        pinned: tag.position() !== null,\n        child: !!tag.parent(),\n        colored: !!tag.color(),\n        selected: this.selected.includes(tag),\n        active: this.indexTag === tag\n      }),\n      style: {\n        color: tag.color()\n      },\n      onmouseover: () => this.indexTag = tag,\n      onclick: this.toggleTag.bind(this, tag)\n    }, m(\"i\", {\n      className: \"SelectTagListItem-icon\"\n    }, tagIcon(tag, {\n      className: 'SelectTagListItem-tagIcon'\n    }), m(\"i\", {\n      className: \"icon TagIcon fas fa-check SelectTagListItem-checkIcon\"\n    })), m(\"span\", {\n      className: \"SelectTagListItem-name\"\n    }, highlight(tag.name(), filter)), tag.description() ? m(\"span\", {\n      className: \"SelectTagListItem-description\"\n    }, tag.description()) : ''))), this.attrs.limits.allowBypassing && m(\"div\", {\n      className: \"TagSelectionModal-controls\"\n    }, m(ToggleButton, {\n      className: \"Button\",\n      onclick: () => this.bypassReqs = !this.bypassReqs,\n      isToggled: this.bypassReqs\n    }, app.translator.trans('flarum-tags.lib.tag_selection_modal.bypass_requirements'))))];\n  }\n\n  /**\n   * Filters the available tags on every state change.\n   */\n  getFilteredTags() {\n    const filter = this.filter().toLowerCase();\n    const primaryCount = this.primaryCount();\n    const secondaryCount = this.secondaryCount();\n    let tags = this.tags;\n    if (this.attrs.requireParentTag) {\n      // Filter out all child tags whose parents have not been selected. This\n      // makes it impossible to select a child if its parent hasn't been selected.\n      tags = tags.filter(tag => {\n        const parent = tag.parent();\n        return parent !== null && (parent === false || this.selected.includes(parent));\n      });\n    }\n    if (!this.bypassReqs) {\n      // If we reached the total maximum number of tags, we can't select anymore.\n      if (this.selected.length >= this.attrs.limits.max.total) {\n        tags = tags.filter(tag => this.selected.includes(tag));\n      }\n      // If the number of selected primary/secondary tags is at the maximum, then\n      // we'll filter out all other tags of that type.\n      else {\n        if (primaryCount >= this.attrs.limits.max.primary) {\n          tags = tags.filter(tag => !tag.isPrimary() || this.selected.includes(tag));\n        }\n        if (secondaryCount >= this.attrs.limits.max.secondary) {\n          tags = tags.filter(tag => tag.isPrimary() || this.selected.includes(tag));\n        }\n      }\n    }\n\n    // If the user has entered text in the filter input, then filter by tags\n    // whose name matches what they've entered.\n    if (filter) {\n      tags = tags.filter(tag => tag.name().toLowerCase().includes(filter));\n    }\n    if (!this.indexTag || !tags.includes(this.indexTag)) this.indexTag = tags[0];\n    return tags;\n  }\n\n  /**\n   * Counts the number of selected primary tags.\n   */\n  primaryCount() {\n    return this.selected.filter(tag => tag.isPrimary()).length;\n  }\n\n  /**\n   * Counts the number of selected secondary tags.\n   */\n  secondaryCount() {\n    return this.selected.filter(tag => !tag.isPrimary()).length;\n  }\n\n  /**\n   * Validates the number of selected primary/secondary tags against the set min max limits.\n   */\n  meetsRequirements(primaryCount, secondaryCount) {\n    if (this.bypassReqs || this.attrs.allowResetting && this.selected.length === 0) {\n      return true;\n    }\n    if (this.selected.length < this.attrs.limits.min.total) {\n      return false;\n    }\n    return primaryCount >= this.attrs.limits.min.primary && secondaryCount >= this.attrs.limits.min.secondary;\n  }\n\n  /**\n   * Add the given tag to the list of selected tags.\n   */\n  addTag(tag) {\n    if (!tag || !this.attrs.canSelect(tag)) return;\n    if (this.attrs.onSelect) {\n      this.attrs.onSelect(tag, this.selected);\n    }\n\n    // If this tag has a parent, we'll also need to add the parent tag to the\n    // selected list if it's not already in there.\n    if (this.attrs.requireParentTag) {\n      const parent = tag.parent();\n      if (parent && !this.selected.includes(parent)) {\n        this.selected.push(parent);\n      }\n    }\n    if (!this.selected.includes(tag)) {\n      this.selected.push(tag);\n    }\n  }\n\n  /**\n   * Remove the given tag from the list of selected tags.\n   */\n  removeTag(tag) {\n    const index = this.selected.indexOf(tag);\n    if (index !== -1) {\n      this.selected.splice(index, 1);\n\n      // Look through the list of selected tags for any tags which have the tag\n      // we just removed as their parent. We'll need to remove them too.\n      if (this.attrs.requireParentTag) {\n        this.selected.filter(t => t.parent() === tag).forEach(this.removeTag.bind(this));\n      }\n      if (this.attrs.onDeselect) {\n        this.attrs.onDeselect(tag, this.selected);\n      }\n    }\n  }\n  toggleTag(tag) {\n    // Won't happen, needed for type safety.\n    if (!this.tags) return;\n    if (this.selected.includes(tag)) {\n      this.removeTag(tag);\n    } else {\n      this.addTag(tag);\n    }\n    if (this.filter()) {\n      this.filter('');\n      this.indexTag = this.tags[0];\n    }\n    this.onready();\n  }\n\n  /**\n   * Gives human text instructions based on the current number of selected tags and set limits.\n   */\n  getInstruction(primaryCount, secondaryCount) {\n    if (this.bypassReqs) {\n      return '';\n    }\n    if (primaryCount < this.attrs.limits.min.primary) {\n      const remaining = this.attrs.limits.min.primary - primaryCount;\n      return extractText(app.translator.trans('flarum-tags.lib.tag_selection_modal.choose_primary_placeholder', {\n        count: remaining\n      }));\n    } else if (secondaryCount < this.attrs.limits.min.secondary) {\n      const remaining = this.attrs.limits.min.secondary - secondaryCount;\n      return extractText(app.translator.trans('flarum-tags.lib.tag_selection_modal.choose_secondary_placeholder', {\n        count: remaining\n      }));\n    } else if (this.selected.length < this.attrs.limits.min.total) {\n      const remaining = this.attrs.limits.min.total - this.selected.length;\n      return extractText(app.translator.trans('flarum-tags.lib.tag_selection_modal.choose_tags_placeholder', {\n        count: remaining\n      }));\n    }\n    return '';\n  }\n\n  /**\n   * Submit tag selection.\n   */\n  onsubmit(e) {\n    e.preventDefault();\n    if (this.attrs.onsubmit) this.attrs.onsubmit(this.selected);\n    this.hide();\n  }\n  select(e) {\n    // Ctrl + Enter submits the selection, just Enter completes the current entry\n    if (e.metaKey || e.ctrlKey || this.indexTag && this.selected.includes(this.indexTag)) {\n      if (this.selected.length) {\n        // The DOM submit method doesn't emit a `submit event, so we\n        // simulate a manual submission so our `onsubmit` logic is run.\n        this.$('button[type=\"submit\"]').click();\n      }\n    } else if (this.indexTag) {\n      this.getItem(this.indexTag)[0].dispatchEvent(new Event('click'));\n    }\n  }\n  selectableItems() {\n    return this.$('.TagSelectionModal-list > li');\n  }\n  getCurrentNumericIndex() {\n    if (!this.indexTag) return -1;\n    return this.selectableItems().index(this.getItem(this.indexTag));\n  }\n  getItem(selectedTag) {\n    return this.selectableItems().filter(\"[data-index=\\\"\".concat(selectedTag.id(), \"\\\"]\"));\n  }\n  setIndex(index, scrollToItem) {\n    const $items = this.selectableItems();\n    const $dropdown = $items.parent();\n    if (index < 0) {\n      index = $items.length - 1;\n    } else if (index >= $items.length) {\n      index = 0;\n    }\n    const $item = $items.eq(index);\n    this.indexTag = app.store.getById('tags', $item.attr('data-index'));\n    m.redraw();\n    if (scrollToItem && this.indexTag) {\n      const dropdownScroll = $dropdown.scrollTop();\n      const dropdownTop = $dropdown.offset().top;\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\n      const itemTop = $item.offset().top;\n      const itemBottom = itemTop + $item.outerHeight();\n      let scrollTop;\n      if (itemTop < dropdownTop) {\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\n      } else if (itemBottom > dropdownBottom) {\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\n      }\n      if (typeof scrollTop !== 'undefined') {\n        $dropdown.stop(true).animate({\n          scrollTop\n        }, 100);\n      }\n    }\n  }\n}\n\n/**\n * Catch invalid limits provided to the tag selection modal.\n */\nfunction catchInvalidLimits(limits) {\n  if (limits.min.primary > limits.max.primary) {\n    throw new Error('The minimum number of primary tags allowed cannot be more than the maximum number of primary tags allowed.');\n  }\n  if (limits.min.secondary > limits.max.secondary) {\n    throw new Error('The minimum number of secondary tags allowed cannot be more than the maximum number of secondary tags allowed.');\n  }\n  if (limits.min.total > limits.max.primary + limits.max.secondary) {\n    throw new Error('The minimum number of tags allowed cannot be more than the maximum number of primary and secondary tags allowed together.');\n  }\n  if (limits.max.total < limits.min.primary + limits.min.secondary) {\n    throw new Error('The maximum number of tags allowed cannot be less than the minimum number of primary and secondary tags allowed together.');\n  }\n  if (limits.min.total > limits.max.total) {\n    throw new Error('The minimum number of tags allowed cannot be more than the maximum number of tags allowed.');\n  }\n}\nflarum.reg.add('flarum-tags', 'common/components/TagSelectionModal', TagSelectionModal);","import app from 'flarum/forum/app';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\nimport getSelectableTags from '../utils/getSelectableTags';\nimport TagSelectionModal from '../../common/components/TagSelectionModal';\nexport default class TagDiscussionModal extends TagSelectionModal {\n  static initAttrs(attrs) {\n    var _attrs$selectedTags, _attrs$discussion;\n    super.initAttrs(attrs);\n    const title = attrs.discussion ? app.translator.trans('flarum-tags.forum.choose_tags.edit_title', {\n      title: m(\"em\", null, attrs.discussion.title())\n    }) : app.translator.trans('flarum-tags.forum.choose_tags.title');\n    attrs.className = classList(attrs.className, 'TagDiscussionModal');\n    attrs.title = extractText(title);\n    attrs.allowResetting = !!app.forum.attribute('canBypassTagCounts');\n    attrs.limits = {\n      allowBypassing: attrs.allowResetting,\n      max: {\n        primary: app.forum.attribute('maxPrimaryTags'),\n        secondary: app.forum.attribute('maxSecondaryTags')\n      },\n      min: {\n        primary: app.forum.attribute('minPrimaryTags'),\n        secondary: app.forum.attribute('minSecondaryTags')\n      }\n    };\n    attrs.requireParentTag = true;\n    attrs.selectableTags = () => getSelectableTags(attrs.discussion);\n    (_attrs$selectedTags = attrs.selectedTags) != null ? _attrs$selectedTags : attrs.selectedTags = ((_attrs$discussion = attrs.discussion) == null ? void 0 : _attrs$discussion.tags()) || [];\n    attrs.canSelect = tag => tag.canStartDiscussion();\n    const suppliedOnsubmit = attrs.onsubmit || null;\n\n    // Save changes.\n    attrs.onsubmit = function (tags) {\n      const discussion = attrs.discussion;\n      if (discussion) {\n        discussion.save({\n          relationships: {\n            tags\n          }\n        }).then(() => {\n          if (app.current.matches(DiscussionPage)) {\n            app.current.get('stream').update();\n          }\n          m.redraw();\n        });\n      }\n      if (suppliedOnsubmit) suppliedOnsubmit(tags);\n    };\n  }\n}\nflarum.reg.add('flarum-tags', 'forum/components/TagDiscussionModal', TagDiscussionModal);"],"names":["ToggleButton","view","vnode","className","isToggled","attrs","this","icon","m","Object","assign","children","flarum","reg","add","TagSelectionModal","constructor","super","arguments","static","_attrs$limits$min$tot","_attrs$limits","_attrs$limits$min","_attrs$limits$min$pri","_attrs$limits2","_attrs$limits2$min","_attrs$limits$min$sec","_attrs$limits3","_attrs$limits3$min","_attrs$limits$max$tot","_attrs$limits4","_attrs$limits4$max","_attrs$limits$max$pri","_attrs$limits5","_attrs$limits5$max","_attrs$limits$max$sec","_attrs$limits6","_attrs$limits6$max","initAttrs","title","canSelect","allowResetting","limits","min","total","primary","secondary","max","Infinity","Error","catchInvalidLimits","oninit","navigator","onUp","setIndex","getCurrentNumericIndex","onDown","onSelect","select","bind","onRemove","selected","splice","length","then","tags","loading","selectableTags","sortTags","selectedTags","map","addTag","indexTag","redraw","content","filter","toLowerCase","primaryCount","secondaryCount","getFilteredTags","inputWidth","Math","getInstruction","focused","onclick","$","focus","tag","removeTag","onready","tagLabel","placeholder","bidi","style","width","onkeydown","navigate","onfocus","onblur","type","disabled","meetsRequirements","id","pinned","position","child","parent","colored","color","includes","active","onmouseover","toggleTag","tagIcon","name","description","allowBypassing","bypassReqs","requireParentTag","isPrimary","push","index","indexOf","t","forEach","onDeselect","remaining","count","onsubmit","e","preventDefault","hide","metaKey","ctrlKey","click","getItem","dispatchEvent","Event","selectableItems","selectedTag","concat","scrollToItem","$items","$dropdown","$item","eq","attr","dropdownScroll","scrollTop","dropdownTop","offset","top","dropdownBottom","outerHeight","itemTop","itemBottom","parseInt","css","stop","animate","TagDiscussionModal","_attrs$discussion","discussion","getSelectableTags","canStartDiscussion","suppliedOnsubmit","save","relationships","update"],"sourceRoot":""}