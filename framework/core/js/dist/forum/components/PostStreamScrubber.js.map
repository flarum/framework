{"version":3,"file":"forum/components/PostStreamScrubber.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/PostStreamScrubber.js"],"sourcesContent":["import app from '../../forum/app';\nimport Component from '../../common/Component';\nimport icon from '../../common/helpers/icon';\nimport formatNumber from '../../common/utils/formatNumber';\nimport ScrollListener from '../../common/utils/ScrollListener';\n\n/**\n * The `PostStreamScrubber` component displays a scrubber which can be used to\n * navigate/scrub through a post stream.\n *\n * ### Attrs\n *\n * - `stream`\n * - `className`\n */\nexport default class PostStreamScrubber extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.stream = this.attrs.stream;\n    this.handlers = {};\n    this.scrollListener = new ScrollListener(this.updateScrubberValues.bind(this, {\n      fromScroll: true,\n      forceHeightChange: true\n    }));\n  }\n  view() {\n    const count = this.stream.count();\n\n    // Index is left blank for performance reasons, it is filled in in updateScubberValues\n    const viewing = app.translator.trans('core.forum.post_scrubber.viewing_text', {\n      count,\n      index: m(\"span\", {\n        className: \"Scrubber-index\"\n      }),\n      formattedCount: m(\"span\", {\n        className: \"Scrubber-count\"\n      }, formatNumber(count))\n    });\n    const unreadCount = this.stream.discussion.unreadCount();\n    const unreadPercent = count ? Math.min(count - this.stream.index, unreadCount) / count : 0;\n    function styleUnread(vnode) {\n      const $element = $(vnode.dom);\n      const newStyle = {\n        top: 100 - unreadPercent * 100 + '%',\n        height: unreadPercent * 100 + '%',\n        opacity: unreadPercent ? 1 : 0\n      };\n      if (vnode.state.oldStyle) {\n        $element.stop(true).css(vnode.state.oldStyle).animate(newStyle);\n      } else {\n        $element.css(newStyle);\n      }\n      vnode.state.oldStyle = newStyle;\n    }\n    const classNames = ['PostStreamScrubber', 'Dropdown'];\n    if (this.attrs.className) classNames.push(this.attrs.className);\n    return m(\"div\", {\n      className: classNames.join(' ')\n    }, m(\"button\", {\n      className: \"Button Dropdown-toggle\",\n      \"data-toggle\": \"dropdown\"\n    }, viewing, \" \", icon('fas fa-sort')), m(\"div\", {\n      className: \"Dropdown-menu dropdown-menu\"\n    }, m(\"div\", {\n      className: \"Scrubber\"\n    }, m(\"a\", {\n      className: \"Scrubber-first\",\n      onclick: this.goToFirst.bind(this)\n    }, icon('fas fa-angle-double-up'), \" \", app.translator.trans('core.forum.post_scrubber.original_post_link')), m(\"div\", {\n      className: \"Scrubber-scrollbar\"\n    }, m(\"div\", {\n      className: \"Scrubber-before\"\n    }), m(\"div\", {\n      className: \"Scrubber-handle\"\n    }, m(\"div\", {\n      className: \"Scrubber-bar\"\n    }), m(\"div\", {\n      className: \"Scrubber-info\"\n    }, m(\"strong\", null, viewing), m(\"span\", {\n      className: \"Scrubber-description\"\n    }))), m(\"div\", {\n      className: \"Scrubber-after\"\n    }), m(\"div\", {\n      className: \"Scrubber-unread\",\n      oncreate: styleUnread,\n      onupdate: styleUnread\n    }, app.translator.trans('core.forum.post_scrubber.unread_text', {\n      count: unreadCount\n    }))), m(\"a\", {\n      className: \"Scrubber-last\",\n      onclick: this.goToLast.bind(this)\n    }, icon('fas fa-angle-double-down'), \" \", app.translator.trans('core.forum.post_scrubber.now_link')))));\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n    if (this.stream.forceUpdateScrubber) {\n      this.stream.forceUpdateScrubber = false;\n      this.stream.loadPromise.then(() => this.updateScrubberValues({\n        animate: true,\n        forceHeightChange: true\n      }));\n    }\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    // Whenever the window is resized, adjust the height of the scrollbar\n    // so that it fills the height of the sidebar.\n    $(window).on('resize', this.handlers.onresize = this.onresize.bind(this)).resize();\n\n    // When any part of the whole scrollbar is clicked, we want to jump to\n    // that position.\n    this.$('.Scrubber-scrollbar').bind('click', this.onclick.bind(this))\n\n    // Now we want to make the scrollbar handle draggable. Let's start by\n    // preventing default browser events from messing things up.\n    .bind('dragstart mousedown touchstart', e => e.preventDefault());\n\n    // When the mouse is pressed on the scrollbar handle, we capture some\n    // information about its current position. We will store this\n    // information in an object and pass it on to the document's\n    // mousemove/mouseup events later.\n    this.dragging = false;\n    this.mouseStart = 0;\n    this.indexStart = 0;\n    this.$('.Scrubber-handle').bind('mousedown touchstart', this.onmousedown.bind(this))\n\n    // Exempt the scrollbar handle from the 'jump to' click event.\n    .click(e => e.stopPropagation());\n\n    // When the mouse moves and when it is released, we pass the\n    // information that we captured when the mouse was first pressed onto\n    // some event handlers. These handlers will move the scrollbar/stream-\n    // content as appropriate.\n    $(document).on('mousemove touchmove', this.handlers.onmousemove = this.onmousemove.bind(this)).on('mouseup touchend', this.handlers.onmouseup = this.onmouseup.bind(this));\n    setTimeout(() => this.scrollListener.start());\n    this.stream.loadPromise.then(() => this.updateScrubberValues({\n      animate: false,\n      forceHeightChange: true\n    }));\n  }\n  onremove(vnode) {\n    super.onremove(vnode);\n    this.scrollListener.stop();\n    $(window).off('resize', this.handlers.onresize);\n    $(document).off('mousemove touchmove', this.handlers.onmousemove).off('mouseup touchend', this.handlers.onmouseup);\n  }\n\n  /**\n   * Update the scrollbar's position to reflect the current values of the\n   * index/visible properties.\n   *\n   * @param {Partial<{fromScroll: boolean, forceHeightChange: boolean, animate: boolean}>} options\n   */\n  updateScrubberValues(options) {\n    if (options === void 0) {\n      options = {};\n    }\n    const index = this.stream.index;\n    const count = this.stream.count();\n    const visible = this.stream.visible || 1;\n    const percentPerPost = this.percentPerPost();\n    const $scrubber = this.$();\n    $scrubber.find('.Scrubber-index').text(formatNumber(this.stream.sanitizeIndex(Math.max(1, index))));\n    $scrubber.find('.Scrubber-description').text(this.stream.description);\n    $scrubber.toggleClass('disabled', this.stream.disabled());\n    const heights = {};\n    heights.before = Math.max(0, percentPerPost.index * Math.min(index - 1, count - visible));\n    heights.handle = Math.min(100 - heights.before, percentPerPost.visible * visible);\n    heights.after = 100 - heights.before - heights.handle;\n\n    // If the stream is paused, don't change height on scroll, as the viewport is being scrolled by the JS\n    // If a height change animation is already in progress, don't adjust height unless overriden\n    if (options.fromScroll && this.stream.paused || this.adjustingHeight && !options.forceHeightChange) return;\n    const func = options.animate ? 'animate' : 'css';\n    this.adjustingHeight = true;\n    const animationPromises = [];\n    for (const part in heights) {\n      const $part = $scrubber.find(\".Scrubber-\".concat(part));\n      animationPromises.push($part.stop(true, true)[func]({\n        height: heights[part] + '%'\n      }, 'fast').promise());\n\n      // jQuery likes to put overflow:hidden, but because the scrollbar handle\n      // has a negative margin-left, we need to override.\n      if (func === 'animate') $part.css('overflow', 'visible');\n    }\n    Promise.all(animationPromises).then(() => this.adjustingHeight = false);\n  }\n\n  /**\n   * Go to the first post in the discussion.\n   */\n  goToFirst() {\n    this.stream.goToFirst();\n    this.updateScrubberValues({\n      animate: true,\n      forceHeightChange: true\n    });\n  }\n\n  /**\n   * Go to the last post in the discussion.\n   */\n  goToLast() {\n    this.stream.goToLast();\n    this.updateScrubberValues({\n      animate: true,\n      forceHeightChange: true\n    });\n  }\n  onresize() {\n    // Adjust the height of the scrollbar so that it fills the height of\n    // the sidebar and doesn't overlap the footer.\n    const scrubber = this.$();\n    const scrollbar = this.$('.Scrubber-scrollbar');\n    scrollbar.css('max-height', $(window).height() - scrubber.offset().top + $(window).scrollTop() - parseInt($('#app').css('padding-bottom'), 10) - (scrubber.outerHeight() - scrollbar.outerHeight()));\n  }\n  onmousedown(e) {\n    e.redraw = false;\n    this.mouseStart = e.clientY || e.originalEvent.touches[0].clientY;\n    this.indexStart = this.stream.index;\n    this.dragging = true;\n    $('body').css('cursor', 'move');\n    this.$().toggleClass('dragging', this.dragging);\n  }\n  onmousemove(e) {\n    if (!this.dragging) return;\n\n    // Work out how much the mouse has moved by - first in pixels, then\n    // convert it to a percentage of the scrollbar's height, and then\n    // finally convert it into an index. Add this delta index onto\n    // the index at which the drag was started, and then scroll there.\n    const deltaPixels = (e.clientY || e.originalEvent.touches[0].clientY) - this.mouseStart;\n    const deltaPercent = deltaPixels / this.$('.Scrubber-scrollbar').outerHeight() * 100;\n    const deltaIndex = deltaPercent / this.percentPerPost().index || 0;\n    const newIndex = Math.min(this.indexStart + deltaIndex, this.stream.count() - 1);\n    this.stream.index = Math.max(0, newIndex);\n    this.updateScrubberValues();\n  }\n  onmouseup() {\n    this.$().toggleClass('dragging', this.dragging);\n    if (!this.dragging) return;\n    this.mouseStart = 0;\n    this.indexStart = 0;\n    this.dragging = false;\n    $('body').css('cursor', '');\n    this.$().removeClass('open');\n\n    // If the index we've landed on is in a gap, then tell the stream-\n    // content that we want to load those posts.\n    const intIndex = Math.floor(this.stream.index);\n    this.stream.goToIndex(intIndex);\n  }\n  onclick(e) {\n    // Calculate the index which we want to jump to based on the click position.\n\n    // 1. Get the offset of the click from the top of the scrollbar, as a\n    //    percentage of the scrollbar's height.\n    const $scrollbar = this.$('.Scrubber-scrollbar');\n    const offsetPixels = (e.pageY || e.originalEvent.touches[0].pageY) - $scrollbar.offset().top + $('body').scrollTop();\n    let offsetPercent = offsetPixels / $scrollbar.outerHeight() * 100;\n\n    // 2. We want the handle of the scrollbar to end up centered on the click\n    //    position. Thus, we calculate the height of the handle in percent and\n    //    use that to find a new offset percentage.\n    offsetPercent = offsetPercent - parseFloat($scrollbar.find('.Scrubber-handle')[0].style.height) / 2;\n\n    // 3. Now we can convert the percentage into an index, and tell the stream-\n    //    content component to jump to that index.\n    let offsetIndex = offsetPercent / this.percentPerPost().index;\n    offsetIndex = Math.max(0, Math.min(this.stream.count() - 1, offsetIndex));\n    this.stream.goToIndex(Math.floor(offsetIndex));\n    this.updateScrubberValues({\n      animate: true,\n      forceHeightChange: true\n    });\n    this.$().removeClass('open');\n  }\n\n  /**\n   * Get the percentage of the height of the scrubber that should be allocated\n   * to each post.\n   *\n   * @return {{ index: number, visible: number }}\n   * @property {Number} index The percent per post for posts on either side of\n   *     the visible part of the scrubber.\n   * @property {Number} visible The percent per post for the visible part of the\n   *     scrubber.\n   */\n  percentPerPost() {\n    const count = this.stream.count() || 1;\n    const visible = this.stream.visible || 1;\n\n    // To stop the handle of the scrollbar from getting too small when there\n    // are many posts, we define a minimum percentage height for the handle\n    // calculated from a 50 pixel limit. From this, we can calculate the\n    // minimum percentage per visible post. If this is greater than the actual\n    // percentage per post, then we need to adjust the 'before' percentage to\n    // account for it.\n    const minPercentVisible = 50 / this.$('.Scrubber-scrollbar').outerHeight() * 100;\n    const percentPerVisiblePost = Math.max(100 / count, minPercentVisible / visible);\n    const percentPerPost = count === visible ? 0 : (100 - percentPerVisiblePost * visible) / (count - visible);\n    return {\n      index: percentPerPost,\n      visible: percentPerVisiblePost\n    };\n  }\n}\nflarum.reg.add('core', 'forum/components/PostStreamScrubber', PostStreamScrubber);"],"names":["PostStreamScrubber","oninit","vnode","super","this","stream","attrs","handlers","scrollListener","updateScrubberValues","bind","fromScroll","forceHeightChange","view","count","viewing","index","m","className","formattedCount","unreadCount","discussion","unreadPercent","Math","min","styleUnread","$element","$","dom","newStyle","top","height","opacity","state","oldStyle","stop","css","animate","classNames","push","join","onclick","goToFirst","oncreate","onupdate","goToLast","forceUpdateScrubber","loadPromise","then","window","on","onresize","resize","e","preventDefault","dragging","mouseStart","indexStart","onmousedown","click","stopPropagation","document","onmousemove","onmouseup","setTimeout","start","onremove","off","options","visible","percentPerPost","$scrubber","find","text","sanitizeIndex","max","description","toggleClass","disabled","heights","before","handle","after","paused","adjustingHeight","func","animationPromises","part","$part","concat","promise","Promise","all","scrubber","scrollbar","offset","scrollTop","parseInt","outerHeight","redraw","clientY","originalEvent","touches","deltaIndex","newIndex","removeClass","intIndex","floor","goToIndex","$scrollbar","offsetPercent","pageY","parseFloat","style","offsetIndex","minPercentVisible","percentPerVisiblePost","flarum","reg","add"],"sourceRoot":""}