{"version":3,"file":"forum/components/SignUpModal.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/SignUpModal.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../../forum/app';\nimport FormModal from '../../common/components/FormModal';\nimport Button from '../../common/components/Button';\nimport LogInButtons from './LogInButtons';\nimport extractText from '../../common/utils/extractText';\nimport ItemList from '../../common/utils/ItemList';\nimport Stream from '../../common/utils/Stream';\nexport default class SignUpModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    /**\n     * The value of the username input.\n     */\n    _defineProperty(this, \"username\", void 0);\n    /**\n     * The value of the email input.\n     */\n    _defineProperty(this, \"email\", void 0);\n    /**\n     * The value of the password input.\n     */\n    _defineProperty(this, \"password\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.username = Stream(this.attrs.username || '');\n    this.email = Stream(this.attrs.email || '');\n    this.password = Stream(this.attrs.password || '');\n  }\n  className() {\n    return 'Modal--small SignUpModal';\n  }\n  title() {\n    return app.translator.trans('core.forum.sign_up.title');\n  }\n  content() {\n    return [m(\"div\", {\n      className: \"Modal-body\"\n    }, this.body()), m(\"div\", {\n      className: \"Modal-footer\"\n    }, this.footer())];\n  }\n  isProvided(field) {\n    var _this$attrs$provided$, _this$attrs$provided;\n    return (_this$attrs$provided$ = (_this$attrs$provided = this.attrs.provided) == null ? void 0 : _this$attrs$provided.includes(field)) != null ? _this$attrs$provided$ : false;\n  }\n  body() {\n    return [!this.attrs.token && m(LogInButtons, null), m(\"div\", {\n      className: \"Form Form--centered\"\n    }, this.fields().toArray())];\n  }\n  fields() {\n    const items = new ItemList();\n    const usernameLabel = extractText(app.translator.trans('core.forum.sign_up.username_placeholder'));\n    const emailLabel = extractText(app.translator.trans('core.forum.sign_up.email_placeholder'));\n    const passwordLabel = extractText(app.translator.trans('core.forum.sign_up.password_placeholder'));\n    items.add('username', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"username\",\n      type: \"text\",\n      placeholder: usernameLabel,\n      \"aria-label\": usernameLabel,\n      bidi: this.username,\n      disabled: this.loading || this.isProvided('username')\n    })), 30);\n    items.add('email', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"email\",\n      type: \"email\",\n      placeholder: emailLabel,\n      \"aria-label\": emailLabel,\n      bidi: this.email,\n      disabled: this.loading || this.isProvided('email')\n    })), 20);\n    if (!this.attrs.token) {\n      items.add('password', m(\"div\", {\n        className: \"Form-group\"\n      }, m(\"input\", {\n        className: \"FormControl\",\n        name: \"password\",\n        type: \"password\",\n        autocomplete: \"new-password\",\n        placeholder: passwordLabel,\n        \"aria-label\": passwordLabel,\n        bidi: this.password,\n        disabled: this.loading\n      })), 10);\n    }\n    items.add('submit', m(\"div\", {\n      className: \"Form-group\"\n    }, m(Button, {\n      className: \"Button Button--primary Button--block\",\n      type: \"submit\",\n      loading: this.loading\n    }, app.translator.trans('core.forum.sign_up.submit_button'))), -10);\n    return items;\n  }\n  footer() {\n    return [m(\"p\", {\n      className: \"SignUpModal-logIn\"\n    }, app.translator.trans('core.forum.sign_up.log_in_text', {\n      a: m(Button, {\n        className: \"Button Button--text Button--link\",\n        onclick: this.logIn.bind(this)\n      })\n    }))];\n  }\n\n  /**\n   * Open the log in modal, prefilling it with an email/username/password if\n   * the user has entered one.\n   */\n  logIn() {\n    const attrs = {\n      identification: this.email() || this.username()\n    };\n    app.modal.show(() => import(/* webpackChunkName: 'forum/components/LogInModal', webpackMode: 'lazy-once' */ './LogInModal'), attrs);\n  }\n  onready() {\n    if (this.attrs.username && !this.attrs.email) {\n      this.$('[name=email]').select();\n    } else {\n      this.$('[name=username]').select();\n    }\n  }\n  onsubmit(e) {\n    e.preventDefault();\n    this.loading = true;\n    const body = this.submitData();\n    app.request({\n      url: app.forum.attribute('baseUrl') + '/register',\n      method: 'POST',\n      body,\n      errorHandler: this.onerror.bind(this)\n    }).then(() => window.location.reload(), this.loaded.bind(this));\n  }\n\n  /**\n   * Get the data that should be submitted in the sign-up request.\n   */\n  submitData() {\n    const authData = this.attrs.token ? {\n      token: this.attrs.token\n    } : {\n      password: this.password()\n    };\n    const data = {\n      username: this.username(),\n      email: this.email(),\n      ...authData\n    };\n    return data;\n  }\n}\nflarum.reg.add('core', 'forum/components/SignUpModal', SignUpModal);"],"names":["SignUpModal","constructor","super","arguments","this","oninit","vnode","username","attrs","email","password","className","title","translator","trans","content","m","body","footer","isProvided","field","_this$attrs$provided$","_this$attrs$provided","provided","includes","token","fields","toArray","items","usernameLabel","emailLabel","passwordLabel","add","name","type","placeholder","bidi","disabled","loading","autocomplete","a","onclick","logIn","bind","identification","modal","show","onready","$","select","onsubmit","e","preventDefault","submitData","request","url","forum","attribute","method","errorHandler","onerror","then","window","location","reload","loaded","authData","flarum","reg"],"sourceRoot":""}