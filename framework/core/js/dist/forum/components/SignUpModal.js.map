{"version":3,"file":"forum/components/SignUpModal.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/SignUpModal.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../../forum/app';\nimport FormModal from '../../common/components/FormModal';\nimport Button from '../../common/components/Button';\nimport LogInButtons from './LogInButtons';\nimport extractText from '../../common/utils/extractText';\nimport ItemList from '../../common/utils/ItemList';\nimport Stream from '../../common/utils/Stream';\nexport default class SignUpModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    /**\n     * The value of the username input.\n     */\n    _defineProperty(this, \"username\", void 0);\n    /**\n     * The value of the email input.\n     */\n    _defineProperty(this, \"email\", void 0);\n    /**\n     * The value of the password input.\n     */\n    _defineProperty(this, \"password\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.username = Stream(this.attrs.username || '');\n    this.email = Stream(this.attrs.email || '');\n    this.password = Stream(this.attrs.password || '');\n  }\n  className() {\n    return 'Modal--small SignUpModal';\n  }\n  title() {\n    return app.translator.trans('core.forum.sign_up.title');\n  }\n  content() {\n    return [m(\"div\", {\n      className: \"Modal-body\"\n    }, this.body()), m(\"div\", {\n      className: \"Modal-footer\"\n    }, this.footer())];\n  }\n  isProvided(field) {\n    var _this$attrs$provided$, _this$attrs$provided;\n    return (_this$attrs$provided$ = (_this$attrs$provided = this.attrs.provided) == null ? void 0 : _this$attrs$provided.includes(field)) != null ? _this$attrs$provided$ : false;\n  }\n  body() {\n    return [!this.attrs.token && m(LogInButtons, null), m(\"div\", {\n      className: \"Form Form--centered\"\n    }, this.fields().toArray())];\n  }\n  fields() {\n    const items = new ItemList();\n    const usernameLabel = extractText(app.translator.trans('core.forum.sign_up.username_placeholder'));\n    const emailLabel = extractText(app.translator.trans('core.forum.sign_up.email_placeholder'));\n    const passwordLabel = extractText(app.translator.trans('core.forum.sign_up.password_placeholder'));\n    items.add('username', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"username\",\n      type: \"text\",\n      placeholder: usernameLabel,\n      \"aria-label\": usernameLabel,\n      bidi: this.username,\n      disabled: this.loading || this.isProvided('username')\n    })), 30);\n    items.add('email', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"email\",\n      type: \"email\",\n      placeholder: emailLabel,\n      \"aria-label\": emailLabel,\n      bidi: this.email,\n      disabled: this.loading || this.isProvided('email')\n    })), 20);\n    if (!this.attrs.token) {\n      items.add('password', m(\"div\", {\n        className: \"Form-group\"\n      }, m(\"input\", {\n        className: \"FormControl\",\n        name: \"password\",\n        type: \"password\",\n        autocomplete: \"new-password\",\n        placeholder: passwordLabel,\n        \"aria-label\": passwordLabel,\n        bidi: this.password,\n        disabled: this.loading\n      })), 10);\n    }\n    items.add('submit', m(\"div\", {\n      className: \"Form-group\"\n    }, m(Button, {\n      className: \"Button Button--primary Button--block\",\n      type: \"submit\",\n      loading: this.loading\n    }, app.translator.trans('core.forum.sign_up.submit_button'))), -10);\n    return items;\n  }\n  footer() {\n    return [m(\"p\", {\n      className: \"SignUpModal-logIn\"\n    }, app.translator.trans('core.forum.sign_up.log_in_text', {\n      a: m(\"a\", {\n        onclick: this.logIn.bind(this)\n      })\n    }))];\n  }\n\n  /**\n   * Open the log in modal, prefilling it with an email/username/password if\n   * the user has entered one.\n   */\n  logIn() {\n    const attrs = {\n      identification: this.email() || this.username()\n    };\n    app.modal.show(() => import(/* webpackChunkName: 'forum/components/LogInModal', webpackMode: 'lazy-once' */ './LogInModal'), attrs);\n  }\n  onready() {\n    if (this.attrs.username && !this.attrs.email) {\n      this.$('[name=email]').select();\n    } else {\n      this.$('[name=username]').select();\n    }\n  }\n  onsubmit(e) {\n    e.preventDefault();\n    this.loading = true;\n    const body = this.submitData();\n    app.request({\n      url: app.forum.attribute('baseUrl') + '/register',\n      method: 'POST',\n      body,\n      errorHandler: this.onerror.bind(this)\n    }).then(() => window.location.reload(), this.loaded.bind(this));\n  }\n\n  /**\n   * Get the data that should be submitted in the sign-up request.\n   */\n  submitData() {\n    const authData = this.attrs.token ? {\n      token: this.attrs.token\n    } : {\n      password: this.password()\n    };\n    const data = {\n      username: this.username(),\n      email: this.email(),\n      ...authData\n    };\n    return data;\n  }\n}\nflarum.reg.add('core', 'forum/components/SignUpModal', SignUpModal);flarum.reg.addChunkModule('460', '5049', 'core', 'forum/components/LogInModal');"],"names":["SignUpModal","constructor","super","arguments","this","oninit","vnode","username","attrs","email","password","className","title","content","m","body","footer","isProvided","field","_this$attrs$provided$","_this$attrs$provided","provided","includes","token","fields","toArray","items","usernameLabel","emailLabel","passwordLabel","add","name","type","placeholder","bidi","disabled","loading","autocomplete","a","onclick","logIn","bind","identification","onready","$","select","onsubmit","e","preventDefault","submitData","url","method","errorHandler","onerror","then","window","location","reload","loaded","authData","flarum","reg","addChunkModule"],"sourceRoot":""}