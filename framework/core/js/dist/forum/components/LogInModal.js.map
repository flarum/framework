{"version":3,"file":"forum/components/LogInModal.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/LogInModal.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../../forum/app';\nimport Modal from '../../common/components/Modal';\nimport Button from '../../common/components/Button';\nimport LogInButtons from './LogInButtons';\nimport extractText from '../../common/utils/extractText';\nimport ItemList from '../../common/utils/ItemList';\nimport Stream from '../../common/utils/Stream';\nexport default class LogInModal extends Modal {\n  constructor() {\n    super(...arguments);\n    /**\n     * The value of the identification input.\n     */\n    _defineProperty(this, \"identification\", void 0);\n    /**\n     * The value of the password input.\n     */\n    _defineProperty(this, \"password\", void 0);\n    /**\n     * The value of the remember me input.\n     */\n    _defineProperty(this, \"remember\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.identification = Stream(this.attrs.identification || '');\n    this.password = Stream(this.attrs.password || '');\n    this.remember = Stream(!!this.attrs.remember);\n  }\n  className() {\n    return 'LogInModal Modal--small';\n  }\n  title() {\n    return app.translator.trans('core.forum.log_in.title');\n  }\n  content() {\n    return [m(\"div\", {\n      className: \"Modal-body\"\n    }, this.body()), m(\"div\", {\n      className: \"Modal-footer\"\n    }, this.footer())];\n  }\n  body() {\n    return [m(LogInButtons, null), m(\"div\", {\n      className: \"Form Form--centered\"\n    }, this.fields().toArray())];\n  }\n  fields() {\n    const items = new ItemList();\n    const identificationLabel = extractText(app.translator.trans('core.forum.log_in.username_or_email_placeholder'));\n    const passwordLabel = extractText(app.translator.trans('core.forum.log_in.password_placeholder'));\n    items.add('identification', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"identification\",\n      type: \"text\",\n      placeholder: identificationLabel,\n      \"aria-label\": identificationLabel,\n      bidi: this.identification,\n      disabled: this.loading\n    })), 30);\n    items.add('password', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      className: \"FormControl\",\n      name: \"password\",\n      type: \"password\",\n      autocomplete: \"current-password\",\n      placeholder: passwordLabel,\n      \"aria-label\": passwordLabel,\n      bidi: this.password,\n      disabled: this.loading\n    })), 20);\n    items.add('remember', m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"div\", null, m(\"label\", {\n      className: \"checkbox\"\n    }, m(\"input\", {\n      type: \"checkbox\",\n      bidi: this.remember,\n      disabled: this.loading\n    }), app.translator.trans('core.forum.log_in.remember_me_label')))), 10);\n    items.add('submit', m(\"div\", {\n      className: \"Form-group\"\n    }, m(Button, {\n      className: \"Button Button--primary Button--block\",\n      type: \"submit\",\n      loading: this.loading\n    }, app.translator.trans('core.forum.log_in.submit_button'))), -10);\n    return items;\n  }\n  footer() {\n    return m('[', null, m(\"p\", {\n      className: \"LogInModal-forgotPassword\"\n    }, m(\"a\", {\n      onclick: this.forgotPassword.bind(this)\n    }, app.translator.trans('core.forum.log_in.forgot_password_link'))), app.forum.attribute('allowSignUp') && m(\"p\", {\n      className: \"LogInModal-signUp\"\n    }, app.translator.trans('core.forum.log_in.sign_up_text', {\n      a: m(\"a\", {\n        onclick: this.signUp.bind(this)\n      })\n    })));\n  }\n\n  /**\n   * Open the forgot password modal, prefilling it with an email if the user has\n   * entered one.\n   */\n  forgotPassword() {\n    const email = this.identification();\n    const attrs = email.includes('@') ? {\n      email\n    } : undefined;\n    app.modal.show(() => import(/* webpackChunkName: 'forum/components/ForgotPasswordModal', webpackMode: 'lazy-once' */ './ForgotPasswordModal'), attrs);\n  }\n\n  /**\n   * Open the sign up modal, prefilling it with an email/username/password if\n   * the user has entered one.\n   */\n  signUp() {\n    const identification = this.identification();\n    const attrs = {\n      [identification.includes('@') ? 'email' : 'username']: identification\n    };\n    app.modal.show(() => import(/* webpackChunkName: 'forum/components/SignUpModal', webpackMode: 'lazy-once' */ './SignUpModal'), attrs);\n  }\n  onready() {\n    this.$('[name=' + (this.identification() ? 'password' : 'identification') + ']').trigger('select');\n  }\n  onsubmit(e) {\n    e.preventDefault();\n    this.loading = true;\n    app.session.login(this.loginParams(), {\n      errorHandler: this.onerror.bind(this)\n    }).then(() => window.location.reload(), this.loaded.bind(this));\n  }\n  loginParams() {\n    const data = {\n      identification: this.identification(),\n      password: this.password(),\n      remember: this.remember()\n    };\n    return data;\n  }\n  onerror(error) {\n    if (error.status === 401 && error.alert) {\n      error.alert.content = app.translator.trans('core.forum.log_in.invalid_login_message');\n      this.password('');\n    }\n    super.onerror(error);\n  }\n}\nflarum.reg.add('core', 'forum/components/LogInModal', LogInModal);flarum.reg.addChunkModule('502', '1839', 'core', 'forum/components/ForgotPasswordModal');"],"names":["LogInModal","constructor","super","arguments","this","oninit","vnode","identification","attrs","password","remember","className","title","content","m","body","footer","fields","toArray","items","identificationLabel","passwordLabel","add","name","type","placeholder","bidi","disabled","loading","autocomplete","onclick","forgotPassword","bind","a","signUp","email","includes","undefined","onready","$","trigger","onsubmit","e","preventDefault","loginParams","errorHandler","onerror","then","window","location","reload","loaded","error","status","alert","flarum","reg","addChunkModule"],"sourceRoot":""}