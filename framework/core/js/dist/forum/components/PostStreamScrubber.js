"use strict";(self.webpackChunkflarum_core=self.webpackChunkflarum_core||[]).push([[486],{8857:(t,e,s)=>{s.r(e),s.d(e,{default:()=>c});var r=s(3554),o=s(5710),i=s(5865),a=s(2361),n=s(7479),h=s(3092);class c extends o.A{oninit(t){super.oninit(t),this.stream=this.attrs.stream,this.handlers={},this.scrollListener=new a.A(this.updateScrubberValues.bind(this,{fromScroll:!0,forceHeightChange:!0}))}view(){const t=this.stream.count(),e=r.A.translator.trans("core.forum.post_scrubber.viewing_text",{count:t,index:m("span",{className:"Scrubber-index"}),formattedCount:m("span",{className:"Scrubber-count"},(0,i.A)(t))}),s=this.stream.discussion.unreadCount(),o=t?Math.min(t-this.stream.index,s)/t:0;function a(t){const e=$(t.dom),s={top:100-100*o+"%",height:100*o+"%",opacity:o?1:0};t.state.oldStyle?e.stop(!0).css(t.state.oldStyle).animate(s):e.css(s),t.state.oldStyle=s}const c=["PostStreamScrubber","Dropdown"];return this.attrs.className&&c.push(this.attrs.className),m("div",{className:c.join(" ")},m("button",{className:"Button Dropdown-toggle","data-toggle":"dropdown"},e," ",m(n.A,{name:"fas fa-sort"})),m("div",{className:"Dropdown-menu dropdown-menu"},m("div",{className:"Scrubber"},m(h.A,{className:"Scrubber-first Button Button--link",onclick:this.goToFirst.bind(this),icon:"fas fa-angle-double-up"},r.A.translator.trans("core.forum.post_scrubber.original_post_link")),m("div",{className:"Scrubber-scrollbar"},m("div",{className:"Scrubber-before"}),m("div",{className:"Scrubber-handle"},m("div",{className:"Scrubber-bar"}),m("div",{className:"Scrubber-info"},m("strong",null,e),m("span",{className:"Scrubber-description"}))),m("div",{className:"Scrubber-after"}),m("div",{className:"Scrubber-unread",oncreate:a,onupdate:a},r.A.translator.trans("core.forum.post_scrubber.unread_text",{count:s}))),m(h.A,{className:"Scrubber-last Button Button--link",onclick:this.goToLast.bind(this),icon:"fas fa-angle-double-down"},r.A.translator.trans("core.forum.post_scrubber.now_link")))))}onupdate(t){super.onupdate(t),this.stream.forceUpdateScrubber&&(this.stream.forceUpdateScrubber=!1,this.stream.loadPromise.then((()=>this.updateScrubberValues({animate:!0,forceHeightChange:!0}))))}oncreate(t){super.oncreate(t),$(window).on("resize",this.handlers.onresize=this.onresize.bind(this)).resize(),this.$(".Scrubber-scrollbar").bind("click",this.onclick.bind(this)).bind("dragstart mousedown touchstart",(t=>t.preventDefault())),this.dragging=!1,this.mouseStart=0,this.indexStart=0,this.$(".Scrubber-handle").bind("mousedown touchstart",this.onmousedown.bind(this)).click((t=>t.stopPropagation())),$(document).on("mousemove touchmove",this.handlers.onmousemove=this.onmousemove.bind(this)).on("mouseup touchend",this.handlers.onmouseup=this.onmouseup.bind(this)),setTimeout((()=>this.scrollListener.start())),this.stream.loadPromise.then((()=>this.updateScrubberValues({animate:!1,forceHeightChange:!0})))}onremove(t){super.onremove(t),this.scrollListener.stop(),$(window).off("resize",this.handlers.onresize),$(document).off("mousemove touchmove",this.handlers.onmousemove).off("mouseup touchend",this.handlers.onmouseup)}updateScrubberValues(t){void 0===t&&(t={});const e=this.stream.index,s=this.stream.count(),r=this.stream.visible||1,o=this.percentPerPost(),a=this.$();a.find(".Scrubber-index").text((0,i.A)(this.stream.sanitizeIndex(Math.max(1,e)))),a.find(".Scrubber-description").text(this.stream.description),a.toggleClass("disabled",this.stream.disabled());const n={};if(n.before=Math.max(0,o.index*Math.min(e-1,s-r)),n.handle=Math.min(100-n.before,o.visible*r),n.after=100-n.before-n.handle,t.fromScroll&&this.stream.paused||this.adjustingHeight&&!t.forceHeightChange)return;const h=t.animate?"animate":"css";this.adjustingHeight=!0;const c=[];for(const t in n){const e=a.find(`.Scrubber-${t}`);c.push(e.stop(!0,!0)[h]({height:n[t]+"%"},"fast").promise()),"animate"===h&&e.css("overflow","visible")}Promise.all(c).then((()=>this.adjustingHeight=!1))}goToFirst(){this.stream.goToFirst(),this.updateScrubberValues({animate:!0,forceHeightChange:!0})}goToLast(){this.stream.goToLast(),this.updateScrubberValues({animate:!0,forceHeightChange:!0})}onresize(){const t=this.$(),e=this.$(".Scrubber-scrollbar");e.css("max-height",$(window).height()-t.offset().top+$(window).scrollTop()-parseInt($("#app").css("padding-bottom"),10)-(t.outerHeight()-e.outerHeight()))}onmousedown(t){t.redraw=!1,this.mouseStart=t.clientY||t.originalEvent.touches[0].clientY,this.indexStart=this.stream.index,this.dragging=!0,$("body").css("cursor","move"),this.$().toggleClass("dragging",this.dragging)}onmousemove(t){if(!this.dragging)return;const e=((t.clientY||t.originalEvent.touches[0].clientY)-this.mouseStart)/this.$(".Scrubber-scrollbar").outerHeight()*100/this.percentPerPost().index||0,s=Math.min(this.indexStart+e,this.stream.count()-1);this.stream.index=Math.max(0,s),this.updateScrubberValues()}onmouseup(){if(this.$().toggleClass("dragging",this.dragging),!this.dragging)return;this.mouseStart=0,this.indexStart=0,this.dragging=!1,$("body").css("cursor",""),this.$().removeClass("open");const t=Math.floor(this.stream.index);this.stream.goToIndex(t)}onclick(t){const e=this.$(".Scrubber-scrollbar");let s=((t.pageY||t.originalEvent.touches[0].pageY)-e.offset().top+$("body").scrollTop())/e.outerHeight()*100;s-=parseFloat(e.find(".Scrubber-handle")[0].style.height)/2;let r=s/this.percentPerPost().index;r=Math.max(0,Math.min(this.stream.count()-1,r)),this.stream.goToIndex(Math.floor(r)),this.updateScrubberValues({animate:!0,forceHeightChange:!0}),this.$().removeClass("open")}percentPerPost(){const t=this.stream.count()||1,e=this.stream.visible||1,s=50/this.$(".Scrubber-scrollbar").outerHeight()*100,r=Math.max(100/t,s/e);return{index:t===e?0:(100-r*e)/(t-e),visible:r}}}flarum.reg.add("core","forum/components/PostStreamScrubber",c)}}]);
//# sourceMappingURL=PostStreamScrubber.js.map