"use strict";(self.webpackChunkflarum_core=self.webpackChunkflarum_core||[]).push([[630],{3481:(t,s,e)=>{e.d(s,{Z:()=>f});var o=e(2190),r=e(5226);class i extends o.Z{handler(){return this.attrs.when()||void 0}oncreate(t){super.oncreate(t),this.boundHandler=this.handler.bind(this),$(window).on("beforeunload",this.boundHandler)}onremove(t){super.onremove(t),$(window).off("beforeunload",this.boundHandler)}view(t){return m("[",null,t.children)}}flarum.reg.add("core","common/components/ConfirmDocumentUnload",i);var a=e(7465),n=e(4041),l=e(1268),d=e(7202),c=e(4219),u=e(6439);class h extends o.Z{oninit(t){super.oninit(t),this.value=this.attrs.value||"",this.disabled=!!this.attrs.disabled,this.loading=!0,this._loaders=[]}view(){return m("div",{className:"TextEditor"},this.loading?m(r.Z,null):m("[",null,m("div",{className:"TextEditor-editorContainer"}),m("ul",{className:"TextEditor-controls Composer-footer"},(0,l.Z)(this.controlItems().toArray()),m("li",{className:"TextEditor-toolbar"},this.toolbarItems().toArray()))))}oncreate(t){super.oncreate(t),this._load().then((()=>{setTimeout(this.onbuild.bind(this),50)}))}onbuild(){this.attrs.composer.editor=this.buildEditor(this.$(".TextEditor-editorContainer")[0])}onupdate(t){super.onupdate(t);const s=!!this.attrs.disabled;this.disabled!==s&&(this.disabled=s,this.attrs.composer.editor.disabled(s))}_load(){return Promise.all(this._loaders.map((t=>t()))).then((()=>{this.loading=!1,m.redraw()}))}buildEditorParams(){return{classNames:["FormControl","Composer-flexible","TextEditor-editor"],disabled:this.disabled,placeholder:this.attrs.placeholder||"",value:this.value,oninput:this.oninput.bind(this),inputListeners:[],onsubmit:()=>{this.onsubmit(),m.redraw()}}}buildEditor(t){return new c.Z(t,this.buildEditorParams())}controlItems(){const t=new n.Z;return t.add("submit",m(d.Z,{icon:"fas fa-paper-plane",className:"Button Button--primary",itemClassName:"App-primaryControl",onclick:this.onsubmit.bind(this)},this.attrs.submitLabel)),this.attrs.preview&&t.add("preview",m(u.Z,{text:a.Z.translator.trans("core.forum.composer.preview_tooltip")},m(d.Z,{icon:"far fa-eye",className:"Button Button--icon",onclick:this.attrs.preview}))),t}toolbarItems(){return new n.Z}oninput(t){this.value=t,this.attrs.onchange(this.value)}onsubmit(){this.attrs.onsubmit(this.value)}}flarum.reg.add("core","common/components/TextEditor",h);var p=e(9336),b=e(3344);class f extends o.Z{oninit(t){super.oninit(t),this.composer=this.attrs.composer,this.loading=!1,this.attrs.confirmExit&&this.composer.preventClosingWhen((()=>this.hasChanges()),this.attrs.confirmExit),this.composer.fields.content(this.attrs.originalContent||"")}view(){var t;return m(i,{when:this.hasChanges.bind(this)},m("div",{className:(0,b.Z)("ComposerBody",this.attrs.className)},(0,p.Z)(this.attrs.user,{className:"ComposerBody-avatar"}),m("div",{className:"ComposerBody-content"},m("ul",{className:"ComposerBody-header"},(0,l.Z)(this.headerItems().toArray())),m("div",{className:"ComposerBody-editor"},m(h,{submitLabel:this.attrs.submitLabel,placeholder:this.attrs.placeholder,disabled:this.loading||this.attrs.disabled,composer:this.composer,preview:null==(t=this.jumpToPreview)?void 0:t.bind(this),onchange:this.composer.fields.content,onsubmit:this.onsubmit.bind(this),value:this.composer.fields.content()}))),m(r.Z,{display:"unset",containerClassName:(0,b.Z)("ComposerBody-loading",this.loading&&"active"),size:"large"})))}hasChanges(){const t=this.composer.fields.content();return t&&t!==this.attrs.originalContent}headerItems(){return new n.Z}onsubmit(){}loaded(){this.loading=!1,m.redraw()}}flarum.reg.add("core","forum/components/ComposerBody",f)},2925:(t,s,e)=>{e.r(s),e.d(s,{default:()=>c});var o=e(6789),r=e(3481),i=e(7202),a=e(6597),n=e(8329),l=e(1552);function d(t){o.Z.composer.isFullScreen()&&(o.Z.composer.minimize(),t.stopPropagation())}class c extends r.Z{static initAttrs(t){super.initAttrs(t),t.placeholder=t.placeholder||(0,l.Z)(o.Z.translator.trans("core.forum.composer_reply.body_placeholder")),t.submitLabel=t.submitLabel||o.Z.translator.trans("core.forum.composer_reply.submit_button"),t.confirmExit=t.confirmExit||(0,l.Z)(o.Z.translator.trans("core.forum.composer_reply.discard_confirmation"))}headerItems(){const t=super.headerItems(),s=this.attrs.discussion;return t.add("title",m("h3",null,(0,n.Z)("fas fa-reply")," ",m(a.Z,{href:o.Z.route.discussion(s),onclick:d},s.title()))),t}jumpToPreview(t){d(t),m.route.set(o.Z.route.discussion(this.attrs.discussion,"reply"))}data(){return{content:this.composer.fields.content(),relationships:{discussion:this.attrs.discussion}}}onsubmit(){const t=this.attrs.discussion;this.loading=!0,m.redraw();const s=this.data();o.Z.store.createRecord("posts").save(s).then((s=>{if(o.Z.viewingDiscussion(t)){const t=o.Z.current.get("stream");t.update().then((()=>t.goToNumber(s.number())))}else{let t;const e=m(i.Z,{className:"Button Button--link",onclick:()=>{m.route.set(o.Z.route.post(s)),o.Z.alerts.dismiss(t)}},o.Z.translator.trans("core.forum.composer_reply.view_button"));t=o.Z.alerts.show({type:"success",controls:[e]},o.Z.translator.trans("core.forum.composer_reply.posted_message"))}this.composer.hide()}),this.loaded.bind(this))}}flarum.reg.add("core","forum/components/ReplyComposer",c)}}]);
//# sourceMappingURL=ReplyComposer.js.map