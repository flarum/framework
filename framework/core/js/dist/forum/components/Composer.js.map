{"version":3,"file":"forum/components/Composer.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/ComposerButton.js","webpack://@flarum/core/./src/forum/components/Composer.js"],"sourcesContent":["import Button from '../../common/components/Button';\n\n/**\n * The `ComposerButton` component displays a button suitable for the composer\n * controls.\n */\nexport default class ComposerButton extends Button {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n    attrs.className = attrs.className || 'Button Button--icon Button--link';\n  }\n}\nflarum.reg.add('core', 'forum/components/ComposerButton', ComposerButton);","import app from '../../forum/app';\nimport Component from '../../common/Component';\nimport ItemList from '../../common/utils/ItemList';\nimport ComposerButton from './ComposerButton';\nimport listItems from '../../common/helpers/listItems';\nimport classList from '../../common/utils/classList';\nimport ComposerState from '../states/ComposerState';\n\n/**\n * The `Composer` component displays the composer. It can be loaded with a\n * content component with `load` and then its position/state can be altered with\n * `show`, `hide`, `close`, `minimize`, `fullScreen`, and `exitFullScreen`.\n */\nexport default class Composer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The composer's \"state\".\n     *\n     * @type {ComposerState}\n     */\n    this.state = this.attrs.state;\n\n    /**\n     * Whether or not the composer currently has focus.\n     *\n     * @type {Boolean}\n     */\n    this.active = false;\n\n    // Store the initial position so that we can trigger animations correctly.\n    this.prevPosition = this.state.position;\n  }\n  view() {\n    const body = this.state.body;\n    const classes = {\n      normal: this.state.position === ComposerState.Position.NORMAL,\n      minimized: this.state.position === ComposerState.Position.MINIMIZED,\n      fullScreen: this.state.position === ComposerState.Position.FULLSCREEN,\n      active: this.active,\n      visible: this.state.isVisible()\n    };\n\n    // Set up a handler so that clicks on the content will show the composer.\n    const showIfMinimized = this.state.position === ComposerState.Position.MINIMIZED ? this.state.show.bind(this.state) : undefined;\n    const ComposerBody = body.componentClass;\n    return m(\"div\", {\n      className: 'Composer ' + classList(classes)\n    }, m(\"div\", {\n      className: \"Composer-handle\",\n      oncreate: this.configHandle.bind(this)\n    }), m(\"ul\", {\n      className: \"Composer-controls\"\n    }, listItems(this.controlItems().toArray())), m(\"div\", {\n      className: \"Composer-content\",\n      onclick: showIfMinimized\n    }, ComposerBody && m(ComposerBody, Object.assign({}, body.attrs, {\n      composer: this.state,\n      disabled: classes.minimized\n    }))));\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n    if (this.state.position === this.prevPosition) {\n      // Set the height of the Composer element and its contents on each redraw,\n      // so that they do not lose it if their DOM elements are recreated.\n      this.updateHeight();\n    } else {\n      this.animatePositionChange();\n      this.prevPosition = this.state.position;\n    }\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    this.initializeHeight();\n    this.$().hide().css('bottom', -this.state.computedHeight());\n\n    // Whenever any of the inputs inside the composer are have focus, we want to\n    // add a class to the composer to draw attention to it.\n    this.$().on('focus blur', ':input,.TextEditor-editorContainer', e => {\n      this.active = e.type === 'focusin';\n      m.redraw();\n    });\n\n    // When the escape key is pressed on any inputs, close the composer.\n    this.$().on('keydown', ':input,.TextEditor-editorContainer', 'esc', () => this.state.close());\n    this.handlers = {};\n    $(window).on('resize', this.handlers.onresize = this.updateHeight.bind(this)).resize();\n    $(document).on('mousemove', this.handlers.onmousemove = this.onmousemove.bind(this)).on('mouseup', this.handlers.onmouseup = this.onmouseup.bind(this));\n  }\n  onremove(vnode) {\n    super.onremove(vnode);\n    $(window).off('resize', this.handlers.onresize);\n    $(document).off('mousemove', this.handlers.onmousemove).off('mouseup', this.handlers.onmouseup);\n  }\n\n  /**\n   * Add the necessary event handlers to the composer's handle so that it can\n   * be used to resize the composer.\n   */\n  configHandle(vnode) {\n    const composer = this;\n    $(vnode.dom).css('cursor', 'row-resize').bind('dragstart mousedown', e => e.preventDefault()).mousedown(function (e) {\n      composer.mouseStart = e.clientY;\n      composer.heightStart = composer.$().height();\n      composer.handle = $(this);\n      $('body').css('cursor', 'row-resize');\n    });\n  }\n\n  /**\n   * Resize the composer according to mouse movement.\n   *\n   * @param {MouseEvent} e\n   */\n  onmousemove(e) {\n    if (!this.handle) return;\n\n    // Work out how much the mouse has been moved, and set the height\n    // relative to the old one based on that. Then update the content's\n    // height so that it fills the height of the composer, and update the\n    // body's padding.\n    const deltaPixels = this.mouseStart - e.clientY;\n    this.changeHeight(this.heightStart + deltaPixels);\n\n    // Update the body's padding-bottom so that no content on the page will ever\n    // get permanently hidden behind the composer. If the user is already\n    // scrolled to the bottom of the page, then we will keep them scrolled to\n    // the bottom after the padding has been updated.\n    const scrollTop = $(window).scrollTop();\n    const anchorToBottom = scrollTop > 0 && scrollTop + $(window).height() >= $(document).height();\n    this.updateBodyPadding(anchorToBottom);\n  }\n\n  /**\n   * Finish resizing the composer when the mouse is released.\n   */\n  onmouseup() {\n    if (!this.handle) return;\n    this.handle = null;\n    $('body').css('cursor', '');\n  }\n\n  /**\n   * Draw focus to the first focusable content element (the text editor).\n   */\n  focus() {\n    this.$(this.attrs.state.body.componentClass.focusOnSelector?.() || '.Composer-content :input:enabled:visible, .TextEditor-editor').first().focus();\n  }\n\n  /**\n   * Update the DOM to reflect the composer's current height. This involves\n   * setting the height of the composer's root element, and adjusting the height\n   * of any flexible elements inside the composer's body.\n   */\n  updateHeight() {\n    const height = this.state.computedHeight();\n    const $flexible = this.$('.Composer-flexible');\n    this.$().height(height);\n    if ($flexible.length) {\n      const headerHeight = $flexible.offset().top - this.$().offset().top;\n      const paddingBottom = parseInt($flexible.css('padding-bottom'), 10);\n      const footerHeight = this.$('.Composer-footer').outerHeight(true);\n      $flexible.height(this.$().outerHeight() - headerHeight - paddingBottom - footerHeight);\n    }\n  }\n\n  /**\n   * Update the amount of padding-bottom on the body so that the page's\n   * content will still be visible above the composer when the page is\n   * scrolled right to the bottom.\n   */\n  updateBodyPadding() {\n    const visible = this.state.position !== ComposerState.Position.HIDDEN && this.state.position !== ComposerState.Position.MINIMIZED && app.screen() !== 'phone';\n    const paddingBottom = visible ? this.state.computedHeight() - parseInt($('#app').css('padding-bottom'), 10) : 0;\n    $('#content').css({\n      paddingBottom\n    });\n  }\n\n  /**\n   * Trigger the right animation depending on the desired new position.\n   */\n  animatePositionChange() {\n    // When exiting full-screen mode: focus content\n    if (this.prevPosition === ComposerState.Position.FULLSCREEN && this.state.position === ComposerState.Position.NORMAL) {\n      this.focus();\n      return;\n    }\n    switch (this.state.position) {\n      case ComposerState.Position.HIDDEN:\n        return this.hide();\n      case ComposerState.Position.MINIMIZED:\n        return this.minimize();\n      case ComposerState.Position.FULLSCREEN:\n        return this.focus();\n      case ComposerState.Position.NORMAL:\n        return this.show();\n    }\n  }\n\n  /**\n   * Animate the Composer into the new position by changing the height.\n   */\n  animateHeightChange() {\n    const $composer = this.$().stop(true);\n    const oldHeight = $composer.outerHeight();\n    const scrollTop = $(window).scrollTop();\n    $composer.show();\n    this.updateHeight();\n    const newHeight = $composer.outerHeight();\n    if (this.prevPosition === ComposerState.Position.HIDDEN) {\n      $composer.css({\n        bottom: -newHeight,\n        height: newHeight\n      });\n    } else {\n      $composer.css({\n        height: oldHeight\n      });\n    }\n    const animation = $composer.animate({\n      bottom: 0,\n      height: newHeight\n    }, 'fast').promise();\n    this.updateBodyPadding();\n    $(window).scrollTop(scrollTop);\n    return animation;\n  }\n\n  /**\n   * Show the Composer backdrop.\n   */\n  showBackdrop() {\n    this.$backdrop = $('<div/>').addClass('composer-backdrop').appendTo('body');\n  }\n\n  /**\n   * Hide the Composer backdrop.\n   */\n  hideBackdrop() {\n    if (this.$backdrop) this.$backdrop.remove();\n  }\n\n  /**\n   * Animate the composer sliding up from the bottom to take its normal height.\n   *\n   * @private\n   */\n  show() {\n    this.animateHeightChange().then(() => this.focus());\n    if (app.screen() === 'phone') {\n      // On safari fixed position doesn't properly work on mobile,\n      // So we use absolute and set the top value.\n      // https://github.com/flarum/core/issues/2652\n\n      // Due to another safari bug, `scrollTop` is unreliable when\n      // at the very bottom of the page AND opening the composer.\n      // So we fallback to a calculated version of scrollTop.\n      // https://github.com/flarum/core/issues/2683\n      const scrollElement = document.documentElement;\n      const topOfViewport = Math.min(scrollElement.scrollTop, scrollElement.scrollHeight - scrollElement.clientHeight);\n      this.$().css('top', $('.App').is('.mobile-safari') ? topOfViewport : 0);\n      this.showBackdrop();\n    }\n  }\n\n  /**\n   * Animate closing the composer.\n   *\n   * @private\n   */\n  hide() {\n    const $composer = this.$();\n\n    // Animate the composer sliding down off the bottom edge of the viewport.\n    // Only when the animation is completed, update other elements on the page.\n    $composer.stop(true).animate({\n      bottom: -$composer.height()\n    }, 'fast', () => {\n      $composer.hide();\n      this.hideBackdrop();\n      this.updateBodyPadding();\n    });\n  }\n\n  /**\n   * Shrink the composer until only its title is visible.\n   *\n   * @private\n   */\n  minimize() {\n    this.animateHeightChange();\n    this.$().css('top', 'auto');\n    this.hideBackdrop();\n  }\n\n  /**\n   * Build an item list for the composer's controls.\n   *\n   * @return {ItemList<import('mithril').Children>}\n   */\n  controlItems() {\n    const items = new ItemList();\n    if (this.state.position === ComposerState.Position.FULLSCREEN) {\n      items.add('exitFullScreen', m(ComposerButton, {\n        icon: \"fas fa-compress\",\n        title: app.translator.trans('core.forum.composer.exit_full_screen_tooltip'),\n        onclick: this.state.exitFullScreen.bind(this.state)\n      }));\n    } else {\n      if (this.state.position !== ComposerState.Position.MINIMIZED) {\n        items.add('minimize', m(ComposerButton, {\n          icon: classList('fas minimize', {\n            'fa-minus': app.screen() !== 'phone',\n            'fa-times': app.screen() === 'phone'\n          }),\n          title: app.translator.trans('core.forum.composer.minimize_tooltip'),\n          onclick: this.state.minimize.bind(this.state),\n          itemClassName: \"App-backControl\"\n        }));\n        items.add('fullScreen', m(ComposerButton, {\n          icon: \"fas fa-expand\",\n          title: app.translator.trans('core.forum.composer.full_screen_tooltip'),\n          onclick: this.state.fullScreen.bind(this.state)\n        }));\n      }\n      items.add('close', m(ComposerButton, {\n        icon: \"fas fa-times\",\n        title: app.translator.trans('core.forum.composer.close_tooltip'),\n        onclick: this.state.close.bind(this.state)\n      }));\n    }\n    return items;\n  }\n\n  /**\n   * Initialize default Composer height.\n   */\n  initializeHeight() {\n    this.state.height = localStorage.getItem('composerHeight');\n    if (!this.state.height) {\n      this.state.height = this.defaultHeight();\n    }\n  }\n\n  /**\n   * Default height of the Composer in case none is saved.\n   * @returns {number}\n   */\n  defaultHeight() {\n    return this.$().height();\n  }\n\n  /**\n   * Save a new Composer height and update the DOM.\n   * @param {number} height\n   */\n  changeHeight(height) {\n    this.state.height = height;\n    this.updateHeight();\n    localStorage.setItem('composerHeight', this.state.height);\n  }\n}\nflarum.reg.add('core', 'forum/components/Composer', Composer);"],"names":["ComposerButton","Button","initAttrs","attrs","super","className","flarum","reg","add","Composer","Component","oninit","vnode","this","state","active","prevPosition","position","view","body","classes","normal","ComposerState","Position","NORMAL","minimized","MINIMIZED","fullScreen","FULLSCREEN","visible","isVisible","showIfMinimized","show","bind","undefined","ComposerBody","componentClass","m","classList","oncreate","configHandle","listItems","controlItems","toArray","onclick","Object","assign","composer","disabled","onupdate","updateHeight","animatePositionChange","initializeHeight","$","hide","css","computedHeight","on","e","type","redraw","close","handlers","window","onresize","resize","document","onmousemove","onmouseup","onremove","off","dom","preventDefault","mousedown","mouseStart","clientY","heightStart","height","handle","deltaPixels","changeHeight","scrollTop","anchorToBottom","updateBodyPadding","focus","focusOnSelector","first","$flexible","length","headerHeight","offset","top","paddingBottom","parseInt","footerHeight","outerHeight","HIDDEN","app","screen","minimize","animateHeightChange","$composer","stop","oldHeight","newHeight","bottom","animation","animate","promise","showBackdrop","$backdrop","addClass","appendTo","hideBackdrop","remove","then","scrollElement","documentElement","topOfViewport","Math","min","scrollHeight","clientHeight","is","items","ItemList","icon","title","translator","trans","exitFullScreen","itemClassName","localStorage","getItem","defaultHeight","setItem"],"sourceRoot":""}