{"version":3,"file":"forum/components/SearchModal.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/SearchModal.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../app';\nimport FormModal from '../../common/components/FormModal';\nimport KeyboardNavigatable from '../../common/utils/KeyboardNavigatable';\nimport SearchManager from '../../common/SearchManager';\nimport extractText from '../../common/utils/extractText';\nimport Input from '../../common/components/Input';\nimport Button from '../../common/components/Button';\nimport Stream from '../../common/utils/Stream';\nimport InfoTile from '../../common/components/InfoTile';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport ItemList from '../../common/utils/ItemList';\nimport GambitsAutocomplete from '../../common/utils/GambitsAutocomplete';\nexport default class SearchModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"searchState\", void 0);\n    _defineProperty(this, \"query\", void 0);\n    /**\n     * An array of SearchSources.\n     */\n    _defineProperty(this, \"sources\", void 0);\n    /**\n     * The key of the currently-active search source.\n     */\n    _defineProperty(this, \"activeSource\", void 0);\n    /**\n     * The sources that are still loading results.\n     */\n    _defineProperty(this, \"loadingSources\", []);\n    /**\n     * The index of the currently-selected <li> in the results list. This can be\n     * a unique string (to account for the fact that an item's position may jump\n     * around as new results load), but otherwise it will be numeric (the\n     * sequential position within the list).\n     */\n    _defineProperty(this, \"index\", 0);\n    _defineProperty(this, \"navigator\", void 0);\n    _defineProperty(this, \"searchTimeout\", void 0);\n    _defineProperty(this, \"inputScroll\", Stream(0));\n    _defineProperty(this, \"gambitsAutocomplete\", {});\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.searchState = this.attrs.searchState;\n    this.sources = this.attrs.sources;\n    this.query = Stream(this.searchState.getValue() || '');\n  }\n  title() {\n    return app.translator.trans('core.forum.search.title');\n  }\n  className() {\n    return 'SearchModal Modal--flat';\n  }\n  content() {\n    var _this$gambitsAutocomp, _this$activeSource$re;\n    // Initialize the active source.\n    if (!this.activeSource) this.activeSource = Stream(this.sources[0]);\n    (_this$gambitsAutocomp = this.gambitsAutocomplete)[_this$activeSource$re = this.activeSource().resource] || (_this$gambitsAutocomp[_this$activeSource$re] = new GambitsAutocomplete(this.activeSource().resource, () => this.inputElement(), this.query, value => this.search(value)));\n    const searchLabel = extractText(app.translator.trans('core.forum.search.placeholder'));\n    return m(\"div\", {\n      className: \"Modal-body SearchModal-body\"\n    }, m(\"div\", {\n      className: \"SearchModal-form\"\n    }, m(Input, {\n      key: \"search\",\n      type: \"search\",\n      loading: !!this.loadingSources.length,\n      clearable: true,\n      clearLabel: app.translator.trans('core.forum.header.search_clear_button_accessible_label'),\n      prefixIcon: \"fas fa-search\",\n      \"aria-label\": searchLabel,\n      placeholder: searchLabel,\n      value: this.query(),\n      onchange: value => {\n        var _this$inputElement$0$, _this$inputElement$;\n        this.query(value);\n        this.inputScroll((_this$inputElement$0$ = (_this$inputElement$ = this.inputElement()[0]) == null ? void 0 : _this$inputElement$.scrollLeft) != null ? _this$inputElement$0$ : 0);\n      },\n      inputAttrs: {\n        className: 'SearchModal-input'\n      },\n      renderInput: attrs => m('[', null, m(\"input\", Object.assign({}, attrs, {\n        onscroll: e => this.inputScroll(e.target.scrollLeft)\n      })), m(\"div\", {\n        className: \"SearchModal-visual-wrapper\"\n      }, m(\"div\", {\n        className: \"SearchModal-visual-input\",\n        style: {\n          left: '-' + this.inputScroll() + 'px'\n        }\n      }, this.gambifyInput())))\n    })), this.tabs());\n  }\n  tabs() {\n    return m(\"div\", {\n      className: \"SearchModal-tabs\"\n    }, m(\"div\", {\n      className: \"SearchModal-tabs-nav\"\n    }, this.tabItems().toArray()), m(\"div\", {\n      className: \"SearchModal-tabs-content\"\n    }, this.activeTabItems().toArray()));\n  }\n  tabItems() {\n    var _this$sources;\n    const items = new ItemList();\n    (_this$sources = this.sources) == null ? void 0 : _this$sources.map((source, index) => items.add(source.resource, m(Button, {\n      className: \"Button Button--link\",\n      active: this.activeSource() === source,\n      onclick: () => this.switchSource(source)\n    }, source.title()), 100 - index));\n    return items;\n  }\n  activeTabItems() {\n    var _this$activeSource;\n    const items = new ItemList();\n    const loading = this.loadingSources.includes(this.activeSource().resource);\n    const shouldShowResults = !!this.query() && !loading;\n    const gambits = this.gambits();\n    const fullPageLink = this.activeSource().fullPage(this.query());\n    const results = (_this$activeSource = this.activeSource()) == null ? void 0 : _this$activeSource.view(this.query());\n    if (shouldShowResults && fullPageLink) {\n      items.add('fullPageLink', m(\"div\", {\n        className: \"SearchModal-section\"\n      }, m(\"hr\", {\n        className: \"Modal-divider\"\n      }), m(\"ul\", {\n        className: \"Dropdown-menu SearchModal-fullPage\"\n      }, fullPageLink)), 80);\n    }\n    if (!!gambits.length) {\n      items.add('gambits', m(\"div\", {\n        className: \"SearchModal-section\"\n      }, m(\"hr\", {\n        className: \"Modal-divider\"\n      }), m(\"ul\", {\n        className: \"Dropdown-menu SearchModal-options\",\n        \"aria-live\": gambits.length ? 'polite' : undefined\n      }, m(\"li\", {\n        className: \"Dropdown-header\"\n      }, app.translator.trans('core.forum.search.options_heading')), gambits)), 60);\n    }\n    items.add('results', m(\"div\", {\n      className: \"SearchModal-section\"\n    }, m(\"hr\", {\n      className: \"Modal-divider\"\n    }), m(\"ul\", {\n      className: \"Dropdown-menu SearchModal-results\",\n      \"aria-live\": shouldShowResults ? 'polite' : undefined\n    }, m(\"li\", {\n      className: \"Dropdown-header\"\n    }, app.translator.trans('core.forum.search.preview_heading')), !shouldShowResults && m(\"li\", {\n      className: \"Dropdown-message\"\n    }, m(InfoTile, {\n      icon: \"fas fa-search\"\n    }, app.translator.trans('core.forum.search.no_search_text'))), shouldShowResults && results, shouldShowResults && !(results != null && results.length) && m(\"li\", {\n      className: \"Dropdown-message\"\n    }, m(InfoTile, {\n      icon: \"far fa-tired\"\n    }, app.translator.trans('core.forum.search.no_results_text'))), loading && m(\"li\", {\n      className: \"Dropdown-message\"\n    }, m(LoadingIndicator, null)))), 40);\n    return items;\n  }\n  switchSource(source) {\n    if (this.activeSource() !== source) {\n      this.activeSource(source);\n      this.search(this.query());\n      this.inputElement().focus();\n      m.redraw();\n    }\n  }\n  gambits() {\n    return this.gambitsAutocomplete[this.activeSource().resource].suggestions(this.query());\n  }\n\n  /**\n   * Transforms a simple search text to wrap valid gambits in a mark tag.\n   * @example `lorem ipsum is:unread dolor` => `lorem ipsum <mark>is:unread</mark> dolor`\n   */\n  gambifyInput() {\n    const query = this.query();\n    let marked = query;\n    app.search.gambits.match(this.activeSource().resource, query, (gambit, matches, negate, bit) => {\n      marked = marked.replace(bit, \"<mark>\".concat(bit, \"</mark>\"));\n    });\n    const jsx = [];\n    marked.split(/(<mark>.*?<\\/mark>)/).forEach(chunk => {\n      if (chunk.startsWith('<mark>')) {\n        jsx.push(m(\"mark\", null, chunk.replace(/<\\/?mark>/g, '')));\n      } else {\n        jsx.push(chunk);\n      }\n    });\n    return jsx;\n  }\n  onupdate(vnode) {\n    var _this$sources2;\n    super.onupdate(vnode);\n\n    // Highlight the item that is currently selected.\n    this.setIndex(this.getCurrentNumericIndex());\n    const component = this;\n    this.$('.Dropdown-menu')\n    // Whenever the mouse is hovered over a search result, highlight it.\n    .on('mouseenter', '> li:not(.Dropdown-header):not(.Dropdown-message)', function () {\n      component.setIndex(component.selectableItems().index(this));\n    });\n\n    // If there are no sources, the search view is not shown.\n    if (!((_this$sources2 = this.sources) != null && _this$sources2.length)) return;\n  }\n  oncreate(vnode) {\n    var _this$sources3;\n    super.oncreate(vnode);\n\n    // If there are no sources, we shouldn't initialize logic for\n    // search elements, as they will not be shown.\n    if (!((_this$sources3 = this.sources) != null && _this$sources3.length)) return;\n    const search = this.search.bind(this);\n\n    // Highlight the item that is currently selected.\n    this.setIndex(this.getCurrentNumericIndex());\n    const $input = this.inputElement();\n    this.navigator = new KeyboardNavigatable();\n    this.navigator.onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true)).onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true)).onSelect(this.selectResult.bind(this), true).onCancel(this.clear.bind(this)).bindTo($input);\n\n    // Handle input key events on the search input, triggering results to load.\n    $input.on('input focus', function () {\n      search(this.value.toLowerCase());\n    });\n  }\n  onremove(vnode) {\n    this.searchState.setValue(this.query());\n    super.onremove(vnode);\n  }\n  search(query) {\n    if (!query) return;\n    const source = this.activeSource();\n    if (this.searchTimeout) clearTimeout(this.searchTimeout);\n    this.searchTimeout = window.setTimeout(() => {\n      if (source.isCached(query)) return;\n      if (query.length >= SearchManager.MIN_SEARCH_LEN) {\n        if (!source.search) return;\n        this.loadingSources.push(source.resource);\n        source.search(query, SearchModal.LIMIT).then(() => {\n          this.loadingSources = this.loadingSources.filter(resource => resource !== source.resource);\n          m.redraw();\n        });\n      }\n      this.searchState.cache(query);\n      m.redraw();\n    }, 250);\n  }\n\n  /**\n   * Navigate to the currently selected search result and close the list.\n   */\n  selectResult() {\n    if (this.searchTimeout) clearTimeout(this.searchTimeout);\n    this.loadingSources = [];\n    const item = this.getItem(this.index);\n    const isResult = !!item.attr('data-id');\n    let selectedUrl = null;\n    if (isResult) {\n      const id = item.attr('data-id');\n      selectedUrl = id && this.activeSource().gotoItem(id);\n    } else if (item.find('a').length) {\n      selectedUrl = item.find('a').attr('href');\n    }\n    const query = this.query();\n    if (query && selectedUrl) {\n      m.route.set(selectedUrl);\n    } else {\n      item.find('button')[0].click();\n    }\n  }\n\n  /**\n   * Clear the search\n   */\n  clear() {\n    this.query('');\n  }\n\n  /**\n   * Get all of the search result items that are selectable.\n   */\n  selectableItems() {\n    return this.$('.Dropdown-menu > li:not(.Dropdown-header):not(.Dropdown-message)');\n  }\n\n  /**\n   * Get the position of the currently selected search result item.\n   * Returns zero if not found.\n   */\n  getCurrentNumericIndex() {\n    return Math.max(0, this.selectableItems().index(this.getItem(this.index)));\n  }\n\n  /**\n   * Get the <li> in the search results with the given index (numeric or named).\n   */\n  getItem(index) {\n    const $items = this.selectableItems();\n    let $item = $items.filter(\"[data-index=\\\"\".concat(index, \"\\\"]\"));\n    if (!$item.length) {\n      $item = $items.eq(index);\n    }\n    return $item;\n  }\n\n  /**\n   * Set the currently-selected search result item to the one with the given\n   * index.\n   */\n  setIndex(index, scrollToItem) {\n    if (scrollToItem === void 0) {\n      scrollToItem = false;\n    }\n    const $items = this.selectableItems();\n    const $dropdown = $items.parent();\n    let fixedIndex = index;\n    if (index < 0) {\n      fixedIndex = $items.length - 1;\n    } else if (index >= $items.length) {\n      fixedIndex = 0;\n    }\n    const $item = $items.removeClass('active').eq(fixedIndex).addClass('active');\n    this.index = parseInt($item.attr('data-index')) || fixedIndex;\n    if (scrollToItem && $dropdown) {\n      const dropdownScroll = $dropdown.scrollTop();\n      const dropdownTop = $dropdown.offset().top;\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\n      const itemTop = $item.offset().top;\n      const itemBottom = itemTop + $item.outerHeight();\n      let scrollTop;\n      if (itemTop < dropdownTop) {\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\n      } else if (itemBottom > dropdownBottom) {\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\n      }\n      if (typeof scrollTop !== 'undefined') {\n        $dropdown.stop(true).animate({\n          scrollTop\n        }, 100);\n      }\n    }\n  }\n  inputElement() {\n    return this.$('.SearchModal-input');\n  }\n}\n_defineProperty(SearchModal, \"LIMIT\", 6);\nflarum.reg.add('core', 'forum/components/SearchModal', SearchModal);"],"names":["SearchModal","constructor","super","arguments","this","oninit","vnode","searchState","attrs","sources","query","getValue","title","className","content","_this$gambitsAutocomp","_this$activeSource$re","activeSource","gambitsAutocomplete","resource","inputElement","value","search","searchLabel","m","key","type","loading","loadingSources","length","clearable","clearLabel","prefixIcon","placeholder","onchange","_this$inputElement$0$","_this$inputElement$","inputScroll","scrollLeft","inputAttrs","renderInput","Object","assign","onscroll","e","target","style","left","gambifyInput","tabs","tabItems","toArray","activeTabItems","_this$sources","items","map","source","index","add","active","onclick","switchSource","_this$activeSource","includes","shouldShowResults","gambits","fullPageLink","fullPage","results","view","undefined","icon","focus","redraw","suggestions","marked","gambit","matches","negate","bit","replace","concat","jsx","split","forEach","chunk","startsWith","push","onupdate","_this$sources2","setIndex","getCurrentNumericIndex","component","$","on","selectableItems","oncreate","_this$sources3","bind","$input","navigator","onUp","onDown","onSelect","selectResult","onCancel","clear","bindTo","toLowerCase","onremove","setValue","searchTimeout","clearTimeout","window","setTimeout","isCached","LIMIT","then","filter","cache","item","getItem","selectedUrl","attr","id","gotoItem","find","route","set","click","Math","max","$items","$item","eq","scrollToItem","$dropdown","parent","fixedIndex","removeClass","addClass","parseInt","dropdownScroll","scrollTop","dropdownTop","offset","top","dropdownBottom","outerHeight","itemTop","itemBottom","css","stop","animate","flarum","reg"],"sourceRoot":""}