{"version":3,"file":"forum/components/UserSecurityPage.js","mappings":"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","sources":["webpack://@flarum/core/./src/common/components/LabelValue.tsx","webpack://@flarum/core/./src/forum/components/AccessTokensList.tsx","webpack://@flarum/core/./src/forum/components/NewAccessTokenModal.tsx","webpack://@flarum/core/./src/forum/states/UserSecurityPageState.ts","webpack://@flarum/core/./src/forum/components/UserSecurityPage.tsx"],"sourcesContent":["import Component from '../Component';\nimport app from '../app';\n/**\n * A generic component for displaying a label and value inline.\n * Created to avoid reinventing the wheel.\n *\n * `label: value`\n */\nexport default class LabelValue extends Component {\n  view(vnode) {\n    return m(\"div\", {\n      className: \"LabelValue\"\n    }, m(\"div\", {\n      className: \"LabelValue-label\"\n    }, app.translator.trans('core.lib.data_segment.label', {\n      label: this.attrs.label\n    })), m(\"div\", {\n      className: \"LabelValue-value\"\n    }, this.attrs.value));\n  }\n}\nflarum.reg.add('core', 'common/components/LabelValue', LabelValue);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../app';\nimport Component from '../../common/Component';\nimport Button from '../../common/components/Button';\nimport humanTime from '../../common/helpers/humanTime';\nimport ItemList from '../../common/utils/ItemList';\nimport LabelValue from '../../common/components/LabelValue';\nimport extractText from '../../common/utils/extractText';\nimport classList from '../../common/utils/classList';\nimport Tooltip from '../../common/components/Tooltip';\nimport Icon from '../../common/components/Icon';\nexport default class AccessTokensList extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"loading\", {});\n    _defineProperty(this, \"showingTokens\", {});\n  }\n  view(vnode) {\n    return m(\"div\", {\n      className: \"AccessTokensList\"\n    }, this.attrs.tokens.length ? this.attrs.tokens.map(this.tokenView.bind(this)) : m(\"div\", {\n      className: \"AccessTokensList--empty\"\n    }, app.translator.trans('core.forum.security.empty_text')));\n  }\n  tokenView(token) {\n    return m(\"div\", {\n      className: classList('AccessTokensList-item', {\n        'AccessTokensList-item--active': token.isCurrent()\n      }),\n      key: token.id()\n    }, this.tokenViewItems(token).toArray());\n  }\n  tokenViewItems(token) {\n    const items = new ItemList();\n    items.add('icon', m(\"div\", {\n      className: \"AccessTokensList-item-icon\"\n    }, m(Icon, {\n      name: this.attrs.icon || 'fas fa-key'\n    })), 50);\n    items.add('info', m(\"div\", {\n      className: \"AccessTokensList-item-info\"\n    }, this.tokenInfoItems(token).toArray()), 40);\n    items.add('actions', m(\"div\", {\n      className: \"AccessTokensList-item-actions\"\n    }, this.tokenActionItems(token).toArray()), 30);\n    return items;\n  }\n  tokenInfoItems(token) {\n    const items = new ItemList();\n    if (this.attrs.type === 'session') {\n      items.add('title', m(\"div\", {\n        className: \"AccessTokensList-item-title\"\n      }, m(\"span\", {\n        className: \"AccessTokensList-item-title-main\"\n      }, token.device()), token.isCurrent() && [' — ', m(\"span\", {\n        className: \"AccessTokensList-item-title-sub\"\n      }, app.translator.trans('core.forum.security.current_active_session'))]));\n    } else {\n      items.add('title', m(\"div\", {\n        className: \"AccessTokensList-item-title\"\n      }, m(\"span\", {\n        className: \"AccessTokensList-item-title-main\"\n      }, this.generateTokenTitle(token))));\n    }\n    items.add('createdAt', m(\"div\", {\n      className: \"AccessTokensList-item-createdAt\"\n    }, m(LabelValue, {\n      label: app.translator.trans('core.forum.security.created'),\n      value: humanTime(token.createdAt())\n    })));\n    items.add('lastActivityAt', m(\"div\", {\n      className: \"AccessTokensList-item-lastActivityAt\"\n    }, m(LabelValue, {\n      label: app.translator.trans('core.forum.security.last_activity'),\n      value: token.lastActivityAt() ? m('[', null, humanTime(token.lastActivityAt()), token.lastIpAddress() && \" \\u2014 \".concat(token.lastIpAddress()), this.attrs.type === 'developer_token' && token.device() && m('[', null, ' ', \"\\u2014 \", m(\"span\", {\n        className: \"AccessTokensList-item-title-sub\"\n      }, token.device()))) : app.translator.trans('core.forum.security.never')\n    })));\n    return items;\n  }\n  tokenActionItems(token) {\n    const items = new ItemList();\n    const deleteKey = {\n      session: 'terminate_session',\n      developer_token: 'revoke_access_token'\n    }[this.attrs.type];\n    if (this.attrs.type === 'developer_token') {\n      const isHidden = !this.showingTokens[token.id()];\n      const displayKey = isHidden ? 'show_access_token' : 'hide_access_token';\n      items.add('toggleDisplay', m(Button, {\n        className: \"Button Button--inverted\",\n        icon: isHidden ? 'fas fa-eye' : 'fas fa-eye-slash',\n        onclick: () => {\n          this.showingTokens[token.id()] = isHidden;\n          m.redraw();\n        }\n      }, app.translator.trans(\"core.forum.security.\".concat(displayKey))));\n    }\n    let revokeButton = m(Button, {\n      className: \"Button Button--danger\",\n      disabled: token.isCurrent(),\n      loading: !!this.loading[token.id()],\n      onclick: () => this.revoke(token)\n    }, app.translator.trans(\"core.forum.security.\".concat(deleteKey)));\n    if (token.isCurrent()) {\n      revokeButton = m(Tooltip, {\n        text: app.translator.trans('core.forum.security.cannot_terminate_current_session')\n      }, m(\"div\", {\n        tabindex: \"0\"\n      }, revokeButton));\n    }\n    items.add('revoke', revokeButton);\n    return items;\n  }\n  async revoke(token) {\n    var _this$attrs$ondelete, _this$attrs;\n    if (!confirm(extractText(app.translator.trans('core.forum.security.revoke_access_token_confirmation')))) return;\n    this.loading[token.id()] = true;\n    await token.delete();\n    this.loading[token.id()] = false;\n    (_this$attrs$ondelete = (_this$attrs = this.attrs).ondelete) == null ? void 0 : _this$attrs$ondelete.call(_this$attrs, token);\n    const key = this.attrs.type === 'session' ? 'session_terminated' : 'token_revoked';\n    app.alerts.show({\n      type: 'success'\n    }, app.translator.trans(\"core.forum.security.\".concat(key), {\n      count: 1\n    }));\n    m.redraw();\n  }\n  generateTokenTitle(token) {\n    const name = token.title() || app.translator.trans('core.forum.security.token_title_placeholder');\n    const value = this.tokenValueDisplay(token);\n    return app.translator.trans('core.forum.security.token_item_title', {\n      title: name,\n      token: value\n    });\n  }\n  tokenValueDisplay(token) {\n    const obfuscatedName = Array(12).fill('*').join('');\n    const value = this.showingTokens[token.id()] ? token.token() : obfuscatedName;\n    return m(\"code\", {\n      className: \"AccessTokensList-item-token\"\n    }, value);\n  }\n}\nflarum.reg.add('core', 'forum/components/AccessTokensList', AccessTokensList);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../app';\nimport FormModal from '../../common/components/FormModal';\nimport Button from '../../common/components/Button';\nimport Stream from '../../common/utils/Stream';\nimport Form from '../../common/components/Form';\nexport default class NewAccessTokenModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"titleInput\", Stream(''));\n  }\n  className() {\n    return 'Modal--small NewAccessTokenModal';\n  }\n  title() {\n    return app.translator.trans('core.forum.security.new_access_token_modal.title');\n  }\n  content() {\n    const titleLabel = app.translator.trans('core.forum.security.new_access_token_modal.title_placeholder');\n    return m(\"div\", {\n      className: \"Modal-body\"\n    }, m(Form, {\n      className: \"Form--centered\"\n    }, m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      type: \"text\",\n      className: \"FormControl\",\n      bidi: this.titleInput,\n      placeholder: titleLabel,\n      \"aria-label\": titleLabel\n    })), m(\"div\", {\n      className: \"Form-group Form-controls\"\n    }, m(Button, {\n      className: \"Button Button--primary Button--block\",\n      type: \"submit\",\n      loading: this.loading\n    }, app.translator.trans('core.forum.security.new_access_token_modal.submit_button')))));\n  }\n  submitData() {\n    return {\n      title: this.titleInput()\n    };\n  }\n  onsubmit(e) {\n    super.onsubmit(e);\n    e.preventDefault();\n    this.loading = true;\n    app.store.createRecord('access-tokens').save(this.submitData()).then(token => {\n      this.attrs.onsuccess(token);\n      app.modal.close();\n    }).finally(this.loaded.bind(this));\n  }\n}\nflarum.reg.add('core', 'forum/components/NewAccessTokenModal', NewAccessTokenModal);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class UserSecurityPageState {\n  constructor() {\n    _defineProperty(this, \"tokens\", null);\n    _defineProperty(this, \"loadingTerminateSessions\", false);\n    _defineProperty(this, \"loadingGlobalLogout\", false);\n  }\n  hasLoadedTokens() {\n    return this.tokens !== null;\n  }\n  getTokens() {\n    return this.tokens;\n  }\n  setTokens(tokens) {\n    this.tokens = tokens;\n  }\n  pushToken(token) {\n    var _this$tokens;\n    (_this$tokens = this.tokens) == null ? void 0 : _this$tokens.push(token);\n  }\n  removeToken(token) {\n    this.tokens = this.tokens.filter(t => t !== token);\n  }\n  getSessionTokens() {\n    var _this$tokens2;\n    return ((_this$tokens2 = this.tokens) == null ? void 0 : _this$tokens2.filter(token => token.isSessionToken()).sort((a, b) => b.isCurrent() ? 1 : -1)) || [];\n  }\n  getDeveloperTokens() {\n    var _this$tokens3;\n    return ((_this$tokens3 = this.tokens) == null ? void 0 : _this$tokens3.filter(token => !token.isSessionToken())) || null;\n  }\n\n  /**\n   * Look up session tokens other than the current one.\n   */\n  getOtherSessionTokens() {\n    var _this$tokens4;\n    return ((_this$tokens4 = this.tokens) == null ? void 0 : _this$tokens4.filter(token => token.isSessionToken() && !token.isCurrent())) || [];\n  }\n  hasOtherActiveSessions() {\n    return (this.getOtherSessionTokens() || []).length > 0;\n  }\n  removeOtherSessionTokens() {\n    this.tokens = this.tokens.filter(token => !token.isSessionToken() || token.isCurrent());\n  }\n}\nflarum.reg.add('core', 'forum/states/UserSecurityPageState', UserSecurityPageState);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../../forum/app';\nimport UserPage from './UserPage';\nimport ItemList from '../../common/utils/ItemList';\nimport FieldSet from '../../common/components/FieldSet';\nimport listItems from '../../common/helpers/listItems';\nimport extractText from '../../common/utils/extractText';\nimport AccessTokensList from './AccessTokensList';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport Button from '../../common/components/Button';\nimport NewAccessTokenModal from './NewAccessTokenModal';\nimport Tooltip from '../../common/components/Tooltip';\nimport UserSecurityPageState from '../states/UserSecurityPageState';\n\n/**\n * The `UserSecurityPage` component displays the user's security control panel, in\n * the context of their user profile.\n */\nexport default class UserSecurityPage extends UserPage {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"state\", new UserSecurityPageState());\n  }\n  oninit(vnode) {\n    var _app$session$user;\n    super.oninit(vnode);\n    const routeUsername = m.route.param('username');\n    if (routeUsername !== ((_app$session$user = app.session.user) == null ? void 0 : _app$session$user.slug()) && !app.forum.attribute('canModerateAccessTokens')) {\n      m.route.set('/');\n    }\n    this.loadUser(routeUsername);\n    app.setTitle(extractText(app.translator.trans('core.forum.security.title')));\n    this.loadTokens();\n  }\n  content() {\n    return m(\"div\", {\n      className: \"UserSecurityPage\"\n    }, m(\"ul\", null, listItems(this.settingsItems().toArray())));\n  }\n\n  /**\n   * Build an item list for the user's settings controls.\n   */\n  settingsItems() {\n    var _this$state$getDevelo;\n    const items = new ItemList();\n    if (app.forum.attribute('canCreateAccessToken') || app.forum.attribute('canModerateAccessTokens') || this.state.hasLoadedTokens() && (_this$state$getDevelo = this.state.getDeveloperTokens()) != null && _this$state$getDevelo.length) {\n      items.add('developerTokens', m(FieldSet, {\n        className: \"UserSecurityPage-developerTokens\",\n        label: app.translator.trans(\"core.forum.security.developer_tokens_heading\")\n      }, this.developerTokensItems().toArray()));\n    } else if (!this.state.hasLoadedTokens()) {\n      items.add('developerTokens', m(LoadingIndicator, null));\n    }\n    items.add('sessions', m(FieldSet, {\n      className: \"UserSecurityPage-sessions\",\n      label: app.translator.trans(\"core.forum.security.sessions_heading\")\n    }, this.sessionsItems().toArray()));\n    if (this.user.id() === app.session.user.id()) {\n      items.add('globalLogout', m(FieldSet, {\n        className: \"FieldSet--col UserSecurityPage-globalLogout\",\n        label: app.translator.trans('core.forum.security.global_logout.heading'),\n        description: app.translator.trans('core.forum.security.global_logout.help_text')\n      }, m(Button, {\n        className: \"Button\",\n        icon: \"fas fa-sign-out-alt\",\n        onclick: this.globalLogout.bind(this),\n        loading: this.state.loadingGlobalLogout,\n        disabled: this.state.loadingTerminateSessions\n      }, app.translator.trans('core.forum.security.global_logout.log_out_button'))));\n    }\n    return items;\n  }\n\n  /**\n   * Build an item list for the user's access accessToken settings.\n   */\n  developerTokensItems() {\n    const items = new ItemList();\n    items.add('accessTokenList', !this.state.hasLoadedTokens() ? m(LoadingIndicator, null) : m(AccessTokensList, {\n      type: \"developer_token\",\n      ondelete: token => {\n        this.state.removeToken(token);\n        m.redraw();\n      },\n      tokens: this.state.getDeveloperTokens(),\n      icon: \"fas fa-key\",\n      hideTokens: false\n    }));\n    if (this.user.id() === app.session.user.id()) {\n      items.add('newAccessToken', m(\"div\", {\n        className: \"UserSecurityPage-controls\"\n      }, m(Button, {\n        className: \"Button\",\n        disabled: !app.forum.attribute('canCreateAccessToken'),\n        onclick: () => app.modal.show(NewAccessTokenModal, {\n          onsuccess: token => {\n            this.state.pushToken(token);\n            m.redraw();\n          }\n        })\n      }, app.translator.trans('core.forum.security.new_access_token_button'))));\n    }\n    return items;\n  }\n\n  /**\n   * Build an item list for the user's access accessToken settings.\n   */\n  sessionsItems() {\n    const items = new ItemList();\n    items.add('sessionsList', !this.state.hasLoadedTokens() ? m(LoadingIndicator, null) : m(AccessTokensList, {\n      type: \"session\",\n      ondelete: token => {\n        this.state.removeToken(token);\n        m.redraw();\n      },\n      tokens: this.state.getSessionTokens(),\n      icon: \"fas fa-laptop\",\n      hideTokens: true\n    }));\n    if (this.user.id() === app.session.user.id()) {\n      const isDisabled = !this.state.hasOtherActiveSessions();\n      let terminateAllOthersButton = m(Button, {\n        className: \"Button\",\n        onclick: this.terminateAllOtherSessions.bind(this),\n        loading: this.state.loadingTerminateSessions,\n        disabled: this.state.loadingGlobalLogout || isDisabled\n      }, app.translator.trans('core.forum.security.terminate_all_other_sessions'));\n      if (isDisabled) {\n        terminateAllOthersButton = m(Tooltip, {\n          text: app.translator.trans('core.forum.security.cannot_terminate_current_session')\n        }, m(\"span\", {\n          tabindex: \"0\"\n        }, terminateAllOthersButton));\n      }\n      items.add('terminateAllOtherSessions', m(\"div\", {\n        className: \"UserSecurityPage-controls\"\n      }, terminateAllOthersButton));\n    }\n    return items;\n  }\n  loadTokens() {\n    return app.store.find('access-tokens', {\n      filter: {\n        user: this.user.id()\n      }\n    }).then(tokens => {\n      this.state.setTokens(tokens);\n      m.redraw();\n    });\n  }\n  terminateAllOtherSessions() {\n    if (!confirm(extractText(app.translator.trans('core.forum.security.terminate_all_other_sessions_confirmation')))) return;\n    this.state.loadingTerminateSessions = true;\n    return app.request({\n      method: 'DELETE',\n      url: app.forum.attribute('apiUrl') + '/sessions'\n    }).then(() => {\n      // Count terminated sessions first.\n      const count = this.state.getOtherSessionTokens().length;\n      this.state.removeOtherSessionTokens();\n      app.alerts.show({\n        type: 'success'\n      }, app.translator.trans('core.forum.security.session_terminated', {\n        count\n      }));\n    }).catch(() => {\n      app.alerts.show({\n        type: 'error'\n      }, app.translator.trans('core.forum.security.session_termination_failed'));\n    }).finally(() => {\n      this.state.loadingTerminateSessions = false;\n      m.redraw();\n    });\n  }\n  globalLogout() {\n    this.state.loadingGlobalLogout = true;\n    return app.request({\n      method: 'POST',\n      url: app.forum.attribute('baseUrl') + '/global-logout'\n    }).then(() => window.location.reload()).finally(() => {\n      this.state.loadingGlobalLogout = false;\n      m.redraw();\n    });\n  }\n}\nflarum.reg.add('core', 'forum/components/UserSecurityPage', UserSecurityPage);"],"names":["LabelValue","Component","view","vnode","m","className","label","this","attrs","value","flarum","reg","add","AccessTokensList","constructor","super","arguments","tokens","length","map","tokenView","bind","app","token","classList","isCurrent","key","id","tokenViewItems","toArray","items","ItemList","Icon","name","icon","tokenInfoItems","tokenActionItems","type","device","generateTokenTitle","humanTime","createdAt","lastActivityAt","lastIpAddress","concat","deleteKey","session","developer_token","isHidden","showingTokens","displayKey","Button","onclick","redraw","revokeButton","disabled","loading","revoke","Tooltip","text","tabindex","async","_this$attrs$ondelete","_this$attrs","confirm","extractText","delete","ondelete","call","count","title","tokenValueDisplay","obfuscatedName","Array","fill","join","NewAccessTokenModal","FormModal","Stream","content","titleLabel","Form","bidi","titleInput","placeholder","submitData","onsubmit","e","preventDefault","save","then","onsuccess","finally","loaded","UserSecurityPageState","hasLoadedTokens","getTokens","setTokens","pushToken","_this$tokens","push","removeToken","filter","t","getSessionTokens","_this$tokens2","isSessionToken","sort","a","b","getDeveloperTokens","_this$tokens3","getOtherSessionTokens","_this$tokens4","hasOtherActiveSessions","removeOtherSessionTokens","UserSecurityPage","UserPage","oninit","_app$session$user","routeUsername","route","param","slug","set","loadUser","loadTokens","listItems","settingsItems","_this$state$getDevelo","state","FieldSet","developerTokensItems","LoadingIndicator","sessionsItems","user","description","globalLogout","loadingGlobalLogout","loadingTerminateSessions","hideTokens","isDisabled","terminateAllOthersButton","terminateAllOtherSessions","method","url","catch","window","location","reload"],"sourceRoot":""}