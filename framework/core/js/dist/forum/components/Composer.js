"use strict";(self.webpackChunkflarum_core=self.webpackChunkflarum_core||[]).push([[366],{8139:(t,s,i)=>{i.r(s),i.d(s,{default:()=>p});var e=i(3554),o=i(5710),n=i(6064),h=i(3092);class a extends h.A{static initAttrs(t){super.initAttrs(t),t.className=t.className||"Button Button--icon Button--link"}}flarum.reg.add("core","forum/components/ComposerButton",a);var r=i(5673),c=i(4268),d=i(8825);class p extends o.A{oninit(t){super.oninit(t),this.state=this.attrs.state,this.active=!1,this.prevPosition=this.state.position}view(){const t=this.state.body,s={normal:this.state.position===d.A.Position.NORMAL,minimized:this.state.position===d.A.Position.MINIMIZED,fullScreen:this.state.position===d.A.Position.FULLSCREEN,active:this.active,visible:this.state.isVisible()},i=this.state.position===d.A.Position.MINIMIZED?this.state.show.bind(this.state):void 0,e=t.componentClass;return m("div",{className:"Composer "+(0,c.A)(s)},m("div",{className:"Composer-handle",oncreate:this.configHandle.bind(this)}),m("ul",{className:"Composer-controls"},(0,r.A)(this.controlItems().toArray())),m("div",{className:"Composer-content",onclick:i},e&&m(e,Object.assign({},t.attrs,{composer:this.state,disabled:s.minimized}))))}onupdate(t){super.onupdate(t),this.state.position===this.prevPosition?this.updateHeight():(this.animatePositionChange(),this.prevPosition=this.state.position)}oncreate(t){super.oncreate(t),this.initializeHeight(),this.$().hide().css("bottom",-this.state.computedHeight()),this.$().on("focus blur",":input,.TextEditor-editorContainer",(t=>{this.active="focusin"===t.type,m.redraw()})),this.$().on("keydown",":input,.TextEditor-editorContainer","esc",(()=>this.state.close())),this.handlers={},$(window).on("resize",this.handlers.onresize=this.updateHeight.bind(this)).resize(),$(document).on("mousemove",this.handlers.onmousemove=this.onmousemove.bind(this)).on("mouseup",this.handlers.onmouseup=this.onmouseup.bind(this))}onremove(t){super.onremove(t),$(window).off("resize",this.handlers.onresize),$(document).off("mousemove",this.handlers.onmousemove).off("mouseup",this.handlers.onmouseup)}configHandle(t){const s=this;$(t.dom).css("cursor","row-resize").bind("dragstart mousedown",(t=>t.preventDefault())).mousedown((function(t){s.mouseStart=t.clientY,s.heightStart=s.$().height(),s.handle=$(this),$("body").css("cursor","row-resize")}))}onmousemove(t){if(!this.handle)return;const s=this.mouseStart-t.clientY;this.changeHeight(this.heightStart+s);const i=$(window).scrollTop(),e=i>0&&i+$(window).height()>=$(document).height();this.updateBodyPadding(e)}onmouseup(){this.handle&&(this.handle=null,$("body").css("cursor",""))}focus(){this.$(this.attrs.state.body.componentClass.focusOnSelector?.()||".Composer-content :input:enabled:visible, .TextEditor-editor").first().focus()}updateHeight(){const t=this.state.computedHeight(),s=this.$(".Composer-flexible");if(this.$().height(t),s.length){const t=s.offset().top-this.$().offset().top,i=parseInt(s.css("padding-bottom"),10),e=this.$(".Composer-footer").outerHeight(!0);s.height(this.$().outerHeight()-t-i-e)}}updateBodyPadding(){const t=this.state.position!==d.A.Position.HIDDEN&&this.state.position!==d.A.Position.MINIMIZED&&"phone"!==e.A.screen()?this.state.computedHeight()-parseInt($("#app").css("padding-bottom"),10):0;$("#content").css({paddingBottom:t})}animatePositionChange(){if(this.prevPosition!==d.A.Position.FULLSCREEN||this.state.position!==d.A.Position.NORMAL)switch(this.state.position){case d.A.Position.HIDDEN:return this.hide();case d.A.Position.MINIMIZED:return this.minimize();case d.A.Position.FULLSCREEN:return this.focus();case d.A.Position.NORMAL:return this.show()}else this.focus()}animateHeightChange(){const t=this.$().stop(!0),s=t.outerHeight(),i=$(window).scrollTop();t.show(),this.updateHeight();const e=t.outerHeight();this.prevPosition===d.A.Position.HIDDEN?t.css({bottom:-e,height:e}):t.css({height:s});const o=t.animate({bottom:0,height:e},"fast").promise();return this.updateBodyPadding(),$(window).scrollTop(i),o}showBackdrop(){this.$backdrop=$("<div/>").addClass("composer-backdrop").appendTo("body")}hideBackdrop(){this.$backdrop&&this.$backdrop.remove()}show(){if(this.animateHeightChange().then((()=>this.focus())),"phone"===e.A.screen()){const t=document.documentElement,s=Math.min(t.scrollTop,t.scrollHeight-t.clientHeight);this.$().css("top",$(".App").is(".mobile-safari")?s:0),this.showBackdrop()}}hide(){const t=this.$();t.stop(!0).animate({bottom:-t.height()},"fast",(()=>{t.hide(),this.hideBackdrop(),this.updateBodyPadding()}))}minimize(){this.animateHeightChange(),this.$().css("top","auto"),this.hideBackdrop()}controlItems(){const t=new n.A;return this.state.position===d.A.Position.FULLSCREEN?t.add("exitFullScreen",m(a,{icon:"fas fa-compress",title:e.A.translator.trans("core.forum.composer.exit_full_screen_tooltip"),onclick:this.state.exitFullScreen.bind(this.state)})):(this.state.position!==d.A.Position.MINIMIZED&&(t.add("minimize",m(a,{icon:(0,c.A)("fas minimize",{"fa-minus":"phone"!==e.A.screen(),"fa-times":"phone"===e.A.screen()}),title:e.A.translator.trans("core.forum.composer.minimize_tooltip"),onclick:this.state.minimize.bind(this.state),itemClassName:"App-backControl"})),t.add("fullScreen",m(a,{icon:"fas fa-expand",title:e.A.translator.trans("core.forum.composer.full_screen_tooltip"),onclick:this.state.fullScreen.bind(this.state)}))),t.add("close",m(a,{icon:"fas fa-times",title:e.A.translator.trans("core.forum.composer.close_tooltip"),onclick:this.state.close.bind(this.state)}))),t}initializeHeight(){this.state.height=localStorage.getItem("composerHeight"),this.state.height||(this.state.height=this.defaultHeight())}defaultHeight(){return this.$().height()}changeHeight(t){this.state.height=t,this.updateHeight(),localStorage.setItem("composerHeight",this.state.height)}}flarum.reg.add("core","forum/components/Composer",p)}}]);
//# sourceMappingURL=Composer.js.map