"use strict";(self.webpackChunkflarum_core=self.webpackChunkflarum_core||[]).push([[826],{9989:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var a=s(7905),n=s(6789),o=s(3390),r=s(4041),i=s(9797),l=s(8312),c=s(8034),d=s(2190),u=s(7298),h=s(9133);class g extends d.Z{oninit(e){super.oninit(e),this.methods=this.notificationMethods().toArray(),this.loading={},this.types=this.notificationTypes().toArray()}view(){const e=this.attrs.user.preferences();return m("table",{className:"NotificationGrid"},m("thead",null,m("tr",null,m("td",null),this.methods.map((e=>m("th",{className:"NotificationGrid-groupToggle",onclick:this.toggleMethod.bind(this,e.name)},m(h.Z,{name:e.icon})," ",e.label))))),m("tbody",null,this.types.map((t=>m("tr",null,m("td",{className:"NotificationGrid-groupToggle",onclick:this.toggleType.bind(this,t.name)},m(h.Z,{name:t.icon})," ",t.label),this.methods.map((s=>{const a=this.preferenceKey(t.name,s.name);return m("td",{className:"NotificationGrid-checkbox"},m(u.Z,{state:!!e[a],loading:this.loading[a],disabled:!(a in e),onchange:this.toggle.bind(this,[a])},m("span",{className:"sr-only"},n.Z.translator.trans("core.forum.settings.notification_checkbox_a11y_label_template",{description:t.label,method:s.label}))))})))))))}oncreate(e){super.oncreate(e),this.$("thead .NotificationGrid-groupToggle").bind("mouseenter mouseleave",(function(e){const t=parseInt($(this).index(),10)+1;$(this).parents("table").find("td:nth-child("+t+")").toggleClass("highlighted","mouseenter"===e.type)})),this.$("tbody .NotificationGrid-groupToggle").bind("mouseenter mouseleave",(function(e){$(this).parent().find("td").toggleClass("highlighted","mouseenter"===e.type)}))}toggle(e){const t=this.attrs.user,s=t.preferences(),a=!s[e[0]];e.forEach((e=>{this.loading[e]=!0,s[e]=a})),m.redraw(),t.save({preferences:s}).then((()=>{e.forEach((e=>this.loading[e]=!1)),m.redraw()}))}toggleMethod(e){const t=this.types.map((t=>this.preferenceKey(t.name,e))).filter((e=>e in this.attrs.user.preferences()));this.toggle(t)}toggleType(e){const t=this.methods.map((t=>this.preferenceKey(e,t.name))).filter((e=>e in this.attrs.user.preferences()));this.toggle(t)}preferenceKey(e,t){return"notify_"+e+"_"+t}notificationMethods(){const e=new r.Z;return e.add("alert",{name:"alert",icon:"fas fa-bell",label:n.Z.translator.trans("core.forum.settings.notify_by_web_heading")}),e.add("email",{name:"email",icon:"far fa-envelope",label:n.Z.translator.trans("core.forum.settings.notify_by_email_heading")}),e}notificationTypes(){const e=new r.Z;return e.add("discussionRenamed",{name:"discussionRenamed",icon:"fas fa-pencil-alt",label:n.Z.translator.trans("core.forum.settings.notify_discussion_renamed_label")}),e}}flarum.reg.add("core","forum/components/NotificationGrid",g);var p=s(899),f=s(6352);class Z extends p.Z{className(){return"ChangePasswordModal Modal--small"}title(){return n.Z.translator.trans("core.forum.change_password.title")}content(){return m("div",{className:"Modal-body"},m(f.Z,{className:"Form--centered"},this.fields().toArray()))}fields(){const e=new r.Z;return e.add("help",m("p",{className:"helpText"},n.Z.translator.trans("core.forum.change_password.text"))),e.add("submit",m("div",{className:"Form-group Form-controls"},m(l.Z,{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},n.Z.translator.trans("core.forum.change_password.send_button")))),e}onsubmit(e){e.preventDefault(),this.loading=!0,n.Z.request({method:"POST",url:n.Z.forum.attribute("apiUrl")+"/forgot",body:this.requestBody()}).then(this.hide.bind(this),this.loaded.bind(this))}requestBody(){return{email:n.Z.session.user.email()}}}flarum.reg.add("core","forum/components/ChangePasswordModal",Z);var b=s(6458);class y extends p.Z{constructor(){super(...arguments),(0,a.Z)(this,"email",void 0),(0,a.Z)(this,"password",void 0),(0,a.Z)(this,"success",!1)}oninit(e){super.oninit(e),this.email=(0,b.Z)(n.Z.session.user.email()||""),this.password=(0,b.Z)("")}className(){return"ChangeEmailModal Modal--small"}title(){return n.Z.translator.trans("core.forum.change_email.title")}content(){return m("div",{className:"Modal-body"},m(f.Z,{className:"Form--centered"},this.fields().toArray()))}fields(){const e=new r.Z;return this.success?(e.add("help",m("p",{className:"helpText"},n.Z.translator.trans("core.forum.change_email.confirmation_message",{email:m("strong",null,this.email())}))),e.add("dismiss",m("div",{className:"Form-group"},m(l.Z,{className:"Button Button--primary Button--block",onclick:this.hide.bind(this)},n.Z.translator.trans("core.forum.change_email.dismiss_button"))))):(e.add("email",m("div",{className:"Form-group"},m("input",{type:"email",name:"email",className:"FormControl",placeholder:n.Z.session.user.email(),bidi:this.email,disabled:this.loading}))),e.add("password",m("div",{className:"Form-group"},m("input",{type:"password",name:"password",className:"FormControl",autocomplete:"current-password",placeholder:n.Z.translator.trans("core.forum.change_email.confirm_password_placeholder"),bidi:this.password,disabled:this.loading}))),e.add("submit",m("div",{className:"Form-group Form-controls"},m(l.Z,{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},n.Z.translator.trans("core.forum.change_email.submit_button"))))),e}onsubmit(e){e.preventDefault(),this.email()!==n.Z.session.user.email()?(this.loading=!0,this.alertAttrs=null,n.Z.session.user.save(this.requestAttributes(),{errorHandler:this.onerror.bind(this),meta:{password:this.password()}}).then((()=>{this.success=!0})).catch((()=>{})).then(this.loaded.bind(this))):this.hide()}requestAttributes(){return{email:this.email()}}onerror(e){401===e.status&&e.alert&&(e.alert.content=n.Z.translator.trans("core.forum.change_email.incorrect_password_message")),super.onerror(e)}}flarum.reg.add("core","forum/components/ChangeEmailModal",y);var _=s(1268),w=s(1552),N=s(3344);class v extends o.Z{constructor(){super(...arguments),(0,a.Z)(this,"discloseOnlineLoading",void 0)}oninit(e){super.oninit(e),this.show(n.Z.session.user),n.Z.setTitle((0,w.Z)(n.Z.translator.trans("core.forum.settings.title")))}content(){return m("div",{className:"SettingsPage"},m("ul",null,(0,_.Z)(this.settingsItems().toArray())))}settingsItems(){const e=new r.Z;return["account","notifications","privacy"].forEach(((t,s)=>{const a="".concat(t,"Items");e.add(t,m(c.Z,{className:(0,N.Z)("Settings-".concat(t),{"FieldSet--col":"account"===t}),label:n.Z.translator.trans("core.forum.settings.".concat(t,"_heading"))},this[a]().toArray()),100-10*s)})),e}accountItems(){const e=new r.Z;return e.add("changePassword",m(l.Z,{className:"Button",onclick:()=>n.Z.modal.show(Z)},n.Z.translator.trans("core.forum.settings.change_password_button")),100),e.add("changeEmail",m(l.Z,{className:"Button",onclick:()=>n.Z.modal.show(y)},n.Z.translator.trans("core.forum.settings.change_email_button")),90),e}notificationsItems(){const e=new r.Z;return e.add("notificationGrid",m(g,{user:this.user}),100),e}privacyItems(){var e;const t=new r.Z;return t.add("discloseOnline",m(i.Z,{state:null==(e=this.user.preferences())?void 0:e.discloseOnline,onchange:e=>{this.discloseOnlineLoading=!0,this.user.savePreferences({discloseOnline:e}).then((()=>{this.discloseOnlineLoading=!1,m.redraw()}))},loading:this.discloseOnlineLoading},n.Z.translator.trans("core.forum.settings.privacy_disclose_online_label")),100),t}}flarum.reg.add("core","forum/components/SettingsPage",v)}}]);
//# sourceMappingURL=SettingsPage.js.map