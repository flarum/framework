{"version":3,"sources":["webpack://@flarum/core/./src/common/utils/setRouteWithForcedRefresh.ts","webpack://@flarum/core/./src/forum/utils/History.js","webpack://@flarum/core/./src/forum/utils/Pane.js","webpack://@flarum/core/./src/forum/components/HeaderPrimary.js","webpack://@flarum/core/./src/forum/components/SessionDropdown.js","webpack://@flarum/core/./src/forum/components/NotificationsDropdown.js","webpack://@flarum/core/./src/forum/utils/KeyboardNavigatable.js","webpack://@flarum/core/./src/forum/components/DiscussionsSearchSource.js","webpack://@flarum/core/./src/forum/components/UsersSearchSource.js","webpack://@flarum/core/./src/forum/components/Search.js","webpack://@flarum/core/./src/forum/components/HeaderSecondary.js","webpack://@flarum/core/./src/forum/components/ComposerButton.js","webpack://@flarum/core/./src/forum/states/ComposerState.js","webpack://@flarum/core/./src/forum/components/Composer.js","webpack://@flarum/core/./src/forum/resolvers/DiscussionPageResolver.ts","webpack://@flarum/core/./src/forum/components/NotificationsPage.js","webpack://@flarum/core/./src/forum/utils/alertEmailConfirmation.js","webpack://@flarum/core/./src/forum/states/NotificationListState.js","webpack://@flarum/core/./src/forum/states/SearchState.js","webpack://@flarum/core/./src/forum/states/GlobalSearchState.js","webpack://@flarum/core/./src/forum/utils/isSafariMobile.ts","webpack://@flarum/core/./src/forum/ForumApplication.js","webpack://@flarum/core/./src/forum/routes.js","webpack://@flarum/core/./src/forum/app.ts","webpack://@flarum/core/./src/common/components/Placeholder.js","webpack://@flarum/core/./src/common/extend.js","webpack://@flarum/core/./src/common/helpers/highlight.tsx","webpack://@flarum/core/./src/common/helpers/humanTime.tsx","webpack://@flarum/core/./src/common/utils/SubtreeRetainer.js","webpack://@flarum/core/./src/common/utils/string.ts","webpack://@flarum/core/./src/common/components/ConfirmDocumentUnload.js","webpack://@flarum/core/./src/forum/components/ComposerBody.js","webpack://@flarum/core/./src/common/utils/abbreviateNumber.ts","webpack://@flarum/core/./src/forum/components/TerminalPost.js","webpack://@flarum/core/./src/forum/utils/slidable.js","webpack://@flarum/core/./node_modules/lodash-es/_baseToString.js","webpack://@flarum/core/./node_modules/lodash-es/_arrayMap.js","webpack://@flarum/core/./node_modules/lodash-es/escapeRegExp.js","webpack://@flarum/core/./node_modules/lodash-es/toString.js","webpack://@flarum/core/./src/forum/components/DiscussionListItem.js","webpack://@flarum/core/./src/forum/components/DiscussionList.js","webpack://@flarum/core/./src/forum/components/DiscussionHero.js","webpack://@flarum/core/./src/forum/components/DiscussionListPane.js","webpack://@flarum/core/./src/common/utils/formatNumber.ts","webpack://@flarum/core/./src/forum/components/PostStreamScrubber.js","webpack://@flarum/core/./src/common/components/SplitDropdown.js","webpack://@flarum/core/./node_modules/lodash-es/isObject.js","webpack://@flarum/core/./node_modules/lodash-es/now.js","webpack://@flarum/core/./node_modules/lodash-es/_trimmedEndIndex.js","webpack://@flarum/core/./node_modules/lodash-es/_baseTrim.js","webpack://@flarum/core/./node_modules/lodash-es/toNumber.js","webpack://@flarum/core/./node_modules/lodash-es/debounce.js","webpack://@flarum/core/./node_modules/lodash-es/throttle.js","webpack://@flarum/core/./src/common/utils/anchorScroll.js","webpack://@flarum/core/./src/forum/states/PostStreamState.js","webpack://@flarum/core/./src/forum/components/DiscussionPage.js","webpack://@flarum/core/./src/forum/components/ReplyComposer.js","webpack://@flarum/core/./src/forum/states/DiscussionListState.js","webpack://@flarum/core/./src/forum/components/RenameDiscussionModal.js","webpack://@flarum/core/./src/forum/utils/DiscussionControls.js","webpack://@flarum/core/./node_modules/color-thief-browser/dist/color-thief.min.js","webpack://@flarum/core/./node_modules/color-thief-browser/dist/color-thief.min-exposed.js","webpack://@flarum/core/./node_modules/punycode/punycode.es6-exposed.js","webpack://@flarum/core/./node_modules/lodash-es/isSymbol.js","webpack://@flarum/core/./node_modules/punycode/punycode.es6.js","webpack://@flarum/core/external \"window.flreg.get('components/UserPage')\""],"names":["setRouteWithForcedRefresh","route","params","options","newOptions","state","key","Date","now","m","set","window","flreg","add","History","defaultRoute","this","stack","getCurrent","length","getPrevious","push","name","title","url","get","secondTop","pop","top","canGoBack","back","home","backUrl","splice","Pane","element","pinnedKey","$element","$","pinned","localStorage","getItem","active","showing","render","enable","disable","show","clearTimeout","hideTimeout","hide","onmouseleave","setTimeout","bind","togglePinned","setItem","toggleClass","HeaderPrimary","view","className","listItems","items","toArray","ItemList","Component","SessionDropdown","initAttrs","attrs","buttonClassName","menuClassName","accessibleToggleLabel","app","translator","trans","vnode","children","getButtonContent","user","session","avatar","username","LinkButton","icon","href","forum","attribute","target","Separator","Button","onclick","logout","Dropdown","NotificationsDropdown","label","getButton","newNotifications","getNewCount","vdom","unread","getUnreadCount","getMenu","NotificationList","menuClick","then","redraw","drawer","isOpen","goToRoute","load","unreadNotificationCount","newNotificationCount","e","shiftKey","metaKey","ctrlKey","which","stopPropagation","KeyboardNavigatable","callbacks","whenCallback","event","onUp","callback","preventDefault","onDown","onSelect","onCancel","onRemove","selectionStart","selectionEnd","when","bindTo","on","navigate","keyCallback","DiscussionsSearchSource","results","search","query","toLowerCase","filter","q","page","limit","include","store","find","map","discussion","mostRelevantPost","data-index","id","Link","number","highlight","contentPlain","UsersSearchResults","concat","all","displayName","some","value","substr","i","arr","lastIndexOf","sort","a","b","localeCompare","text","undefined","Search","oninit","hasFocus","sources","loadingSources","index","currentSearch","getInitialSearch","sourceItems","searchLabel","extractText","role","classList","open","getValue","focused","loading","aria-label","type","placeholder","oninput","setValue","onfocus","onblur","LoadingIndicator","size","clear","source","onupdate","setIndex","getCurrentNumericIndex","maxHeight","innerHeight","querySelector","getBoundingClientRect","bottom","style","oncreate","blur","selectableItems","$input","navigator","selectResult","searchTimeout","isCached","MIN_SEARCH_LEN","Math","max","cache","one","select","attr","UsersSearchSource","$items","$item","eq","scrollToItem","$dropdown","parent","fixedIndex","removeClass","addClass","scrollTop","dropdownScroll","dropdownTop","offset","dropdownBottom","outerHeight","itemTop","itemBottom","parseInt","css","stop","animate","HeaderSecondary","LogInModal","SignUpModal","component","Object","keys","data","locales","locale","savePreferences","location","reload","document","cookie","SelectDropdown","notifications","modal","ComposerButton","ComposerState","position","Position","HIDDEN","height","body","editor","componentClass","componentResolver","preventExit","isVisible","sync","onExit","fields","content","Stream","destroy","NORMAL","FULLSCREEN","close","minimize","MINIMIZED","fullScreen","exitFullScreen","bodyMatches","subclassOf","every","isFullScreen","screen","composingReplyTo","ReplyComposer","confirm","message","preventClosingWhen","minimumHeight","maximumHeight","computedHeight","min","Composer","prevPosition","classes","normal","minimized","visible","showIfMinimized","configHandle","controlItems","composer","disabled","updateHeight","animatePositionChange","initializeHeight","handlers","onresize","resize","onmousemove","onmouseup","onremove","off","dom","mousedown","mouseStart","clientY","heightStart","handle","deltaPixels","changeHeight","anchorToBottom","updateBodyPadding","focus","first","$flexible","headerHeight","paddingBottom","footerHeight","animateHeightChange","$composer","oldHeight","newHeight","animation","promise","showBackdrop","$backdrop","appendTo","hideBackdrop","remove","scrollElement","documentElement","topOfViewport","scrollHeight","clientHeight","is","itemClassName","defaultHeight","DiscussionPageResolver","canonicalizeDiscussionSlug","slug","split","makeKey","param","near","routeName","replace","JSON","stringify","onmatch","args","requestedPath","current","matches","DiscussionPage","scrollToPostNumber","goToNumber","DefaultResolver","NotificationsPage","history","bodyClass","Page","alertEmailConfirmation","isEmailConfirmed","ResendButton","sent","class","request","method","ContainedAlert","Alert","mount","insertBefore","dismissible","controls","email","NotificationListState","notificationPages","moreResults","getNotificationPages","isLoading","hasMoreResults","pushAttributes","loadMore","parseResults","payload","links","next","markAllAsRead","forEach","notification","isRead","SearchState","cachedSearches","indexOf","GlobalSearchState","clearInitialSearch","stickyParams","changeSort","discussions","sortMap","providesInitialSearch","isSafariMobile","vendor","includes","userAgent","ForumApplication","PostsUserPage","routes","path","resolverClass","settings","post","DiscussionListState","defaultAction","pane","getElementById","prefix","Navigation","click","viewingDiscussion","authenticationComplete","loggedIn","Application","Forum","Placeholder","extend","object","original","apply","newMethod","string","phrase","regexp","RegExp","highlighted","start","truncate","html","trust","humanTime","time","d","dayjs","datetime","format","full","ago","humanTimeUtil","pubdate","data-humantime","SubtreeRetainer","needsRebuild","result","check","invalidate","substring","getPlainContent","removeSelectors","join","trim","ucfirst","toUpperCase","ConfirmDocumentUnload","handler","boundHandler","ComposerBody","TextEditor","confirmExit","hasChanges","originalContent","headerItems","submitLabel","preview","jumpToPreview","onchange","onsubmit","loaded","abbreviateNumber","floor","toFixed","toString","TerminalPost","lastPost","replyCount","slidable","$underneathLeft","$underneathRight","startX","startY","couldBeSliding","isSliding","pos","animatePos","newPos","duration","step","x","reset","complete","originalEvent","targetTouches","clientX","newX","newY","abs","toggle","$underneath","side","hasClass","scale","activate","width","symbolProto","symbolToString","baseToString","isArray","array","iteratee","Array","isSymbol","call","reRegExpChar","reHasRegExpChar","test","DiscussionListItem","subtree","freshness","markedAllAsReadAt","getTime","elementAttrs","isHidden","isUnread","showUnread","showRepliesCount","jumpTo","DiscussionControls","escapeRegExp","highlightRegExp","lastPostNumber","lastReadPostNumber","markAsRead","createdAt","tooltip","placement","badges","infoItems","tabindex","slidableInstance","onbeforeupdate","old","showFirstPost","save","firstPost","contentType","excerpt","DiscussionList","getParams","empty","isSearchResults","data-id","DiscussionHero","hotEdge","pageX","DiscussionListPane","hasDiscussions","enoughSpace","$list","hover","previous","discussionListPaneScrollTop","$discussion","listTop","listBottom","discussionTop","discussionBottom","formatNumber","PostStreamScrubber","stream","scrollListener","ScrollListener","updateScrubberValues","fromScroll","forceHeightChange","count","viewing","transChoice","unreadCount","unreadPercent","styleUnread","newStyle","oldStyle","classNames","data-toggle","goToFirst","goToLast","forceUpdateScrubber","loadPromise","dragging","indexStart","onmousedown","percentPerPost","$scrubber","sanitizeIndex","description","heights","before","after","paused","adjustingHeight","func","animationPromises","part","$part","Promise","scrubber","scrollbar","touches","deltaIndex","newIndex","intIndex","goToIndex","$scrollbar","offsetPercent","pageY","offsetIndex","parseFloat","minPercentVisible","percentPerVisiblePost","SplitDropdown","firstChild","getFirstChild","buttonAttrs","aria-haspopup","reWhitespace","reTrimStart","slice","charAt","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","other","valueOf","isBinary","nativeMax","nativeMin","wait","leading","trailing","TypeError","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","maxing","invokeFunc","thisArg","leadingEdge","timerExpired","shouldInvoke","timeSinceLastCall","trailingEdge","timeWaiting","remainingWait","debounced","isInvoking","arguments","cancel","flush","anchorScroll","$window","relativeScroll","PostStreamState","includedPosts","loadPageTimeouts","pagesLoading","loadNext","throttle","_loadNext","loadPrevious","_loadPrevious","update","viewingEnd","visibleEnd","loadRange","visibleStart","resolve","noAnimation","resultPromise","targetPost","reply","loadNearNumber","needsScroll","animateScroll","loadNearIndex","posts","Number","constructor","loadCount","end","twoPagesAway","loadPage","backwards","loadIds","postIds","getById","canEdit","newPosts","useBrowserScrollRestoration","PostStream","sidebarItems","onPositionChange","positionChanged","preloadedDiscussion","preloadedApiDocument","requestParams","bySlug","setTitle","setTitleCount","included","discussionId","record","relationships","startNumber","endNumber","replaceState","minimizeComposerIfFullScreen","createRecord","alert","viewButton","alerts","dismiss","relevance","latest","newest","oldest","refreshParams","newParams","refresh","deferClear","loadResults","preloadedDiscussions","removeDiscussion","addDiscussion","unshift","RenameDiscussionModal","currentTitle","newTitle","bidi","Modal","context","section","item","itemName","userControls","canReply","replyAction","moderationControls","canRename","renameAction","destructiveControls","canHide","restoreAction","canDelete","deleteAction","hideAction","forceRefresh","reject","console","log","hiddenAt","hiddenUser","CanvasImage","canvas","createElement","getContext","appendChild","drawImage","prototype","clearRect","putImageData","getPixelCount","getImageData","removeCanvas","parentNode","removeChild","ColorThief","getColor","getPalette","c","f","g","k","l","n","o","MMCQ","quantize","p","palette","pv","naturalOrder","sum","reduce","peek","debug","h","r1","r2","g1","g2","b1","b2","histo","vboxes","vbox","volume","j","copy","_volume","_count_set","_count","avg","_avg","contains","gval","bval","color","nearest","sqrt","pow","forcebw","module","exports","___EXPOSE_LOADER_IMPORT___","___EXPOSE_LOADER_GLOBAL_THIS___","maxInt","base","regexPunycode","regexNonASCII","regexSeparators","errors","stringFromCharCode","String","fromCharCode","error","RangeError","mapDomain","fn","parts","encoded","ucs2decode","output","counter","charCodeAt","extra","ucs2encode","fromCodePoint","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","baseMinusTMin","decode","input","inputLength","bias","basic","oldi","w","codePoint","t","baseMinusT","out","encode","currentValue","basicLength","handledCPCount","handledCPCountPlusOne","qMinusT","toUnicode","toASCII"],"mappings":"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","file":"forum/flarum-core.js","sourcesContent":["import Mithril from 'mithril';\n\n/**\n * Mithril 2 does not completely rerender the page if a route change leads to the same route\n * (or the same component handling a different route). This util calls m.route.set, forcing a reonit.\n *\n * @see https://mithril.js.org/route.html#key-parameter\n */\nexport default function setRouteWithForcedRefresh(route: string, params = null, options: Mithril.RouteOptions = {}) {\n  const newOptions = { ...options };\n  newOptions.state = newOptions.state || {};\n  newOptions.state.key = Date.now();\n\n  m.route.set(route, params, newOptions);\n}\n\nwindow.flreg.add('utils/setRouteWithForcedRefresh', setRouteWithForcedRefresh)","import setRouteWithForcedRefresh from '../../common/utils/setRouteWithForcedRefresh';\n\n/**\n * The `History` class keeps track and manages a stack of routes that the user\n * has navigated to in their session.\n *\n * An item can be pushed to the top of the stack using the `push` method. An\n * item in the stack has a name and a URL. The name need not be unique; if it is\n * the same as the item before it, that will be overwritten with the new URL. In\n * this way, if a user visits a discussion, and then visits another discussion,\n * popping the history stack will still take them back to the discussion list\n * rather than the previous discussion.\n */\nexport default class History {\n  constructor(defaultRoute) {\n    /**\n     * The stack of routes that have been navigated to.\n     *\n     * @type {Array}\n     * @protected\n     */\n    this.stack = [];\n  }\n\n  /**\n   * Get the item on the top of the stack.\n   *\n   * @return {Object}\n   * @public\n   */\n  getCurrent() {\n    return this.stack[this.stack.length - 1];\n  }\n\n  /**\n   * Get the previous item on the stack.\n   *\n   * @return {Object}\n   * @public\n   */\n  getPrevious() {\n    return this.stack[this.stack.length - 2];\n  }\n\n  /**\n   * Push an item to the top of the stack.\n   *\n   * @param {String} name The name of the route.\n   * @param {String} title The title of the route.\n   * @param {String} [url] The URL of the route. The current URL will be used if\n   *     not provided.\n   * @public\n   */\n  push(name, title, url = m.route.get()) {\n    // If we're pushing an item with the same name as second-to-top item in the\n    // stack, we will assume that the user has clicked the 'back' button in\n    // their browser. In this case, we don't want to push a new item, so we will\n    // pop off the top item, and then the second-to-top item will be overwritten\n    // below.\n    const secondTop = this.stack[this.stack.length - 2];\n    if (secondTop && secondTop.name === name) {\n      this.stack.pop();\n    }\n\n    // If we're pushing an item with the same name as the top item in the stack,\n    // then we'll overwrite it with the new URL.\n    const top = this.getCurrent();\n    if (top && top.name === name) {\n      Object.assign(top, { url, title });\n    } else {\n      this.stack.push({ name, url, title });\n    }\n  }\n\n  /**\n   * Check whether or not the history stack is able to be popped.\n   *\n   * @return {Boolean}\n   * @public\n   */\n  canGoBack() {\n    return this.stack.length > 1;\n  }\n\n  /**\n   * Go back to the previous route in the history stack.\n   *\n   * @public\n   */\n  back() {\n    if (!this.canGoBack()) {\n      return this.home();\n    }\n\n    this.stack.pop();\n\n    m.route.set(this.getCurrent().url);\n  }\n\n  /**\n   * Get the URL of the previous page.\n   *\n   * @public\n   */\n  backUrl() {\n    const secondTop = this.stack[this.stack.length - 2];\n\n    return secondTop.url;\n  }\n\n  /**\n   * Go to the first route in the history stack.\n   *\n   * @public\n   */\n  home() {\n    this.stack.splice(0);\n\n    setRouteWithForcedRefresh('/');\n  }\n}\n\nwindow.flreg.add('utils/History', History)","/**\n * The `Pane` class manages the page's discussion list sidepane. The pane is a\n * part of the content view (DiscussionPage component), but its visibility is\n * determined by CSS classes applied to the outer page element. This class\n * manages the application of those CSS classes.\n */\nexport default class Pane {\n  constructor(element) {\n    /**\n     * The localStorage key to store the pane's pinned state with.\n     *\n     * @type {String}\n     * @protected\n     */\n    this.pinnedKey = 'panePinned';\n\n    /**\n     * The page element.\n     *\n     * @type {jQuery}\n     * @protected\n     */\n    this.$element = $(element);\n\n    /**\n     * Whether or not the pane is currently pinned.\n     *\n     * @type {Boolean}\n     * @protected\n     */\n    this.pinned = localStorage.getItem(this.pinnedKey) === 'true';\n\n    /**\n     * Whether or not the pane is currently exists.\n     *\n     * @type {Boolean}\n     * @protected\n     */\n    this.active = false;\n\n    /**\n     * Whether or not the pane is currently showing, or is hidden off the edge\n     * of the screen.\n     *\n     * @type {Boolean}\n     * @protected\n     */\n    this.showing = false;\n\n    this.render();\n  }\n\n  /**\n   * Enable the pane.\n   *\n   * @public\n   */\n  enable() {\n    this.active = true;\n    this.render();\n  }\n\n  /**\n   * Disable the pane.\n   *\n   * @public\n   */\n  disable() {\n    this.active = false;\n    this.showing = false;\n    this.render();\n  }\n\n  /**\n   * Show the pane.\n   *\n   * @public\n   */\n  show() {\n    clearTimeout(this.hideTimeout);\n    this.showing = true;\n    this.render();\n  }\n\n  /**\n   * Hide the pane.\n   *\n   * @public\n   */\n  hide() {\n    this.showing = false;\n    this.render();\n  }\n\n  /**\n   * Begin a timeout to hide the pane, which can be cancelled by showing the\n   * pane.\n   *\n   * @public\n   */\n  onmouseleave() {\n    this.hideTimeout = setTimeout(this.hide.bind(this), 250);\n  }\n\n  /**\n   * Toggle whether or not the pane is pinned.\n   *\n   * @public\n   */\n  togglePinned() {\n    this.pinned = !this.pinned;\n\n    localStorage.setItem(this.pinnedKey, this.pinned ? 'true' : 'false');\n\n    this.render();\n  }\n\n  /**\n   * Apply the appropriate CSS classes to the page element.\n   *\n   * @protected\n   */\n  render() {\n    this.$element.toggleClass('panePinned', this.pinned).toggleClass('hasPane', this.active).toggleClass('paneShowing', this.showing);\n  }\n}\n\nwindow.flreg.add('utils/Pane', Pane)","import Component from '../../common/Component';\nimport ItemList from '../../common/utils/ItemList';\nimport listItems from '../../common/helpers/listItems';\n\n/**\n * The `HeaderPrimary` component displays primary header controls. On the\n * default skin, these are shown just to the right of the forum title.\n */\nexport default class HeaderPrimary extends Component {\n  view() {\n    return <ul className=\"Header-controls\">{listItems(this.items().toArray())}</ul>;\n  }\n\n  /**\n   * Build an item list for the controls.\n   *\n   * @return {ItemList}\n   */\n  items() {\n    return new ItemList();\n  }\n}\n\nwindow.flreg.add('components/HeaderPrimary', HeaderPrimary)","import avatar from '../../common/helpers/avatar';\nimport username from '../../common/helpers/username';\nimport Dropdown from '../../common/components/Dropdown';\nimport LinkButton from '../../common/components/LinkButton';\nimport Button from '../../common/components/Button';\nimport ItemList from '../../common/utils/ItemList';\nimport Separator from '../../common/components/Separator';\n\n/**\n * The `SessionDropdown` component shows a button with the current user's\n * avatar/name, with a dropdown of session controls.\n */\nexport default class SessionDropdown extends Dropdown {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    attrs.className = 'SessionDropdown';\n    attrs.buttonClassName = 'Button Button--user Button--flat';\n    attrs.menuClassName = 'Dropdown-menu--right';\n\n    attrs.accessibleToggleLabel = app.translator.trans('core.forum.header.session_dropdown_accessible_label');\n  }\n\n  view(vnode) {\n    return super.view({ ...vnode, children: this.items().toArray() });\n  }\n\n  getButtonContent() {\n    const user = app.session.user;\n\n    return [avatar(user), ' ', <span className=\"Button-label\">{username(user)}</span>];\n  }\n\n  /**\n   * Build an item list for the contents of the dropdown menu.\n   *\n   * @return {ItemList}\n   */\n  items() {\n    const items = new ItemList();\n    const user = app.session.user;\n\n    items.add(\n      'profile',\n      LinkButton.component(\n        {\n          icon: 'fas fa-user',\n          href: app.route.user(user),\n        },\n        app.translator.trans('core.forum.header.profile_button')\n      ),\n      100\n    );\n\n    items.add(\n      'settings',\n      LinkButton.component(\n        {\n          icon: 'fas fa-cog',\n          href: app.route('settings'),\n        },\n        app.translator.trans('core.forum.header.settings_button')\n      ),\n      50\n    );\n\n    if (app.forum.attribute('adminUrl')) {\n      items.add(\n        'administration',\n        LinkButton.component(\n          {\n            icon: 'fas fa-wrench',\n            href: app.forum.attribute('adminUrl'),\n            target: '_blank',\n          },\n          app.translator.trans('core.forum.header.admin_button')\n        ),\n        0\n      );\n    }\n\n    items.add('separator', Separator.component(), -90);\n\n    items.add(\n      'logOut',\n      Button.component(\n        {\n          icon: 'fas fa-sign-out-alt',\n          onclick: app.session.logout.bind(app.session),\n        },\n        app.translator.trans('core.forum.header.log_out_button')\n      ),\n      -100\n    );\n\n    return items;\n  }\n}\n\nwindow.flreg.add('components/SessionDropdown', SessionDropdown)","import Dropdown from '../../common/components/Dropdown';\nimport icon from '../../common/helpers/icon';\n\nexport default class NotificationsDropdown extends Dropdown {\n  static initAttrs(attrs) {\n    attrs.className = attrs.className || 'NotificationsDropdown';\n    attrs.buttonClassName = attrs.buttonClassName || 'Button Button--flat';\n    attrs.menuClassName = attrs.menuClassName || 'Dropdown-menu--right';\n    attrs.label = attrs.label || app.translator.trans('core.forum.notifications.tooltip');\n    attrs.icon = attrs.icon || 'fas fa-bell';\n    // For best a11y support, both `title` and `aria-label` should be used\n    attrs.accessibleToggleLabel = attrs.accessibleToggleLabel || app.translator.trans('core.forum.notifications.toggle_dropdown_accessible_label');\n\n    super.initAttrs(attrs);\n  }\n\n  getButton() {\n    const newNotifications = this.getNewCount();\n    const vdom = super.getButton();\n\n    vdom.attrs.title = this.attrs.label;\n\n    vdom.attrs.className += newNotifications ? ' new' : '';\n    vdom.attrs.onclick = this.onclick.bind(this);\n\n    return vdom;\n  }\n\n  getButtonContent() {\n    const unread = this.getUnreadCount();\n\n    return [\n      icon(this.attrs.icon, { className: 'Button-icon' }),\n      unread ? <span className=\"NotificationsDropdown-unread\">{unread}</span> : '',\n      <span className=\"Button-label\">{this.attrs.label}</span>,\n    ];\n  }\n\n  getMenu() {\n    const NotificationList = this.NotificationList;\n\n    return (\n      <div className={'Dropdown-menu ' + this.attrs.menuClassName} onclick={this.menuClick.bind(this)}>\n        {this.showing && NotificationList ? <NotificationList state={this.attrs.state} /> : ''}\n      </div>\n    );\n  }\n\n  onclick() {\n    import(/* webpackChunkName: \"forum/components/NotificationList\" */ './NotificationList').then((NotificationList) => {\n      this.NotificationList = NotificationList.default;\n      m.redraw();\n    });\n\n    if (app.drawer.isOpen()) {\n      this.goToRoute();\n    } else {\n      this.attrs.state.load();\n    }\n  }\n\n  goToRoute() {\n    m.route.set(app.route('notifications'));\n  }\n\n  getUnreadCount() {\n    return app.session.user.unreadNotificationCount();\n  }\n\n  getNewCount() {\n    return app.session.user.newNotificationCount();\n  }\n\n  menuClick(e) {\n    // Don't close the notifications dropdown if the user is opening a link in a\n    // new tab or window.\n    if (e.shiftKey || e.metaKey || e.ctrlKey || e.which === 2) e.stopPropagation();\n  }\n}\n\nwindow.flreg.add('components/NotificationsDropdown', NotificationsDropdown)","/**\n * The `KeyboardNavigatable` class manages lists that can be navigated with the\n * keyboard, calling callbacks for each actions.\n *\n * This helper encapsulates the key binding logic, providing a simple fluent\n * API for use.\n */\nexport default class KeyboardNavigatable {\n  constructor() {\n    /**\n     * Callback to be executed for a specified input.\n     *\n     * @callback KeyboardNavigatable~keyCallback\n     * @param {KeyboardEvent} event\n     * @returns {boolean}\n     */\n    this.callbacks = {};\n\n    /**\n     * Callback that determines whether keyboard input should be handled.\n     * By default, always handle keyboard navigation.\n     *\n     * @callback whenCallback\n     * @param {KeyboardEvent} event\n     * @returns {boolean}\n     */\n    this.whenCallback = (event) => true;\n  }\n\n  /**\n   * Provide a callback to be executed when navigating upwards.\n   *\n   * This will be triggered by the Up key.\n   *\n   * @public\n   * @param {KeyboardNavigatable~keyCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  onUp(callback) {\n    this.callbacks[38] = (e) => {\n      e.preventDefault();\n      callback(e);\n    };\n\n    return this;\n  }\n\n  /**\n   * Provide a callback to be executed when navigating downwards.\n   *\n   * This will be triggered by the Down key.\n   *\n   * @public\n   * @param {KeyboardNavigatable~keyCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  onDown(callback) {\n    this.callbacks[40] = (e) => {\n      e.preventDefault();\n      callback(e);\n    };\n\n    return this;\n  }\n\n  /**\n   * Provide a callback to be executed when the current item is selected..\n   *\n   * This will be triggered by the Return and Tab keys..\n   *\n   * @public\n   * @param {KeyboardNavigatable~keyCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  onSelect(callback) {\n    this.callbacks[9] = this.callbacks[13] = (e) => {\n      e.preventDefault();\n      callback(e);\n    };\n\n    return this;\n  }\n\n  /**\n   * Provide a callback to be executed when the navigation is canceled.\n   *\n   * This will be triggered by the Escape key.\n   *\n   * @public\n   * @param {KeyboardNavigatable~keyCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  onCancel(callback) {\n    this.callbacks[27] = (e) => {\n      e.stopPropagation();\n      e.preventDefault();\n      callback(e);\n    };\n\n    return this;\n  }\n\n  /**\n   * Provide a callback to be executed when previous input is removed.\n   *\n   * This will be triggered by the Backspace key.\n   *\n   * @public\n   * @param {KeyboardNavigatable~keyCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  onRemove(callback) {\n    this.callbacks[8] = (e) => {\n      if (e.target.selectionStart === 0 && e.target.selectionEnd === 0) {\n        callback(e);\n        e.preventDefault();\n      }\n    };\n\n    return this;\n  }\n\n  /**\n   * Provide a callback that determines whether keyboard input should be handled.\n   *\n   * @public\n   * @param {KeyboardNavigatable~whenCallback} callback\n   * @return {KeyboardNavigatable}\n   */\n  when(callback) {\n    this.whenCallback = callback;\n\n    return this;\n  }\n\n  /**\n   * Set up the navigation key bindings on the given jQuery element.\n   *\n   * @public\n   * @param {jQuery} $element\n   */\n  bindTo($element) {\n    // Handle navigation key events on the navigatable element.\n    $element.on('keydown', this.navigate.bind(this));\n  }\n\n  /**\n   * Interpret the given keyboard event as navigation commands.\n   *\n   * @public\n   * @param {KeyboardEvent} event\n   */\n  navigate(event) {\n    // This callback determines whether keyboard should be handled or ignored.\n    if (!this.whenCallback(event)) return;\n\n    const keyCallback = this.callbacks[event.which];\n    if (keyCallback) {\n      keyCallback(event);\n    }\n  }\n}\n\nwindow.flreg.add('utils/KeyboardNavigatable', KeyboardNavigatable)","import highlight from '../../common/helpers/highlight';\nimport LinkButton from '../../common/components/LinkButton';\nimport Link from '../../common/components/Link';\n\n/**\n * The `DiscussionsSearchSource` finds and displays discussion search results in\n * the search dropdown.\n *\n * @implements SearchSource\n */\nexport default class DiscussionsSearchSource {\n  constructor() {\n    this.results = {};\n  }\n\n  search(query) {\n    query = query.toLowerCase();\n\n    this.results[query] = [];\n\n    const params = {\n      filter: { q: query },\n      page: { limit: 3 },\n      include: 'mostRelevantPost',\n    };\n\n    return app.store.find('discussions', params).then((results) => (this.results[query] = results));\n  }\n\n  view(query) {\n    query = query.toLowerCase();\n\n    const results = this.results[query] || [];\n\n    return [\n      <li className=\"Dropdown-header\">{app.translator.trans('core.forum.search.discussions_heading')}</li>,\n      <li>\n        {LinkButton.component(\n          {\n            icon: 'fas fa-search',\n            href: app.route('index', { q: query }),\n          },\n          app.translator.trans('core.forum.search.all_discussions_button', { query })\n        )}\n      </li>,\n      results.map((discussion) => {\n        const mostRelevantPost = discussion.mostRelevantPost();\n\n        return (\n          <li className=\"DiscussionSearchResult\" data-index={'discussions' + discussion.id()}>\n            <Link href={app.route.discussion(discussion, mostRelevantPost && mostRelevantPost.number())}>\n              <div className=\"DiscussionSearchResult-title\">{highlight(discussion.title(), query)}</div>\n              {mostRelevantPost ? <div className=\"DiscussionSearchResult-excerpt\">{highlight(mostRelevantPost.contentPlain(), query, 100)}</div> : ''}\n            </Link>\n          </li>\n        );\n      }),\n    ];\n  }\n}\n\nwindow.flreg.add('components/DiscussionsSearchSource', DiscussionsSearchSource)","import highlight from '../../common/helpers/highlight';\nimport avatar from '../../common/helpers/avatar';\nimport username from '../../common/helpers/username';\nimport Link from '../../common/components/Link';\n\n/**\n * The `UsersSearchSource` finds and displays user search results in the search\n * dropdown.\n *\n * @implements SearchSource\n */\nexport default class UsersSearchResults {\n  constructor() {\n    this.results = {};\n  }\n\n  search(query) {\n    return app.store\n      .find('users', {\n        filter: { q: query },\n        page: { limit: 5 },\n      })\n      .then((results) => {\n        this.results[query] = results;\n        m.redraw();\n      });\n  }\n\n  view(query) {\n    query = query.toLowerCase();\n\n    const results = (this.results[query] || [])\n      .concat(\n        app.store\n          .all('users')\n          .filter((user) => [user.username(), user.displayName()].some((value) => value.toLowerCase().substr(0, query.length) === query))\n      )\n      .filter((e, i, arr) => arr.lastIndexOf(e) === i)\n      .sort((a, b) => a.displayName().localeCompare(b.displayName()));\n\n    if (!results.length) return '';\n\n    return [\n      <li className=\"Dropdown-header\">{app.translator.trans('core.forum.search.users_heading')}</li>,\n      results.map((user) => {\n        const name = username(user);\n\n        const children = [highlight(name.text, query)];\n\n        return (\n          <li className=\"UserSearchResult\" data-index={'users' + user.id()}>\n            <Link href={app.route.user(user)}>\n              {avatar(user)}\n              {{ ...name, text: undefined, children }}\n            </Link>\n          </li>\n        );\n      }),\n    ];\n  }\n}\n\nwindow.flreg.add('components/UsersSearchResults', UsersSearchResults)","import Component from '../../common/Component';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport ItemList from '../../common/utils/ItemList';\nimport classList from '../../common/utils/classList';\nimport extractText from '../../common/utils/extractText';\nimport KeyboardNavigatable from '../utils/KeyboardNavigatable';\nimport icon from '../../common/helpers/icon';\nimport DiscussionsSearchSource from './DiscussionsSearchSource';\nimport UsersSearchSource from './UsersSearchSource';\n\n/**\n * The `Search` component displays a menu of as-you-type results from a variety\n * of sources.\n *\n * The search box will be 'activated' if the app's search state's\n * getInitialSearch() value is a truthy value. If this is the case, an 'x'\n * button will be shown next to the search field, and clicking it will clear the search.\n *\n * ATTRS:\n *\n * - state: SearchState instance.\n */\nexport default class Search extends Component {\n  static MIN_SEARCH_LEN = 3;\n\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.state = this.attrs.state;\n\n    /**\n     * Whether or not the search input has focus.\n     *\n     * @type {Boolean}\n     */\n    this.hasFocus = false;\n\n    /**\n     * An array of SearchSources.\n     *\n     * @type {SearchSource[]}\n     */\n    this.sources = null;\n\n    /**\n     * The number of sources that are still loading results.\n     *\n     * @type {Integer}\n     */\n    this.loadingSources = 0;\n\n    /**\n     * The index of the currently-selected <li> in the results list. This can be\n     * a unique string (to account for the fact that an item's position may jump\n     * around as new results load), but otherwise it will be numeric (the\n     * sequential position within the list).\n     *\n     * @type {String|Integer}\n     */\n    this.index = 0;\n  }\n\n  view() {\n    const currentSearch = this.state.getInitialSearch();\n\n    // Initialize search sources in the view rather than the constructor so\n    // that we have access to app.forum.\n    if (!this.sources) {\n      this.sources = this.sourceItems().toArray();\n    }\n\n    // Hide the search view if no sources were loaded\n    if (!this.sources.length) return <div></div>;\n\n    const searchLabel = extractText(app.translator.trans('core.forum.header.search_placeholder'));\n\n    return (\n      <div\n        role=\"search\"\n        className={\n          'Search ' +\n          classList({\n            open: this.state.getValue() && this.hasFocus,\n            focused: this.hasFocus,\n            active: !!currentSearch,\n            loading: !!this.loadingSources,\n          })\n        }\n      >\n        <div className=\"Search-input\">\n          <input\n            aria-label={searchLabel}\n            className=\"FormControl\"\n            type=\"search\"\n            placeholder={searchLabel}\n            value={this.state.getValue()}\n            oninput={(e) => this.state.setValue(e.target.value)}\n            onfocus={() => (this.hasFocus = true)}\n            onblur={() => (this.hasFocus = false)}\n          />\n          {this.loadingSources ? (\n            LoadingIndicator.component({ size: 'tiny', className: 'Button Button--icon Button--link' })\n          ) : currentSearch ? (\n            <button className=\"Search-clear Button Button--icon Button--link\" onclick={this.clear.bind(this)}>\n              {icon('fas fa-times-circle')}\n            </button>\n          ) : (\n            ''\n          )}\n        </div>\n        <ul className=\"Dropdown-menu Search-results\">\n          {this.state.getValue() && this.hasFocus ? this.sources.map((source) => source.view(this.state.getValue())) : ''}\n        </ul>\n      </div>\n    );\n  }\n\n  onupdate() {\n    // Highlight the item that is currently selected.\n    this.setIndex(this.getCurrentNumericIndex());\n\n    // If there are no sources, the search view is not shown.\n    if (!this.sources.length) return;\n\n    // Since extensions might add elements above the search box on mobile,\n    // we need to calculate and set the max height dynamically.\n    const resultsElementMargin = 14;\n    const maxHeight =\n      window.innerHeight - this.element.querySelector('.Search-input>.FormControl').getBoundingClientRect().bottom - resultsElementMargin;\n    this.element.querySelector('.Search-results').style['max-height'] = `${maxHeight}px`;\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    const search = this;\n    const state = this.state;\n\n    // Highlight the item that is currently selected.\n    this.setIndex(this.getCurrentNumericIndex());\n\n    this.$('.Search-results')\n      .on('mousedown', (e) => e.preventDefault())\n      .on('click', () => this.$('input').blur())\n\n      // Whenever the mouse is hovered over a search result, highlight it.\n      .on('mouseenter', '> li:not(.Dropdown-header)', function () {\n        search.setIndex(search.selectableItems().index(this));\n      });\n\n    const $input = this.$('input');\n\n    this.navigator = new KeyboardNavigatable();\n    this.navigator\n      .onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true))\n      .onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true))\n      .onSelect(this.selectResult.bind(this))\n      .onCancel(this.clear.bind(this))\n      .bindTo($input);\n\n    // Handle input key events on the search input, triggering results to load.\n    $input\n      .on('input focus', function () {\n        const query = this.value.toLowerCase();\n\n        if (!query) return;\n\n        clearTimeout(search.searchTimeout);\n        search.searchTimeout = setTimeout(() => {\n          if (state.isCached(query)) return;\n\n          if (query.length >= Search.MIN_SEARCH_LEN) {\n            search.sources.map((source) => {\n              if (!source.search) return;\n\n              search.loadingSources++;\n\n              source.search(query).then(() => {\n                search.loadingSources = Math.max(0, search.loadingSources - 1);\n                m.redraw();\n              });\n            });\n          }\n\n          state.cache(query);\n          m.redraw();\n        }, 250);\n      })\n\n      .on('focus', function () {\n        $(this)\n          .one('mouseup', (e) => e.preventDefault())\n          .select();\n      });\n  }\n\n  /**\n   * Navigate to the currently selected search result and close the list.\n   */\n  selectResult() {\n    clearTimeout(this.searchTimeout);\n    this.loadingSources = 0;\n\n    if (this.state.getValue()) {\n      m.route.set(this.getItem(this.index).find('a').attr('href'));\n    } else {\n      this.clear();\n    }\n\n    this.$('input').blur();\n  }\n\n  /**\n   * Clear the search\n   */\n  clear() {\n    this.state.clear();\n  }\n\n  /**\n   * Build an item list of SearchSources.\n   *\n   * @return {ItemList}\n   */\n  sourceItems() {\n    const items = new ItemList();\n\n    if (app.forum.attribute('canViewDiscussions')) items.add('discussions', new DiscussionsSearchSource());\n    if (app.forum.attribute('canViewUserList')) items.add('users', new UsersSearchSource());\n\n    return items;\n  }\n\n  /**\n   * Get all of the search result items that are selectable.\n   *\n   * @return {jQuery}\n   */\n  selectableItems() {\n    return this.$('.Search-results > li:not(.Dropdown-header)');\n  }\n\n  /**\n   * Get the position of the currently selected search result item.\n   *\n   * @return {Integer}\n   */\n  getCurrentNumericIndex() {\n    return this.selectableItems().index(this.getItem(this.index));\n  }\n\n  /**\n   * Get the <li> in the search results with the given index (numeric or named).\n   *\n   * @param {String} index\n   * @return {DOMElement}\n   */\n  getItem(index) {\n    const $items = this.selectableItems();\n    let $item = $items.filter(`[data-index=\"${index}\"]`);\n\n    if (!$item.length) {\n      $item = $items.eq(index);\n    }\n\n    return $item;\n  }\n\n  /**\n   * Set the currently-selected search result item to the one with the given\n   * index.\n   *\n   * @param {Integer} index\n   * @param {Boolean} scrollToItem Whether or not to scroll the dropdown so that\n   *     the item is in view.\n   */\n  setIndex(index, scrollToItem) {\n    const $items = this.selectableItems();\n    const $dropdown = $items.parent();\n\n    let fixedIndex = index;\n    if (index < 0) {\n      fixedIndex = $items.length - 1;\n    } else if (index >= $items.length) {\n      fixedIndex = 0;\n    }\n\n    const $item = $items.removeClass('active').eq(fixedIndex).addClass('active');\n\n    this.index = $item.attr('data-index') || fixedIndex;\n\n    if (scrollToItem) {\n      const dropdownScroll = $dropdown.scrollTop();\n      const dropdownTop = $dropdown.offset().top;\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\n      const itemTop = $item.offset().top;\n      const itemBottom = itemTop + $item.outerHeight();\n\n      let scrollTop;\n      if (itemTop < dropdownTop) {\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\n      } else if (itemBottom > dropdownBottom) {\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\n      }\n\n      if (typeof scrollTop !== 'undefined') {\n        $dropdown.stop(true).animate({ scrollTop }, 100);\n      }\n    }\n  }\n}\n\nwindow.flreg.add('components/Search', Search)","import Component from '../../common/Component';\nimport Button from '../../common/components/Button';\nimport SessionDropdown from './SessionDropdown';\nimport SelectDropdown from '../../common/components/SelectDropdown';\nimport NotificationsDropdown from './NotificationsDropdown';\nimport ItemList from '../../common/utils/ItemList';\nimport listItems from '../../common/helpers/listItems';\nimport Search from '../components/Search';\n\n/**\n * The `HeaderSecondary` component displays secondary header controls, such as\n * the search box and the user menu. On the default skin, these are shown on the\n * right side of the header.\n */\nexport default class HeaderSecondary extends Component {\n  view() {\n    return <ul className=\"Header-controls\">{listItems(this.items().toArray())}</ul>;\n  }\n\n  /**\n   * Build an item list for the controls.\n   *\n   * @return {ItemList}\n   */\n  items() {\n    const items = new ItemList();\n\n    const LogInModal = () => import(/* webpackChunkName: \"forum/components/LogInModal\" */ './LogInModal');\n    const SignUpModal = () => import(/* webpackChunkName: \"forum/components/SignUpModal\" */ './SignUpModal');\n\n    items.add('search', Search.component({ state: app.search }), 30);\n\n    if (app.forum.attribute('showLanguageSelector') && Object.keys(app.data.locales).length > 1) {\n      const locales = [];\n\n      for (const locale in app.data.locales) {\n        locales.push(\n          Button.component(\n            {\n              active: app.data.locale === locale,\n              icon: app.data.locale === locale ? 'fas fa-check' : true,\n              onclick: () => {\n                if (app.session.user) {\n                  app.session.user.savePreferences({ locale }).then(() => window.location.reload());\n                } else {\n                  document.cookie = `locale=${locale}; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT`;\n                  window.location.reload();\n                }\n              },\n            },\n            app.data.locales[locale]\n          )\n        );\n      }\n\n      items.add(\n        'locale',\n        SelectDropdown.component(\n          {\n            buttonClassName: 'Button Button--link',\n            accessibleToggleLabel: app.translator.trans('core.forum.header.locale_dropdown_accessible_label'),\n          },\n          locales\n        ),\n        20\n      );\n    }\n\n    if (app.session.user) {\n      items.add('notifications', NotificationsDropdown.component({ state: app.notifications }), 10);\n      items.add('session', SessionDropdown.component(), 0);\n    } else {\n      if (app.forum.attribute('allowSignUp')) {\n        items.add(\n          'signUp',\n          Button.component(\n            {\n              className: 'Button Button--link',\n              onclick: () => app.modal.show(SignUpModal),\n            },\n            app.translator.trans('core.forum.header.sign_up_link')\n          ),\n          10\n        );\n      }\n\n      items.add(\n        'logIn',\n        Button.component(\n          {\n            className: 'Button Button--link',\n            onclick: () => app.modal.show(LogInModal),\n          },\n          app.translator.trans('core.forum.header.log_in_link')\n        ),\n        0\n      );\n    }\n\n    return items;\n  }\n}\n\nwindow.flreg.add('components/HeaderSecondary', HeaderSecondary)","import Button from '../../common/components/Button';\n\n/**\n * The `ComposerButton` component displays a button suitable for the composer\n * controls.\n */\nexport default class ComposerButton extends Button {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    attrs.className = attrs.className || 'Button Button--icon Button--link';\n  }\n}\n\nwindow.flreg.add('components/ComposerButton', ComposerButton)","import Component from '../../common/Component';\nimport subclassOf from '../../common/utils/subclassOf';\nimport Stream from '../../common/utils/Stream';\nimport ReplyComposer from '../components/ReplyComposer';\nimport EditorDriverInterface from '../../common/utils/EditorDriverInterface';\n\nclass ComposerState {\n  constructor() {\n    /**\n     * The composer's current position.\n     *\n     * @type {ComposerState.Position}\n     */\n    this.position = ComposerState.Position.HIDDEN;\n\n    /**\n     * The composer's intended height, which can be modified by the user\n     * (by dragging the composer handle).\n     *\n     * @type {Integer}\n     */\n    this.height = null;\n\n    /**\n     * The dynamic component being shown inside the composer.\n     *\n     * @type {Object}\n     */\n    this.body = { attrs: {} };\n\n    /**\n     * A reference to the text editor that allows text manipulation.\n     *\n     * @type {EditorDriverInterface|null}\n     */\n    this.editor = null;\n\n    this.clear();\n  }\n\n  /**\n   * Load a content component into the composer.\n   *\n   * @param {ComposerBody|Function} componentClass\n   * @public\n   */\n  async load(componentClass, attrs) {\n    if (!(componentClass instanceof Component)) {\n      const componentResolver = await componentClass();\n      componentClass = componentResolver.default;\n    }\n\n    const body = { componentClass, attrs };\n\n    if (this.preventExit()) return;\n\n    // If we load a similar component into the composer, then Mithril will be\n    // able to diff the old/new contents and some DOM-related state from the\n    // old composer will remain. To prevent this from happening, we clear the\n    // component and force a redraw, so that the new component will be working\n    // on a blank slate.\n    if (this.isVisible()) {\n      this.clear();\n      m.redraw.sync();\n    }\n\n    this.body = body;\n  }\n\n  /**\n   * Clear the composer's content component.\n   */\n  clear() {\n    this.position = ComposerState.Position.HIDDEN;\n    this.body = { attrs: {} };\n    this.onExit = null;\n\n    this.fields = {\n      content: Stream(''),\n    };\n\n    if (this.editor) {\n      this.editor.destroy();\n    }\n    this.editor = null;\n  }\n\n  /**\n   * Show the composer.\n   *\n   * @public\n   */\n  show() {\n    if (this.position === ComposerState.Position.NORMAL || this.position === ComposerState.Position.FULLSCREEN) return;\n\n    this.position = ComposerState.Position.NORMAL;\n    m.redraw.sync();\n  }\n\n  /**\n   * Close the composer.\n   *\n   * @public\n   */\n  hide() {\n    this.clear();\n    m.redraw();\n  }\n\n  /**\n   * Confirm with the user so they don't lose their content, then close the\n   * composer.\n   *\n   * @public\n   */\n  close() {\n    if (this.preventExit()) return;\n\n    this.hide();\n  }\n\n  /**\n   * Minimize the composer. Has no effect if the composer is hidden.\n   *\n   * @public\n   */\n  minimize() {\n    if (!this.isVisible()) return;\n\n    this.position = ComposerState.Position.MINIMIZED;\n    m.redraw();\n  }\n\n  /**\n   * Take the composer into fullscreen mode. Has no effect if the composer is\n   * hidden.\n   *\n   * @public\n   */\n  fullScreen() {\n    if (!this.isVisible()) return;\n\n    this.position = ComposerState.Position.FULLSCREEN;\n    m.redraw();\n  }\n\n  /**\n   * Exit fullscreen mode.\n   *\n   * @public\n   */\n  exitFullScreen() {\n    if (this.position !== ComposerState.Position.FULLSCREEN) return;\n\n    this.position = ComposerState.Position.NORMAL;\n    m.redraw();\n  }\n\n  /**\n   * Determine whether the body matches the given component class and data.\n   *\n   * @param {object} type The component class to check against. Subclasses are\n   *                      accepted as well.\n   * @param {object} data\n   * @return {boolean}\n   */\n  bodyMatches(type, data = {}) {\n    // Fail early when the body is of a different type\n    if (!subclassOf(this.body.componentClass, type)) return false;\n\n    // Now that the type is known to be correct, we loop through the provided\n    // data to see whether it matches the data in the attributes for the body.\n    return Object.keys(data).every((key) => this.body.attrs[key] === data[key]);\n  }\n\n  /**\n   * Determine whether or not the Composer is visible.\n   *\n   * True when the composer is displayed on the screen and has a body component.\n   * It could be open in \"normal\" or full-screen mode, or even minimized.\n   *\n   * @returns {boolean}\n   */\n  isVisible() {\n    return this.position !== ComposerState.Position.HIDDEN;\n  }\n\n  /**\n   * Determine whether or not the Composer is covering the screen.\n   *\n   * This will be true if the Composer is in full-screen mode on desktop,\n   * or if we are on a mobile device, where we always consider the composer as full-screen..\n   *\n   * @return {Boolean}\n   * @public\n   */\n  isFullScreen() {\n    return this.position === ComposerState.Position.FULLSCREEN || app.screen() === 'phone';\n  }\n\n  /**\n   * Check whether or not the user is currently composing a reply to a\n   * discussion.\n   *\n   * @param {Discussion} discussion\n   * @return {Boolean}\n   */\n  composingReplyTo(discussion) {\n    return this.isVisible() && this.bodyMatches(ReplyComposer, { discussion });\n  }\n\n  /**\n   * Confirm with the user that they want to close the composer and lose their\n   * content.\n   *\n   * @return {Boolean} Whether or not the exit was cancelled.\n   */\n  preventExit() {\n    if (!this.isVisible()) return;\n    if (!this.onExit) return;\n\n    if (this.onExit.callback()) {\n      return !confirm(this.onExit.message);\n    }\n  }\n\n  /**\n   * Configure when / what to ask the user before closing the composer.\n   *\n   * The provided callback will be used to determine whether asking for\n   * confirmation is necessary. If the callback returns true at the time of\n   * closing, the provided text will be shown in a standard confirmation dialog.\n   *\n   * @param {Function} callback\n   * @param {String} message\n   */\n  preventClosingWhen(callback, message) {\n    this.onExit = { callback, message };\n  }\n\n  /**\n   * Minimum height of the Composer.\n   * @returns {Integer}\n   */\n  minimumHeight() {\n    return 200;\n  }\n\n  /**\n   * Maxmimum height of the Composer.\n   * @returns {Integer}\n   */\n  maximumHeight() {\n    return $(window).height() - $('#header').outerHeight();\n  }\n\n  /**\n   * Computed the composer's current height, based on the intended height, and\n   * the composer's current state. This will be applied to the composer's\n   * content's DOM element.\n   * @returns {Integer|String}\n   */\n  computedHeight() {\n    // If the composer is minimized, then we don't want to set a height; we'll\n    // let the CSS decide how high it is. If it's fullscreen, then we need to\n    // make it as high as the window.\n    if (this.position === ComposerState.Position.MINIMIZED) {\n      return '';\n    } else if (this.position === ComposerState.Position.FULLSCREEN) {\n      return $(window).height();\n    }\n\n    // Otherwise, if it's normal or hidden, then we use the intended height.\n    // We don't let the composer get too small or too big, though.\n    return Math.max(this.minimumHeight(), Math.min(this.height, this.maximumHeight()));\n  }\n}\n\nComposerState.Position = {\n  HIDDEN: 'hidden',\n  NORMAL: 'normal',\n  MINIMIZED: 'minimized',\n  FULLSCREEN: 'fullScreen',\n};\n\nexport default ComposerState;\n\nwindow.flreg.add('states/ComposerState', ComposerState)","import Component from '../../common/Component';\nimport ItemList from '../../common/utils/ItemList';\nimport ComposerButton from './ComposerButton';\nimport listItems from '../../common/helpers/listItems';\nimport classList from '../../common/utils/classList';\nimport ComposerState from '../states/ComposerState';\n\n/**\n * The `Composer` component displays the composer. It can be loaded with a\n * content component with `load` and then its position/state can be altered with\n * `show`, `hide`, `close`, `minimize`, `fullScreen`, and `exitFullScreen`.\n */\nexport default class Composer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The composer's \"state\".\n     *\n     * @type {ComposerState}\n     */\n    this.state = this.attrs.state;\n\n    /**\n     * Whether or not the composer currently has focus.\n     *\n     * @type {Boolean}\n     */\n    this.active = false;\n\n    // Store the initial position so that we can trigger animations correctly.\n    this.prevPosition = this.state.position;\n  }\n\n  view() {\n    const body = this.state.body;\n    const classes = {\n      normal: this.state.position === ComposerState.Position.NORMAL,\n      minimized: this.state.position === ComposerState.Position.MINIMIZED,\n      fullScreen: this.state.position === ComposerState.Position.FULLSCREEN,\n      active: this.active,\n      visible: this.state.isVisible(),\n    };\n\n    // Set up a handler so that clicks on the content will show the composer.\n    const showIfMinimized = this.state.position === ComposerState.Position.MINIMIZED ? this.state.show.bind(this.state) : undefined;\n\n    return (\n      <div className={'Composer ' + classList(classes)}>\n        <div className=\"Composer-handle\" oncreate={this.configHandle.bind(this)} />\n        <ul className=\"Composer-controls\">{listItems(this.controlItems().toArray())}</ul>\n        <div className=\"Composer-content\" onclick={showIfMinimized}>\n          {body.componentClass ? body.componentClass.component({ ...body.attrs, composer: this.state, disabled: classes.minimized }) : ''}\n        </div>\n      </div>\n    );\n  }\n\n  onupdate() {\n    if (this.state.position === this.prevPosition) {\n      // Set the height of the Composer element and its contents on each redraw,\n      // so that they do not lose it if their DOM elements are recreated.\n      this.updateHeight();\n    } else {\n      this.animatePositionChange();\n\n      this.prevPosition = this.state.position;\n    }\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.initializeHeight();\n    this.$().hide().css('bottom', -this.state.computedHeight());\n\n    // Whenever any of the inputs inside the composer are have focus, we want to\n    // add a class to the composer to draw attention to it.\n    this.$().on('focus blur', ':input,.TextEditor-editorContainer', (e) => {\n      this.active = e.type === 'focusin';\n      m.redraw();\n    });\n\n    // When the escape key is pressed on any inputs, close the composer.\n    this.$().on('keydown', ':input,.TextEditor-editorContainer', 'esc', () => this.state.close());\n\n    this.handlers = {};\n\n    $(window)\n      .on('resize', (this.handlers.onresize = this.updateHeight.bind(this)))\n      .resize();\n\n    $(document)\n      .on('mousemove', (this.handlers.onmousemove = this.onmousemove.bind(this)))\n      .on('mouseup', (this.handlers.onmouseup = this.onmouseup.bind(this)));\n  }\n\n  onremove() {\n    $(window).off('resize', this.handlers.onresize);\n\n    $(document).off('mousemove', this.handlers.onmousemove).off('mouseup', this.handlers.onmouseup);\n  }\n\n  /**\n   * Add the necessary event handlers to the composer's handle so that it can\n   * be used to resize the composer.\n   */\n  configHandle(vnode) {\n    const composer = this;\n\n    $(vnode.dom)\n      .css('cursor', 'row-resize')\n      .bind('dragstart mousedown', (e) => e.preventDefault())\n      .mousedown(function (e) {\n        composer.mouseStart = e.clientY;\n        composer.heightStart = composer.$().height();\n        composer.handle = $(this);\n        $('body').css('cursor', 'row-resize');\n      });\n  }\n\n  /**\n   * Resize the composer according to mouse movement.\n   *\n   * @param {Event} e\n   */\n  onmousemove(e) {\n    if (!this.handle) return;\n\n    // Work out how much the mouse has been moved, and set the height\n    // relative to the old one based on that. Then update the content's\n    // height so that it fills the height of the composer, and update the\n    // body's padding.\n    const deltaPixels = this.mouseStart - e.clientY;\n    this.changeHeight(this.heightStart + deltaPixels);\n\n    // Update the body's padding-bottom so that no content on the page will ever\n    // get permanently hidden behind the composer. If the user is already\n    // scrolled to the bottom of the page, then we will keep them scrolled to\n    // the bottom after the padding has been updated.\n    const scrollTop = $(window).scrollTop();\n    const anchorToBottom = scrollTop > 0 && scrollTop + $(window).height() >= $(document).height();\n    this.updateBodyPadding(anchorToBottom);\n  }\n\n  /**\n   * Finish resizing the composer when the mouse is released.\n   */\n  onmouseup() {\n    if (!this.handle) return;\n\n    this.handle = null;\n    $('body').css('cursor', '');\n  }\n\n  /**\n   * Draw focus to the first focusable content element (the text editor).\n   */\n  focus() {\n    this.$('.Composer-content :input:enabled:visible, .TextEditor-editor').first().focus();\n  }\n\n  /**\n   * Update the DOM to reflect the composer's current height. This involves\n   * setting the height of the composer's root element, and adjusting the height\n   * of any flexible elements inside the composer's body.\n   */\n  updateHeight() {\n    const height = this.state.computedHeight();\n    const $flexible = this.$('.Composer-flexible');\n\n    this.$().height(height);\n\n    if ($flexible.length) {\n      const headerHeight = $flexible.offset().top - this.$().offset().top;\n      const paddingBottom = parseInt($flexible.css('padding-bottom'), 10);\n      const footerHeight = this.$('.Composer-footer').outerHeight(true);\n\n      $flexible.height(this.$().outerHeight() - headerHeight - paddingBottom - footerHeight);\n    }\n  }\n\n  /**\n   * Update the amount of padding-bottom on the body so that the page's\n   * content will still be visible above the composer when the page is\n   * scrolled right to the bottom.\n   */\n  updateBodyPadding() {\n    const visible =\n      this.state.position !== ComposerState.Position.HIDDEN && this.state.position !== ComposerState.Position.MINIMIZED && app.screen() !== 'phone';\n\n    const paddingBottom = visible ? this.state.computedHeight() - parseInt($('#app').css('padding-bottom'), 10) : 0;\n\n    $('#content').css({ paddingBottom });\n  }\n\n  /**\n   * Trigger the right animation depending on the desired new position.\n   */\n  animatePositionChange() {\n    // When exiting full-screen mode: focus content\n    if (this.prevPosition === ComposerState.Position.FULLSCREEN && this.state.position === ComposerState.Position.NORMAL) {\n      this.focus();\n      return;\n    }\n\n    switch (this.state.position) {\n      case ComposerState.Position.HIDDEN:\n        return this.hide();\n      case ComposerState.Position.MINIMIZED:\n        return this.minimize();\n      case ComposerState.Position.FULLSCREEN:\n        return this.focus();\n      case ComposerState.Position.NORMAL:\n        return this.show();\n    }\n  }\n\n  /**\n   * Animate the Composer into the new position by changing the height.\n   */\n  animateHeightChange() {\n    const $composer = this.$().stop(true);\n    const oldHeight = $composer.outerHeight();\n    const scrollTop = $(window).scrollTop();\n\n    $composer.show();\n    this.updateHeight();\n\n    const newHeight = $composer.outerHeight();\n\n    if (this.prevPosition === ComposerState.Position.HIDDEN) {\n      $composer.css({ bottom: -newHeight, height: newHeight });\n    } else {\n      $composer.css({ height: oldHeight });\n    }\n\n    const animation = $composer.animate({ bottom: 0, height: newHeight }, 'fast').promise();\n\n    this.updateBodyPadding();\n    $(window).scrollTop(scrollTop);\n    return animation;\n  }\n\n  /**\n   * Show the Composer backdrop.\n   */\n  showBackdrop() {\n    this.$backdrop = $('<div/>').addClass('composer-backdrop').appendTo('body');\n  }\n\n  /**\n   * Hide the Composer backdrop.\n   */\n  hideBackdrop() {\n    if (this.$backdrop) this.$backdrop.remove();\n  }\n\n  /**\n   * Animate the composer sliding up from the bottom to take its normal height.\n   *\n   * @private\n   */\n  show() {\n    this.animateHeightChange().then(() => this.focus());\n\n    if (app.screen() === 'phone') {\n      // On safari fixed position doesn't properly work on mobile,\n      // So we use absolute and set the top value.\n      // https://github.com/flarum/core/issues/2652\n\n      // Due to another safari bug, `scrollTop` is unreliable when\n      // at the very bottom of the page AND opening the composer.\n      // So we fallback to a calculated version of scrollTop.\n      // https://github.com/flarum/core/issues/2683\n      const scrollElement = document.documentElement;\n      const topOfViewport = Math.min(scrollElement.scrollTop, scrollElement.scrollHeight - scrollElement.clientHeight);\n      this.$().css('top', $('.App').is('.mobile-safari') ? topOfViewport : 0);\n      this.showBackdrop();\n    }\n  }\n\n  /**\n   * Animate closing the composer.\n   *\n   * @private\n   */\n  hide() {\n    const $composer = this.$();\n\n    // Animate the composer sliding down off the bottom edge of the viewport.\n    // Only when the animation is completed, update other elements on the page.\n    $composer.stop(true).animate({ bottom: -$composer.height() }, 'fast', () => {\n      $composer.hide();\n      this.hideBackdrop();\n      this.updateBodyPadding();\n    });\n  }\n\n  /**\n   * Shrink the composer until only its title is visible.\n   *\n   * @private\n   */\n  minimize() {\n    this.animateHeightChange();\n\n    this.$().css('top', 'auto');\n    this.hideBackdrop();\n  }\n\n  /**\n   * Build an item list for the composer's controls.\n   *\n   * @return {ItemList}\n   */\n  controlItems() {\n    const items = new ItemList();\n\n    if (this.state.position === ComposerState.Position.FULLSCREEN) {\n      items.add(\n        'exitFullScreen',\n        ComposerButton.component({\n          icon: 'fas fa-compress',\n          title: app.translator.trans('core.forum.composer.exit_full_screen_tooltip'),\n          onclick: this.state.exitFullScreen.bind(this.state),\n        })\n      );\n    } else {\n      if (this.state.position !== ComposerState.Position.MINIMIZED) {\n        items.add(\n          'minimize',\n          ComposerButton.component({\n            icon: 'fas fa-minus minimize',\n            title: app.translator.trans('core.forum.composer.minimize_tooltip'),\n            onclick: this.state.minimize.bind(this.state),\n            itemClassName: 'App-backControl',\n          })\n        );\n\n        items.add(\n          'fullScreen',\n          ComposerButton.component({\n            icon: 'fas fa-expand',\n            title: app.translator.trans('core.forum.composer.full_screen_tooltip'),\n            onclick: this.state.fullScreen.bind(this.state),\n          })\n        );\n      }\n\n      items.add(\n        'close',\n        ComposerButton.component({\n          icon: 'fas fa-times',\n          title: app.translator.trans('core.forum.composer.close_tooltip'),\n          onclick: this.state.close.bind(this.state),\n        })\n      );\n    }\n\n    return items;\n  }\n\n  /**\n   * Initialize default Composer height.\n   */\n  initializeHeight() {\n    this.state.height = localStorage.getItem('composerHeight');\n\n    if (!this.state.height) {\n      this.state.height = this.defaultHeight();\n    }\n  }\n\n  /**\n   * Default height of the Composer in case none is saved.\n   * @returns {Integer}\n   */\n  defaultHeight() {\n    return this.$().height();\n  }\n\n  /**\n   * Save a new Composer height and update the DOM.\n   * @param {Integer} height\n   */\n  changeHeight(height) {\n    this.state.height = height;\n    this.updateHeight();\n\n    localStorage.setItem('composerHeight', this.state.height);\n  }\n}\n\nwindow.flreg.add('components/Composer', Composer)","import DefaultResolver from '../../common/resolvers/DefaultResolver';\nimport DiscussionPage from '../components/DiscussionPage';\n\n/**\n * A custom route resolver for DiscussionPage that generates the same key to all posts\n * on the same discussion. It triggers a scroll when going from one post to another\n * in the same discussion.\n */\nexport default class DiscussionPageResolver extends DefaultResolver {\n  static scrollToPostNumber: string | null = null;\n\n  /**\n   * Remove optional parts of a discussion's slug to keep the substring\n   * that bijectively maps to a discussion object. By default this just\n   * extracts the numerical ID from the slug. If a custom discussion\n   * slugging driver is used, this may need to be overriden.\n   * @param slug\n   */\n  canonicalizeDiscussionSlug(slug: string | undefined) {\n    if (!slug) return;\n    return slug.split('-')[0];\n  }\n\n  /**\n   * @inheritdoc\n   */\n  makeKey() {\n    const params = { ...m.route.param() };\n    if ('near' in params) {\n      delete params.near;\n    }\n    params.id = this.canonicalizeDiscussionSlug(params.id);\n    return this.routeName.replace('.near', '') + JSON.stringify(params);\n  }\n\n  onmatch(args, requestedPath, route) {\n    if (app.current.matches(DiscussionPage) && this.canonicalizeDiscussionSlug(args.id) === this.canonicalizeDiscussionSlug(m.route.param('id'))) {\n      // By default, the first post number of any discussion is 1\n      DiscussionPageResolver.scrollToPostNumber = args.near || '1';\n    }\n\n    return super.onmatch(args, requestedPath, route);\n  }\n\n  render(vnode) {\n    if (DiscussionPageResolver.scrollToPostNumber !== null) {\n      const number = DiscussionPageResolver.scrollToPostNumber;\n      // Scroll after a timeout to avoid clashes with the render.\n      setTimeout(() => app.current.get('stream').goToNumber(number));\n      DiscussionPageResolver.scrollToPostNumber = null;\n    }\n\n    return super.render(vnode);\n  }\n}\n\nwindow.flreg.add('resolvers/DiscussionPageResolver', DiscussionPageResolver)","import Page from '../../common/components/Page';\n\n/**\n * The `NotificationsPage` component shows the notifications list. It is only\n * used on mobile devices where the notifications dropdown is within the drawer.\n */\nexport default class NotificationsPage extends Page {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    app.history.push('notifications');\n\n    import(/* webpackChunkName: \"forum/components/NotificationList\" */ './NotificationList').then((NotificationList) => {\n      this.NotificationList = NotificationList.default;\n      m.redraw();\n    });\n\n    app.notifications.load();\n\n    this.bodyClass = 'App--notifications';\n  }\n\n  view() {\n    const NotificationList = this.NotificationList;\n\n    return <div className=\"NotificationsPage\">{NotificationList ? <NotificationList state={app.notifications} /> : ''}</div>;\n  }\n}\n\nwindow.flreg.add('components/NotificationsPage', NotificationsPage)","import Alert from '../../common/components/Alert';\nimport Button from '../../common/components/Button';\nimport icon from '../../common/helpers/icon';\nimport Component from '../../common/Component';\n\n/**\n * Shows an alert if the user has not yet confirmed their email address.\n *\n * @param {ForumApplication} app\n */\nexport default function alertEmailConfirmation(app) {\n  const user = app.session.user;\n\n  if (!user || user.isEmailConfirmed()) return;\n\n  class ResendButton extends Component {\n    oninit(vnode) {\n      super.oninit(vnode);\n\n      this.loading = false;\n      this.sent = false;\n    }\n\n    view() {\n      return (\n        <Button class=\"Button Button--link\" onclick={this.onclick.bind(this)} loading={this.loading} disabled={this.sent}>\n          {this.sent\n            ? [icon('fas fa-check'), ' ', app.translator.trans('core.forum.user_email_confirmation.sent_message')]\n            : app.translator.trans('core.forum.user_email_confirmation.resend_button')}\n        </Button>\n      );\n    }\n\n    onclick() {\n      this.loading = true;\n      m.redraw();\n\n      app\n        .request({\n          method: 'POST',\n          url: app.forum.attribute('apiUrl') + '/users/' + user.id() + '/send-confirmation',\n        })\n        .then(() => {\n          this.loading = false;\n          this.sent = true;\n          m.redraw();\n        })\n        .catch(() => {\n          this.loading = false;\n          m.redraw();\n        });\n    }\n  }\n\n  class ContainedAlert extends Alert {\n    view(vnode) {\n      const vdom = super.view(vnode);\n      return { ...vdom, children: [<div className=\"container\">{vdom.children}</div>] };\n    }\n  }\n\n  m.mount($('<div/>').insertBefore('#content')[0], {\n    view: () => (\n      <ContainedAlert dismissible={false} controls={[<ResendButton />]}>\n        {app.translator.trans('core.forum.user_email_confirmation.alert_message', { email: <strong>{user.email()}</strong> })}\n      </ContainedAlert>\n    ),\n  });\n}\n\nwindow.flreg.add('utils/alertEmailConfirmation', alertEmailConfirmation)","export default class NotificationListState {\n  constructor(app) {\n    this.app = app;\n\n    this.notificationPages = [];\n\n    this.loading = false;\n\n    this.moreResults = false;\n  }\n\n  clear() {\n    this.notificationPages = [];\n  }\n\n  getNotificationPages() {\n    return this.notificationPages;\n  }\n\n  isLoading() {\n    return this.loading;\n  }\n\n  hasMoreResults() {\n    return this.moreResults;\n  }\n\n  /**\n   * Load notifications into the application's cache if they haven't already\n   * been loaded.\n   */\n  load() {\n    if (this.app.session.user.newNotificationCount()) {\n      this.notificationPages = [];\n    }\n\n    if (this.notificationPages.length > 0) {\n      return;\n    }\n\n    this.app.session.user.pushAttributes({ newNotificationCount: 0 });\n\n    this.loadMore();\n  }\n\n  /**\n   * Load the next page of notification results.\n   *\n   * @public\n   */\n  loadMore() {\n    this.loading = true;\n    m.redraw();\n\n    const params = this.notificationPages.length > 0 ? { page: { offset: this.notificationPages.length * 10 } } : null;\n\n    return this.app.store\n      .find('notifications', params)\n      .then(this.parseResults.bind(this))\n      .catch(() => {})\n      .then(() => {\n        this.loading = false;\n        m.redraw();\n      });\n  }\n\n  /**\n   * Parse results and append them to the notification list.\n   *\n   * @param {Notification[]} results\n   * @return {Notification[]}\n   */\n  parseResults(results) {\n    if (results.length) this.notificationPages.push(results);\n\n    this.moreResults = !!results.payload.links.next;\n\n    return results;\n  }\n\n  /**\n   * Mark all of the notifications as read.\n   */\n  markAllAsRead() {\n    if (this.notificationPages.length === 0) return;\n\n    this.app.session.user.pushAttributes({ unreadNotificationCount: 0 });\n\n    this.notificationPages.forEach((notifications) => {\n      notifications.forEach((notification) => notification.pushAttributes({ isRead: true }));\n    });\n\n    this.app.request({\n      url: this.app.forum.attribute('apiUrl') + '/notifications/read',\n      method: 'POST',\n    });\n  }\n}\n\nwindow.flreg.add('states/NotificationListState', NotificationListState)","export default class SearchState {\n  constructor(cachedSearches = []) {\n    this.cachedSearches = cachedSearches;\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  setValue(value) {\n    this.value = value;\n  }\n\n  /**\n   * Clear the search value.\n   */\n  clear() {\n    this.setValue('');\n  }\n\n  /**\n   * Mark that we have already searched for this query so that we don't\n   * have to ping the endpoint again.\n   */\n  cache(query) {\n    this.cachedSearches.push(query);\n  }\n\n  /**\n   * Check if this query has been searched before.\n   */\n  isCached(query) {\n    return this.cachedSearches.indexOf(query) !== -1;\n  }\n}\n\nwindow.flreg.add('states/SearchState', SearchState)","import setRouteWithForcedRefresh from '../../common/utils/setRouteWithForcedRefresh';\nimport SearchState from './SearchState';\n\nexport default class GlobalSearchState extends SearchState {\n  constructor(cachedSearches = []) {\n    super(cachedSearches);\n  }\n\n  getValue() {\n    if (this.value === undefined) {\n      this.value = this.getInitialSearch() || '';\n    }\n\n    return super.getValue();\n  }\n\n  /**\n   * Clear the search input and the current controller's active search.\n   */\n  clear() {\n    super.clear();\n\n    if (this.getInitialSearch()) {\n      this.clearInitialSearch();\n    } else {\n      m.redraw();\n    }\n  }\n\n  /**\n   * Get URL parameters that stick between filter changes.\n   *\n   * @return {Object}\n   */\n  stickyParams() {\n    return {\n      sort: m.route.param('sort'),\n      q: m.route.param('q'),\n    };\n  }\n\n  /**\n   * Get parameters to pass to the DiscussionList component.\n   *\n   * @return {Object}\n   */\n  params() {\n    const params = this.stickyParams();\n\n    params.filter = m.route.param('filter');\n\n    return params;\n  }\n\n  /**\n   * Redirect to the index page using the given sort parameter.\n   *\n   * @param {String} sort\n   */\n  changeSort(sort) {\n    const params = this.params();\n\n    if (sort === Object.keys(app.discussions.sortMap())[0]) {\n      delete params.sort;\n    } else {\n      params.sort = sort;\n    }\n\n    setRouteWithForcedRefresh(app.route(app.current.get('routeName'), params));\n  }\n\n  /**\n   * Return the current search query, if any. This is implemented to activate\n   * the search box in the header.\n   *\n   * @see Search\n   * @return {String}\n   */\n  getInitialSearch() {\n    return app.current.type && app.current.type.providesInitialSearch && this.params().q;\n  }\n\n  /**\n   * Redirect to the index page without a search filter. This is called when the\n   * 'x' is clicked in the search box in the header.\n   *\n   * @see Search\n   */\n  clearInitialSearch() {\n    const params = this.params();\n    delete params.q;\n\n    setRouteWithForcedRefresh(app.route(app.current.get('routeName'), params));\n  }\n}\n\nwindow.flreg.add('states/GlobalSearchState', GlobalSearchState)","/**\n * @see https://stackoverflow.com/a/31732310\n */\nexport default function isSafariMobile(): boolean {\n  return (\n    'ontouchstart' in window &&\n    navigator.vendor &&\n    navigator.vendor.includes('Apple') &&\n    navigator.userAgent &&\n    !navigator.userAgent.includes('CriOS') &&\n    !navigator.userAgent.includes('FxiOS')\n  );\n}\n\nwindow.flreg.add('utils/isSafariMobile', isSafariMobile)","import History from './utils/History';\nimport Pane from './utils/Pane';\nimport DiscussionPage from './components/DiscussionPage';\nimport HeaderPrimary from './components/HeaderPrimary';\nimport HeaderSecondary from './components/HeaderSecondary';\nimport Composer from './components/Composer';\nimport routes from './routes';\nimport alertEmailConfirmation from './utils/alertEmailConfirmation';\nimport Application from '../common/Application';\nimport Navigation from '../common/components/Navigation';\nimport NotificationListState from './states/NotificationListState';\nimport GlobalSearchState from './states/GlobalSearchState';\nimport DiscussionListState from './states/DiscussionListState';\nimport ComposerState from './states/ComposerState';\nimport isSafariMobile from './utils/isSafariMobile';\n\nexport default class ForumApplication extends Application {\n  /**\n   * An object which controls the state of the page's side pane.\n   *\n   * @type {Pane}\n   */\n  pane = null;\n\n  /**\n   * An object which controls the state of the page's drawer.\n   *\n   * @type {Drawer}\n   */\n  drawer = null;\n\n  /**\n   * The app's history stack, which keeps track of which routes the user visits\n   * so that they can easily navigate back to the previous route.\n   *\n   * @type {History}\n   */\n  history = new History();\n\n  /**\n   * An object which controls the state of the user's notifications.\n   *\n   * @type {NotificationListState}\n   */\n  notifications = new NotificationListState(this);\n\n  /*\n   * An object which stores previously searched queries and provides convenient\n   * tools for retrieving and managing search values.\n   *\n   * @type {GlobalSearchState}\n   */\n  search = new GlobalSearchState();\n\n  /*\n   * An object which controls the state of the composer.\n   */\n  composer = new ComposerState();\n\n  constructor() {\n    super();\n\n    routes(this);\n\n    /**\n     * An object which controls the state of the cached discussion list, which\n     * is used in the index page and the slideout pane.\n     *\n     * @type {DiscussionListState}\n     */\n    this.discussions = new DiscussionListState({}, this);\n  }\n\n  /**\n   * @inheritdoc\n   */\n  mount() {\n    // Get the configured default route and update that route's path to be '/'.\n    // Push the homepage as the first route, so that the user will always be\n    // able to click on the 'back' button to go home, regardless of which page\n    // they started on.\n    const defaultRoute = this.forum.attribute('defaultRoute');\n    let defaultAction = 'index';\n\n    for (const i in this.routes) {\n      if (this.routes[i].path === defaultRoute) defaultAction = i;\n    }\n\n    this.routes[defaultAction].path = '/';\n    this.history.push(defaultAction, this.translator.trans('core.forum.header.back_to_index_tooltip'), '/');\n\n    this.pane = new Pane(document.getElementById('app'));\n\n    m.route.prefix = '';\n    super.mount(this.forum.attribute('basePath'));\n\n    // We mount navigation and header components after the page, so components\n    // like the back button can access the updated state when rendering.\n    m.mount(document.getElementById('app-navigation'), { view: () => Navigation.component({ className: 'App-backControl', drawer: true }) });\n    m.mount(document.getElementById('header-navigation'), Navigation);\n    m.mount(document.getElementById('header-primary'), HeaderPrimary);\n    m.mount(document.getElementById('header-secondary'), HeaderSecondary);\n    m.mount(document.getElementById('composer'), { view: () => Composer.component({ state: this.composer }) });\n\n    alertEmailConfirmation(this);\n\n    // Route the home link back home when clicked. We do not want it to register\n    // if the user is opening it in a new tab, however.\n    $('#home-link').click((e) => {\n      if (e.ctrlKey || e.metaKey || e.which === 2) return;\n      e.preventDefault();\n      app.history.home();\n\n      // Reload the current user so that their unread notification count is refreshed.\n      if (app.session.user) {\n        app.store.find('users', app.session.user.id());\n        m.redraw();\n      }\n    });\n\n    if (isSafariMobile()) {\n      $(() => {\n        $('.App').addClass('mobile-safari');\n      });\n    }\n  }\n\n  /**\n   * Check whether or not the user is currently viewing a discussion.\n   *\n   * @param {Discussion} discussion\n   * @return {Boolean}\n   */\n  async viewingDiscussion(discussion) {\n    return this.current.matches(DiscussionPage.default, { discussion });\n  }\n\n  /**\n   * Callback for when an external authenticator (social login) action has\n   * completed.\n   *\n   * If the payload indicates that the user has been logged in, then the page\n   * will be reloaded. Otherwise, a SignUpModal will be opened, prefilled\n   * with the provided details.\n   *\n   * @param {Object} payload A dictionary of attrs to pass into the sign up\n   *     modal. A truthy `loggedIn` attr indicates that the user has logged\n   *     in, and thus the page is reloaded.\n   * @public\n   */\n  authenticationComplete(payload) {\n    if (payload.loggedIn) {\n      window.location.reload();\n    } else {\n      const SignUpModal = () => import(/* webpackChunkName: \"forum/components/SignUpModal\" */ './components/SignUpModal');\n\n      this.modal.show(SignUpModal, payload);\n    }\n  }\n}\n\nwindow.flreg.add('forum/ForumApplication', ForumApplication)","import DiscussionPageResolver from './resolvers/DiscussionPageResolver';\nimport DiscussionPage from './components/DiscussionPage';\nimport NotificationsPage from './components/NotificationsPage';\n\n/**\n * The `routes` initializer defines the forum app's routes.\n *\n * @param {App} app\n */\nexport default function (app) {\n  const IndexPage = () => import(/* webpackChunkName: \"forum/components/IndexPage\" */ './components/IndexPage');\n  const PostsUserPage = () => import(/* webpackChunkName: \"forum/components/PostsUserPage\" */ './components/PostsUserPage');\n  const DiscussionsUserPage = () => import(/* webpackChunkName: \"forum/components/DiscussionsUserPage\" */ './components/DiscussionsUserPage');\n  const SettingsPage = () => import(/* webpackChunkName: \"forum/components/SettingsPage\" */ './components/SettingsPage');\n\n  app.routes = {\n    index: { path: '/all', component: IndexPage },\n\n    discussion: { path: '/d/:id', component: DiscussionPage, resolverClass: DiscussionPageResolver },\n    'discussion.near': { path: '/d/:id/:near', component: DiscussionPage, resolverClass: DiscussionPageResolver },\n\n    user: { path: '/u/:username', component: PostsUserPage },\n    'user.posts': { path: '/u/:username', component: PostsUserPage },\n    'user.discussions': { path: '/u/:username/discussions', component: DiscussionsUserPage },\n\n    settings: { path: '/settings', component: SettingsPage },\n    notifications: { path: '/notifications', component: NotificationsPage },\n  };\n\n  /**\n   * Generate a URL to a discussion.\n   *\n   * @param {Discussion} discussion\n   * @param {Integer} [near]\n   * @return {String}\n   */\n  app.route.discussion = (discussion, near) => {\n    return app.route(near && near !== 1 ? 'discussion.near' : 'discussion', {\n      id: discussion.slug(),\n      near: near && near !== 1 ? near : undefined,\n    });\n  };\n\n  /**\n   * Generate a URL to a post.\n   *\n   * @param {Post} post\n   * @return {String}\n   */\n  app.route.post = (post) => {\n    return app.route.discussion(post.discussion(), post.number());\n  };\n\n  /**\n   * Generate a URL to a user.\n   *\n   * @param {User} user\n   * @return {String}\n   */\n  app.route.user = (user) => {\n    return app.route('user', {\n      username: user.slug(),\n    });\n  };\n}\n","import Forum from './ForumApplication';\n\nconst app = new Forum();\n\n// @ts-ignore\nwindow.app = app;\n\nexport default app;\n","import Component from '../Component';\n\n/**\n * The `Placeholder` component displays a muted text with some call to action,\n * usually used as an empty state.\n *\n * ### Attrs\n *\n * - `text`\n */\nexport default class Placeholder extends Component {\n  view() {\n    return (\n      <div className=\"Placeholder\">\n        <p>{this.attrs.text}</p>\n      </div>\n    );\n  }\n}\n\nwindow.flreg.add('components/Placeholder', Placeholder)","/**\n * Extend an object's method by running its output through a mutating callback\n * every time it is called.\n *\n * The callback accepts the method's return value and should perform any\n * mutations directly on this value. For this reason, this function will not be\n * effective on methods which return scalar values (numbers, strings, booleans).\n *\n * Care should be taken to extend the correct object  in most cases, a class'\n * prototype will be the desired target of extension, not the class itself.\n *\n * @example\n * extend(Discussion.prototype, 'badges', function(badges) {\n *   // do something with `badges`\n * });\n *\n * @param {Object} object The object that owns the method\n * @param {String} method The name of the method to extend\n * @param {function} callback A callback which mutates the method's output\n */\nexport function extend(object, method, callback) {\n  const original = object[method];\n\n  object[method] = function (...args) {\n    const value = original ? original.apply(this, args) : undefined;\n\n    callback.apply(this, [value].concat(args));\n\n    return value;\n  };\n\n  Object.assign(object[method], original);\n}\n\n/**\n * Override an object's method by replacing it with a new function, so that the\n * new function will be run every time the object's method is called.\n *\n * The replacement function accepts the original method as its first argument,\n * which is like a call to 'super'. Any arguments passed to the original method\n * are also passed to the replacement.\n *\n * Care should be taken to extend the correct object  in most cases, a class'\n * prototype will be the desired target of extension, not the class itself.\n *\n * @example\n * override(Discussion.prototype, 'badges', function(original) {\n *   const badges = original();\n *   // do something with badges\n *   return badges;\n * });\n *\n * @param {Object} object The object that owns the method\n * @param {String} method The name of the method to override\n * @param {function} newMethod The method to replace it with\n */\nexport function override(object, method, newMethod) {\n  const original = object[method];\n\n  object[method] = function (...args) {\n    return newMethod.apply(this, [original.bind(this)].concat(args));\n  };\n\n  Object.assign(object[method], original);\n}\n\nwindow.flreg.add('common/extend', extend)\nwindow.flreg.add('common/override', override)","import * as Mithril from 'mithril';\nimport { truncate } from '../utils/string';\n\n/**\n * The `highlight` helper searches for a word phrase in a string, and wraps\n * matches with the <mark> tag.\n *\n * @param string The string to highlight.\n * @param phrase The word or words to highlight.\n * @param [length] The number of characters to truncate the string to.\n *     The string will be truncated surrounding the first match.\n */\nexport default function highlight(string: string, phrase: string | RegExp, length?: number): Mithril.Vnode<any, any> | string {\n  if (!phrase && !length) return string;\n\n  // Convert the word phrase into a global regular expression (if it isn't\n  // already) so we can search the string for matched.\n  const regexp = phrase instanceof RegExp ? phrase : new RegExp(phrase, 'gi');\n\n  let highlighted = string;\n  let start = 0;\n\n  // If a length was given, the truncate the string surrounding the first match.\n  if (length) {\n    if (phrase) start = Math.max(0, string.search(regexp) - length / 2);\n\n    highlighted = truncate(highlighted, length, start);\n  }\n\n  // Convert the string into HTML entities, then highlight all matches with\n  // <mark> tags. Then we will return the result as a trusted HTML string.\n  highlighted = $('<div/>').text(highlighted).html();\n\n  if (phrase) highlighted = highlighted.replace(regexp, '<mark>$&</mark>');\n\n  return m.trust(highlighted);\n}\n\nwindow.flreg.add('helpers/highlight', highlight)","import dayjs from 'dayjs';\nimport * as Mithril from 'mithril';\nimport humanTimeUtil from '../utils/humanTime';\n\n/**\n * The `humanTime` helper displays a time in a human-friendly time-ago format\n * (e.g. '12 days ago'), wrapped in a <time> tag with other information about\n * the time.\n */\nexport default function humanTime(time: Date): Mithril.Vnode {\n  const d = dayjs(time);\n\n  const datetime = d.format();\n  const full = d.format('LLLL');\n  const ago = humanTimeUtil(time);\n\n  return (\n    <time pubdate datetime={datetime} title={full} data-humantime>\n      {ago}\n    </time>\n  );\n}\n\nwindow.flreg.add('helpers/humanTime', humanTime)","/**\n * The `SubtreeRetainer` class keeps track of a number of pieces of data,\n * comparing the values of these pieces at every iteration.\n *\n * This is useful for preventing redraws to relatively static (or huge)\n * components whose VDOM only depends on very few values, when none of them\n * have changed.\n *\n * @example\n * // Check two callbacks for changes on each update\n * this.subtree = new SubtreeRetainer(\n *   () => this.attrs.post.freshness,\n *   () => this.showing\n * );\n *\n * // Add more callbacks to be checked for updates\n * this.subtree.check(() => this.attrs.user.freshness);\n *\n * // In a component's onbeforeupdate() method:\n * return this.subtree.needsRebuild()\n *\n * @see https://mithril.js.org/lifecycle-methods.html#onbeforeupdate\n */\nexport default class SubtreeRetainer {\n  /**\n   * @param {...callbacks} callbacks Functions returning data to keep track of.\n   */\n  constructor(...callbacks) {\n    this.callbacks = callbacks;\n    this.data = {};\n    // Build the initial data, so it is available when calling\n    // needsRebuild from the onbeforeupdate hook.\n    this.needsRebuild();\n  }\n\n  /**\n   * Return whether any data has changed since the last check.\n   * If so, Mithril needs to re-diff the vnode and its children.\n   *\n   * @return {boolean}\n   * @public\n   */\n  needsRebuild() {\n    let needsRebuild = false;\n\n    this.callbacks.forEach((callback, i) => {\n      const result = callback();\n\n      if (result !== this.data[i]) {\n        this.data[i] = result;\n        needsRebuild = true;\n      }\n    });\n\n    return needsRebuild;\n  }\n\n  /**\n   * Add another callback to be checked.\n   *\n   * @param {...Function} callbacks\n   * @public\n   */\n  check(...callbacks) {\n    this.callbacks = this.callbacks.concat(callbacks);\n    // Update the data cache when new checks are added.\n    this.needsRebuild();\n  }\n\n  /**\n   * Invalidate the subtree, forcing it to be rerendered.\n   *\n   * @public\n   */\n  invalidate() {\n    this.data = {};\n  }\n}\n\nwindow.flreg.add('utils/SubtreeRetainer', SubtreeRetainer)","/**\n * Truncate a string to the given length, appending ellipses if necessary.\n */\nexport function truncate(string: string, length: number, start: number = 0): string {\n  return (start > 0 ? '...' : '') + string.substring(start, start + length) + (string.length > start + length ? '...' : '');\n}\n\n/**\n * Create a slug out of the given string. Non-alphanumeric characters are\n * converted to hyphens.\n *\n * NOTE: This method does not use the comparably sophisticated transliteration\n * mechanism that is employed in the backend. Therefore, it should only be used\n * to *suggest* slugs that can be overridden by the user.\n */\nexport function slug(string: string): string {\n  return string\n    .toLowerCase()\n    .replace(/[^a-z0-9]/gi, '-')\n    .replace(/-+/g, '-')\n    .replace(/-$|^-/g, '');\n}\n\n/**\n * Strip HTML tags and quotes out of the given string, replacing them with\n * meaningful punctuation.\n */\nexport function getPlainContent(string: string): string {\n  const html = string.replace(/(<\\/p>|<br>)/g, '$1 &nbsp;').replace(/<img\\b[^>]*>/gi, ' ');\n\n  const dom = $('<div/>').html(html);\n\n  dom.find(getPlainContent.removeSelectors.join(',')).remove();\n\n  return dom.text().replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * An array of DOM selectors to remove when getting plain content.\n *\n * @type {Array}\n */\ngetPlainContent.removeSelectors = ['blockquote', 'script'];\n\n/**\n * Make a string's first character uppercase.\n */\nexport function ucfirst(string: string): string {\n  return string.substr(0, 1).toUpperCase() + string.substr(1);\n}\n\nwindow.flreg.add('utils/truncate', truncate)\nwindow.flreg.add('utils/slug', slug)\nwindow.flreg.add('utils/getPlainContent', getPlainContent)\nwindow.flreg.add('utils/ucfirst', ucfirst)","import Component from '../Component';\n\n/**\n * The `ConfirmDocumentUnload` component can be used to register a global\n * event handler that prevents closing the browser window/tab based on the\n * return value of a given callback prop.\n *\n * ### Attrs\n *\n * - `when` - a callback returning true when the browser should prompt for\n *            confirmation before closing the window/tab\n *\n * ### Children\n *\n * NOTE: Only the first child will be rendered. (Use this component to wrap\n * another component / DOM element.)\n *\n */\nexport default class ConfirmDocumentUnload extends Component {\n  handler() {\n    return this.attrs.when() || undefined;\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.boundHandler = this.handler.bind(this);\n    $(window).on('beforeunload', this.boundHandler);\n  }\n\n  onremove() {\n    $(window).off('beforeunload', this.boundHandler);\n  }\n\n  view(vnode) {\n    // To avoid having to render another wrapping <div> here, we assume that\n    // this component is only wrapped around a single element / component.\n    return vnode.children[0];\n  }\n}\n\nwindow.flreg.add('components/ConfirmDocumentUnload', ConfirmDocumentUnload)","import Component from '../../common/Component';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport ConfirmDocumentUnload from '../../common/components/ConfirmDocumentUnload';\nimport avatar from '../../common/helpers/avatar';\nimport listItems from '../../common/helpers/listItems';\nimport ItemList from '../../common/utils/ItemList';\n\n/**\n * The `ComposerBody` component handles the body, or the content, of the\n * composer. Subclasses should implement the `onsubmit` method and override\n * `headerTimes`.\n *\n * ### Attrs\n *\n * - `composer`\n * - `originalContent`\n * - `submitLabel`\n * - `placeholder`\n * - `user`\n * - `confirmExit`\n * - `disabled`\n *\n * @abstract\n */\nexport default class ComposerBody extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.composer = this.attrs.composer;\n\n    /**\n     * Whether or not the component is loading.\n     *\n     * @type {Boolean}\n     */\n    this.loading = true;\n\n    import(/* webpackChunkName: \"common/components/TextEditor\" */ '../../common/components/TextEditor').then((TextEditor) => {\n      this.TextEditor = TextEditor.default;\n      this.loading = false;\n      m.redraw();\n    });\n\n    // Let the composer state know to ask for confirmation under certain\n    // circumstances, if the body supports / requires it and has a corresponding\n    // confirmation question to ask.\n    if (this.attrs.confirmExit) {\n      this.composer.preventClosingWhen(() => this.hasChanges(), this.attrs.confirmExit);\n    }\n\n    this.composer.fields.content(this.attrs.originalContent || '');\n  }\n\n  view() {\n    const TextEditor = this.TextEditor;\n\n    return (\n      <ConfirmDocumentUnload when={this.hasChanges.bind(this)}>\n        <div className={'ComposerBody ' + (this.attrs.className || '')}>\n          {avatar(this.attrs.user, { className: 'ComposerBody-avatar' })}\n          <div className=\"ComposerBody-content\">\n            <ul className=\"ComposerBody-header\">{listItems(this.headerItems().toArray())}</ul>\n            <div className=\"ComposerBody-editor\">\n              {TextEditor\n                ? TextEditor.component({\n                    submitLabel: this.attrs.submitLabel,\n                    placeholder: this.attrs.placeholder,\n                    disabled: this.loading || this.attrs.disabled,\n                    composer: this.composer,\n                    preview: this.jumpToPreview && this.jumpToPreview.bind(this),\n                    onchange: this.composer.fields.content,\n                    onsubmit: this.onsubmit.bind(this),\n                    value: this.composer.fields.content(),\n                  })\n                : ''}\n            </div>\n          </div>\n          {LoadingIndicator.component({ className: 'ComposerBody-loading' + (this.loading ? ' active' : '') })}\n        </div>\n      </ConfirmDocumentUnload>\n    );\n  }\n\n  /**\n   * Check if there is any unsaved data.\n   *\n   * @return {String}\n   */\n  hasChanges() {\n    const content = this.composer.fields.content();\n\n    return content && content !== this.attrs.originalContent;\n  }\n\n  /**\n   * Build an item list for the composer's header.\n   *\n   * @return {ItemList}\n   */\n  headerItems() {\n    return new ItemList();\n  }\n\n  /**\n   * Handle the submit event of the text editor.\n   *\n   * @abstract\n   */\n  onsubmit() {}\n\n  /**\n   * Stop loading.\n   */\n  loaded() {\n    this.loading = false;\n    m.redraw();\n  }\n}\n\nwindow.flreg.add('components/ComposerBody', ComposerBody)","/**\n * The `abbreviateNumber` utility converts a number to a shorter localized form.\n *\n * @example\n * abbreviateNumber(1234);\n * // \"1.2K\"\n */\nexport default function abbreviateNumber(number: number): string {\n  // TODO: translation\n  if (number >= 1000000) {\n    return Math.floor(number / 1000000) + app.translator.trans('core.lib.number_suffix.mega_text');\n  } else if (number >= 1000) {\n    return (number / 1000).toFixed(1) + app.translator.trans('core.lib.number_suffix.kilo_text');\n  } else {\n    return number.toString();\n  }\n}\n\nwindow.flreg.add('utils/abbreviateNumber', abbreviateNumber)","import Component from '../../common/Component';\nimport humanTime from '../../common/helpers/humanTime';\nimport icon from '../../common/helpers/icon';\n\n/**\n * Displays information about a the first or last post in a discussion.\n *\n * ### Attrs\n *\n * - `discussion`\n * - `lastPost`\n */\nexport default class TerminalPost extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const lastPost = this.attrs.lastPost && discussion.replyCount();\n\n    const user = discussion[lastPost ? 'lastPostedUser' : 'user']();\n    const time = discussion[lastPost ? 'lastPostedAt' : 'createdAt']();\n\n    return (\n      <span>\n        {lastPost ? icon('fas fa-reply') : ''}{' '}\n        {app.translator.trans('core.forum.discussion_list.' + (lastPost ? 'replied' : 'started') + '_text', {\n          user,\n          ago: humanTime(time),\n        })}\n      </span>\n    );\n  }\n}\n\nwindow.flreg.add('components/TerminalPost', TerminalPost)","/**\n * The `slidable` utility adds touch gestures to an element so that it can be\n * slid away to reveal controls underneath, and then released to activate those\n * controls.\n *\n * It relies on the element having children with particular CSS classes.\n * TODO: document\n *\n * @param {DOMElement} element\n * @return {Object}\n * @property {function} reset Revert the slider to its original position. This\n *     should be called, for example, when a controls dropdown is closed.\n */\nexport default function slidable(element) {\n  const $element = $(element);\n  const threshold = 50;\n\n  let $underneathLeft;\n  let $underneathRight;\n\n  let startX;\n  let startY;\n  let couldBeSliding = false;\n  let isSliding = false;\n  let pos = 0;\n\n  /**\n   * Animate the slider to a new position.\n   *\n   * @param {Integer} newPos\n   * @param {Object} [options]\n   */\n  const animatePos = (newPos, options = {}) => {\n    // Since we can't animate the transform property with jQuery, we'll use a\n    // bit of a workaround. We set up the animation with a step function that\n    // will set the transform property, but then we animate an unused property\n    // (background-position-x) with jQuery.\n    options.duration = options.duration || 'fast';\n    options.step = function (x) {\n      $(this).css('transform', 'translate(' + x + 'px, 0)');\n    };\n\n    $element.find('.Slidable-content').animate({ 'background-position-x': newPos }, options);\n  };\n\n  /**\n   * Revert the slider to its original position.\n   */\n  const reset = () => {\n    animatePos(0, {\n      complete: function () {\n        $element.removeClass('sliding');\n        $underneathLeft.hide();\n        $underneathRight.hide();\n        isSliding = false;\n      },\n    });\n  };\n\n  $element\n    .find('.Slidable-content')\n    .on('touchstart', function (e) {\n      // Update the references to the elements underneath the slider, provided\n      // they're not disabled.\n      $underneathLeft = $element.find('.Slidable-underneath--left:not(.disabled)');\n      $underneathRight = $element.find('.Slidable-underneath--right:not(.disabled)');\n\n      startX = e.originalEvent.targetTouches[0].clientX;\n      startY = e.originalEvent.targetTouches[0].clientY;\n\n      couldBeSliding = true;\n      pos = 0;\n    })\n\n    .on('touchmove', function (e) {\n      const newX = e.originalEvent.targetTouches[0].clientX;\n      const newY = e.originalEvent.targetTouches[0].clientY;\n\n      // Once the user moves their touch in a direction that's more up/down than\n      // left/right, we'll assume they're scrolling the page. But if they do\n      // move in a horizontal direction at first, then we'll lock their touch\n      // into the slider.\n      if (couldBeSliding && Math.abs(newX - startX) > Math.abs(newY - startY)) {\n        isSliding = true;\n      }\n      couldBeSliding = false;\n\n      if (isSliding) {\n        pos = newX - startX;\n\n        // If there are controls underneath the either side, then we'll show/hide\n        // them depending on the slider's position. We also make the controls\n        // icon get a bit bigger the further they slide.\n        const toggle = ($underneath, side) => {\n          if ($underneath.length) {\n            const active = side === 'left' ? pos > 0 : pos < 0;\n\n            if (active && $underneath.hasClass('Slidable-underneath--elastic')) {\n              pos -= pos * 0.5;\n            }\n            $underneath.toggle(active);\n\n            const scale = Math.max(0, Math.min(1, (Math.abs(pos) - 25) / threshold));\n            $underneath.find('.icon').css('transform', 'scale(' + scale + ')');\n          } else {\n            pos = Math[side === 'left' ? 'min' : 'max'](0, pos);\n          }\n        };\n\n        toggle($underneathLeft, 'left');\n        toggle($underneathRight, 'right');\n\n        $(this).css('transform', 'translate(' + pos + 'px, 0)');\n        $(this).css('background-position-x', pos + 'px');\n\n        $element.toggleClass('sliding', !!pos);\n\n        e.preventDefault();\n      }\n    })\n\n    .on('touchend', function () {\n      // If the user releases the touch and the slider is past the threshold\n      // position on either side, then we will activate the control for that\n      // side. We will also animate the slider's position all the way to the\n      // other side, or back to its original position, depending on whether or\n      // not the side is 'elastic'.\n      const activate = ($underneath) => {\n        $underneath.click();\n\n        if ($underneath.hasClass('Slidable-underneath--elastic')) {\n          reset();\n        } else {\n          animatePos((pos > 0 ? 1 : -1) * $element.width());\n        }\n      };\n\n      if ($underneathRight.length && pos < -threshold) {\n        activate($underneathRight);\n      } else if ($underneathLeft.length && pos > threshold) {\n        activate($underneathLeft);\n      } else {\n        reset();\n      }\n\n      couldBeSliding = false;\n      isSliding = false;\n    });\n\n  return { reset };\n}\n\nwindow.flreg.add('utils/slidable', slidable)","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","import toString from './toString.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g,\n    reHasRegExpChar = RegExp(reRegExpChar.source);\n\n/**\n * Escapes the `RegExp` special characters \"^\", \"$\", \"\\\", \".\", \"*\", \"+\",\n * \"?\", \"(\", \")\", \"[\", \"]\", \"{\", \"}\", and \"|\" in `string`.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category String\n * @param {string} [string=''] The string to escape.\n * @returns {string} Returns the escaped string.\n * @example\n *\n * _.escapeRegExp('[lodash](https://lodash.com/)');\n * // => '\\[lodash\\]\\(https://lodash\\.com/\\)'\n */\nfunction escapeRegExp(string) {\n  string = toString(string);\n  return (string && reHasRegExpChar.test(string))\n    ? string.replace(reRegExpChar, '\\\\$&')\n    : string;\n}\n\nexport default escapeRegExp;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","import Component from '../../common/Component';\nimport Link from '../../common/components/Link';\nimport avatar from '../../common/helpers/avatar';\nimport listItems from '../../common/helpers/listItems';\nimport highlight from '../../common/helpers/highlight';\nimport icon from '../../common/helpers/icon';\nimport humanTime from '../../common/utils/humanTime';\nimport ItemList from '../../common/utils/ItemList';\nimport abbreviateNumber from '../../common/utils/abbreviateNumber';\nimport Dropdown from '../../common/components/Dropdown';\nimport TerminalPost from './TerminalPost';\nimport SubtreeRetainer from '../../common/utils/SubtreeRetainer';\nimport DiscussionControls from '../utils/DiscussionControls';\nimport slidable from '../utils/slidable';\nimport extractText from '../../common/utils/extractText';\nimport classList from '../../common/utils/classList';\nimport DiscussionPage from './DiscussionPage';\n\nimport { escapeRegExp } from 'lodash-es';\n/**\n * The `DiscussionListItem` component shows a single discussion in the\n * discussion list.\n *\n * ### Attrs\n *\n * - `discussion`\n * - `params`\n */\nexport default class DiscussionListItem extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * Set up a subtree retainer so that the discussion will not be redrawn\n     * unless new data comes in.\n     *\n     * @type {SubtreeRetainer}\n     */\n    this.subtree = new SubtreeRetainer(\n      () => this.attrs.discussion.freshness,\n      () => {\n        const time = app.session.user && app.session.user.markedAllAsReadAt();\n        return time && time.getTime();\n      },\n      () => this.active()\n    );\n  }\n\n  elementAttrs() {\n    return {\n      className: classList([\n        'DiscussionListItem',\n        this.active() ? 'active' : '',\n        this.attrs.discussion.isHidden() ? 'DiscussionListItem--hidden' : '',\n        'ontouchstart' in window ? 'Slidable' : '',\n      ]),\n    };\n  }\n\n  view() {\n    const discussion = this.attrs.discussion;\n    const user = discussion.user();\n    const isUnread = discussion.isUnread();\n    const isRead = discussion.isRead();\n    const showUnread = !this.showRepliesCount() && isUnread;\n    let jumpTo = 0;\n    const controls = new DiscussionControls().controls(discussion, this).toArray();\n    const attrs = this.elementAttrs();\n\n    if (this.attrs.params.q) {\n      const post = discussion.mostRelevantPost();\n      if (post) {\n        jumpTo = post.number();\n      }\n\n      const phrase = escapeRegExp(this.attrs.params.q);\n      this.highlightRegExp = new RegExp(phrase + '|' + phrase.trim().replace(/\\s+/g, '|'), 'gi');\n    } else {\n      jumpTo = Math.min(discussion.lastPostNumber(), (discussion.lastReadPostNumber() || 0) + 1);\n    }\n\n    return (\n      <div {...attrs}>\n        {controls.length\n          ? Dropdown.component(\n              {\n                icon: 'fas fa-ellipsis-v',\n                className: 'DiscussionListItem-controls',\n                buttonClassName: 'Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right',\n                accessibleToggleLabel: app.translator.trans('core.forum.discussion_controls.toggle_dropdown_accessible_label'),\n              },\n              controls\n            )\n          : ''}\n\n        <span\n          className={'Slidable-underneath Slidable-underneath--left Slidable-underneath--elastic' + (isUnread ? '' : ' disabled')}\n          onclick={this.markAsRead.bind(this)}\n        >\n          {icon('fas fa-check')}\n        </span>\n\n        <div className={'DiscussionListItem-content Slidable-content' + (isUnread ? ' unread' : '') + (isRead ? ' read' : '')}>\n          <Link\n            href={user ? app.route.user(user) : '#'}\n            className=\"DiscussionListItem-author\"\n            title={extractText(\n              app.translator.trans('core.forum.discussion_list.started_text', { user: user, ago: humanTime(discussion.createdAt()) })\n            )}\n            oncreate={function (vnode) {\n              $(vnode.dom).tooltip({ placement: 'right' });\n            }}\n          >\n            {avatar(user, { title: '' })}\n          </Link>\n\n          <ul className=\"DiscussionListItem-badges badges\">{listItems(discussion.badges().toArray())}</ul>\n\n          <Link href={app.route.discussion(discussion, jumpTo)} className=\"DiscussionListItem-main\">\n            <h3 className=\"DiscussionListItem-title\">{highlight(discussion.title(), this.highlightRegExp)}</h3>\n            <ul className=\"DiscussionListItem-info\">{listItems(this.infoItems().toArray())}</ul>\n          </Link>\n\n          <span\n            tabindex=\"0\"\n            role=\"button\"\n            className=\"DiscussionListItem-count\"\n            onclick={this.markAsRead.bind(this)}\n            title={showUnread ? app.translator.trans('core.forum.discussion_list.mark_as_read_tooltip') : ''}\n          >\n            {abbreviateNumber(discussion[showUnread ? 'unreadCount' : 'replyCount']())}\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    // If we're on a touch device, set up the discussion row to be slidable.\n    // This allows the user to drag the row to either side of the screen to\n    // reveal controls.\n    if ('ontouchstart' in window) {\n      const slidableInstance = slidable(this.$());\n\n      this.$('.DiscussionListItem-controls').on('hidden.bs.dropdown', () => slidableInstance.reset());\n    }\n  }\n\n  onbeforeupdate(vnode, old) {\n    super.onbeforeupdate(vnode, old);\n\n    return this.subtree.needsRebuild();\n  }\n\n  /**\n   * Determine whether or not the discussion is currently being viewed.\n   *\n   * @return {Boolean}\n   */\n  active() {\n    return app.current.matches(DiscussionPage, { discussion: this.attrs.discussion });\n  }\n\n  /**\n   * Determine whether or not information about who started the discussion\n   * should be displayed instead of information about the most recent reply to\n   * the discussion.\n   *\n   * @return {Boolean}\n   */\n  showFirstPost() {\n    return ['newest', 'oldest'].indexOf(this.attrs.params.sort) !== -1;\n  }\n\n  /**\n   * Determine whether or not the number of replies should be shown instead of\n   * the number of unread posts.\n   *\n   * @return {Boolean}\n   */\n  showRepliesCount() {\n    return this.attrs.params.sort === 'replies';\n  }\n\n  /**\n   * Mark the discussion as read.\n   */\n  markAsRead() {\n    const discussion = this.attrs.discussion;\n\n    if (discussion.isUnread()) {\n      discussion.save({ lastReadPostNumber: discussion.lastPostNumber() });\n      m.redraw();\n    }\n  }\n\n  /**\n   * Build an item list of info for a discussion listing. By default this is\n   * just the first/last post indicator.\n   *\n   * @return {ItemList}\n   */\n  infoItems() {\n    const items = new ItemList();\n\n    if (this.attrs.params.q) {\n      const post = this.attrs.discussion.mostRelevantPost() || this.attrs.discussion.firstPost();\n\n      if (post && post.contentType() === 'comment') {\n        const excerpt = highlight(post.contentPlain(), this.highlightRegExp, 175);\n        items.add('excerpt', excerpt, -100);\n      }\n    } else {\n      items.add(\n        'terminalPost',\n        TerminalPost.component({\n          discussion: this.attrs.discussion,\n          lastPost: !this.showFirstPost(),\n        })\n      );\n    }\n\n    return items;\n  }\n}\n\nwindow.flreg.add('components/DiscussionListItem', DiscussionListItem)","import Component from '../../common/Component';\nimport DiscussionListItem from './DiscussionListItem';\nimport Button from '../../common/components/Button';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport Placeholder from '../../common/components/Placeholder';\n\n/**\n * The `DiscussionList` component displays a list of discussions.\n *\n * ### Attrs\n *\n * - `state` A DiscussionListState object that represents the discussion lists's state.\n */\nexport default class DiscussionList extends Component {\n  view() {\n    const state = this.attrs.state;\n\n    const params = state.getParams();\n    let loading;\n\n    if (state.isLoading()) {\n      loading = LoadingIndicator.component();\n    } else if (state.moreResults) {\n      loading = Button.component(\n        {\n          className: 'Button',\n          onclick: state.loadMore.bind(state),\n        },\n        app.translator.trans('core.forum.discussion_list.load_more_button')\n      );\n    }\n\n    if (state.empty()) {\n      const text = app.translator.trans('core.forum.discussion_list.empty_text');\n      return <div className=\"DiscussionList\">{Placeholder.component({ text })}</div>;\n    }\n\n    return (\n      <div className={'DiscussionList' + (state.isSearchResults() ? ' DiscussionList--searchResults' : '')}>\n        <ul className=\"DiscussionList-discussions\">\n          {state.discussions.map((discussion) => {\n            return (\n              <li key={discussion.id()} data-id={discussion.id()}>\n                {DiscussionListItem.component({ discussion, params })}\n              </li>\n            );\n          })}\n        </ul>\n        <div className=\"DiscussionList-loadMore\">{loading}</div>\n      </div>\n    );\n  }\n}\n\nwindow.flreg.add('components/DiscussionList', DiscussionList)","import Component from '../../common/Component';\nimport ItemList from '../../common/utils/ItemList';\nimport listItems from '../../common/helpers/listItems';\n\n/**\n * The `DiscussionHero` component displays the hero on a discussion page.\n *\n * ### attrs\n *\n * - `discussion`\n */\nexport default class DiscussionHero extends Component {\n  view() {\n    return (\n      <header className=\"Hero DiscussionHero\">\n        <div className=\"container\">\n          <ul className=\"DiscussionHero-items\">{listItems(this.items().toArray())}</ul>\n        </div>\n      </header>\n    );\n  }\n\n  /**\n   * Build an item list for the contents of the discussion hero.\n   *\n   * @return {ItemList}\n   */\n  items() {\n    const items = new ItemList();\n    const discussion = this.attrs.discussion;\n    const badges = discussion.badges().toArray();\n\n    if (badges.length) {\n      items.add('badges', <ul className=\"DiscussionHero-badges badges\">{listItems(badges)}</ul>, 10);\n    }\n\n    items.add('title', <h2 className=\"DiscussionHero-title\">{discussion.title()}</h2>);\n\n    return items;\n  }\n}\n\nwindow.flreg.add('components/DiscussionHero', DiscussionHero)","import DiscussionList from './DiscussionList';\nimport Component from '../../common/Component';\nimport DiscussionPage from './DiscussionPage';\n\nconst hotEdge = (e) => {\n  if (e.pageX < 10) app.pane.show();\n};\n\n/**\n * The `DiscussionListPane` component displays the list of previously viewed\n * discussions in a panel that can be displayed by moving the mouse to the left\n * edge of the screen, where it can also be pinned in place.\n *\n * ### Attrs\n *\n * - `state` A DiscussionListState object that represents the discussion lists's state.\n */\nexport default class DiscussionListPane extends Component {\n  view() {\n    if (!this.attrs.state.hasDiscussions()) {\n      return;\n    }\n\n    return <div className=\"DiscussionPage-list\">{this.enoughSpace() && <DiscussionList state={this.attrs.state} />}</div>;\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    const $list = $(vnode.dom);\n\n    // When the mouse enters and leaves the discussions pane, we want to show\n    // and hide the pane respectively. We also create a 10px 'hot edge' on the\n    // left of the screen to activate the pane.\n    const pane = app.pane;\n    $list.hover(pane.show.bind(pane), pane.onmouseleave.bind(pane));\n\n    $(document).on('mousemove', hotEdge);\n\n    // When coming from another discussion, scroll to the previous postition\n    // to prevent the discussion list jumping around.\n    if (app.previous.matches(DiscussionPage)) {\n      const top = app.cache.discussionListPaneScrollTop || 0;\n      $list.scrollTop(top);\n    } else {\n      // If the discussion we are viewing is listed in the discussion list, then\n      // we will make sure it is visible in the viewport  if it is not we will\n      // scroll the list down to it.\n      const $discussion = $list.find('.DiscussionListItem.active');\n      if ($discussion.length) {\n        const listTop = $list.offset().top;\n        const listBottom = listTop + $list.outerHeight();\n        const discussionTop = $discussion.offset().top;\n        const discussionBottom = discussionTop + $discussion.outerHeight();\n\n        if (discussionTop < listTop || discussionBottom > listBottom) {\n          $list.scrollTop($list.scrollTop() - listTop + discussionTop);\n        }\n      }\n    }\n  }\n\n  onremove(vnode) {\n    app.cache.discussionListPaneScrollTop = $(vnode.dom).scrollTop();\n    $(document).off('mousemove', hotEdge);\n  }\n\n  /**\n   * Are we on a device that's larger than we consider \"mobile\"?\n   *\n   * @returns {boolean}\n   */\n  enoughSpace() {\n    return !$('.App-navigation').is(':visible');\n  }\n}\n\nwindow.flreg.add('components/DiscussionListPane', DiscussionListPane)","/**\n * The `formatNumber` utility localizes a number into a string with the\n * appropriate punctuation.\n *\n * @example\n * formatNumber(1234);\n * // 1,234\n */\nexport default function formatNumber(number: number): string {\n  return number.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n\nwindow.flreg.add('utils/formatNumber', formatNumber)","import Component from '../../common/Component';\nimport icon from '../../common/helpers/icon';\nimport formatNumber from '../../common/utils/formatNumber';\nimport ScrollListener from '../../common/utils/ScrollListener';\n\n/**\n * The `PostStreamScrubber` component displays a scrubber which can be used to\n * navigate/scrub through a post stream.\n *\n * ### Attrs\n *\n * - `stream`\n * - `className`\n */\nexport default class PostStreamScrubber extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.stream = this.attrs.stream;\n    this.handlers = {};\n\n    this.scrollListener = new ScrollListener(this.updateScrubberValues.bind(this, { fromScroll: true, forceHeightChange: true }));\n  }\n\n  view() {\n    const count = this.stream.count();\n\n    // Index is left blank for performance reasons, it is filled in in updateScubberValues\n    const viewing = app.translator.transChoice('core.forum.post_scrubber.viewing_text', count, {\n      index: <span className=\"Scrubber-index\"></span>,\n      count: <span className=\"Scrubber-count\">{formatNumber(count)}</span>,\n    });\n\n    const unreadCount = this.stream.discussion.unreadCount();\n    const unreadPercent = count ? Math.min(count - this.stream.index, unreadCount) / count : 0;\n\n    function styleUnread(vnode) {\n      const $element = $(vnode.dom);\n      const newStyle = {\n        top: 100 - unreadPercent * 100 + '%',\n        height: unreadPercent * 100 + '%',\n      };\n\n      if (vnode.state.oldStyle) {\n        $element.stop(true).css(vnode.state.oldStyle).animate(newStyle);\n      } else {\n        $element.css(newStyle);\n      }\n\n      vnode.state.oldStyle = newStyle;\n    }\n    const classNames = ['PostStreamScrubber', 'Dropdown'];\n    if (this.attrs.className) classNames.push(this.attrs.className);\n\n    return (\n      <div className={classNames.join(' ')}>\n        <button className=\"Button Dropdown-toggle\" data-toggle=\"dropdown\">\n          {viewing} {icon('fas fa-sort')}\n        </button>\n\n        <div className=\"Dropdown-menu dropdown-menu\">\n          <div className=\"Scrubber\">\n            <a className=\"Scrubber-first\" onclick={this.goToFirst.bind(this)}>\n              {icon('fas fa-angle-double-up')} {app.translator.trans('core.forum.post_scrubber.original_post_link')}\n            </a>\n\n            <div className=\"Scrubber-scrollbar\">\n              <div className=\"Scrubber-before\" />\n              <div className=\"Scrubber-handle\">\n                <div className=\"Scrubber-bar\" />\n                <div className=\"Scrubber-info\">\n                  <strong>{viewing}</strong>\n                  <span className=\"Scrubber-description\"></span>\n                </div>\n              </div>\n              <div className=\"Scrubber-after\" />\n\n              <div className=\"Scrubber-unread\" oncreate={styleUnread} onupdate={styleUnread}>\n                {app.translator.trans('core.forum.post_scrubber.unread_text', { count: unreadCount })}\n              </div>\n            </div>\n\n            <a className=\"Scrubber-last\" onclick={this.goToLast.bind(this)}>\n              {icon('fas fa-angle-double-down')} {app.translator.trans('core.forum.post_scrubber.now_link')}\n            </a>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  onupdate() {\n    if (this.stream.forceUpdateScrubber) {\n      this.stream.forceUpdateScrubber = false;\n      this.stream.loadPromise.then(() => this.updateScrubberValues({ animate: true, forceHeightChange: true }));\n    }\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    // Whenever the window is resized, adjust the height of the scrollbar\n    // so that it fills the height of the sidebar.\n    $(window)\n      .on('resize', (this.handlers.onresize = this.onresize.bind(this)))\n      .resize();\n\n    // When any part of the whole scrollbar is clicked, we want to jump to\n    // that position.\n    this.$('.Scrubber-scrollbar')\n      .bind('click', this.onclick.bind(this))\n\n      // Now we want to make the scrollbar handle draggable. Let's start by\n      // preventing default browser events from messing things up.\n      .bind('dragstart mousedown touchstart', (e) => e.preventDefault());\n\n    // When the mouse is pressed on the scrollbar handle, we capture some\n    // information about its current position. We will store this\n    // information in an object and pass it on to the document's\n    // mousemove/mouseup events later.\n    this.dragging = false;\n    this.mouseStart = 0;\n    this.indexStart = 0;\n\n    this.$('.Scrubber-handle')\n      .bind('mousedown touchstart', this.onmousedown.bind(this))\n\n      // Exempt the scrollbar handle from the 'jump to' click event.\n      .click((e) => e.stopPropagation());\n\n    // When the mouse moves and when it is released, we pass the\n    // information that we captured when the mouse was first pressed onto\n    // some event handlers. These handlers will move the scrollbar/stream-\n    // content as appropriate.\n    $(document)\n      .on('mousemove touchmove', (this.handlers.onmousemove = this.onmousemove.bind(this)))\n      .on('mouseup touchend', (this.handlers.onmouseup = this.onmouseup.bind(this)));\n\n    setTimeout(() => this.scrollListener.start());\n\n    this.stream.loadPromise.then(() => this.updateScrubberValues({ animate: false, forceHeightChange: true }));\n  }\n\n  onremove() {\n    this.scrollListener.stop();\n    $(window).off('resize', this.handlers.onresize);\n\n    $(document).off('mousemove touchmove', this.handlers.onmousemove).off('mouseup touchend', this.handlers.onmouseup);\n  }\n\n  /**\n   * Update the scrollbar's position to reflect the current values of the\n   * index/visible properties.\n   *\n   * @param {Boolean} animate\n   */\n  updateScrubberValues(options = {}) {\n    const index = this.stream.index;\n    const count = this.stream.count();\n    const visible = this.stream.visible || 1;\n    const percentPerPost = this.percentPerPost();\n\n    const $scrubber = this.$();\n    $scrubber.find('.Scrubber-index').text(formatNumber(this.stream.sanitizeIndex(Math.max(1, index))));\n    $scrubber.find('.Scrubber-description').text(this.stream.description);\n    $scrubber.toggleClass('disabled', this.stream.disabled());\n\n    const heights = {};\n    heights.before = Math.max(0, percentPerPost.index * Math.min(index - 1, count - visible));\n    heights.handle = Math.min(100 - heights.before, percentPerPost.visible * visible);\n    heights.after = 100 - heights.before - heights.handle;\n\n    // If the stream is paused, don't change height on scroll, as the viewport is being scrolled by the JS\n    // If a height change animation is already in progress, don't adjust height unless overriden\n    if ((options.fromScroll && this.stream.paused) || (this.adjustingHeight && !options.forceHeightChange)) return;\n\n    const func = options.animate ? 'animate' : 'css';\n    this.adjustingHeight = true;\n    const animationPromises = [];\n    for (const part in heights) {\n      const $part = $scrubber.find(`.Scrubber-${part}`);\n      animationPromises.push(\n        $part\n          .stop(true, true)\n          [func]({ height: heights[part] + '%' }, 'fast')\n          .promise()\n      );\n\n      // jQuery likes to put overflow:hidden, but because the scrollbar handle\n      // has a negative margin-left, we need to override.\n      if (func === 'animate') $part.css('overflow', 'visible');\n    }\n    Promise.all(animationPromises).then(() => (this.adjustingHeight = false));\n  }\n\n  /**\n   * Go to the first post in the discussion.\n   */\n  goToFirst() {\n    this.stream.goToFirst();\n    this.updateScrubberValues({ animate: true, forceHeightChange: true });\n  }\n\n  /**\n   * Go to the last post in the discussion.\n   */\n  goToLast() {\n    this.stream.goToLast();\n    this.updateScrubberValues({ animate: true, forceHeightChange: true });\n  }\n\n  onresize() {\n    // Adjust the height of the scrollbar so that it fills the height of\n    // the sidebar and doesn't overlap the footer.\n    const scrubber = this.$();\n    const scrollbar = this.$('.Scrubber-scrollbar');\n\n    scrollbar.css(\n      'max-height',\n      $(window).height() -\n        scrubber.offset().top +\n        $(window).scrollTop() -\n        parseInt($('#app').css('padding-bottom'), 10) -\n        (scrubber.outerHeight() - scrollbar.outerHeight())\n    );\n  }\n\n  onmousedown(e) {\n    e.redraw = false;\n    this.mouseStart = e.clientY || e.originalEvent.touches[0].clientY;\n    this.indexStart = this.stream.index;\n    this.dragging = true;\n    $('body').css('cursor', 'move');\n    this.$().toggleClass('dragging', this.dragging);\n  }\n\n  onmousemove(e) {\n    if (!this.dragging) return;\n\n    // Work out how much the mouse has moved by - first in pixels, then\n    // convert it to a percentage of the scrollbar's height, and then\n    // finally convert it into an index. Add this delta index onto\n    // the index at which the drag was started, and then scroll there.\n    const deltaPixels = (e.clientY || e.originalEvent.touches[0].clientY) - this.mouseStart;\n    const deltaPercent = (deltaPixels / this.$('.Scrubber-scrollbar').outerHeight()) * 100;\n    const deltaIndex = deltaPercent / this.percentPerPost().index || 0;\n    const newIndex = Math.min(this.indexStart + deltaIndex, this.stream.count() - 1);\n\n    this.stream.index = Math.max(0, newIndex);\n    this.updateScrubberValues();\n  }\n\n  onmouseup() {\n    this.$().toggleClass('dragging', this.dragging);\n    if (!this.dragging) return;\n\n    this.mouseStart = 0;\n    this.indexStart = 0;\n    this.dragging = false;\n    $('body').css('cursor', '');\n\n    this.$().removeClass('open');\n\n    // If the index we've landed on is in a gap, then tell the stream-\n    // content that we want to load those posts.\n    const intIndex = Math.floor(this.stream.index);\n    this.stream.goToIndex(intIndex);\n  }\n\n  onclick(e) {\n    // Calculate the index which we want to jump to based on the click position.\n\n    // 1. Get the offset of the click from the top of the scrollbar, as a\n    //    percentage of the scrollbar's height.\n    const $scrollbar = this.$('.Scrubber-scrollbar');\n    const offsetPixels = (e.pageY || e.originalEvent.touches[0].pageY) - $scrollbar.offset().top + $('body').scrollTop();\n    let offsetPercent = (offsetPixels / $scrollbar.outerHeight()) * 100;\n\n    // 2. We want the handle of the scrollbar to end up centered on the click\n    //    position. Thus, we calculate the height of the handle in percent and\n    //    use that to find a new offset percentage.\n    offsetPercent = offsetPercent - parseFloat($scrollbar.find('.Scrubber-handle')[0].style.height) / 2;\n\n    // 3. Now we can convert the percentage into an index, and tell the stream-\n    //    content component to jump to that index.\n    let offsetIndex = offsetPercent / this.percentPerPost().index;\n    offsetIndex = Math.max(0, Math.min(this.stream.count() - 1, offsetIndex));\n    this.stream.goToIndex(Math.floor(offsetIndex));\n    this.updateScrubberValues({ animate: true, forceHeightChange: true });\n\n    this.$().removeClass('open');\n  }\n\n  /**\n   * Get the percentage of the height of the scrubber that should be allocated\n   * to each post.\n   *\n   * @return {Object}\n   * @property {Number} index The percent per post for posts on either side of\n   *     the visible part of the scrubber.\n   * @property {Number} visible The percent per post for the visible part of the\n   *     scrubber.\n   */\n  percentPerPost() {\n    const count = this.stream.count() || 1;\n    const visible = this.stream.visible || 1;\n\n    // To stop the handle of the scrollbar from getting too small when there\n    // are many posts, we define a minimum percentage height for the handle\n    // calculated from a 50 pixel limit. From this, we can calculate the\n    // minimum percentage per visible post. If this is greater than the actual\n    // percentage per post, then we need to adjust the 'before' percentage to\n    // account for it.\n    const minPercentVisible = (50 / this.$('.Scrubber-scrollbar').outerHeight()) * 100;\n    const percentPerVisiblePost = Math.max(100 / count, minPercentVisible / visible);\n    const percentPerPost = count === visible ? 0 : (100 - percentPerVisiblePost * visible) / (count - visible);\n\n    return {\n      index: percentPerPost,\n      visible: percentPerVisiblePost,\n    };\n  }\n}\n\nwindow.flreg.add('components/PostStreamScrubber', PostStreamScrubber)","import Dropdown from './Dropdown';\nimport Button from './Button';\nimport icon from '../helpers/icon';\n\n/**\n * The `SplitDropdown` component is similar to `Dropdown`, but the first child\n * is displayed as its own button prior to the toggle button.\n */\nexport default class SplitDropdown extends Dropdown {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    attrs.className += ' Dropdown--split';\n    attrs.menuClassName += ' Dropdown-menu--right';\n  }\n\n  getButton(children) {\n    // Make a copy of the attrs of the first child component. We will assign\n    // these attrs to a new button, so that it has exactly the same behaviour as\n    // the first child.\n    const firstChild = this.getFirstChild(children);\n    const buttonAttrs = Object.assign({}, firstChild.attrs);\n    buttonAttrs.className = (buttonAttrs.className || '') + ' SplitDropdown-button Button ' + this.attrs.buttonClassName;\n\n    return [\n      Button.component(buttonAttrs, firstChild.children),\n      <button\n        className={'Dropdown-toggle Button Button--icon ' + this.attrs.buttonClassName}\n        aria-haspopup=\"menu\"\n        aria-label={this.attrs.accessibleToggleLabel}\n        data-toggle=\"dropdown\"\n      >\n        {icon(this.attrs.icon, { className: 'Button-icon' })}\n        {icon('fas fa-caret-down', { className: 'Button-caret' })}\n      </button>,\n    ];\n  }\n\n  /**\n   * Get the first child. If the first child is an array, the first item in that\n   * array will be returned.\n   *\n   * @return {*}\n   * @protected\n   */\n  getFirstChild(children) {\n    let firstChild = children;\n\n    while (firstChild instanceof Array) firstChild = firstChild[0];\n\n    return firstChild;\n  }\n}\n\nwindow.flreg.add('components/SplitDropdown', SplitDropdown)","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n","import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n","import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n","import debounce from './debounce.js';\nimport isObject from './isObject.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nexport default throttle;\n","/**\n * The `anchorScroll` utility saves the scroll position relative to an element,\n * and then restores it after a callback has been run.\n *\n * This is useful if a redraw will change the page's content above the viewport.\n * Normally doing this will result in the content in the viewport being pushed\n * down or pulled up. By wrapping the redraw with this utility, the scroll\n * position can be anchor to an element that is in or below the viewport, so\n * the content in the viewport will stay the same.\n *\n * @param {DOMElement} element The element to anchor the scroll position to.\n * @param {Function} callback The callback to run that will change page content.\n */\nexport default function anchorScroll(element, callback) {\n  const $window = $(window);\n  const relativeScroll = $(element).offset().top - $window.scrollTop();\n\n  callback();\n\n  $window.scrollTop($(element).offset().top - relativeScroll);\n}\n\nwindow.flreg.add('utils/anchorScroll', anchorScroll)","import { throttle } from 'lodash-es';\nimport anchorScroll from '../../common/utils/anchorScroll';\n\nclass PostStreamState {\n  constructor(discussion, includedPosts = []) {\n    /**\n     * The discussion to display the post stream for.\n     *\n     * @type {Discussion}\n     */\n    this.discussion = discussion;\n\n    /**\n     * Whether or not the infinite-scrolling auto-load functionality is\n     * disabled.\n     *\n     * @type {Boolean}\n     */\n    this.paused = false;\n\n    this.loadPageTimeouts = {};\n    this.pagesLoading = 0;\n\n    this.index = 0;\n    this.number = 1;\n\n    /**\n     * The number of posts that are currently visible in the viewport.\n     *\n     * @type {Number}\n     */\n    this.visible = 1;\n\n    /**\n     * The description to render on the scrubber.\n     *\n     * @type {String}\n     */\n    this.description = '';\n\n    /**\n     * When the page is scrolled, goToIndex is called, or the page is loaded,\n     * various listeners result in the scrubber being updated with a new\n     * position and values. However, if goToNumber is called, the scrubber\n     * will not be updated. Accordingly, we add logic to the scrubber's\n     * onupdate to update itself, but only when needed, as indicated by this\n     * property.\n     *\n     * @type {Boolean}\n     */\n    this.forceUpdateScrubber = false;\n\n    this.loadNext = throttle(this._loadNext, 300);\n    this.loadPrevious = throttle(this._loadPrevious, 300);\n\n    this.show(includedPosts);\n  }\n\n  /**\n   * Update the stream so that it loads and includes the latest posts in the\n   * discussion, if the end is being viewed.\n   *\n   * @public\n   */\n  update() {\n    if (!this.viewingEnd()) return Promise.resolve();\n\n    this.visibleEnd = this.count();\n\n    return this.loadRange(this.visibleStart, this.visibleEnd);\n  }\n\n  /**\n   * Load and scroll up to the first post in the discussion.\n   *\n   * @return {Promise}\n   */\n  goToFirst() {\n    return this.goToIndex(0);\n  }\n\n  /**\n   * Load and scroll down to the last post in the discussion.\n   *\n   * @return {Promise}\n   */\n  goToLast() {\n    return this.goToIndex(this.count() - 1, true);\n  }\n\n  /**\n   * Load and scroll to a post with a certain number.\n   *\n   * @param {number|String} number The post number to go to. If 'reply', go to\n   *     the last post and scroll the reply preview into view.\n   * @param {Boolean} noAnimation\n   * @return {Promise}\n   */\n  goToNumber(number, noAnimation = false) {\n    // If we want to go to the reply preview, then we will go to the end of the\n    // discussion and then scroll to the very bottom of the page.\n    if (number === 'reply') {\n      const resultPromise = this.goToLast();\n      this.targetPost.reply = true;\n      return resultPromise;\n    }\n\n    this.paused = true;\n\n    this.loadPromise = this.loadNearNumber(number);\n\n    this.needsScroll = true;\n    this.targetPost = { number };\n    this.animateScroll = !noAnimation;\n    this.number = number;\n\n    // In this case, the redraw is only called after the response has been loaded\n    // because we need to know the indices of the post range before we can\n    // start scrolling to items. Calling redraw early causes issues.\n    // Since this is only used for external navigation to the post stream, the delay\n    // before the stream is moved is not an issue.\n    return this.loadPromise.then(() => m.redraw());\n  }\n\n  /**\n   * Load and scroll to a certain index within the discussion.\n   *\n   * @param {number} index\n   * @param {Boolean} noAnimation\n   * @return {Promise}\n   */\n  goToIndex(index, noAnimation = false) {\n    this.paused = true;\n\n    this.loadPromise = this.loadNearIndex(index);\n\n    this.needsScroll = true;\n    this.targetPost = { index };\n    this.animateScroll = !noAnimation;\n    this.index = index;\n\n    m.redraw();\n\n    return this.loadPromise;\n  }\n\n  /**\n   * Clear the stream and load posts near a certain number. Returns a promise.\n   * If the post with the given number is already loaded, the promise will be\n   * resolved immediately.\n   *\n   * @param {number} number\n   * @return {Promise}\n   */\n  loadNearNumber(number) {\n    if (this.posts().some((post) => post && Number(post.number()) === Number(number))) {\n      return Promise.resolve();\n    }\n\n    this.reset();\n\n    return app.store\n      .find('posts', {\n        filter: { discussion: this.discussion.id() },\n        page: { near: number },\n      })\n      .then(this.show.bind(this));\n  }\n\n  /**\n   * Clear the stream and load posts near a certain index. A page of posts\n   * surrounding the given index will be loaded. Returns a promise. If the given\n   * index is already loaded, the promise will be resolved immediately.\n   *\n   * @param {number} index\n   * @return {Promise}\n   */\n  loadNearIndex(index) {\n    if (index >= this.visibleStart && index < this.visibleEnd) {\n      return Promise.resolve();\n    }\n\n    const start = this.sanitizeIndex(index - this.constructor.loadCount / 2);\n    const end = start + this.constructor.loadCount;\n\n    this.reset(start, end);\n\n    return this.loadRange(start, end).then(this.show.bind(this));\n  }\n\n  /**\n   * Load the next page of posts.\n   */\n  _loadNext() {\n    const start = this.visibleEnd;\n    const end = (this.visibleEnd = this.sanitizeIndex(this.visibleEnd + this.constructor.loadCount));\n\n    // Unload the posts which are two pages back from the page we're currently\n    // loading.\n    const twoPagesAway = start - this.constructor.loadCount * 2;\n    if (twoPagesAway > this.visibleStart && twoPagesAway >= 0) {\n      this.visibleStart = twoPagesAway + this.constructor.loadCount + 1;\n\n      if (this.loadPageTimeouts[twoPagesAway]) {\n        clearTimeout(this.loadPageTimeouts[twoPagesAway]);\n        this.loadPageTimeouts[twoPagesAway] = null;\n        this.pagesLoading--;\n      }\n    }\n\n    this.loadPage(start, end);\n  }\n\n  /**\n   * Load the previous page of posts.\n   */\n  _loadPrevious() {\n    const end = this.visibleStart;\n    const start = (this.visibleStart = this.sanitizeIndex(this.visibleStart - this.constructor.loadCount));\n\n    // Unload the posts which are two pages back from the page we're currently\n    // loading.\n    const twoPagesAway = start + this.constructor.loadCount * 2;\n    if (twoPagesAway < this.visibleEnd && twoPagesAway <= this.count()) {\n      this.visibleEnd = twoPagesAway;\n\n      if (this.loadPageTimeouts[twoPagesAway]) {\n        clearTimeout(this.loadPageTimeouts[twoPagesAway]);\n        this.loadPageTimeouts[twoPagesAway] = null;\n        this.pagesLoading--;\n      }\n    }\n\n    this.loadPage(start, end, true);\n  }\n\n  /**\n   * Load a page of posts into the stream and redraw.\n   *\n   * @param {number} start\n   * @param {number} end\n   * @param {Boolean} backwards\n   */\n  loadPage(start, end, backwards = false) {\n    this.pagesLoading++;\n\n    const redraw = () => {\n      if (start < this.visibleStart || end > this.visibleEnd) return;\n\n      const anchorIndex = backwards ? this.visibleEnd - 1 : this.visibleStart;\n      anchorScroll(`.PostStream-item[data-index=\"${anchorIndex}\"]`, m.redraw.sync);\n    };\n    redraw();\n\n    this.loadPageTimeouts[start] = setTimeout(\n      () => {\n        this.loadRange(start, end).then(() => {\n          redraw();\n          this.pagesLoading--;\n        });\n        this.loadPageTimeouts[start] = null;\n      },\n      this.pagesLoading - 1 ? 1000 : 0\n    );\n  }\n\n  /**\n   * Load and inject the specified range of posts into the stream, without\n   * clearing it.\n   *\n   * @param {number} start\n   * @param {number} end\n   * @return {Promise}\n   */\n  loadRange(start, end) {\n    const loadIds = [];\n    const loaded = [];\n\n    this.discussion\n      .postIds()\n      .slice(start, end)\n      .forEach((id) => {\n        const post = app.store.getById('posts', id);\n\n        if (post && post.discussion() && typeof post.canEdit() !== 'undefined') {\n          loaded.push(post);\n        } else {\n          loadIds.push(id);\n        }\n      });\n\n    if (loadIds.length) {\n      return app.store.find('posts', loadIds).then((newPosts) => {\n        return loaded.concat(newPosts).sort((a, b) => a.createdAt() - b.createdAt());\n      });\n    }\n\n    return Promise.resolve(loaded);\n  }\n\n  /**\n   * Set up the stream with the given array of posts.\n   *\n   * @param {Post[]} posts\n   */\n  show(posts) {\n    this.visibleStart = posts.length ? this.discussion.postIds().indexOf(posts[0].id()) : 0;\n    this.visibleEnd = this.sanitizeIndex(this.visibleStart + posts.length);\n  }\n\n  /**\n   * Reset the stream so that a specific range of posts is displayed. If a range\n   * is not specified, the first page of posts will be displayed.\n   *\n   * @param {number} [start]\n   * @param {number} [end]\n   */\n  reset(start, end) {\n    this.visibleStart = start || 0;\n    this.visibleEnd = this.sanitizeIndex(end || this.constructor.loadCount);\n  }\n\n  /**\n   * Get the visible page of posts.\n   *\n   * @return {Post[]}\n   */\n  posts() {\n    return this.discussion\n      .postIds()\n      .slice(this.visibleStart, this.visibleEnd)\n      .map((id) => {\n        const post = app.store.getById('posts', id);\n\n        return post && post.discussion() && typeof post.canEdit() !== 'undefined' ? post : null;\n      });\n  }\n\n  /**\n   * Get the total number of posts in the discussion.\n   *\n   * @return {number}\n   */\n  count() {\n    return this.discussion.postIds().length;\n  }\n\n  /**\n   * Check whether or not the scrubber should be disabled, i.e. if all of the\n   * posts are visible in the viewport.\n   *\n   * @return {Boolean}\n   */\n  disabled() {\n    return this.visible >= this.count();\n  }\n\n  /**\n   * Are we currently viewing the end of the discussion?\n   *\n   * @return {boolean}\n   */\n  viewingEnd() {\n    // In some cases, such as if we've stickied a post, an event post\n    // may have been added / removed. This means that `this.visibleEnd`\n    // and`this.count()` will be out of sync by 1 post, but we are still\n    // \"viewing the end\" of the post stream, so we should still reload\n    // all posts up until the last one.\n    return Math.abs(this.count() - this.visibleEnd) <= 1;\n  }\n\n  /**\n   * Make sure that the given index is not outside of the possible range of\n   * indexes in the discussion.\n   *\n   * @param {number} index\n   */\n  sanitizeIndex(index) {\n    return Math.max(0, Math.min(this.count(), Math.floor(index)));\n  }\n}\n\n/**\n * The number of posts to load per page.\n *\n * @type {number}\n */\nPostStreamState.loadCount = 20;\n\nexport default PostStreamState;\n\nwindow.flreg.add('states/PostStreamState', PostStreamState)","import Page from '../../common/components/Page';\nimport ItemList from '../../common/utils/ItemList';\nimport DiscussionHero from './DiscussionHero';\nimport DiscussionListPane from './DiscussionListPane';\nimport PostStreamScrubber from './PostStreamScrubber';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport SplitDropdown from '../../common/components/SplitDropdown';\nimport listItems from '../../common/helpers/listItems';\nimport DiscussionControls from '../utils/DiscussionControls';\nimport PostStreamState from '../states/PostStreamState';\n\n/**\n * The `DiscussionPage` component displays a whole discussion page, including\n * the discussion list pane, the hero, the posts, and the sidebar.\n */\nexport default class DiscussionPage extends Page {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.useBrowserScrollRestoration = false;\n\n    /**\n     * The discussion that is being viewed.\n     *\n     * @type {Discussion}\n     */\n    this.discussion = null;\n\n    /**\n     * The number of the first post that is currently visible in the viewport.\n     *\n     * @type {number}\n     */\n    this.near = m.route.param('near') || 0;\n\n    this.load();\n\n    // If the discussion list has been loaded, then we'll enable the pane (and\n    // hide it by default). Also, if we've just come from another discussion\n    // page, then we don't want Mithril to redraw the whole page  if it did,\n    // then the pane would redraw which would be slow and would cause problems with\n    // event handlers.\n    if (app.discussions.hasDiscussions()) {\n      app.pane.enable();\n      app.pane.hide();\n    }\n\n    app.history.push('discussion');\n\n    this.bodyClass = 'App--discussion';\n  }\n\n  onremove() {\n    super.onremove();\n    // If we are indeed navigating away from this discussion, then disable the\n    // discussion list pane. Also, if we're composing a reply to this\n    // discussion, minimize the composer  unless it's empty, in which case\n    // we'll just close it.\n    app.pane.disable();\n\n    if (app.composer.composingReplyTo(this.discussion) && !app.composer.fields.content()) {\n      app.composer.hide();\n    } else {\n      app.composer.minimize();\n    }\n  }\n\n  view() {\n    const discussion = this.discussion;\n\n    const PostStream = this.PostStream;\n\n    return (\n      <div className=\"DiscussionPage\">\n        <DiscussionListPane state={app.discussions} />\n        <div className=\"DiscussionPage-discussion\">\n          {discussion\n            ? [\n                DiscussionHero.component({ discussion }),\n                <div className=\"container\">\n                  <nav className=\"DiscussionPage-nav\">\n                    <ul>{listItems(this.sidebarItems().toArray())}</ul>\n                  </nav>\n                  <div className=\"DiscussionPage-stream\">\n                    {PostStream ? (\n                      <PostStream discussion={discussion} stream={this.stream} onPositionChange={this.positionChanged.bind(this)} />\n                    ) : (\n                      LoadingIndicator.component({ className: 'LoadingIndicator--block' })\n                    )}\n                  </div>\n                </div>,\n              ]\n            : LoadingIndicator.component({ className: 'LoadingIndicator--block' })}\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Load the discussion from the API or use the preloaded one.\n   */\n  load() {\n    import(/* webpackChunkName: \"forum/components/PostStream\" */ './PostStream').then((PostStream) => {\n      this.PostStream = PostStream.default;\n      m.redraw();\n    });\n\n    const preloadedDiscussion = app.preloadedApiDocument();\n    if (preloadedDiscussion) {\n      // We must wrap this in a setTimeout because if we are mounting this\n      // component for the first time on page load, then any calls to m.redraw\n      // will be ineffective and thus any configs (scroll code) will be run\n      // before stuff is drawn to the page.\n      setTimeout(this.show.bind(this, preloadedDiscussion), 0);\n    } else {\n      const params = this.requestParams();\n\n      app.store.find('discussions', m.route.param('id'), params).then(this.show.bind(this));\n    }\n\n    m.redraw();\n  }\n\n  /**\n   * Get the parameters that should be passed in the API request to get the\n   * discussion.\n   *\n   * @return {Object}\n   */\n  requestParams() {\n    return {\n      bySlug: true,\n      page: { near: this.near },\n    };\n  }\n\n  /**\n   * Initialize the component to display the given discussion.\n   *\n   * @param {Discussion} discussion\n   */\n  show(discussion) {\n    app.history.push('discussion', discussion.title());\n    app.setTitle(discussion.title());\n    app.setTitleCount(0);\n\n    // When the API responds with a discussion, it will also include a number of\n    // posts. Some of these posts are included because they are on the first\n    // page of posts we want to display (determined by the `near` parameter) \n    // others may be included because due to other relationships introduced by\n    // extensions. We need to distinguish the two so we don't end up displaying\n    // the wrong posts. We do so by filtering out the posts that don't have\n    // the 'discussion' relationship linked, then sorting and splicing.\n    let includedPosts = [];\n    if (discussion.payload && discussion.payload.included) {\n      const discussionId = discussion.id();\n\n      includedPosts = discussion.payload.included\n        .filter(\n          (record) =>\n            record.type === 'posts' &&\n            record.relationships &&\n            record.relationships.discussion &&\n            record.relationships.discussion.data.id === discussionId\n        )\n        .map((record) => app.store.getById('posts', record.id))\n        .sort((a, b) => a.createdAt() - b.createdAt())\n        .slice(0, 20);\n    }\n\n    // Set up the post stream for this discussion, along with the first page of\n    // posts we want to display. Tell the stream to scroll down and highlight\n    // the specific post that was routed to.\n    this.stream = new PostStreamState(discussion, includedPosts);\n    this.stream.goToNumber(m.route.param('near') || (includedPosts[0] && includedPosts[0].number()), true).then(() => {\n      this.discussion = discussion;\n\n      app.current.set('discussion', discussion);\n      app.current.set('stream', this.stream);\n    });\n  }\n\n  /**\n   * Build an item list for the contents of the sidebar.\n   *\n   * @return {ItemList}\n   */\n  sidebarItems() {\n    const items = new ItemList();\n\n    items.add(\n      'controls',\n      SplitDropdown.component(\n        {\n          icon: 'fas fa-ellipsis-v',\n          className: 'App-primaryControl',\n          buttonClassName: 'Button--primary',\n          accessibleToggleLabel: app.translator.trans('core.forum.discussion_controls.toggle_dropdown_accessible_label'),\n        },\n        new DiscussionControls().controls(this.discussion, this).toArray()\n      )\n    );\n\n    items.add(\n      'scrubber',\n      PostStreamScrubber.component({\n        stream: this.stream,\n        className: 'App-titleControl',\n      }),\n      -100\n    );\n\n    return items;\n  }\n\n  /**\n   * When the posts that are visible in the post stream change (i.e. the user\n   * scrolls up or down), then we update the URL and mark the posts as read.\n   *\n   * @param {Integer} startNumber\n   * @param {Integer} endNumber\n   */\n  positionChanged(startNumber, endNumber) {\n    const discussion = this.discussion;\n\n    // Construct a URL to this discussion with the updated position, then\n    // replace it into the window's history and our own history stack.\n    const url = app.route.discussion(discussion, (this.near = startNumber));\n\n    window.history.replaceState(null, document.title, url);\n    app.history.push('discussion', discussion.title());\n\n    // If the user hasn't read past here before, then we'll update their read\n    // state and redraw.\n    if (app.session.user && endNumber > (discussion.lastReadPostNumber() || 0)) {\n      discussion.save({ lastReadPostNumber: endNumber });\n      m.redraw();\n    }\n  }\n}\n\nwindow.flreg.add('components/DiscussionPage', DiscussionPage)","import ComposerBody from './ComposerBody';\nimport Button from '../../common/components/Button';\nimport Link from '../../common/components/Link';\nimport icon from '../../common/helpers/icon';\nimport extractText from '../../common/utils/extractText';\n\nfunction minimizeComposerIfFullScreen(e) {\n  if (app.composer.isFullScreen()) {\n    app.composer.minimize();\n    e.stopPropagation();\n  }\n}\n\n/**\n * The `ReplyComposer` component displays the composer content for replying to a\n * discussion.\n *\n * ### Attrs\n *\n * - All of the attrs of ComposerBody\n * - `discussion`\n */\nexport default class ReplyComposer extends ComposerBody {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    attrs.placeholder = attrs.placeholder || extractText(app.translator.trans('core.forum.composer_reply.body_placeholder'));\n    attrs.submitLabel = attrs.submitLabel || app.translator.trans('core.forum.composer_reply.submit_button');\n    attrs.confirmExit = attrs.confirmExit || extractText(app.translator.trans('core.forum.composer_reply.discard_confirmation'));\n  }\n\n  headerItems() {\n    const items = super.headerItems();\n    const discussion = this.attrs.discussion;\n\n    items.add(\n      'title',\n      <h3>\n        {icon('fas fa-reply')}{' '}\n        <Link href={app.route.discussion(discussion)} onclick={minimizeComposerIfFullScreen}>\n          {discussion.title()}\n        </Link>\n      </h3>\n    );\n\n    return items;\n  }\n\n  /**\n   * Jump to the preview when triggered by the text editor.\n   */\n  jumpToPreview(e) {\n    minimizeComposerIfFullScreen(e);\n\n    m.route.set(app.route.discussion(this.attrs.discussion, 'reply'));\n  }\n\n  /**\n   * Get the data to submit to the server when the reply is saved.\n   *\n   * @return {Object}\n   */\n  data() {\n    return {\n      content: this.composer.fields.content(),\n      relationships: { discussion: this.attrs.discussion },\n    };\n  }\n\n  onsubmit() {\n    const discussion = this.attrs.discussion;\n\n    this.loading = true;\n    m.redraw();\n\n    const data = this.data();\n\n    app.store\n      .createRecord('posts')\n      .save(data)\n      .then((post) => {\n        // If we're currently viewing the discussion which this reply was made\n        // in, then we can update the post stream and scroll to the post.\n        if (app.viewingDiscussion(discussion)) {\n          const stream = app.current.get('stream');\n          stream.update().then(() => stream.goToNumber(post.number()));\n        } else {\n          // Otherwise, we'll create an alert message to inform the user that\n          // their reply has been posted, containing a button which will\n          // transition to their new post when clicked.\n          let alert;\n          const viewButton = Button.component(\n            {\n              className: 'Button Button--link',\n              onclick: () => {\n                m.route.set(app.route.post(post));\n                app.alerts.dismiss(alert);\n              },\n            },\n            app.translator.trans('core.forum.composer_reply.view_button')\n          );\n          alert = app.alerts.show(\n            {\n              type: 'success',\n              controls: [viewButton],\n            },\n            app.translator.trans('core.forum.composer_reply.posted_message')\n          );\n        }\n\n        this.composer.hide();\n      }, this.loaded.bind(this));\n  }\n}\n\nwindow.flreg.add('components/ReplyComposer', ReplyComposer)","export default class DiscussionListState {\n  constructor(params = {}, app = window.app) {\n    this.params = params;\n\n    this.app = app;\n\n    this.discussions = [];\n\n    this.moreResults = false;\n\n    this.loading = false;\n  }\n\n  /**\n   * Get the parameters that should be passed in the API request to get\n   * discussion results.\n   *\n   * @api\n   */\n  requestParams() {\n    const params = { include: ['user', 'lastPostedUser'], filter: {} };\n\n    params.sort = this.sortMap()[this.params.sort];\n\n    if (this.params.q) {\n      params.filter.q = this.params.q;\n\n      params.include.push('mostRelevantPost', 'mostRelevantPost.user');\n    }\n\n    return params;\n  }\n\n  /**\n   * Get a map of sort keys (which appear in the URL, and are used for\n   * translation) to the API sort value that they represent.\n   */\n  sortMap() {\n    const map = {};\n\n    if (this.params.q) {\n      map.relevance = '';\n    }\n    map.latest = '-lastPostedAt';\n    map.top = '-commentCount';\n    map.newest = '-createdAt';\n    map.oldest = 'createdAt';\n\n    return map;\n  }\n\n  /**\n   * Get the search parameters.\n   */\n  getParams() {\n    return this.params;\n  }\n\n  /**\n   * Clear cached discussions.\n   */\n  clear() {\n    this.discussions = [];\n    m.redraw();\n  }\n\n  /**\n   * If there are no cached discussions or the new params differ from the\n   * old ones, update params and refresh the discussion list from the database.\n   */\n  refreshParams(newParams) {\n    if (!this.hasDiscussions() || Object.keys(newParams).some((key) => this.getParams()[key] !== newParams[key])) {\n      this.params = newParams;\n\n      this.refresh();\n    }\n  }\n\n  /**\n   * Clear and reload the discussion list. Passing the option `deferClear: true`\n   * will clear discussions only after new data has been received.\n   * This can be used to refresh discussions without loading animations.\n   */\n  refresh({ deferClear = false } = {}) {\n    this.loading = true;\n\n    if (!deferClear) {\n      this.clear();\n    }\n\n    return this.loadResults().then(\n      (results) => {\n        // This ensures that any changes made while waiting on this request\n        // are ignored. Otherwise, we could get duplicate discussions.\n        // We don't use `this.clear()` to avoid an unnecessary redraw.\n        this.discussions = [];\n        this.parseResults(results);\n      },\n      () => {\n        this.loading = false;\n        m.redraw();\n      }\n    );\n  }\n\n  /**\n   * Load a new page of discussion results.\n   *\n   * @param offset The index to start the page at.\n   */\n  loadResults(offset) {\n    const preloadedDiscussions = this.app.preloadedApiDocument();\n\n    if (preloadedDiscussions) {\n      return Promise.resolve(preloadedDiscussions);\n    }\n\n    const params = this.requestParams();\n    params.page = { offset };\n    params.include = params.include.join(',');\n\n    return this.app.store.find('discussions', params);\n  }\n\n  /**\n   * Load the next page of discussion results.\n   */\n  loadMore() {\n    this.loading = true;\n\n    this.loadResults(this.discussions.length).then(this.parseResults.bind(this));\n  }\n\n  /**\n   * Parse results and append them to the discussion list.\n   */\n  parseResults(results) {\n    this.discussions.push(...results);\n\n    this.loading = false;\n    this.moreResults = !!results.payload.links && !!results.payload.links.next;\n\n    m.redraw();\n\n    return results;\n  }\n\n  /**\n   * Remove a discussion from the list if it is present.\n   */\n  removeDiscussion(discussion) {\n    const index = this.discussions.indexOf(discussion);\n\n    if (index !== -1) {\n      this.discussions.splice(index, 1);\n    }\n\n    m.redraw();\n  }\n\n  /**\n   * Add a discussion to the top of the list.\n   */\n  addDiscussion(discussion) {\n    this.discussions.unshift(discussion);\n    m.redraw();\n  }\n\n  /**\n   * Are there discussions stored in the discussion list state?\n   */\n  hasDiscussions() {\n    return this.discussions.length > 0;\n  }\n\n  /**\n   * Are discussions currently being loaded?\n   */\n  isLoading() {\n    return this.loading;\n  }\n\n  /**\n   * In the last request, has the user searched for a discussion?\n   */\n  isSearchResults() {\n    return !!this.params.q;\n  }\n\n  /**\n   * Have the search results come up empty?\n   */\n  empty() {\n    return !this.hasDiscussions() && !this.isLoading();\n  }\n}\n\nwindow.flreg.add('states/DiscussionListState', DiscussionListState)","import Modal from '../../common/components/Modal';\nimport Button from '../../common/components/Button';\nimport Stream from '../../common/utils/Stream';\n\n/**\n * The 'RenameDiscussionModal' displays a modal dialog with an input to rename a discussion\n */\nexport default class RenameDiscussionModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.discussion = this.attrs.discussion;\n    this.currentTitle = this.attrs.currentTitle;\n    this.newTitle = Stream(this.currentTitle);\n  }\n\n  className() {\n    return 'RenameDiscussionModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans('core.forum.rename_discussion.title');\n  }\n\n  content() {\n    return (\n      <div className=\"Modal-body\">\n        <div className=\"Form Form--centered\">\n          <div className=\"Form-group\">\n            <input className=\"FormControl\" bidi={this.newTitle} type=\"text\" />\n          </div>\n          <div className=\"Form-group\">\n            {Button.component(\n              {\n                className: 'Button Button--primary Button--block',\n                type: 'submit',\n                loading: this.loading,\n              },\n              app.translator.trans('core.forum.rename_discussion.submit_button')\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const title = this.newTitle();\n    const currentTitle = this.currentTitle;\n\n    // If the title is different to what it was before, then save it. After the\n    // save has completed, update the post stream as there will be a new post\n    // indicating that the discussion was renamed.\n    if (title && title !== currentTitle) {\n      return this.discussion\n        .save({ title })\n        .then(() => {\n          if (app.viewingDiscussion(this.discussion)) {\n            app.current.get('stream').update();\n          }\n          m.redraw();\n          this.hide();\n        })\n        .catch(() => {\n          this.loading = false;\n          m.redraw();\n        });\n    } else {\n      this.hide();\n    }\n  }\n}\n\nwindow.flreg.add('components/RenameDiscussionModal', RenameDiscussionModal)","import DiscussionPage from '../components/DiscussionPage';\nimport Button from '../../common/components/Button';\nimport Separator from '../../common/components/Separator';\nimport RenameDiscussionModal from '../components/RenameDiscussionModal';\nimport ItemList from '../../common/utils/ItemList';\nimport extractText from '../../common/utils/extractText';\n\n/**\n * The `DiscussionControls` utility constructs a list of buttons for a\n * discussion which perform actions on it.\n */\nexport default class DiscussionControls {\n  /**\n   * Get a list of controls for a discussion.\n   *\n   * @param {Discussion} discussion\n   * @param {*} context The parent component under which the controls menu will\n   *     be displayed.\n   * @return {ItemList}\n   * @public\n   */\n  controls(discussion, context) {\n    const items = new ItemList();\n\n    ['user', 'moderation', 'destructive'].forEach((section) => {\n      const controls = this[section + 'Controls'](discussion, context).toArray();\n      if (controls.length) {\n        controls.forEach((item) => items.add(item.itemName, item));\n        items.add(section + 'Separator', Separator.component());\n      }\n    });\n\n    return items;\n  }\n\n  /**\n   * Get controls for a discussion pertaining to the current user (e.g. reply,\n   * follow).\n   *\n   * @param {Discussion} discussion\n   * @param {*} context The parent component under which the controls menu will\n   *     be displayed.\n   * @return {ItemList}\n   * @protected\n   */\n  userControls(discussion, context) {\n    const items = new ItemList();\n\n    // Only add a reply control if this is the discussion's controls dropdown\n    // for the discussion page itself. We don't want it to show up for\n    // discussions in the discussion list, etc.\n    if (context instanceof DiscussionPage) {\n      items.add(\n        'reply',\n        !app.session.user || discussion.canReply()\n          ? Button.component(\n              {\n                icon: 'fas fa-reply',\n                onclick: () => {\n                  // If the user is not logged in, the promise rejects, and a login modal shows up.\n                  // Since that's already handled, we dont need to show an error message in the console.\n                  return this.replyAction\n                    .bind(discussion)(true, false)\n                    .catch(() => {});\n                },\n              },\n              app.translator.trans(\n                app.session.user ? 'core.forum.discussion_controls.reply_button' : 'core.forum.discussion_controls.log_in_to_reply_button'\n              )\n            )\n          : Button.component(\n              {\n                icon: 'fas fa-reply',\n                className: 'disabled',\n                title: app.translator.trans('core.forum.discussion_controls.cannot_reply_text'),\n              },\n              app.translator.trans('core.forum.discussion_controls.cannot_reply_button')\n            )\n      );\n    }\n\n    return items;\n  }\n\n  /**\n   * Get controls for a discussion pertaining to moderation (e.g. rename, lock).\n   *\n   * @param {Discussion} discussion\n   * @param {*} context The parent component under which the controls menu will\n   *     be displayed.\n   * @return {ItemList}\n   * @protected\n   */\n  moderationControls(discussion) {\n    const items = new ItemList();\n\n    if (discussion.canRename()) {\n      items.add(\n        'rename',\n        Button.component(\n          {\n            icon: 'fas fa-pencil-alt',\n            onclick: this.renameAction.bind(discussion),\n          },\n          app.translator.trans('core.forum.discussion_controls.rename_button')\n        )\n      );\n    }\n\n    return items;\n  }\n\n  /**\n   * Get controls for a discussion which are destructive (e.g. delete).\n   *\n   * @param {Discussion} discussion\n   * @param {*} context The parent component under which the controls menu will\n   *     be displayed.\n   * @return {ItemList}\n   * @protected\n   */\n  destructiveControls(discussion) {\n    const items = new ItemList();\n\n    if (!discussion.isHidden()) {\n      if (discussion.canHide()) {\n        items.add(\n          'hide',\n          Button.component(\n            {\n              icon: 'far fa-trash-alt',\n              onclick: this.hideAction.bind(discussion),\n            },\n            app.translator.trans('core.forum.discussion_controls.delete_button')\n          )\n        );\n      }\n    } else {\n      if (discussion.canHide()) {\n        items.add(\n          'restore',\n          Button.component(\n            {\n              icon: 'fas fa-reply',\n              onclick: this.restoreAction.bind(discussion),\n            },\n            app.translator.trans('core.forum.discussion_controls.restore_button')\n          )\n        );\n      }\n\n      if (discussion.canDelete()) {\n        items.add(\n          'delete',\n          Button.component(\n            {\n              icon: 'fas fa-times',\n              onclick: this.deleteAction.bind(discussion),\n            },\n            app.translator.trans('core.forum.discussion_controls.delete_forever_button')\n          )\n        );\n      }\n    }\n\n    return items;\n  }\n\n  /**\n   * Open the reply composer for the discussion. A promise will be returned,\n   * which resolves when the composer opens successfully. If the user is not\n   * logged in, they will be prompted. If they don't have permission to\n   * reply, the promise will be rejected.\n   *\n   * @param {Boolean} goToLast Whether or not to scroll down to the last post if\n   *     the discussion is being viewed.\n   * @param {Boolean} forceRefresh Whether or not to force a reload of the\n   *     composer component, even if it is already open for this discussion.\n   * @return {Promise}\n   */\n  replyAction(goToLast, forceRefresh) {\n    const LogInModal = () => import(/* webpackChunkName: \"forum/components/LogInModal\" */ '../components/LogInModal');\n    const ReplyComposer = () => import(/* webpackChunkName: \"forum/components/ReplyComposer\" */ '../components/ReplyComposer');\n\n    return new Promise(async (resolve, reject) => {\n      if (app.session.user) {\n        if (this.canReply()) {\n          if (!app.composer.composingReplyTo(this) || forceRefresh) {\n            await app.composer.load(ReplyComposer, {\n              user: app.session.user,\n              discussion: this,\n            });\n          }\n          console.log('hi');\n          app.composer.show();\n\n          if (goToLast && app.viewingDiscussion(this) && !app.composer.isFullScreen()) {\n            app.current.get('stream').goToNumber('reply');\n          }\n\n          return resolve(app.composer);\n        } else {\n          return reject();\n        }\n      }\n\n      app.modal.show(LogInModal);\n\n      return reject();\n    });\n  }\n\n  /**\n   * Hide a discussion.\n   *\n   * @return {Promise}\n   */\n  hideAction() {\n    this.pushAttributes({ hiddenAt: new Date(), hiddenUser: app.session.user });\n\n    return this.save({ isHidden: true });\n  }\n\n  /**\n   * Restore a discussion.\n   *\n   * @return {Promise}\n   */\n  restoreAction() {\n    this.pushAttributes({ hiddenAt: null, hiddenUser: null });\n\n    return this.save({ isHidden: false });\n  }\n\n  /**\n   * Delete the discussion after confirming with the user.\n   *\n   * @return {Promise}\n   */\n  deleteAction() {\n    if (confirm(extractText(app.translator.trans('core.forum.discussion_controls.delete_confirmation')))) {\n      // If we're currently viewing the discussion that was deleted, go back\n      // to the previous page.\n      if (app.viewingDiscussion(this)) {\n        app.history.back();\n      }\n\n      return this.delete().then(() => app.discussions.removeDiscussion(this));\n    }\n  }\n\n  /**\n   * Rename the discussion.\n   *\n   * @return {Promise}\n   */\n  renameAction() {\n    return app.modal.show(RenameDiscussionModal, {\n      currentTitle: this.title(),\n      discussion: this,\n    });\n  }\n}\n\nwindow.flreg.add('utils/DiscussionControls', DiscussionControls)","/*!\r\n * Color Thief v2.0\r\n * by Lokesh Dhakar - http://www.lokeshdhakar.com\r\n *\r\n * Thanks\r\n * ------\r\n * Nick Rabinowitz - For creating quantize.js.\r\n * John Schulz - For clean up and optimization. @JFSIII\r\n * Nathan Spady - For adding drag and drop support to the demo page.\r\n *\r\n * License\r\n * -------\r\n * Copyright 2011, 2015 Lokesh Dhakar\r\n * Released under the MIT license\r\n * https://raw.githubusercontent.com/lokesh/color-thief/master/LICENSE\r\n *\r\n */\r\nvar CanvasImage=function(a){this.canvas=document.createElement(\"canvas\"),this.context=this.canvas.getContext(\"2d\"),document.body.appendChild(this.canvas),this.width=this.canvas.width=a.width,this.height=this.canvas.height=a.height,this.context.drawImage(a,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(a){this.context.putImageData(a,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};/*!\r\n * quantize.js Copyright 2008 Nick Rabinowitz.\r\n * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php\r\n */\r\n/*!\r\n * Block below copied from Protovis: http://mbostock.github.com/protovis/\r\n * Copyright 2010 Stanford Visualization Group\r\n * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php\r\n */\r\nif(ColorThief.prototype.getColor=function(a,b){var c=this.getPalette(a,5,b),d=c[0];return d},ColorThief.prototype.getPalette=function(a,b,c){\"undefined\"==typeof b&&(b=10),(\"undefined\"==typeof c||1>c)&&(c=10);for(var d,e,f,g,h,i=new CanvasImage(a),j=i.getImageData(),k=j.data,l=i.getPixelCount(),m=[],n=0;l>n;n+=c)d=4*n,e=k[d+0],f=k[d+1],g=k[d+2],h=k[d+3],h>=125&&(e>250&&f>250&&g>250||m.push([e,f,g]));var o=MMCQ.quantize(m,b),p=o?o.palette():null;return i.removeCanvas(),p},!pv)var pv={map:function(a,b){var c={};return b?a.map(function(a,d){return c.index=d,b.call(c,a)}):a.slice()},naturalOrder:function(a,b){return b>a?-1:a>b?1:0},sum:function(a,b){var c={};return a.reduce(b?function(a,d,e){return c.index=e,a+b.call(c,d)}:function(a,b){return a+b},0)},max:function(a,b){return Math.max.apply(null,b?pv.map(a,b):a)}};var MMCQ=function(){function a(a,b,c){return(a<<2*i)+(b<<i)+c}function b(a){function b(){c.sort(a),d=!0}var c=[],d=!1;return{push:function(a){c.push(a),d=!1},peek:function(a){return d||b(),void 0===a&&(a=c.length-1),c[a]},pop:function(){return d||b(),c.pop()},size:function(){return c.length},map:function(a){return c.map(a)},debug:function(){return d||b(),c}}}function c(a,b,c,d,e,f,g){var h=this;h.r1=a,h.r2=b,h.g1=c,h.g2=d,h.b1=e,h.b2=f,h.histo=g}function d(){this.vboxes=new b(function(a,b){return pv.naturalOrder(a.vbox.count()*a.vbox.volume(),b.vbox.count()*b.vbox.volume())})}function e(b){var c,d,e,f,g=1<<3*i,h=new Array(g);return b.forEach(function(b){d=b[0]>>j,e=b[1]>>j,f=b[2]>>j,c=a(d,e,f),h[c]=(h[c]||0)+1}),h}function f(a,b){var d,e,f,g=1e6,h=0,i=1e6,k=0,l=1e6,m=0;return a.forEach(function(a){d=a[0]>>j,e=a[1]>>j,f=a[2]>>j,g>d?g=d:d>h&&(h=d),i>e?i=e:e>k&&(k=e),l>f?l=f:f>m&&(m=f)}),new c(g,h,i,k,l,m,b)}function g(b,c){function d(a){var b,d,e,f,g,h=a+\"1\",j=a+\"2\",k=0;for(i=c[h];i<=c[j];i++)if(o[i]>n/2){for(e=c.copy(),f=c.copy(),b=i-c[h],d=c[j]-i,g=d>=b?Math.min(c[j]-1,~~(i+d/2)):Math.max(c[h],~~(i-1-b/2));!o[g];)g++;for(k=p[g];!k&&o[g-1];)k=p[--g];return e[j]=g,f[h]=e[j]+1,[e,f]}}if(c.count()){var e=c.r2-c.r1+1,f=c.g2-c.g1+1,g=c.b2-c.b1+1,h=pv.max([e,f,g]);if(1==c.count())return[c.copy()];var i,j,k,l,m,n=0,o=[],p=[];if(h==e)for(i=c.r1;i<=c.r2;i++){for(l=0,j=c.g1;j<=c.g2;j++)for(k=c.b1;k<=c.b2;k++)m=a(i,j,k),l+=b[m]||0;n+=l,o[i]=n}else if(h==f)for(i=c.g1;i<=c.g2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.b1;k<=c.b2;k++)m=a(j,i,k),l+=b[m]||0;n+=l,o[i]=n}else for(i=c.b1;i<=c.b2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.g1;k<=c.g2;k++)m=a(j,k,i),l+=b[m]||0;n+=l,o[i]=n}return o.forEach(function(a,b){p[b]=n-a}),d(h==e?\"r\":h==f?\"g\":\"b\")}}function h(a,c){function h(a,b){for(var c,d=1,e=0;k>e;)if(c=a.pop(),c.count()){var f=g(i,c),h=f[0],j=f[1];if(!h)return;if(a.push(h),j&&(a.push(j),d++),d>=b)return;if(e++>k)return}else a.push(c),e++}if(!a.length||2>c||c>256)return!1;var i=e(a),j=0;i.forEach(function(){j++});var m=f(a,i),n=new b(function(a,b){return pv.naturalOrder(a.count(),b.count())});n.push(m),h(n,l*c);for(var o=new b(function(a,b){return pv.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});n.size();)o.push(n.pop());h(o,c-o.size());for(var p=new d;o.size();)p.push(o.pop());return p}var i=5,j=8-i,k=1e3,l=.75;return c.prototype={volume:function(a){var b=this;return(!b._volume||a)&&(b._volume=(b.r2-b.r1+1)*(b.g2-b.g1+1)*(b.b2-b.b1+1)),b._volume},count:function(b){var c=this,d=c.histo;if(!c._count_set||b){var e,f,g,h=0;for(e=c.r1;e<=c.r2;e++)for(f=c.g1;f<=c.g2;f++)for(g=c.b1;g<=c.b2;g++)index=a(e,f,g),h+=d[index]||0;c._count=h,c._count_set=!0}return c._count},copy:function(){var a=this;return new c(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},avg:function(b){var c=this,d=c.histo;if(!c._avg||b){var e,f,g,h,j,k=0,l=1<<8-i,m=0,n=0,o=0;for(f=c.r1;f<=c.r2;f++)for(g=c.g1;g<=c.g2;g++)for(h=c.b1;h<=c.b2;h++)j=a(f,g,h),e=d[j]||0,k+=e,m+=e*(f+.5)*l,n+=e*(g+.5)*l,o+=e*(h+.5)*l;k?c._avg=[~~(m/k),~~(n/k),~~(o/k)]:c._avg=[~~(l*(c.r1+c.r2+1)/2),~~(l*(c.g1+c.g2+1)/2),~~(l*(c.b1+c.b2+1)/2)]}return c._avg},contains:function(a){var b=this,c=a[0]>>j;return gval=a[1]>>j,bval=a[2]>>j,c>=b.r1&&c<=b.r2&&gval>=b.g1&&gval<=b.g2&&bval>=b.b1&&bval<=b.b2}},d.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var b=this.vboxes,c=0;c<b.size();c++)if(b.peek(c).vbox.contains(a))return b.peek(c).color;return this.nearest(a)},nearest:function(a){for(var b,c,d,e=this.vboxes,f=0;f<e.size();f++)c=Math.sqrt(Math.pow(a[0]-e.peek(f).color[0],2)+Math.pow(a[1]-e.peek(f).color[1],2)+Math.pow(a[2]-e.peek(f).color[2],2)),(b>c||void 0===b)&&(b=c,d=e.peek(f).color);return d},forcebw:function(){var a=this.vboxes;a.sort(function(a,b){return pv.naturalOrder(pv.sum(a.color),pv.sum(b.color))});var b=a[0].color;b[0]<5&&b[1]<5&&b[2]<5&&(a[0].color=[0,0,0]);var c=a.length-1,d=a[c].color;d[0]>251&&d[1]>251&&d[2]>251&&(a[c].color=[255,255,255])}},{quantize:h}}();\r\nmodule.exports = ColorThief;\r\n","var ___EXPOSE_LOADER_IMPORT___ = require(\"-!./color-thief.min.js\");\nvar ___EXPOSE_LOADER_GET_GLOBAL_THIS___ = require(\"../../expose-loader/dist/runtime/getGlobalThis.js\");\nvar ___EXPOSE_LOADER_GLOBAL_THIS___ = ___EXPOSE_LOADER_GET_GLOBAL_THIS___;\nif (typeof ___EXPOSE_LOADER_GLOBAL_THIS___[\"ColorThief\"] === 'undefined') ___EXPOSE_LOADER_GLOBAL_THIS___[\"ColorThief\"] = ___EXPOSE_LOADER_IMPORT___;\nmodule.exports = ___EXPOSE_LOADER_IMPORT___;\n","var ___EXPOSE_LOADER_IMPORT___ = require(\"-!./punycode.es6.js\");\nvar ___EXPOSE_LOADER_GET_GLOBAL_THIS___ = require(\"../expose-loader/dist/runtime/getGlobalThis.js\");\nvar ___EXPOSE_LOADER_GLOBAL_THIS___ = ___EXPOSE_LOADER_GET_GLOBAL_THIS___;\nif (typeof ___EXPOSE_LOADER_GLOBAL_THIS___[\"punycode\"] === 'undefined') ___EXPOSE_LOADER_GLOBAL_THIS___[\"punycode\"] = ___EXPOSE_LOADER_IMPORT___;\nmodule.exports = ___EXPOSE_LOADER_IMPORT___;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","'use strict';\n\n/** Highest positive signed 32-bit float value */\nconst maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1\n\n/** Bootstring parameters */\nconst base = 36;\nconst tMin = 1;\nconst tMax = 26;\nconst skew = 38;\nconst damp = 700;\nconst initialBias = 72;\nconst initialN = 128; // 0x80\nconst delimiter = '-'; // '\\x2D'\n\n/** Regular expressions */\nconst regexPunycode = /^xn--/;\nconst regexNonASCII = /[^\\0-\\x7E]/; // non-ASCII chars\nconst regexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g; // RFC 3490 separators\n\n/** Error messages */\nconst errors = {\n\t'overflow': 'Overflow: input needs wider integers to process',\n\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t'invalid-input': 'Invalid input'\n};\n\n/** Convenience shortcuts */\nconst baseMinusTMin = base - tMin;\nconst floor = Math.floor;\nconst stringFromCharCode = String.fromCharCode;\n\n/*--------------------------------------------------------------------------*/\n\n/**\n * A generic error utility function.\n * @private\n * @param {String} type The error type.\n * @returns {Error} Throws a `RangeError` with the applicable error message.\n */\nfunction error(type) {\n\tthrow new RangeError(errors[type]);\n}\n\n/**\n * A generic `Array#map` utility function.\n * @private\n * @param {Array} array The array to iterate over.\n * @param {Function} callback The function that gets called for every array\n * item.\n * @returns {Array} A new array of values returned by the callback function.\n */\nfunction map(array, fn) {\n\tconst result = [];\n\tlet length = array.length;\n\twhile (length--) {\n\t\tresult[length] = fn(array[length]);\n\t}\n\treturn result;\n}\n\n/**\n * A simple `Array#map`-like wrapper to work with domain name strings or email\n * addresses.\n * @private\n * @param {String} domain The domain name or email address.\n * @param {Function} callback The function that gets called for every\n * character.\n * @returns {Array} A new string of characters returned by the callback\n * function.\n */\nfunction mapDomain(string, fn) {\n\tconst parts = string.split('@');\n\tlet result = '';\n\tif (parts.length > 1) {\n\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t// the local part (i.e. everything up to `@`) intact.\n\t\tresult = parts[0] + '@';\n\t\tstring = parts[1];\n\t}\n\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\tstring = string.replace(regexSeparators, '\\x2E');\n\tconst labels = string.split('.');\n\tconst encoded = map(labels, fn).join('.');\n\treturn result + encoded;\n}\n\n/**\n * Creates an array containing the numeric code points of each Unicode\n * character in the string. While JavaScript uses UCS-2 internally,\n * this function will convert a pair of surrogate halves (each of which\n * UCS-2 exposes as separate characters) into a single code point,\n * matching UTF-16.\n * @see `punycode.ucs2.encode`\n * @see <https://mathiasbynens.be/notes/javascript-encoding>\n * @memberOf punycode.ucs2\n * @name decode\n * @param {String} string The Unicode input string (UCS-2).\n * @returns {Array} The new array of code points.\n */\nfunction ucs2decode(string) {\n\tconst output = [];\n\tlet counter = 0;\n\tconst length = string.length;\n\twhile (counter < length) {\n\t\tconst value = string.charCodeAt(counter++);\n\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t// It's a high surrogate, and there is a next character.\n\t\t\tconst extra = string.charCodeAt(counter++);\n\t\t\tif ((extra & 0xFC00) == 0xDC00) { // Low surrogate.\n\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t} else {\n\t\t\t\t// It's an unmatched surrogate; only append this code unit, in case the\n\t\t\t\t// next code unit is the high surrogate of a surrogate pair.\n\t\t\t\toutput.push(value);\n\t\t\t\tcounter--;\n\t\t\t}\n\t\t} else {\n\t\t\toutput.push(value);\n\t\t}\n\t}\n\treturn output;\n}\n\n/**\n * Creates a string based on an array of numeric code points.\n * @see `punycode.ucs2.decode`\n * @memberOf punycode.ucs2\n * @name encode\n * @param {Array} codePoints The array of numeric code points.\n * @returns {String} The new Unicode string (UCS-2).\n */\nconst ucs2encode = array => String.fromCodePoint(...array);\n\n/**\n * Converts a basic code point into a digit/integer.\n * @see `digitToBasic()`\n * @private\n * @param {Number} codePoint The basic numeric code point value.\n * @returns {Number} The numeric value of a basic code point (for use in\n * representing integers) in the range `0` to `base - 1`, or `base` if\n * the code point does not represent a value.\n */\nconst basicToDigit = function(codePoint) {\n\tif (codePoint - 0x30 < 0x0A) {\n\t\treturn codePoint - 0x16;\n\t}\n\tif (codePoint - 0x41 < 0x1A) {\n\t\treturn codePoint - 0x41;\n\t}\n\tif (codePoint - 0x61 < 0x1A) {\n\t\treturn codePoint - 0x61;\n\t}\n\treturn base;\n};\n\n/**\n * Converts a digit/integer into a basic code point.\n * @see `basicToDigit()`\n * @private\n * @param {Number} digit The numeric value of a basic code point.\n * @returns {Number} The basic code point whose value (when used for\n * representing integers) is `digit`, which needs to be in the range\n * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n * used; else, the lowercase form is used. The behavior is undefined\n * if `flag` is non-zero and `digit` has no uppercase form.\n */\nconst digitToBasic = function(digit, flag) {\n\t//  0..25 map to ASCII a..z or A..Z\n\t// 26..35 map to ASCII 0..9\n\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n};\n\n/**\n * Bias adaptation function as per section 3.4 of RFC 3492.\n * https://tools.ietf.org/html/rfc3492#section-3.4\n * @private\n */\nconst adapt = function(delta, numPoints, firstTime) {\n\tlet k = 0;\n\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\tdelta += floor(delta / numPoints);\n\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\tdelta = floor(delta / baseMinusTMin);\n\t}\n\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n};\n\n/**\n * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n * symbols.\n * @memberOf punycode\n * @param {String} input The Punycode string of ASCII-only symbols.\n * @returns {String} The resulting string of Unicode symbols.\n */\nconst decode = function(input) {\n\t// Don't use UCS-2.\n\tconst output = [];\n\tconst inputLength = input.length;\n\tlet i = 0;\n\tlet n = initialN;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points: let `basic` be the number of input code\n\t// points before the last delimiter, or `0` if there is none, then copy\n\t// the first basic code points to the output.\n\n\tlet basic = input.lastIndexOf(delimiter);\n\tif (basic < 0) {\n\t\tbasic = 0;\n\t}\n\n\tfor (let j = 0; j < basic; ++j) {\n\t\t// if it's not a basic code point\n\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\terror('not-basic');\n\t\t}\n\t\toutput.push(input.charCodeAt(j));\n\t}\n\n\t// Main decoding loop: start just after the last delimiter if any basic code\n\t// points were copied; start at the beginning otherwise.\n\n\tfor (let index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t// `index` is the index of the next character to be consumed.\n\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t// which gets added to `i`. The overflow checking is easier\n\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t// value at the end to obtain `delta`.\n\t\tlet oldi = i;\n\t\tfor (let w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\tif (index >= inputLength) {\n\t\t\t\terror('invalid-input');\n\t\t\t}\n\n\t\t\tconst digit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\ti += digit * w;\n\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\tif (digit < t) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst baseMinusT = base - t;\n\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tw *= baseMinusT;\n\n\t\t}\n\n\t\tconst out = output.length + 1;\n\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t// incrementing `n` each time, so we'll fix that now:\n\t\tif (floor(i / out) > maxInt - n) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tn += floor(i / out);\n\t\ti %= out;\n\n\t\t// Insert `n` at position `i` of the output.\n\t\toutput.splice(i++, 0, n);\n\n\t}\n\n\treturn String.fromCodePoint(...output);\n};\n\n/**\n * Converts a string of Unicode symbols (e.g. a domain name label) to a\n * Punycode string of ASCII-only symbols.\n * @memberOf punycode\n * @param {String} input The string of Unicode symbols.\n * @returns {String} The resulting Punycode string of ASCII-only symbols.\n */\nconst encode = function(input) {\n\tconst output = [];\n\n\t// Convert the input in UCS-2 to an array of Unicode code points.\n\tinput = ucs2decode(input);\n\n\t// Cache the length.\n\tlet inputLength = input.length;\n\n\t// Initialize the state.\n\tlet n = initialN;\n\tlet delta = 0;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points.\n\tfor (const currentValue of input) {\n\t\tif (currentValue < 0x80) {\n\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t}\n\t}\n\n\tlet basicLength = output.length;\n\tlet handledCPCount = basicLength;\n\n\t// `handledCPCount` is the number of code points that have been handled;\n\t// `basicLength` is the number of basic code points.\n\n\t// Finish the basic string with a delimiter unless it's empty.\n\tif (basicLength) {\n\t\toutput.push(delimiter);\n\t}\n\n\t// Main encoding loop:\n\twhile (handledCPCount < inputLength) {\n\n\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t// larger one:\n\t\tlet m = maxInt;\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\tm = currentValue;\n\t\t\t}\n\t\t}\n\n\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t// but guard against overflow.\n\t\tconst handledCPCountPlusOne = handledCPCount + 1;\n\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\tn = m;\n\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\t\t\tif (currentValue == n) {\n\t\t\t\t// Represent delta as a generalized variable-length integer.\n\t\t\t\tlet q = delta;\n\t\t\t\tfor (let k = base; /* no condition */; k += base) {\n\t\t\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst qMinusT = q - t;\n\t\t\t\t\tconst baseMinusT = base - t;\n\t\t\t\t\toutput.push(\n\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t);\n\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t}\n\n\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\tdelta = 0;\n\t\t\t\t++handledCPCount;\n\t\t\t}\n\t\t}\n\n\t\t++delta;\n\t\t++n;\n\n\t}\n\treturn output.join('');\n};\n\n/**\n * Converts a Punycode string representing a domain name or an email address\n * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n * it doesn't matter if you call it on a string that has already been\n * converted to Unicode.\n * @memberOf punycode\n * @param {String} input The Punycoded domain name or email address to\n * convert to Unicode.\n * @returns {String} The Unicode representation of the given Punycode\n * string.\n */\nconst toUnicode = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexPunycode.test(string)\n\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t: string;\n\t});\n};\n\n/**\n * Converts a Unicode string representing a domain name or an email address to\n * Punycode. Only the non-ASCII parts of the domain name will be converted,\n * i.e. it doesn't matter if you call it with a domain that's already in\n * ASCII.\n * @memberOf punycode\n * @param {String} input The domain name or email address to convert, as a\n * Unicode string.\n * @returns {String} The Punycode representation of the given domain name or\n * email address.\n */\nconst toASCII = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexNonASCII.test(string)\n\t\t\t? 'xn--' + encode(string)\n\t\t\t: string;\n\t});\n};\n\n/*--------------------------------------------------------------------------*/\n\n/** Define the public API */\nconst punycode = {\n\t/**\n\t * A string representing the current Punycode.js version number.\n\t * @memberOf punycode\n\t * @type String\n\t */\n\t'version': '2.1.0',\n\t/**\n\t * An object of methods to convert from JavaScript's internal character\n\t * representation (UCS-2) to Unicode code points, and back.\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode\n\t * @type Object\n\t */\n\t'ucs2': {\n\t\t'decode': ucs2decode,\n\t\t'encode': ucs2encode\n\t},\n\t'decode': decode,\n\t'encode': encode,\n\t'toASCII': toASCII,\n\t'toUnicode': toUnicode\n};\n\nexport { ucs2decode, ucs2encode, decode, encode, toASCII, toUnicode };\nexport default punycode;\n","module.exports = window.flreg.get('components/UserPage');"],"sourceRoot":""}