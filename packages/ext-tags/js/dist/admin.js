module.exports=function(t){var a={};function n(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=a,n.d=function(t,a,e){n.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,a){if(1&a&&(t=n(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)n.d(e,r,function(a){return t[a]}.bind(null,r));return e},n.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(a,"a",a),a},n.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},n.p="",n(n.s=49)}([function(t,a){t.exports=flarum.core.compat.Model},function(t,a){t.exports=flarum.core.compat.extend},function(t,a,n){"use strict";function e(t){return t.slice(0).sort(function(t,a){var n=t.position(),e=a.position();if(null===n&&null===e)return a.discussionCount()-t.discussionCount();if(null===e)return-1;if(null===n)return 1;var r=t.parent(),s=a.parent();return r===s?n-e:r&&s?r.position()-s.position():r?r===a?1:r.position()-e:s?s===t?-1:n-s.position():0})}n.d(a,"a",function(){return e})},function(t,a,n){"use strict";function e(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a}n.d(a,"a",function(){return e})},function(t,a,n){"use strict";n.d(a,"a",function(){return s});var e=n(11),r=n.n(e);function s(t,a){void 0===a&&(a={}),a.style=a.style||{},a.className="TagLabel "+(a.className||"");var n=r()(a,"link");if(t){var e=t.color();e&&(a.style.backgroundColor=a.style.color=e,a.className+=" colored"),n&&(a.title=t.description()||"",a.href=app.route("tag",{tags:t.slug()}),a.config=m.route)}else a.className+=" untagged";return m(n?"a":"span",a,m("span",{className:"TagLabel-text"},t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text")))}},,function(t,a,n){"use strict";function e(t,a){return void 0===a&&(a={}),a.className="icon TagIcon "+(a.className||""),t?(a.style=a.style||{},a.style.backgroundColor=t.color()):a.className+=" untagged",m("span",a)}n.d(a,"a",function(){return e})},function(t,a,n){"use strict";n.d(a,"a",function(){return o});var e=n(11),r=n.n(e),s=n(4),i=n(2);function o(t,a){void 0===a&&(a={});var n=[],e=r()(a,"link");return a.className="TagsLabel "+(a.className||""),t?Object(i.a)(t).forEach(function(a){(a||1===t.length)&&n.push(Object(s.a)(a,{link:e}))}):n.push(Object(s.a)()),m("span",a,n)}},function(t,a){t.exports=flarum.core.compat["components/Button"]},function(t,a,n){"use strict";function e(){return(e=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}n.d(a,"a",function(){return e})},function(t,a,n){"use strict";n.d(a,"a",function(){return c});var e=n(3),r=n(0),s=n.n(r),i=n(15),o=n.n(i),l=n(16),u=n.n(l),c=function(t){function a(){return t.apply(this,arguments)||this}return Object(e.a)(a,t),a}(o()(s.a,{name:s.a.attribute("name"),slug:s.a.attribute("slug"),description:s.a.attribute("description"),color:s.a.attribute("color"),backgroundUrl:s.a.attribute("backgroundUrl"),backgroundMode:s.a.attribute("backgroundMode"),position:s.a.attribute("position"),parent:s.a.hasOne("parent"),defaultSort:s.a.attribute("defaultSort"),isChild:s.a.attribute("isChild"),isHidden:s.a.attribute("isHidden"),discussionCount:s.a.attribute("discussionCount"),lastPostedAt:s.a.attribute("lastPostedAt",s.a.transformDate),lastPostedDiscussion:s.a.hasOne("lastPostedDiscussion"),isRestricted:s.a.attribute("isRestricted"),canStartDiscussion:s.a.attribute("canStartDiscussion"),canAddToDiscussion:s.a.attribute("canAddToDiscussion"),isPrimary:u()("position","parent",function(t,a){return null!==t&&!1===a})}))},function(t,a){t.exports=flarum.core.compat["utils/extract"]},function(t,a){t.exports=flarum.core.compat["components/PermissionGrid"]},,function(t,a){},function(t,a){t.exports=flarum.core.compat["utils/mixin"]},function(t,a){t.exports=flarum.core.compat["utils/computed"]},function(t,a){t.exports=flarum.core.compat["components/Page"]},function(t,a){t.exports=flarum.core.compat["components/Modal"]},function(t,a,n){"use strict";var e=n(2),r=n(10),s=n(7),i=n(6),o=n(4);a.a={"tags/utils/sortTags":e.a,"tags/models/Tag":r.a,"tags/helpers/tagsLabel":s.a,"tags/helpers/tagIcon":i.a,"tags/helpers/tagLabel":o.a}},function(t,a){t.exports=flarum.core},,,,,,function(t,a,n){"use strict";var e=n(9),r=n(10),s=n(1),i=n(12),o=n.n(i),l=n(39),u=n.n(l),c=n(40),d=n.n(c),p=n(8),g=n.n(p),f=n(4),h=n(6),b=n(2),v=function(){Object(s.override)(app,"getRequiredPermissions",function(t,a){var n=a.match(/^tag\d+\./);return n?t(a.substr(n[0].length)).map(function(t){return n[0]+t}):t(a)}),Object(s.extend)(o.a.prototype,"scopeItems",function(t){Object(b.a)(app.store.all("tags")).filter(function(t){return t.isRestricted()}).forEach(function(a){return t.add("tag"+a.id(),{label:Object(f.a)(a),onremove:function(){return a.save({isRestricted:!1})},render:function(t){return"viewDiscussions"===t.permission||"startDiscussion"===t.permission||t.permission&&0===t.permission.indexOf("discussion.")?u.a.component({permission:"tag"+a.id()+"."+t.permission,allowGuest:t.allowGuest}):""}})})}),Object(s.extend)(o.a.prototype,"scopeControlItems",function(t){var a=Object(b.a)(app.store.all("tags").filter(function(t){return!t.isRestricted()}));a.length&&t.add("tag",d.a.component({className:"Dropdown--restrictByTag",buttonClassName:"Button Button--text",label:app.translator.trans("flarum-tags.admin.permissions.restrict_by_tag_heading"),icon:"fas fa-plus",caretIcon:null,children:a.map(function(t){return g.a.component({icon:!0,children:[Object(h.a)(t,{className:"Button-icon"})," ",t.name()],onclick:function(){return t.save({isRestricted:!0})}})})}))})},_=function(){Object(s.extend)(o.a.prototype,"moderateItems",function(t){t.add("tag",{icon:"fas fa-tag",label:app.translator.trans("flarum-tags.admin.permissions.tag_discussions_label"),permission:"discussion.tag"},95)})},y=n(41),x=n.n(y),N=n(42),T=n.n(N),w=n(3),O=(n(50),n(17)),C=n.n(O),j=n(18),I=n.n(j),D=n(43),P=n.n(D),M=n(44),k=function(t){function a(){return t.apply(this,arguments)||this}Object(w.a)(a,t);var n=a.prototype;return n.init=function(){t.prototype.init.call(this),this.tag=this.props.tag||app.store.createRecord("tags"),this.name=m.prop(this.tag.name()||""),this.slug=m.prop(this.tag.slug()||""),this.description=m.prop(this.tag.description()||""),this.color=m.prop(this.tag.color()||""),this.isHidden=m.prop(this.tag.isHidden()||!1)},n.className=function(){return"EditTagModal Modal--small"},n.title=function(){return this.name()?Object(f.a)({name:this.name,color:this.color}):app.translator.trans("flarum-tags.admin.edit_tag.title")},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray()))},n.fields=function(){var t=this,a=new P.a;return a.add("name",m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.edit_tag.name_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("flarum-tags.admin.edit_tag.name_placeholder"),value:this.name(),oninput:function(a){t.name(a.target.value),t.slug(Object(M.slug)(a.target.value))}})),50),a.add("slug",m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.edit_tag.slug_label")),m("input",{className:"FormControl",value:this.slug(),oninput:m.withAttr("value",this.slug)})),40),a.add("description",m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.edit_tag.description_label")),m("textarea",{className:"FormControl",value:this.description(),oninput:m.withAttr("value",this.description)})),30),a.add("color",m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.edit_tag.color_label")),m("input",{className:"FormControl",placeholder:"#aaaaaa",value:this.color(),oninput:m.withAttr("value",this.color)})),20),a.add("hidden",m("div",{className:"Form-group"},m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",value:"1",checked:this.isHidden(),onchange:m.withAttr("checked",this.isHidden)}),app.translator.trans("flarum-tags.admin.edit_tag.hide_label")))),10),a.add("submit",m("div",{className:"Form-group"},g.a.component({type:"submit",className:"Button Button--primary EditTagModal-save",loading:this.loading,children:app.translator.trans("flarum-tags.admin.edit_tag.submit_button")}),this.tag.exists?m("button",{type:"button",className:"Button EditTagModal-delete",onclick:this.delete.bind(this)},app.translator.trans("flarum-tags.admin.edit_tag.delete_tag_button")):""),-10),a},n.submitData=function(){return{name:this.name(),slug:this.slug(),description:this.description(),color:this.color(),isHidden:this.isHidden()}},n.onsubmit=function(t){var a=this;t.preventDefault(),this.loading=!0,this.tag.save(this.submitData()).then(function(){return a.hide()},function(t){a.loading=!1,a.handleErrors(t)})},n.delete=function(){var t=this;if(confirm(app.translator.trans("flarum-tags.admin.edit_tag.delete_tag_confirmation"))){var a=app.store.all("tags").filter(function(a){return a.parent()===t.tag});this.tag.delete().then(function(){a.forEach(function(t){return t.pushData({attributes:{isChild:!1},relationships:{parent:null}})}),m.redraw()}),this.hide()}},a}(I.a),E=n(45),S=function(t){function a(){return t.apply(this,arguments)||this}Object(w.a)(a,t);var n=a.prototype;return n.setMinTags=function(t,a,n){t(n),a(Math.max(n,a()))},n.className=function(){return"TagSettingsModal Modal--small"},n.title=function(){return app.translator.trans("flarum-tags.admin.tag_settings.title")},n.form=function(){var t=this.setting("flarum-tags.min_primary_tags",0),a=this.setting("flarum-tags.max_primary_tags",0),n=this.setting("flarum-tags.min_secondary_tags",0),e=this.setting("flarum-tags.max_secondary_tags",0);return[m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.tag_settings.required_primary_heading")),m("div",{className:"helpText"},app.translator.trans("flarum-tags.admin.tag_settings.required_primary_text")),m("div",{className:"TagSettingsModal-rangeInput"},m("input",{className:"FormControl",type:"number",min:"0",value:t(),oninput:m.withAttr("value",this.setMinTags.bind(this,t,a))}),app.translator.trans("flarum-tags.admin.tag_settings.range_separator_text"),m("input",{className:"FormControl",type:"number",min:t(),bidi:a}))),m("div",{className:"Form-group"},m("label",null,app.translator.trans("flarum-tags.admin.tag_settings.required_secondary_heading")),m("div",{className:"helpText"},app.translator.trans("flarum-tags.admin.tag_settings.required_secondary_text")),m("div",{className:"TagSettingsModal-rangeInput"},m("input",{className:"FormControl",type:"number",min:"0",value:n(),oninput:m.withAttr("value",this.setMinTags.bind(this,n,e))}),app.translator.trans("flarum-tags.admin.tag_settings.range_separator_text"),m("input",{className:"FormControl",type:"number",min:n(),bidi:e})))]},a}(n.n(E).a);function A(t){return m("li",{"data-id":t.id(),style:{color:t.color()}},m("div",{className:"TagListItem-info"},Object(h.a)(t),m("span",{className:"TagListItem-name"},t.name()),g.a.component({className:"Button Button--link",icon:"fas fa-pencil-alt",onclick:function(){return app.modal.show(new k({tag:t}))}})),t.isChild()||null===t.position()?"":m("ol",{className:"TagListItem-children"},Object(b.a)(app.store.all("tags")).filter(function(a){return a.parent()===t}).map(A)))}var F=function(t){function a(){return t.apply(this,arguments)||this}Object(w.a)(a,t);var n=a.prototype;return n.view=function(){return m("div",{className:"TagsPage"},m("div",{className:"TagsPage-header"},m("div",{className:"container"},m("p",null,app.translator.trans("flarum-tags.admin.tags.about_tags_text")),g.a.component({className:"Button Button--primary",icon:"fas fa-plus",children:app.translator.trans("flarum-tags.admin.tags.create_tag_button"),onclick:function(){return app.modal.show(new k)}}),g.a.component({className:"Button",children:app.translator.trans("flarum-tags.admin.tags.settings_button"),onclick:function(){return app.modal.show(new S)}}))),m("div",{className:"TagsPage-list"},m("div",{className:"container"},m("div",{className:"TagGroup"},m("label",null,app.translator.trans("flarum-tags.admin.tags.primary_heading")),m("ol",{className:"TagList TagList--primary"},Object(b.a)(app.store.all("tags")).filter(function(t){return null!==t.position()&&!t.isChild()}).map(A))),m("div",{className:"TagGroup"},m("label",null,app.translator.trans("flarum-tags.admin.tags.secondary_heading")),m("ul",{className:"TagList"},app.store.all("tags").filter(function(t){return null===t.position()}).sort(function(t,a){return t.name().localeCompare(a.name())}).map(A))))))},n.config=function(){var t=this;this.$("ol, ul").sortable({connectWith:"primary"}).on("sortupdate",function(a,n){n.startparent.is("ol")&&n.endparent.is("ul")&&app.store.getById("tags",n.item.data("id")).pushData({attributes:{position:null,isChild:!1},relationships:{parent:null}});var e=t.$(".TagList--primary > li").map(function(){return{id:$(this).data("id"),children:$(this).find("li").map(function(){return $(this).data("id")}).get()}}).get();e.forEach(function(t,a){var n=app.store.getById("tags",t.id);n.pushData({attributes:{position:a,isChild:!1},relationships:{parent:null}}),t.children.forEach(function(t,a){app.store.getById("tags",t).pushData({attributes:{position:a,isChild:!0},relationships:{parent:n}})})}),app.request({url:app.forum.attribute("apiUrl")+"/tags/order",method:"POST",data:{order:e}}),m.redraw.strategy("all"),m.redraw()})},a}(C.a),B=function(){app.routes.tags={path:"/tags",component:F.component()},app.extensionSettings["flarum-tags"]=function(){return m.route(app.route("tags"))},Object(s.extend)(x.a.prototype,"items",function(t){t.add("tags",T.a.component({href:app.route("tags"),icon:"fas fa-tags",children:app.translator.trans("flarum-tags.admin.nav.tags_button"),description:app.translator.trans("flarum-tags.admin.nav.tags_text")}))})},L=n(46),H=n.n(L),W=function(){Object(s.extend)(H.a.prototype,"homePageItems",function(t){t.add("tags",{path:"/tags",label:app.translator.trans("flarum-tags.admin.basics.tags_label")})})},R=n(47),q=n.n(R),G=function(){Object(s.extend)(o.a.prototype,"startItems",function(t){t.add("allowTagChange",{icon:"fas fa-tag",label:app.translator.trans("flarum-tags.admin.permissions.allow_edit_tags_label"),setting:function(){var t=parseInt(app.data.settings.allow_tag_change,10);return q.a.component({defaultLabel:t?app.translator.transChoice("core.admin.permissions_controls.allow_some_minutes_button",t,{count:t}):app.translator.trans("core.admin.permissions_controls.allow_indefinitely_button"),key:"allow_tag_change",options:[{value:"-1",label:app.translator.trans("core.admin.permissions_controls.allow_indefinitely_button")},{value:"10",label:app.translator.trans("core.admin.permissions_controls.allow_ten_minutes_button")},{value:"reply",label:app.translator.trans("core.admin.permissions_controls.allow_until_reply_button")}]})}},90)})},U=n(19),Y=Object(e.a)(U.a,{"tags/addTagsHomePageOption":W,"tags/addTagChangePermission":G,"tags/addTagsPane":B,"tags/components/TagSettingsModal":S,"tags/components/TagsPage":F,"tags/components/EditTagModal":k,"tags/addTagPermission":_,"tags/addTagsPermissionScope":v}),z=n(20);app.initializers.add("flarum-tags",function(t){t.store.models.tags=r.a,v(),_(),B(),W(),G()}),Object(e.a)(z.compat,Y)},,,,,,,,,,,,,function(t,a){t.exports=flarum.core.compat["components/PermissionDropdown"]},function(t,a){t.exports=flarum.core.compat["components/Dropdown"]},function(t,a){t.exports=flarum.core.compat["components/AdminNav"]},function(t,a){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,a){t.exports=flarum.core.compat["utils/ItemList"]},function(t,a){t.exports=flarum.core.compat["utils/string"]},function(t,a){t.exports=flarum.core.compat["components/SettingsModal"]},function(t,a){t.exports=flarum.core.compat["components/BasicsPage"]},function(t,a){t.exports=flarum.core.compat["components/SettingDropdown"]},,function(t,a,n){"use strict";n.r(a);var e=n(14);for(var r in e)"default"!==r&&function(t){n.d(a,t,function(){return e[t]})}(r);n(26)},function(t,a,n){var e,r,s;r=[n(51)],void 0===(s="function"==typeof(e=function(t){"use strict";var a,n,e=t(),r=[],s=function(t){t.off("dragstart.h5s"),t.off("dragend.h5s"),t.off("selectstart.h5s"),t.off("dragover.h5s"),t.off("dragenter.h5s"),t.off("drop.h5s")},i=function(t){t.off("dragover.h5s"),t.off("dragenter.h5s"),t.off("drop.h5s")},o=function(t,a){t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text",""),t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(a.item,a.x,a.y)},l=function(t,a){var n=function(t){return{item:t[0],draggedItem:t}}(a);n=function(t,a){return a.x||(a.x=parseInt(t.pageX-a.draggedItem.offset().left)),a.y||(a.y=parseInt(t.pageY-a.draggedItem.offset().top)),a}(t,n),o(t,n)},u=function(t,a){return t[0]===a[0]||void 0!==t.data("connectWith")&&t.data("connectWith")===a.data("connectWith")},c=function(a){var n=a.data("opts"),e=a.children(n.items),r=n.handle?e.find(n.handle):e;a.attr("aria-dropeffect","move"),r.attr("draggable","true"),"function"!=typeof document.createElement("span").dragDrop||n.disableIEFix||r.on("mousedown.h5s",function(){-1!==e.index(this)?this.dragDrop():t(this).parents(n.items)[0].dragDrop()})},d=function(p,m){var g=t(p),f=String(m);return m=t.extend({connectWith:!1,placeholder:null,dragImage:null,disableIEFix:!1,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging"},m),g.each(function(){var p=t(this);if(/enable|disable|destroy/.test(f))d[f](p);else{m=function(t,a){return void 0===t?a:t}(p.data("opts"),m),p.data("opts",m),function(t){var a=t.data("opts"),n=t.children(a.items),e=a.handle?n.find(a.handle):n;s(n),e.off("mousedown.h5s"),i(t)}(p);var g,h,b,v=p.children(m.items),_=null===m.placeholder?t("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="'+m.placeholderClass+'"/>'):t(m.placeholder).addClass(m.placeholderClass);if(!p.attr("data-sortable-id")){var y=r.length;r[y]=p,p.attr("data-sortable-id",y),v.attr("data-item-sortable-id",y)}p.data("items",m.items),e=e.add(_),m.connectWith&&p.data("connectWith",m.connectWith),c(p),v.attr("role","option"),v.attr("aria-grabbed","false"),v.on("dragstart.h5s",function(e){e.stopImmediatePropagation(),m.dragImage?(o(e.originalEvent,{item:m.dragImage,x:0,y:0}),console.log("WARNING: dragImage option is deprecated and will be removed in the future!")):l(e.originalEvent,t(this),m.dragImage),(a=t(this)).addClass(m.draggingClass),a.attr("aria-grabbed","true"),g=a.index(),n=a.height(),h=t(this).parent(),a.parent().triggerHandler("sortstart",{item:a,startparent:h})}),v.on("dragend.h5s",function(){a&&(a.removeClass(m.draggingClass),a.attr("aria-grabbed","false"),a.show(),e.detach(),b=t(this).parent(),a.parent().triggerHandler("sortstop",{item:a,startparent:h}),g===a.index()&&h.get(0)===b.get(0)||a.parent().triggerHandler("sortupdate",{item:a,index:b.children(b.data("items")).index(a),oldindex:v.index(a),elementIndex:a.index(),oldElementIndex:g,startparent:h,endparent:b}),a=null,n=null)}),t(this).add([_]).on("drop.h5s",function(n){if(u(p,t(a).parent()))return n.stopPropagation(),e.filter(":visible").after(a),a.trigger("dragend.h5s"),!1}),v.add([this,_]).on("dragover.h5s dragenter.h5s",function(r){if(u(p,t(a).parent())){if(r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="move",v.is(this)){var s=t(this).height();if(m.forcePlaceholderSize&&_.height(n),s>n){var i=s-n,o=t(this).offset().top;if(_.index()<t(this).index()&&r.originalEvent.pageY<o+i)return!1;if(_.index()>t(this).index()&&r.originalEvent.pageY>o+s-i)return!1}a.hide(),_.index()<t(this).index()?t(this).after(_):t(this).before(_),e.not(_).detach()}else e.is(this)||t(this).children(m.items).length||(e.detach(),t(this).append(_));return!1}})}})};return d.destroy=function(t){!function(t){var a=t.data("opts")||{},n=t.children(a.items),e=a.handle?n.find(a.handle):n;i(t),function(t){t.removeData("opts"),t.removeData("connectWith"),t.removeData("items"),t.removeAttr("aria-dropeffect")}(t),e.off("mousedown.h5s"),s(n),function(t){t.removeAttr("aria-grabbed"),t.removeAttr("draggable"),t.removeAttr("role")}(n)}(t)},d.enable=function(t){c(t)},d.disable=function(t){!function(t){var a=t.data("opts"),n=t.children(a.items),e=a.handle?n.find(a.handle):n;t.attr("aria-dropeffect","none"),e.attr("draggable",!1),e.off("mousedown.h5s")}(t)},t.fn.sortable=function(t){return d(this,t)},d})?e.apply(a,r):e)||(t.exports=s)},function(t,a){t.exports=jQuery}]);
//# sourceMappingURL=admin.js.map