{"version":3,"sources":["webpack://@flarum/tags/webpack/bootstrap","webpack://@flarum/tags/external \"flarum.core.compat['Model']\"","webpack://@flarum/tags/external \"flarum.core.compat['extend']\"","webpack://@flarum/tags/./src/common/utils/sortTags.js","webpack://@flarum/tags/./src/common/helpers/tagIcon.js","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flarum/tags/./src/common/helpers/tagLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/IndexPage']\"","webpack://@flarum/tags/./src/common/helpers/tagsLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/Button']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Link']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/Stream']\"","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flarum/tags/./src/common/models/Tag.js","webpack://@flarum/tags/external \"flarum.core.compat['utils/classList']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/extract']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/mixin']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/computed']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Modal']\"","webpack://@flarum/tags/./src/common/compat.js","webpack://@flarum/tags/external \"flarum.core\"","webpack://@flarum/tags/external \"flarum.core.compat['components/LinkButton']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@flarum/tags/external \"flarum.core.compat['models/Discussion']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/extractText']\"","webpack://@flarum/tags/./src/forum/components/TagsPage.js","webpack://@flarum/tags/./src/forum/components/DiscussionTaggedPost.js","webpack://@flarum/tags/./src/forum/components/TagLinkButton.js","webpack://@flarum/tags/./src/forum/addTagList.js","webpack://@flarum/tags/./src/forum/components/TagHero.js","webpack://@flarum/tags/./src/forum/addTagFilter.js","webpack://@flarum/tags/./src/forum/addTagLabels.js","webpack://@flarum/tags/./src/forum/components/TagDiscussionModal.js","webpack://@flarum/tags/./src/forum/addTagControl.js","webpack://@flarum/tags/./src/forum/addTagComposer.js","webpack://@flarum/tags/./src/forum/compat.js","webpack://@flarum/tags/./src/forum/index.js","webpack://@flarum/tags/external \"flarum.core.compat['components/Page']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/listItems']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/humanTime']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/EventPost']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Separator']\"","webpack://@flarum/tags/external \"flarum.core.compat['states/DiscussionListState']\"","webpack://@flarum/tags/external \"flarum.core.compat['states/GlobalSearchState']\"","webpack://@flarum/tags/external \"flarum.core.compat['Component']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionListItem']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/highlight']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/KeyboardNavigatable']\"","webpack://@flarum/tags/./forum.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","sortTags","tags","slice","sort","a","b","aPos","position","bPos","discussionCount","aParent","parent","bParent","tagIcon","tag","attrs","settings","hasIcon","icon","useColor","className","classList","style","color","backgroundColor","_inheritsLoose","subClass","superClass","constructor","__proto__","tagLabel","link","extract","tagText","app","translator","trans","title","description","href","route","slug","Link","tagsLabel","children","forEach","length","push","_extends","assign","target","arguments","source","apply","this","Tag","mixin","Model","attribute","backgroundUrl","backgroundMode","hasOne","defaultSort","isChild","isHidden","lastPostedAt","transformDate","lastPostedDiscussion","isRestricted","canStartDiscussion","canAddToDiscussion","isPrimary","computed","TagsPage","oninit","vnode","store","all","filter","history","view","pinned","cloud","IndexPage","hero","listItems","sidebarItems","toArray","map","child","discussion","lastPostNumber","humanTime","oncreate","setTitle","setTitleCount","Page","DiscussionTaggedPost","initAttrs","oldTags","post","content","newTags","diffTags","tags1","tags2","indexOf","id","getById","tagsAdded","tagsRemoved","descriptionKey","descriptionData","data","transChoice","count","EventPost","TagLinkButton","model","active","isActive","params","LinkButton","extend","items","add","current","matches","Separator","component","search","stickyParams","currentTag","addTag","more","splice","TagHero","Component","getBy","override","original","vdom","session","user","disabled","GlobalSearchState","param","DiscussionListState","include","q","DiscussionListItem","DiscussionHero","TagDiscussionModal","selected","Stream","index","focused","selectedTags","minPrimary","forum","maxPrimary","minSecondary","maxSecondary","navigator","KeyboardNavigatable","onUp","setIndex","getCurrentNumericIndex","onDown","onSelect","select","onRemove","primaryCount","secondaryCount","removeTag","getInstruction","remaining","toLowerCase","substr","inputWidth","Math","max","extractText","onclick","$","focus","onready","placeholder","bidi","width","onkeydown","navigate","onfocus","onblur","type","data-index","colored","onmouseover","toggleTag","highlight","e","metaKey","ctrlKey","submit","getItem","dispatchEvent","Event","selectableItems","scrollToItem","$items","$dropdown","$item","eq","attr","redraw","scrollTop","dropdownScroll","dropdownTop","offset","top","dropdownBottom","outerHeight","itemTop","itemBottom","parseInt","css","stop","animate","onsubmit","preventDefault","save","relationships","then","DiscussionPage","update","hide","Modal","DiscussionControls","canTag","modal","show","promise","composer","fields","DiscussionComposer","chooseTags","chosenTags","chosenPrimaryTags","chosenSecondaryTags","addTagFilter","addTagControl","addTagList","addTagLabels","addTagComposer","initializers","routes","path","postComponents","discussionTagged","models","Discussion","hasMany","tagsCompat"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 50);\n","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['extend'];","export default function sortTags(tags) {\n  return tags.slice(0).sort((a, b) => {\n    const aPos = a.position();\n    const bPos = b.position();\n\n    // If they're both secondary tags, sort them by their discussions count,\n    // descending.\n    if (aPos === null && bPos === null)\n      return b.discussionCount() - a.discussionCount();\n\n    // If just one is a secondary tag, then the primary tag should\n    // come first.\n    if (bPos === null) return -1;\n    if (aPos === null) return 1;\n\n    // If we've made it this far, we know they're both primary tags. So we'll\n    // need to see if they have parents.\n    const aParent = a.parent();\n    const bParent = b.parent();\n\n    // If they both have the same parent, then their positions are local,\n    // so we can compare them directly.\n    if (aParent === bParent) return aPos - bPos;\n\n    // If they are both child tags, then we will compare the positions of their\n    // parents.\n    else if (aParent && bParent)\n      return aParent.position() - bParent.position();\n\n    // If we are comparing a child tag with its parent, then we let the parent\n    // come first. If we are comparing an unrelated parent/child, then we\n    // compare both of the parents.\n    else if (aParent)\n      return aParent === b ? 1 : aParent.position() - bPos;\n\n    else if (bParent)\n      return bParent === a ? -1 : aPos - bParent.position();\n\n    return 0;\n  });\n}\n","import classList from 'flarum/utils/classList';\n\nexport default function tagIcon(tag, attrs = {}, settings = {}) {\n  const hasIcon = tag && tag.icon();\n  const { useColor = true } = settings;\n\n  attrs.className = classList([\n    attrs.className,\n    'icon',\n    hasIcon ? tag.icon() : 'TagIcon'\n  ]);\n\n  if (tag) {\n    attrs.style = attrs.style || {};\n\n    if (hasIcon) {\n      attrs.style.color = useColor ? tag.color() : '';\n    } else {\n      attrs.style.backgroundColor = tag.color();\n    }\n\n  } else {\n    attrs.className += ' untagged';\n  }\n\n  return hasIcon ? <i {...attrs}/> : <span {...attrs}/>;\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import extract from 'flarum/utils/extract';\nimport Link from 'flarum/components/Link';\nimport tagIcon from './tagIcon';\n\nexport default function tagLabel(tag, attrs = {}) {\n  attrs.style = attrs.style || {};\n  attrs.className = 'TagLabel ' + (attrs.className || '');\n\n  const link = extract(attrs, 'link');\n  const tagText = tag ? tag.name() : app.translator.trans('flarum-tags.lib.deleted_tag_text');\n\n  if (tag) {\n    const color = tag.color();\n    if (color) {\n      attrs.style.backgroundColor = attrs.style.color = color;\n      attrs.className += ' colored';\n    }\n\n    if (link) {\n      attrs.title = tag.description() || '';\n      attrs.href = app.route('tag', {tags: tag.slug()});\n    }\n  } else {\n    attrs.className += ' untagged';\n  }\n\n  return (\n    m((link ? Link : 'span'), attrs,\n      <span className=\"TagLabel-text\">\n        {tag && tag.icon() && tagIcon(tag, {}, {useColor: false})} {tagText}\n      </span>\n    )\n  );\n}\n","module.exports = flarum.core.compat['components/IndexPage'];","import extract from 'flarum/utils/extract';\nimport tagLabel from './tagLabel';\nimport sortTags from '../utils/sortTags';\n\nexport default function tagsLabel(tags, attrs = {}) {\n  const children = [];\n  const link = extract(attrs, 'link');\n\n  attrs.className = 'TagsLabel ' + (attrs.className || '');\n\n  if (tags) {\n    sortTags(tags).forEach(tag => {\n      if (tag || tags.length === 1) {\n        children.push(tagLabel(tag, {link}));\n      }\n    });\n  } else {\n    children.push(tagLabel());\n  }\n\n  return <span {...attrs}>{children}</span>;\n}\n","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/Link'];","module.exports = flarum.core.compat['utils/Stream'];","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\nimport computed from 'flarum/utils/computed';\n\nexport default class Tag extends mixin(Model, {\n  name: Model.attribute('name'),\n  slug: Model.attribute('slug'),\n  description: Model.attribute('description'),\n\n  color: Model.attribute('color'),\n  backgroundUrl: Model.attribute('backgroundUrl'),\n  backgroundMode: Model.attribute('backgroundMode'),\n  icon: Model.attribute('icon'),\n\n  position: Model.attribute('position'),\n  parent: Model.hasOne('parent'),\n  defaultSort: Model.attribute('defaultSort'),\n  isChild: Model.attribute('isChild'),\n  isHidden: Model.attribute('isHidden'),\n\n  discussionCount: Model.attribute('discussionCount'),\n  lastPostedAt: Model.attribute('lastPostedAt', Model.transformDate),\n  lastPostedDiscussion: Model.hasOne('lastPostedDiscussion'),\n\n  isRestricted: Model.attribute('isRestricted'),\n  canStartDiscussion: Model.attribute('canStartDiscussion'),\n  canAddToDiscussion: Model.attribute('canAddToDiscussion'),\n\n  isPrimary: computed('position', 'parent', (position, parent) => position !== null && parent === false)\n}) {}\n","module.exports = flarum.core.compat['utils/classList'];","module.exports = flarum.core.compat['utils/extract'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['components/Modal'];","import sortTags from './utils/sortTags';\nimport Tag from './models/Tag';\nimport tagsLabel from './helpers/tagsLabel';\nimport tagIcon from './helpers/tagIcon';\nimport tagLabel from './helpers/tagLabel';\n\nexport default {\n  'tags/utils/sortTags': sortTags,\n  'tags/models/Tag': Tag,\n  'tags/helpers/tagsLabel': tagsLabel,\n  'tags/helpers/tagIcon': tagIcon,\n  'tags/helpers/tagLabel': tagLabel\n};\n","module.exports = flarum.core;","module.exports = flarum.core.compat['components/LinkButton'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['components/DiscussionHero'];","module.exports = flarum.core.compat['utils/extractText'];","import Page from 'flarum/components/Page';\nimport IndexPage from 'flarum/components/IndexPage';\nimport Link from 'flarum/components/Link';\nimport listItems from 'flarum/helpers/listItems';\nimport humanTime from 'flarum/helpers/humanTime';\n\nimport tagIcon from '../../common/helpers/tagIcon';\nimport tagLabel from '../../common/helpers/tagLabel';\nimport sortTags from '../../common/utils/sortTags';\n\nexport default class TagsPage extends Page {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.tags = sortTags(app.store.all('tags').filter(tag => !tag.parent()));\n\n    app.history.push('tags', app.translator.trans('flarum-tags.forum.header.back_to_tags_tooltip'));\n  }\n\n  view() {\n    const pinned = this.tags.filter(tag => tag.position() !== null);\n    const cloud = this.tags.filter(tag => tag.position() === null);\n\n    return (\n      <div className=\"TagsPage\">\n        {IndexPage.prototype.hero()}\n        <div className=\"container\">\n          <nav className=\"TagsPage-nav IndexPage-nav sideNav\">\n            <ul>{listItems(IndexPage.prototype.sidebarItems().toArray())}</ul>\n          </nav>\n\n          <div className=\"TagsPage-content sideNavOffset\">\n            <ul className=\"TagTiles\">\n              {pinned.map(tag => {\n                const lastPostedDiscussion = tag.lastPostedDiscussion();\n                const children = sortTags(app.store.all('tags').filter(child => child.parent() === tag));\n\n                return (\n                  <li className={'TagTile ' + (tag.color() ? 'colored' : '')}\n                    style={{backgroundColor: tag.color()}}>\n                    <Link className=\"TagTile-info\" href={app.route.tag(tag)}>\n                      {tag.icon() && tagIcon(tag, {}, { useColor: false })}\n                      <h3 className=\"TagTile-name\">{tag.name()}</h3>\n                      <p className=\"TagTile-description\">{tag.description()}</p>\n                      {children\n                        ? (\n                          <div className=\"TagTile-children\">\n                            {children.map(child => [\n                              <Link href={app.route.tag(child)}>\n                                {child.name()}\n                              </Link>,\n                              ' '\n                            ])}\n                          </div>\n                        ) : ''}\n                    </Link>\n                    {lastPostedDiscussion\n                      ? (\n                        <Link className=\"TagTile-lastPostedDiscussion\"\n                          href={app.route.discussion(lastPostedDiscussion, lastPostedDiscussion.lastPostNumber())}\n                          >\n                          <span className=\"TagTile-lastPostedDiscussion-title\">{lastPostedDiscussion.title()}</span>\n                          {humanTime(lastPostedDiscussion.lastPostedAt())}\n                        </Link>\n                      ) : (\n                        <span className=\"TagTile-lastPostedDiscussion\"/>\n                      )}\n                  </li>\n                );\n              })}\n            </ul>\n\n            {cloud.length ? (\n              <div className=\"TagCloud\">\n                {cloud.map(tag => [\n                  tagLabel(tag, {link: true}),\n                  ' ',\n                ])}\n              </div>\n            ) : ''}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    app.setTitle(app.translator.trans('flarum-tags.forum.all_tags.meta_title_text'));\n    app.setTitleCount(0);\n  }\n}\n","import EventPost from 'flarum/components/EventPost';\nimport tagsLabel from '../../common/helpers/tagsLabel';\n\nexport default class DiscussionTaggedPost extends EventPost {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    const oldTags = attrs.post.content()[0];\n    const newTags = attrs.post.content()[1];\n\n    function diffTags(tags1, tags2) {\n      return tags1\n        .filter(tag => tags2.indexOf(tag) === -1)\n        .map(id => app.store.getById('tags', id));\n    }\n\n    attrs.tagsAdded = diffTags(newTags, oldTags);\n    attrs.tagsRemoved = diffTags(oldTags, newTags);\n  }\n\n  icon() {\n    return 'fas fa-tag';\n  }\n\n  descriptionKey() {\n    if (this.attrs.tagsAdded.length) {\n      if (this.attrs.tagsRemoved.length) {\n        return 'flarum-tags.forum.post_stream.added_and_removed_tags_text';\n      }\n\n      return 'flarum-tags.forum.post_stream.added_tags_text';\n    }\n\n    return 'flarum-tags.forum.post_stream.removed_tags_text';\n  }\n\n  descriptionData() {\n    const data = {};\n\n    if (this.attrs.tagsAdded.length) {\n      data.tagsAdded = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.attrs.tagsAdded.length, {\n        tags: tagsLabel(this.attrs.tagsAdded, {link: true}),\n        count: this.attrs.tagsAdded.length\n      });\n    }\n\n    if (this.attrs.tagsRemoved.length) {\n      data.tagsRemoved = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.attrs.tagsRemoved.length, {\n        tags: tagsLabel(this.attrs.tagsRemoved, {link: true}),\n        count: this.attrs.tagsRemoved.length\n      });\n    }\n\n    return data;\n  }\n}\n","import Link from 'flarum/components/Link';\nimport LinkButton from 'flarum/components/LinkButton';\nimport classList from 'flarum/utils/classList';\nimport tagIcon from '../../common/helpers/tagIcon';\n\nexport default class TagLinkButton extends LinkButton {\n  view(vnode) {\n    const tag = this.attrs.model;\n    const active = this.constructor.isActive(this.attrs);\n    const description = tag && tag.description();\n    const className = classList([\n      'TagLinkButton',\n      'hasIcon',\n      this.attrs.className,\n      tag.isChild() && 'child',\n    ]);\n\n    return (\n      <Link className={className} href={this.attrs.route}\n        style={active && tag ? {color: tag.color()} : ''}\n        title={description || ''}>\n        {tagIcon(tag, {className: 'Button-icon'})}\n        {tag ? tag.name() : app.translator.trans('flarum-tags.forum.index.untagged_link')}\n      </Link>\n    );\n  }\n\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n\n    const tag = attrs.model;\n\n    attrs.params.tags = tag ? tag.slug() : 'untagged';\n    attrs.route = app.route('tag', attrs.params);\n  }\n}\n","import { extend } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport Separator from 'flarum/components/Separator';\nimport LinkButton from 'flarum/components/LinkButton';\n\nimport TagLinkButton from './components/TagLinkButton';\nimport TagsPage from './components/TagsPage';\nimport sortTags from '../common/utils/sortTags';\n\nexport default function() {\n  // Add a link to the tags page, as well as a list of all the tags,\n  // to the index page's sidebar.\n  extend(IndexPage.prototype, 'navItems', function (items) {\n    items.add('tags', <LinkButton icon=\"fas fa-th-large\" href={app.route('tags')}>\n      {app.translator.trans('flarum-tags.forum.index.tags_link')}\n    </LinkButton>\n      , -10);\n\n    if (app.current.matches(TagsPage)) return;\n\n    items.add('separator', Separator.component(), -12);\n\n    const params = app.search.stickyParams();\n    const tags = app.store.all('tags');\n    const currentTag = this.currentTag();\n\n    const addTag = tag => {\n      let active = currentTag === tag;\n\n      if (!active && currentTag) {\n        active = currentTag.parent() === tag;\n      }\n\n      // tag.name() is passed here as children even though it isn't used directly\n      // because when we need to get the active child in SelectDropdown, we need to\n      // use its children to populate the dropdown. The problem here is that `view`\n      // on TagLinkButton is only called AFTER SelectDropdown, so no children are available\n      // for SelectDropdown to use at the time.\n      items.add('tag' + tag.id(), TagLinkButton.component({model: tag, params, active}, tag?.name()), -14);\n    };\n\n    sortTags(tags)\n      .filter(tag => tag.position() !== null && (!tag.isChild() || (currentTag && (tag.parent() === currentTag || tag.parent() === currentTag.parent()))))\n      .forEach(addTag);\n\n    const more = tags\n      .filter(tag => tag.position() === null)\n      .sort((a, b) => b.discussionCount() - a.discussionCount());\n\n    more.splice(0, 3).forEach(addTag);\n\n    if (more.length) {\n      items.add('moreTags', <LinkButton href={app.route('tags')}>\n        {app.translator.trans('flarum-tags.forum.index.more_link')}\n      </LinkButton>, -16)\n    }\n  });\n}\n","import Component from 'flarum/Component';\nimport tagIcon from '../../common/helpers/tagIcon';\n\nexport default class TagHero extends Component {\n  view() {\n    const tag = this.attrs.model;\n    const color = tag.color();\n\n    return (\n      <header className={'Hero TagHero' + (color ? ' TagHero--colored' : '')}\n        style={color ? {color: '#fff', backgroundColor: color} : ''}>\n        <div className=\"container\">\n          <div className=\"containerNarrow\">\n            <h2 className=\"Hero-title\">{tag.icon() && tagIcon(tag, {}, { useColor: false })} {tag.name()}</h2>\n            <div className=\"Hero-subtitle\">{tag.description()}</div>\n          </div>\n        </div>\n      </header>\n    );\n  }\n}\n","import { extend, override } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport DiscussionListState from 'flarum/states/DiscussionListState';\nimport GlobalSearchState from 'flarum/states/GlobalSearchState';\n\nimport TagHero from './components/TagHero';\n\nexport default function() {\n  IndexPage.prototype.currentTag = function() {\n    const slug = app.search.params().tags;\n\n    if (slug) return app.store.getBy('tags', 'slug', slug);\n  };\n\n  // If currently viewing a tag, insert a tag hero at the top of the view.\n  override(IndexPage.prototype, 'hero', function(original) {\n    const tag = this.currentTag();\n\n    if (tag) return <TagHero model={tag} />;\n\n    return original();\n  });\n\n  extend(IndexPage.prototype, 'view', function(vdom) {\n    const tag = this.currentTag();\n\n    if (tag) vdom.attrs.className += ' IndexPage--tag'+tag.id();\n  });\n\n  extend(IndexPage.prototype, 'setTitle', function() {\n    const tag = this.currentTag();\n\n    if (tag) {\n      app.setTitle(tag.name());\n    }\n  });\n\n  // If currently viewing a tag, restyle the 'new discussion' button to use\n  // the tag's color, and disable if the user isn't allowed to edit.\n  extend(IndexPage.prototype, 'sidebarItems', function(items) {\n    const tag = this.currentTag();\n\n    if (tag) {\n      const color = tag.color();\n      const canStartDiscussion = tag.canStartDiscussion() || !app.session.user;\n\n      if (color) {\n        items.get('newDiscussion').attrs.style = {backgroundColor: color};\n      }\n\n      items.get('newDiscussion').attrs.disabled = !canStartDiscussion;\n      items.get('newDiscussion').children = app.translator.trans(canStartDiscussion ? 'core.forum.index.start_discussion_button' : 'core.forum.index.cannot_start_discussion_button');\n    }\n  });\n\n  // Add a parameter for the global search state to pass on to the\n  // DiscussionListState that will let us filter discussions by tag.\n  extend(GlobalSearchState.prototype, 'params', function(params) {\n    params.tags = m.route.param('tags');\n  });\n\n  // Translate that parameter into a gambit appended to the search query.\n  extend(DiscussionListState.prototype, 'requestParams', function(params) {\n    params.include.push('tags');\n\n    if (this.params.tags) {\n      params.filter.q = (params.filter.q || '') + ' tag:' + this.params.tags;\n    }\n  });\n}\n","import { extend } from 'flarum/extend';\nimport DiscussionListItem from 'flarum/components/DiscussionListItem';\nimport DiscussionHero from 'flarum/components/DiscussionHero';\n\nimport tagsLabel from '../common/helpers/tagsLabel';\nimport sortTags from '../common/utils/sortTags';\n\nexport default function() {\n  // Add tag labels to each discussion in the discussion list.\n  extend(DiscussionListItem.prototype, 'infoItems', function(items) {\n    const tags = this.attrs.discussion.tags();\n\n    if (tags && tags.length) {\n      items.add('tags', tagsLabel(tags), 10);\n    }\n  });\n\n  // Restyle a discussion's hero to use its first tag's color.\n  extend(DiscussionHero.prototype, 'view', function(view) {\n    const tags = sortTags(this.attrs.discussion.tags());\n\n    if (tags && tags.length) {\n      const color = tags[0].color();\n      if (color) {\n        view.attrs.style = {backgroundColor: color};\n        view.attrs.className += ' DiscussionHero--colored';\n      }\n    }\n  });\n\n  // Add a list of a discussion's tags to the discussion hero, displayed\n  // before the title. Put the title on its own line.\n  extend(DiscussionHero.prototype, 'items', function(items) {\n    const tags = this.attrs.discussion.tags();\n\n    if (tags && tags.length) {\n      items.add('tags', tagsLabel(tags, {link: true}), 5);\n    }\n  });\n}\n","import Modal from 'flarum/components/Modal';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport Button from 'flarum/components/Button';\nimport highlight from 'flarum/helpers/highlight';\nimport classList from 'flarum/utils/classList';\nimport extractText from 'flarum/utils/extractText';\nimport KeyboardNavigatable from 'flarum/utils/KeyboardNavigatable';\nimport Stream from 'flarum/utils/Stream';\n\nimport tagLabel from '../../common/helpers/tagLabel';\nimport tagIcon from '../../common/helpers/tagIcon';\nimport sortTags from '../../common/utils/sortTags';\n\nexport default class TagDiscussionModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.tags = app.store.all('tags');\n\n    if (this.attrs.discussion) {\n      this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.attrs.discussion.tags().indexOf(tag) !== -1);\n    } else {\n      this.tags = this.tags.filter(tag => tag.canStartDiscussion());\n    }\n\n    this.tags = sortTags(this.tags);\n\n    this.selected = [];\n    this.filter = Stream('');\n    this.index = this.tags[0].id();\n    this.focused = false;\n\n    if (this.attrs.selectedTags) {\n      this.attrs.selectedTags.map(this.addTag.bind(this));\n    } else if (this.attrs.discussion) {\n      this.attrs.discussion.tags().map(this.addTag.bind(this));\n    }\n\n    this.minPrimary = app.forum.attribute('minPrimaryTags');\n    this.maxPrimary = app.forum.attribute('maxPrimaryTags');\n    this.minSecondary = app.forum.attribute('minSecondaryTags');\n    this.maxSecondary = app.forum.attribute('maxSecondaryTags');\n\n    this.navigator = new KeyboardNavigatable();\n    this.navigator\n      .onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true))\n      .onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true))\n      .onSelect(this.select.bind(this))\n      .onRemove(() => this.selected.splice(this.selected.length - 1, 1));\n  }\n\n  primaryCount() {\n    return this.selected.filter(tag => tag.isPrimary()).length;\n  }\n\n  secondaryCount() {\n    return this.selected.filter(tag => !tag.isPrimary()).length;\n  }\n\n  /**\n   * Add the given tag to the list of selected tags.\n   *\n   * @param {Tag} tag\n   */\n  addTag(tag) {\n    if (!tag.canStartDiscussion()) return;\n\n    // If this tag has a parent, we'll also need to add the parent tag to the\n    // selected list if it's not already in there.\n    const parent = tag.parent();\n    if (parent && this.selected.indexOf(parent) === -1) {\n      this.selected.push(parent);\n    }\n\n    if (this.selected.indexOf(tag) === -1) {\n      this.selected.push(tag);\n    }\n  }\n\n  /**\n   * Remove the given tag from the list of selected tags.\n   *\n   * @param {Tag} tag\n   */\n  removeTag(tag) {\n    const index = this.selected.indexOf(tag);\n    if (index !== -1) {\n      this.selected.splice(index, 1);\n\n      // Look through the list of selected tags for any tags which have the tag\n      // we just removed as their parent. We'll need to remove them too.\n      this.selected\n        .filter(selected => selected.parent() === tag)\n        .forEach(this.removeTag.bind(this));\n    }\n  }\n\n  className() {\n    return 'TagDiscussionModal';\n  }\n\n  title() {\n    return this.attrs.discussion\n      ? app.translator.trans('flarum-tags.forum.choose_tags.edit_title', {title: <em>{this.attrs.discussion.title()}</em>})\n      : app.translator.trans('flarum-tags.forum.choose_tags.title');\n  }\n\n  getInstruction(primaryCount, secondaryCount) {\n    if (primaryCount < this.minPrimary) {\n      const remaining = this.minPrimary - primaryCount;\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_primary_placeholder', remaining, {count: remaining});\n    } else if (secondaryCount < this.minSecondary) {\n      const remaining = this.minSecondary - secondaryCount;\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_secondary_placeholder', remaining, {count: remaining});\n    }\n\n    return '';\n  }\n\n  content() {\n    let tags = this.tags;\n    const filter = this.filter().toLowerCase();\n    const primaryCount = this.primaryCount();\n    const secondaryCount = this.secondaryCount();\n\n    // Filter out all child tags whose parents have not been selected. This\n    // makes it impossible to select a child if its parent hasn't been selected.\n    tags = tags.filter(tag => {\n      const parent = tag.parent();\n      return parent === false || this.selected.indexOf(parent) !== -1;\n    });\n\n    // If the number of selected primary/secondary tags is at the maximum, then\n    // we'll filter out all other tags of that type.\n    if (primaryCount >= this.maxPrimary) {\n      tags = tags.filter(tag => !tag.isPrimary() || this.selected.indexOf(tag) !== -1);\n    }\n\n    if (secondaryCount >= this.maxSecondary) {\n      tags = tags.filter(tag => tag.isPrimary() || this.selected.indexOf(tag) !== -1);\n    }\n\n    // If the user has entered text in the filter input, then filter by tags\n    // whose name matches what they've entered.\n    if (filter) {\n      tags = tags.filter(tag => tag.name().substr(0, filter.length).toLowerCase() === filter);\n    }\n\n    if (tags.indexOf(this.index) === -1) this.index = tags[0];\n\n    const inputWidth = Math.max(extractText(this.getInstruction(primaryCount, secondaryCount)).length, this.filter().length);\n\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"TagDiscussionModal-form\">\n          <div className=\"TagDiscussionModal-form-input\">\n            <div className={'TagsInput FormControl ' + (this.focused ? 'focus' : '')}\n              onclick={() => this.$('.TagsInput input').focus()}\n            >\n              <span className=\"TagsInput-selected\">\n                {this.selected.map(tag =>\n                  <span className=\"TagsInput-tag\" onclick={() => {\n                    this.removeTag(tag);\n                    this.onready();\n                  }}>\n                    {tagLabel(tag)}\n                  </span>\n                )}\n              </span>\n              <input className=\"FormControl\"\n                placeholder={extractText(this.getInstruction(primaryCount, secondaryCount))}\n                bidi={this.filter}\n                style={{ width: inputWidth + 'ch' }}\n                onkeydown={this.navigator.navigate.bind(this.navigator)}\n                onfocus={() => this.focused = true}\n                onblur={() => this.focused = false}/>\n            </div>\n          </div>\n          <div className=\"TagDiscussionModal-form-submit App-primaryControl\">\n            <Button type=\"submit\" className=\"Button Button--primary\" disabled={primaryCount < this.minPrimary || secondaryCount < this.minSecondary} icon=\"fas fa-check\">\n              {app.translator.trans('flarum-tags.forum.choose_tags.submit_button')}\n            </Button>\n          </div>\n        </div>\n      </div>,\n\n      <div className=\"Modal-footer\">\n        <ul className=\"TagDiscussionModal-list SelectTagList\">\n          {tags\n            .filter(tag => filter || !tag.parent() || this.selected.indexOf(tag.parent()) !== -1)\n            .map(tag => (\n              <li data-index={tag.id()}\n                className={classList({\n                  pinned: tag.position() !== null,\n                  child: !!tag.parent(),\n                  colored: !!tag.color(),\n                  selected: this.selected.indexOf(tag) !== -1,\n                  active: this.index === tag\n                })}\n                style={{color: tag.color()}}\n                onmouseover={() => this.index = tag}\n                onclick={this.toggleTag.bind(this, tag)}\n              >\n                {tagIcon(tag)}\n                <span className=\"SelectTagListItem-name\">\n                  {highlight(tag.name(), filter)}\n                </span>\n                {tag.description()\n                  ? (\n                    <span className=\"SelectTagListItem-description\">\n                      {tag.description()}\n                    </span>\n                  ) : ''}\n              </li>\n            ))}\n        </ul>\n      </div>\n    ];\n  }\n\n  toggleTag(tag) {\n    const index = this.selected.indexOf(tag);\n\n    if (index !== -1) {\n      this.removeTag(tag);\n    } else {\n      this.addTag(tag);\n    }\n\n    if (this.filter()) {\n      this.filter('');\n      this.index = this.tags[0];\n    }\n\n    this.onready();\n  }\n\n  select(e) {\n    // Ctrl + Enter submits the selection, just Enter completes the current entry\n    if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\n      if (this.selected.length) {\n        this.$('form').submit();\n      }\n    } else {\n      this.getItem(this.index)[0].dispatchEvent(new Event('click'));\n    }\n  }\n\n  selectableItems() {\n    return this.$('.TagDiscussionModal-list > li');\n  }\n\n  getCurrentNumericIndex() {\n    return this.selectableItems().index(\n      this.getItem(this.index)\n    );\n  }\n\n  getItem(index) {\n    return this.selectableItems().filter(`[data-index=\"${index.id()}\"]`);\n  }\n\n  setIndex(index, scrollToItem) {\n    const $items = this.selectableItems();\n    const $dropdown = $items.parent();\n\n    if (index < 0) {\n      index = $items.length - 1;\n    } else if (index >= $items.length) {\n      index = 0;\n    }\n\n    const $item = $items.eq(index);\n\n    this.index = app.store.getById('tags', $item.attr('data-index'));\n\n    m.redraw();\n\n    if (scrollToItem) {\n      const dropdownScroll = $dropdown.scrollTop();\n      const dropdownTop = $dropdown.offset().top;\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\n      const itemTop = $item.offset().top;\n      const itemBottom = itemTop + $item.outerHeight();\n\n      let scrollTop;\n      if (itemTop < dropdownTop) {\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\n      } else if (itemBottom > dropdownBottom) {\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\n      }\n\n      if (typeof scrollTop !== 'undefined') {\n        $dropdown.stop(true).animate({scrollTop}, 100);\n      }\n    }\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const discussion = this.attrs.discussion;\n    const tags = this.selected;\n\n    if (discussion) {\n      discussion.save({relationships: {tags}})\n        .then(() => {\n          if (app.current.matches(DiscussionPage)) {\n            app.current.get('stream').update();\n          }\n          m.redraw();\n        });\n    }\n\n    if (this.attrs.onsubmit) this.attrs.onsubmit(tags);\n\n    this.hide();\n  }\n}\n","import { extend } from 'flarum/extend';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\n\nimport TagDiscussionModal from './components/TagDiscussionModal';\n\nexport default function() {\n  // Add a control allowing the discussion to be moved to another category.\n  extend(DiscussionControls, 'moderationControls', function(items, discussion) {\n    if (discussion.canTag()) {\n      items.add('tags', <Button icon=\"fas fa-tag\" onclick={() => app.modal.show(TagDiscussionModal, { discussion })}>\n        {app.translator.trans('flarum-tags.forum.discussion_controls.edit_tags_button')}\n      </Button>);\n    }\n  });\n}\n","import { extend, override } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\n\nimport TagDiscussionModal from './components/TagDiscussionModal';\nimport tagsLabel from '../common/helpers/tagsLabel';\n\nexport default function () {\n  extend(IndexPage.prototype, 'newDiscussionAction', function (promise) {\n    const tag = app.store.getBy('tags', 'slug', app.search.params().tags);\n\n    if (tag) {\n      const parent = tag.parent();\n      const tags = parent ? [parent, tag] : [tag];\n      promise.then(composer => composer.fields.tags = tags);\n    } else {\n      app.composer.fields.tags = [];\n    }\n  });\n\n  // Add tag-selection abilities to the discussion composer.\n  DiscussionComposer.prototype.chooseTags = function () {\n    app.modal.show(TagDiscussionModal, {\n      selectedTags: (this.composer.fields.tags || []).slice(0),\n      onsubmit: tags => {\n        this.composer.fields.tags = tags;\n        this.$('textarea').focus();\n      }\n    });\n  };\n\n  // Add a tag-selection menu to the discussion composer's header, after the\n  // title.\n  extend(DiscussionComposer.prototype, 'headerItems', function (items) {\n    const tags = this.composer.fields.tags || [];\n\n    items.add('tags', (\n      <a className=\"DiscussionComposer-changeTags\" onclick={this.chooseTags.bind(this)}>\n        {tags.length\n          ? tagsLabel(tags)\n          : <span className=\"TagLabel untagged\">{app.translator.trans('flarum-tags.forum.composer_discussion.choose_tags_link')}</span>}\n      </a>\n    ), 10);\n  });\n\n  override(DiscussionComposer.prototype, 'onsubmit', function (original) {\n    const chosenTags = this.composer.fields.tags || [];\n    const chosenPrimaryTags = chosenTags.filter(tag => tag.position() !== null && !tag.isChild());\n    const chosenSecondaryTags = chosenTags.filter(tag => tag.position() === null);\n    if (!chosenTags.length\n      || (chosenPrimaryTags.length < app.forum.attribute('minPrimaryTags'))\n      || (chosenSecondaryTags.length < app.forum.attribute('minSecondaryTags'))) {\n      app.modal.show(TagDiscussionModal, {\n          selectedTags: chosenTags,\n          onsubmit: tags => {\n            this.composer.fields.tags = tags;\n            original();\n          }\n        });\n    } else {\n      original();\n    }\n  });\n\n  // Add the selected tags as data to submit to the server.\n  extend(DiscussionComposer.prototype, 'data', function (data) {\n    data.relationships = data.relationships || {};\n    data.relationships.tags = this.composer.fields.tags;\n  });\n}\n","import compat from '../common/compat';\n\nimport addTagFilter from './addTagFilter';\nimport addTagControl from './addTagControl';\nimport TagHero from './components/TagHero';\nimport TagDiscussionModal from './components/TagDiscussionModal';\nimport TagsPage from './components/TagsPage';\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\nimport TagLinkButton from './components/TagLinkButton';\nimport addTagList from './addTagList';\nimport addTagLabels from './addTagLabels';\nimport addTagComposer from './addTagComposer';\n\nexport default Object.assign(compat, {\n  'tags/addTagFilter': addTagFilter,\n  'tags/addTagControl': addTagControl,\n  'tags/components/TagHero': TagHero,\n  'tags/components/TagDiscussionModal': TagDiscussionModal,\n  'tags/components/TagsPage': TagsPage,\n  'tags/components/DiscussionTaggedPost': DiscussionTaggedPost,\n  'tags/components/TagLinkButton': TagLinkButton,\n  'tags/addTagList': addTagList,\n  'tags/addTagLabels': addTagLabels,\n  'tags/addTagComposer': addTagComposer,\n});\n","import Model from 'flarum/Model';\nimport Discussion from 'flarum/models/Discussion';\nimport IndexPage from 'flarum/components/IndexPage';\n\nimport Tag from '../common/models/Tag';\nimport TagsPage from './components/TagsPage';\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\n\nimport addTagList from './addTagList';\nimport addTagFilter from './addTagFilter';\nimport addTagLabels from './addTagLabels';\nimport addTagControl from './addTagControl';\nimport addTagComposer from './addTagComposer';\n\napp.initializers.add('flarum-tags', function(app) {\n  app.routes.tags = {path: '/tags', component: TagsPage };\n  app.routes.tag = {path: '/t/:tags', component: IndexPage };\n\n  app.route.tag = tag => app.route('tag', {tags: tag.slug()});\n\n  app.postComponents.discussionTagged = DiscussionTaggedPost;\n\n  app.store.models.tags = Tag;\n\n  Discussion.prototype.tags = Model.hasMany('tags');\n  Discussion.prototype.canTag = Model.attribute('canTag');\n\n  addTagList();\n  addTagFilter();\n  addTagLabels();\n  addTagControl();\n  addTagComposer();\n});\n\n\n// Expose compat API\nimport tagsCompat from './compat';\nimport { compat } from '@flarum/core/forum';\n\nObject.assign(compat, tagsCompat);\n","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['helpers/listItems'];","module.exports = flarum.core.compat['helpers/humanTime'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/Separator'];","module.exports = flarum.core.compat['states/DiscussionListState'];","module.exports = flarum.core.compat['states/GlobalSearchState'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/DiscussionListItem'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['utils/KeyboardNavigatable'];","/*\n * This file is part of Flarum.\n *\n * (c) Toby Zerner <toby.zerner@gmail.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nexport * from './src/common';\nexport * from './src/forum';\n"],"sourceRoot":""}