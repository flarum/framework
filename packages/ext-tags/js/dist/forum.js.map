{"version":3,"sources":["webpack://@flarum/tags/webpack/bootstrap","webpack://@flarum/tags/external \"flarum.core.compat['Model']\"","webpack://@flarum/tags/external \"flarum.core.compat['extend']\"","webpack://@flarum/tags/./src/common/utils/sortTags.js","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flarum/tags/./src/common/helpers/tagIcon.js","webpack://@flarum/tags/./src/common/helpers/tagLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/IndexPage']\"","webpack://@flarum/tags/./src/common/helpers/tagsLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/Button']\"","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flarum/tags/./src/common/models/Tag.js","webpack://@flarum/tags/external \"flarum.core.compat['utils/extract']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/mixin']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/computed']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Page']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Modal']\"","webpack://@flarum/tags/./src/common/compat.js","webpack://@flarum/tags/external \"flarum.core\"","webpack://@flarum/tags/external \"flarum.core.compat['components/LinkButton']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@flarum/tags/external \"flarum.core.compat['models/Discussion']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@flarum/tags/./src/forum/components/TagsPage.js","webpack://@flarum/tags/./src/forum/components/DiscussionTaggedPost.js","webpack://@flarum/tags/./src/forum/components/TagLinkButton.js","webpack://@flarum/tags/./src/forum/addTagList.js","webpack://@flarum/tags/./src/forum/components/TagHero.js","webpack://@flarum/tags/./src/forum/addTagFilter.js","webpack://@flarum/tags/./src/forum/addTagLabels.js","webpack://@flarum/tags/./src/forum/components/TagDiscussionModal.js","webpack://@flarum/tags/./src/forum/addTagControl.js","webpack://@flarum/tags/./src/forum/addTagComposer.js","webpack://@flarum/tags/./src/forum/compat.js","webpack://@flarum/tags/./src/forum/index.js","webpack://@flarum/tags/external \"flarum.core.compat['helpers/listItems']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/humanTime']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/EventPost']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Separator']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionList']\"","webpack://@flarum/tags/external \"flarum.core.compat['Component']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionListItem']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/highlight']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/classList']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/extractText']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/KeyboardNavigatable']\"","webpack://@flarum/tags/./forum.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","sortTags","tags","slice","sort","a","b","aPos","position","bPos","discussionCount","aParent","parent","bParent","__webpack_exports__","_inheritsLoose","subClass","superClass","constructor","__proto__","tagIcon","tag","attrs","settings","hasIcon","icon","className","style","color","disableColors","backgroundColor","tagLabel","flarum_utils_extract__WEBPACK_IMPORTED_MODULE_0__","flarum_utils_extract__WEBPACK_IMPORTED_MODULE_0___default","_tagIcon__WEBPACK_IMPORTED_MODULE_1__","link","extract","tagText","app","translator","trans","title","description","href","route","slug","config","tagsLabel","_tagLabel__WEBPACK_IMPORTED_MODULE_1__","_utils_sortTags__WEBPACK_IMPORTED_MODULE_2__","children","forEach","length","push","_extends","assign","target","arguments","source","apply","this","Tag","mixin","Model","attribute","backgroundUrl","backgroundMode","hasOne","defaultSort","isChild","isHidden","lastPostedAt","transformDate","lastPostedDiscussion","isRestricted","canStartDiscussion","canAddToDiscussion","isPrimary","computed","_utils_sortTags__WEBPACK_IMPORTED_MODULE_0__","_models_Tag__WEBPACK_IMPORTED_MODULE_1__","_helpers_tagsLabel__WEBPACK_IMPORTED_MODULE_2__","_helpers_tagIcon__WEBPACK_IMPORTED_MODULE_3__","_helpers_tagLabel__WEBPACK_IMPORTED_MODULE_4__","tags/utils/sortTags","tags/models/Tag","tags/helpers/tagsLabel","tags/helpers/tagIcon","tags/helpers/tagLabel","TagsPage","init","_Page","store","all","filter","history","view","pinned","cloud","IndexPage","hero","affixSidebar","listItems","sidebarItems","toArray","map","child","element","isInitialized","$","on","e","stopPropagation","discussion","lastPostNumber","humanTime","Page","DiscussionTaggedPost","initProps","props","_EventPost","oldTags","post","content","newTags","diffTags","tags1","tags2","indexOf","id","getById","tagsAdded","tagsRemoved","descriptionKey","descriptionData","data","transChoice","count","EventPost","TagLinkButton","active","isActive","params","LinkButton","addTagList","extend","items","add","component","current","Separator","stickyParams","currentTag","addTag","more","splice","TagHero","Component","addTagFilter","getBy","override","original","vdom","param","DiscussionList","include","q","addTagLabels","DiscussionListItem","DiscussionPage","DiscussionHero","TagDiscussionModal","_this","_Modal","selected","prop","index","focused","selectedTags","minPrimary","forum","maxPrimary","minSecondary","maxSecondary","navigator","KeyboardNavigatable","onUp","setIndex","getCurrentNumericIndex","onDown","onSelect","select","onRemove","primaryCount","secondaryCount","removeTag","getInstruction","remaining","_this2","toLowerCase","substr","onclick","onready","placeholder","extractText","oninput","withAttr","onkeydown","navigate","onfocus","onblur","Button","type","disabled","data-index","classList","colored","onmouseover","toggleTag","highlight","metaKey","ctrlKey","submit","getItem","dispatchEvent","Event","selectableItems","scrollToItem","$items","$dropdown","$item","eq","attr","redraw","scrollTop","dropdownScroll","dropdownTop","offset","top","dropdownBottom","outerHeight","itemTop","itemBottom","parseInt","css","stop","animate","onsubmit","preventDefault","save","relationships","then","stream","update","modal","close","strategy","Modal","addTagControl","DiscussionControls","canTag","show","addTagComposer","promise","DiscussionComposer","chooseTags","focus","chosenTags","chosenPrimaryTags","chosenSecondaryTags","forum_compat","esm_extends","tags/addTagFilter","tags/addTagControl","tags/components/TagHero","tags/components/TagDiscussionModal","tags/components/TagsPage","tags/components/DiscussionTaggedPost","tags/components/TagLinkButton","tags/addTagList","tags/addTagLabels","tags/addTagComposer","initializers","routes","path","postComponents","discussionTagged","models","Discussion","hasMany","tagsCompat","_src_common__WEBPACK_IMPORTED_MODULE_0__","__WEBPACK_IMPORT_KEY__"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 48);\n","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['extend'];","export default function sortTags(tags) {\n  return tags.slice(0).sort((a, b) => {\n    const aPos = a.position();\n    const bPos = b.position();\n\n    // If they're both secondary tags, sort them by their discussions count,\n    // descending.\n    if (aPos === null && bPos === null)\n      return b.discussionCount() - a.discussionCount();\n\n    // If just one is a secondary tag, then the primary tag should\n    // come first.\n    if (bPos === null) return -1;\n    if (aPos === null) return 1;\n\n    // If we've made it this far, we know they're both primary tags. So we'll\n    // need to see if they have parents.\n    const aParent = a.parent();\n    const bParent = b.parent();\n\n    // If they both have the same parent, then their positions are local,\n    // so we can compare them directly.\n    if (aParent === bParent) return aPos - bPos;\n\n    // If they are both child tags, then we will compare the positions of their\n    // parents.\n    else if (aParent && bParent)\n      return aParent.position() - bParent.position();\n\n    // If we are comparing a child tag with its parent, then we let the parent\n    // come first. If we are comparing an unrelated parent/child, then we\n    // compare both of the parents.\n    else if (aParent)\n      return aParent === b ? 1 : aParent.position() - bPos;\n\n    else if (bParent)\n      return bParent === a ? -1 : aPos - bParent.position();\n\n    return 0;\n  });\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","export default function tagIcon(tag, attrs = {}, settings = {}) {\n  const hasIcon = tag && tag.icon();\n\n  attrs.className = hasIcon ? 'icon ' + tag.icon() + ' ' + (attrs.className || '') : 'icon TagIcon ' + (attrs.className || '');\n\n  if (tag) {\n    attrs.style = attrs.style || {};\n\n    if (hasIcon) {\n      attrs.style.color = settings.disableColors ? '' : tag.color();\n    } else {\n      attrs.style.backgroundColor = tag.color();\n    }\n\n  } else {\n    attrs.className += ' untagged';\n  }\n\n  return hasIcon ? <i {...attrs}/> : <span {...attrs}/>;\n}\n","import extract from 'flarum/utils/extract';\nimport tagIcon from './tagIcon';\n\nexport default function tagLabel(tag, attrs = {}) {\n  attrs.style = attrs.style || {};\n  attrs.className = 'TagLabel ' + (attrs.className || '');\n\n  const link = extract(attrs, 'link');\n  let tagText = tag ? tag.name() : app.translator.trans('flarum-tags.lib.deleted_tag_text');\n\n  if (tag) {\n    const color = tag.color();\n    if (color) {\n      attrs.style.backgroundColor = attrs.style.color = color;\n      attrs.className += ' colored';\n    }\n\n    if (link) {\n      attrs.title = tag.description() || '';\n      attrs.href = app.route('tag', {tags: tag.slug()});\n      attrs.config = m.route;\n    }\n  } else {\n    attrs.className += ' untagged';\n  }\n  return (\n    m((link ? 'a' : 'span'), attrs,\n      <span className=\"TagLabel-text\">\n        {tag.icon() && tagIcon(tag, {}, {disableColors: true})} {tagText}\n      </span>\n    )\n  );\n}\n","module.exports = flarum.core.compat['components/IndexPage'];","import extract from 'flarum/utils/extract';\nimport tagLabel from './tagLabel';\nimport sortTags from '../utils/sortTags';\n\nexport default function tagsLabel(tags, attrs = {}) {\n  const children = [];\n  const link = extract(attrs, 'link');\n\n  attrs.className = 'TagsLabel ' + (attrs.className || '');\n\n  if (tags) {\n    sortTags(tags).forEach(tag => {\n      if (tag || tags.length === 1) {\n        children.push(tagLabel(tag, {link}));\n      }\n    });\n  } else {\n    children.push(tagLabel());\n  }\n\n  return <span {...attrs}>{children}</span>;\n}\n","module.exports = flarum.core.compat['components/Button'];","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\nimport computed from 'flarum/utils/computed';\n\nexport default class Tag extends mixin(Model, {\n  name: Model.attribute('name'),\n  slug: Model.attribute('slug'),\n  description: Model.attribute('description'),\n\n  color: Model.attribute('color'),\n  backgroundUrl: Model.attribute('backgroundUrl'),\n  backgroundMode: Model.attribute('backgroundMode'),\n  icon: Model.attribute('icon'),\n\n  position: Model.attribute('position'),\n  parent: Model.hasOne('parent'),\n  defaultSort: Model.attribute('defaultSort'),\n  isChild: Model.attribute('isChild'),\n  isHidden: Model.attribute('isHidden'),\n\n  discussionCount: Model.attribute('discussionCount'),\n  lastPostedAt: Model.attribute('lastPostedAt', Model.transformDate),\n  lastPostedDiscussion: Model.hasOne('lastPostedDiscussion'),\n\n  isRestricted: Model.attribute('isRestricted'),\n  canStartDiscussion: Model.attribute('canStartDiscussion'),\n  canAddToDiscussion: Model.attribute('canAddToDiscussion'),\n\n  isPrimary: computed('position', 'parent', (position, parent) => position !== null && parent === false)\n}) {}\n","module.exports = flarum.core.compat['utils/extract'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['components/Modal'];","import sortTags from './utils/sortTags';\nimport Tag from './models/Tag';\nimport tagsLabel from './helpers/tagsLabel';\nimport tagIcon from './helpers/tagIcon';\nimport tagLabel from './helpers/tagLabel';\n\nexport default {\n  'tags/utils/sortTags': sortTags,\n  'tags/models/Tag': Tag,\n  'tags/helpers/tagsLabel': tagsLabel,\n  'tags/helpers/tagIcon': tagIcon,\n  'tags/helpers/tagLabel': tagLabel\n};\n","module.exports = flarum.core;","module.exports = flarum.core.compat['components/LinkButton'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['components/DiscussionHero'];","import Page from 'flarum/components/Page';\nimport IndexPage from 'flarum/components/IndexPage';\nimport listItems from 'flarum/helpers/listItems';\nimport humanTime from 'flarum/helpers/humanTime';\n\nimport tagLabel from '../../common/helpers/tagLabel';\nimport sortTags from '../../common/utils/sortTags';\n\nexport default class TagsPage extends Page {\n  init() {\n    super.init();\n\n    this.tags = sortTags(app.store.all('tags').filter(tag => !tag.parent()));\n\n    app.history.push('tags', app.translator.trans('flarum-tags.forum.header.back_to_tags_tooltip'));\n  }\n\n  view() {\n    const pinned = this.tags.filter(tag => tag.position() !== null);\n    const cloud = this.tags.filter(tag => tag.position() === null);\n\n    return (\n      <div className=\"TagsPage\">\n        {IndexPage.prototype.hero()}\n        <div className=\"container\">\n          <nav className=\"TagsPage-nav IndexPage-nav sideNav\" config={IndexPage.prototype.affixSidebar}>\n            <ul>{listItems(IndexPage.prototype.sidebarItems().toArray())}</ul>\n          </nav>\n\n          <div className=\"TagsPage-content sideNavOffset\">\n            <ul className=\"TagTiles\">\n              {pinned.map(tag => {\n                const lastPostedDiscussion = tag.lastPostedDiscussion();\n                const children = sortTags(app.store.all('tags').filter(child => child.parent() === tag));\n\n                return (\n                  <li className={'TagTile ' + (tag.color() ? 'colored' : '')}\n                    style={{backgroundColor: tag.color()}}>\n                    <a className=\"TagTile-info\" href={app.route.tag(tag)} config={m.route}>\n                      <h3 className=\"TagTile-name\">{tag.name()}</h3>\n                      <p className=\"TagTile-description\">{tag.description()}</p>\n                      {children\n                        ? (\n                          <div className=\"TagTile-children\">\n                            {children.map(child => [\n                              <a href={app.route.tag(child)} config={function(element, isInitialized) {\n                                if (isInitialized) return;\n                                $(element).on('click', e => e.stopPropagation());\n                                m.route.apply(this, arguments);\n                              }}>\n                                {child.name()}\n                              </a>,\n                              ' '\n                            ])}\n                          </div>\n                        ) : ''}\n                    </a>\n                    {lastPostedDiscussion\n                      ? (\n                        <a className=\"TagTile-lastPostedDiscussion\"\n                          href={app.route.discussion(lastPostedDiscussion, lastPostedDiscussion.lastPostNumber())}\n                          config={m.route}>\n                          <span className=\"TagTile-lastPostedDiscussion-title\">{lastPostedDiscussion.title()}</span>\n                          {humanTime(lastPostedDiscussion.lastPostedAt())}\n                        </a>\n                      ) : (\n                        <span className=\"TagTile-lastPostedDiscussion\"/>\n                      )}\n                  </li>\n                );\n              })}\n            </ul>\n\n            {cloud.length ? (\n              <div className=\"TagCloud\">\n                {cloud.map(tag => [\n                  tagLabel(tag, {link: true}),\n                  ' ',\n                ])}\n              </div>\n            ) : ''}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import EventPost from 'flarum/components/EventPost';\nimport tagsLabel from '../../common/helpers/tagsLabel';\n\nexport default class DiscussionTaggedPost extends EventPost {\n  static initProps(props) {\n    super.initProps(props);\n\n    const oldTags = props.post.content()[0];\n    const newTags = props.post.content()[1];\n\n    function diffTags(tags1, tags2) {\n      return tags1\n        .filter(tag => tags2.indexOf(tag) === -1)\n        .map(id => app.store.getById('tags', id));\n    }\n\n    props.tagsAdded = diffTags(newTags, oldTags);\n    props.tagsRemoved = diffTags(oldTags, newTags);\n  }\n\n  icon() {\n    return 'fas fa-tag';\n  }\n\n  descriptionKey() {\n    if (this.props.tagsAdded.length) {\n      if (this.props.tagsRemoved.length) {\n        return 'flarum-tags.forum.post_stream.added_and_removed_tags_text';\n      }\n\n      return 'flarum-tags.forum.post_stream.added_tags_text';\n    }\n\n    return 'flarum-tags.forum.post_stream.removed_tags_text';\n  }\n\n  descriptionData() {\n    const data = {};\n\n    if (this.props.tagsAdded.length) {\n      data.tagsAdded = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.props.tagsAdded.length, {\n        tags: tagsLabel(this.props.tagsAdded, {link: true}),\n        count: this.props.tagsAdded.length\n      });\n    }\n\n    if (this.props.tagsRemoved.length) {\n      data.tagsRemoved = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.props.tagsRemoved.length, {\n        tags: tagsLabel(this.props.tagsRemoved, {link: true}),\n        count: this.props.tagsRemoved.length\n      });\n    }\n\n    return data;\n  }\n}\n","import LinkButton from 'flarum/components/LinkButton';\nimport tagIcon from '../../common/helpers/tagIcon';\n\nexport default class TagLinkButton extends LinkButton {\n  view() {\n    const tag = this.props.tag;\n    const active = this.constructor.isActive(this.props);\n    const description = tag && tag.description();\n\n    return (\n      <a className={'TagLinkButton hasIcon ' + (tag.isChild() ? 'child' : '')} href={this.props.href} config={m.route}\n        style={active && tag ? {color: tag.color()} : ''}\n        title={description || ''}>\n        {tagIcon(tag, {className: 'Button-icon'})}\n        {this.props.children}\n      </a>\n    );\n  }\n\n  static initProps(props) {\n    const tag = props.tag;\n\n    props.params.tags = tag ? tag.slug() : 'untagged';\n    props.href = app.route('tag', props.params);\n    props.children = tag ? tag.name() : app.translator.trans('flarum-tags.forum.index.untagged_link');\n  }\n}\n","import { extend } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport Separator from 'flarum/components/Separator';\nimport LinkButton from 'flarum/components/LinkButton';\n\nimport TagLinkButton from './components/TagLinkButton';\nimport TagsPage from './components/TagsPage';\nimport sortTags from '../common/utils/sortTags';\n\nexport default function() {\n  // Add a link to the tags page, as well as a list of all the tags,\n  // to the index page's sidebar.\n  extend(IndexPage.prototype, 'navItems', function(items) {\n    items.add('tags', LinkButton.component({\n      icon: 'fas fa-th-large',\n      children: app.translator.trans('flarum-tags.forum.index.tags_link'),\n      href: app.route('tags')\n    }), -10);\n\n    if (app.current instanceof TagsPage) return;\n\n    items.add('separator', Separator.component(), -10);\n\n    const params = this.stickyParams();\n    const tags = app.store.all('tags');\n    const currentTag = this.currentTag();\n\n    const addTag = tag => {\n      let active = currentTag === tag;\n\n      if (!active && currentTag) {\n        active = currentTag.parent() === tag;\n      }\n\n      items.add('tag' + tag.id(), TagLinkButton.component({tag, params, active}), -10);\n    };\n\n    sortTags(tags)\n      .filter(tag => tag.position() !== null && (!tag.isChild() || (currentTag && (tag.parent() === currentTag || tag.parent() === currentTag.parent()))))\n      .forEach(addTag);\n\n    const more = tags\n      .filter(tag => tag.position() === null)\n      .sort((a, b) => b.discussionCount() - a.discussionCount());\n\n    more.splice(0, 3).forEach(addTag);\n\n    if (more.length) {\n      items.add('moreTags', LinkButton.component({\n        children: app.translator.trans('flarum-tags.forum.index.more_link'),\n        href: app.route('tags')\n      }), -10);\n    }\n  });\n}\n","import Component from 'flarum/Component';\nimport tagIcon from '../../common/helpers/tagIcon';\n\nexport default class TagHero extends Component {\n  view() {\n    const tag = this.props.tag;\n    const color = tag.color();\n\n    return (\n      <header className={'Hero TagHero' + (color ? ' TagHero--colored' : '')}\n        style={color ? {color: '#fff', backgroundColor: color} : ''}>\n        <div className=\"container\">\n          <div className=\"containerNarrow\">\n            <h2 className=\"Hero-title\">{tag.icon() && tagIcon(tag, {}, { disableColors: true })} {tag.name()}</h2>\n            <div className=\"Hero-subtitle\">{tag.description()}</div>\n          </div>\n        </div>\n      </header>\n    );\n  }\n}\n","import { extend, override } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport DiscussionList from 'flarum/components/DiscussionList';\n\nimport TagHero from './components/TagHero';\n\nexport default function() {\n  IndexPage.prototype.currentTag = function() {\n    const slug = this.params().tags;\n\n    if (slug) return app.store.getBy('tags', 'slug', slug);\n  };\n\n  // If currently viewing a tag, insert a tag hero at the top of the view.\n  override(IndexPage.prototype, 'hero', function(original) {\n    const tag = this.currentTag();\n\n    if (tag) return TagHero.component({tag});\n\n    return original();\n  });\n\n  extend(IndexPage.prototype, 'view', function(vdom) {\n    const tag = this.currentTag();\n\n    if (tag) {\n      vdom.attrs.className += ' IndexPage--tag'+tag.id();\n    }\n  });\n\n  // If currently viewing a tag, restyle the 'new discussion' button to use\n  // the tag's color.\n  extend(IndexPage.prototype, 'sidebarItems', function(items) {\n    const tag = this.currentTag();\n\n    if (tag) {\n      const color = tag.color();\n\n      if (color) {\n        items.get('newDiscussion').props.style = {backgroundColor: color};\n      }\n    }\n  });\n\n  // Add a parameter for the IndexPage to pass on to the DiscussionList that\n  // will let us filter discussions by tag.\n  extend(IndexPage.prototype, 'params', function(params) {\n    params.tags = m.route.param('tags');\n  });\n\n  // Translate that parameter into a gambit appended to the search query.\n  extend(DiscussionList.prototype, 'requestParams', function(params) {\n    params.include.push('tags');\n\n    if (this.props.params.tags) {\n      params.filter.q = (params.filter.q || '') + ' tag:' + this.props.params.tags;\n    }\n  });\n}\n","import { extend } from 'flarum/extend';\nimport DiscussionListItem from 'flarum/components/DiscussionListItem';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport DiscussionHero from 'flarum/components/DiscussionHero';\n\nimport tagsLabel from '../common/helpers/tagsLabel';\nimport sortTags from '../common/utils/sortTags';\n\nexport default function() {\n  // Add tag labels to each discussion in the discussion list.\n  extend(DiscussionListItem.prototype, 'infoItems', function(items) {\n    const tags = this.props.discussion.tags();\n\n    if (tags && tags.length) {\n      items.add('tags', tagsLabel(tags), 10);\n    }\n  });\n\n  // Include a discussion's tags when fetching it.\n  extend(DiscussionPage.prototype, 'params', function(params) {\n    params.include.push('tags');\n  });\n\n  // Restyle a discussion's hero to use its first tag's color.\n  extend(DiscussionHero.prototype, 'view', function(view) {\n    const tags = sortTags(this.props.discussion.tags());\n\n    if (tags && tags.length) {\n      const color = tags[0].color();\n      if (color) {\n        view.attrs.style = {backgroundColor: color};\n        view.attrs.className += ' DiscussionHero--colored';\n      }\n    }\n  });\n\n  // Add a list of a discussion's tags to the discussion hero, displayed\n  // before the title. Put the title on its own line.\n  extend(DiscussionHero.prototype, 'items', function(items) {\n    const tags = this.props.discussion.tags();\n\n    if (tags && tags.length) {\n      items.add('tags', tagsLabel(tags, {link: true}), 5);\n    }\n  });\n}\n","import Modal from 'flarum/components/Modal';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport Button from 'flarum/components/Button';\nimport highlight from 'flarum/helpers/highlight';\nimport classList from 'flarum/utils/classList';\nimport extractText from 'flarum/utils/extractText';\nimport KeyboardNavigatable from 'flarum/utils/KeyboardNavigatable';\n\nimport tagLabel from '../../common/helpers/tagLabel';\nimport tagIcon from '../../common/helpers/tagIcon';\nimport sortTags from '../../common/utils/sortTags';\n\nexport default class TagDiscussionModal extends Modal {\n  init() {\n    super.init();\n\n    this.tags = app.store.all('tags');\n\n    if (this.props.discussion) {\n      this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.props.discussion.tags().indexOf(tag) !== -1);\n    } else {\n      this.tags = this.tags.filter(tag => tag.canStartDiscussion());\n    }\n\n    this.tags = sortTags(this.tags);\n\n    this.selected = [];\n    this.filter = m.prop('');\n    this.index = this.tags[0].id();\n    this.focused = false;\n\n    if (this.props.selectedTags) {\n      this.props.selectedTags.map(this.addTag.bind(this));\n    } else if (this.props.discussion) {\n      this.props.discussion.tags().map(this.addTag.bind(this));\n    }\n\n    this.minPrimary = app.forum.attribute('minPrimaryTags');\n    this.maxPrimary = app.forum.attribute('maxPrimaryTags');\n    this.minSecondary = app.forum.attribute('minSecondaryTags');\n    this.maxSecondary = app.forum.attribute('maxSecondaryTags');\n\n    this.navigator = new KeyboardNavigatable();\n    this.navigator\n      .onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true))\n      .onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true))\n      .onSelect(this.select.bind(this))\n      .onRemove(() => this.selected.splice(this.selected.length - 1, 1));\n  }\n\n  primaryCount() {\n    return this.selected.filter(tag => tag.isPrimary()).length;\n  }\n\n  secondaryCount() {\n    return this.selected.filter(tag => !tag.isPrimary()).length;\n  }\n\n  /**\n   * Add the given tag to the list of selected tags.\n   *\n   * @param {Tag} tag\n   */\n  addTag(tag) {\n    if (!tag.canStartDiscussion()) return;\n\n    // If this tag has a parent, we'll also need to add the parent tag to the\n    // selected list if it's not already in there.\n    const parent = tag.parent();\n    if (parent) {\n      const index = this.selected.indexOf(parent);\n      if (index === -1) {\n        this.selected.push(parent);\n      }\n    }\n\n    this.selected.push(tag);\n  }\n\n  /**\n   * Remove the given tag from the list of selected tags.\n   *\n   * @param {Tag} tag\n   */\n  removeTag(tag) {\n    const index = this.selected.indexOf(tag);\n    if (index !== -1) {\n      this.selected.splice(index, 1);\n\n      // Look through the list of selected tags for any tags which have the tag\n      // we just removed as their parent. We'll need to remove them too.\n      this.selected\n        .filter(selected => selected.parent() === tag)\n        .forEach(this.removeTag.bind(this));\n    }\n  }\n\n  className() {\n    return 'TagDiscussionModal';\n  }\n\n  title() {\n    return this.props.discussion\n      ? app.translator.trans('flarum-tags.forum.choose_tags.edit_title', {title: <em>{this.props.discussion.title()}</em>})\n      : app.translator.trans('flarum-tags.forum.choose_tags.title');\n  }\n\n  getInstruction(primaryCount, secondaryCount) {\n    if (primaryCount < this.minPrimary) {\n      const remaining = this.minPrimary - primaryCount;\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_primary_placeholder', remaining, {count: remaining});\n    } else if (secondaryCount < this.minSecondary) {\n      const remaining = this.minSecondary - secondaryCount;\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_secondary_placeholder', remaining, {count: remaining});\n    }\n\n    return '';\n  }\n\n  content() {\n    let tags = this.tags;\n    const filter = this.filter().toLowerCase();\n    const primaryCount = this.primaryCount();\n    const secondaryCount = this.secondaryCount();\n\n    // Filter out all child tags whose parents have not been selected. This\n    // makes it impossible to select a child if its parent hasn't been selected.\n    tags = tags.filter(tag => {\n      const parent = tag.parent();\n      return parent === false || this.selected.indexOf(parent) !== -1;\n    });\n\n    // If the number of selected primary/secondary tags is at the maximum, then\n    // we'll filter out all other tags of that type.\n    if (primaryCount >= this.maxPrimary) {\n      tags = tags.filter(tag => !tag.isPrimary() || this.selected.indexOf(tag) !== -1);\n    }\n\n    if (secondaryCount >= this.maxSecondary) {\n      tags = tags.filter(tag => tag.isPrimary() || this.selected.indexOf(tag) !== -1);\n    }\n\n    // If the user has entered text in the filter input, then filter by tags\n    // whose name matches what they've entered.\n    if (filter) {\n      tags = tags.filter(tag => tag.name().substr(0, filter.length).toLowerCase() === filter);\n    }\n\n    if (tags.indexOf(this.index) === -1) this.index = tags[0];\n\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"TagDiscussionModal-form\">\n          <div className=\"TagDiscussionModal-form-input\">\n            <div className={'TagsInput FormControl ' + (this.focused ? 'focus' : '')}>\n              <span className=\"TagsInput-selected\">\n                {this.selected.map(tag =>\n                  <span className=\"TagsInput-tag\" onclick={() => {\n                    this.removeTag(tag);\n                    this.onready();\n                  }}>\n                    {tagLabel(tag)}\n                  </span>\n                )}\n              </span>\n              <input className=\"FormControl\"\n                placeholder={extractText(this.getInstruction(primaryCount, secondaryCount))}\n                value={this.filter()}\n                oninput={m.withAttr('value', this.filter)}\n                onkeydown={this.navigator.navigate.bind(this.navigator)}\n                onfocus={() => this.focused = true}\n                onblur={() => this.focused = false}/>\n            </div>\n          </div>\n          <div className=\"TagDiscussionModal-form-submit App-primaryControl\">\n            {Button.component({\n              type: 'submit',\n              className: 'Button Button--primary',\n              disabled: primaryCount < this.minPrimary || secondaryCount < this.minSecondary,\n              icon: 'fas fa-check',\n              children: app.translator.trans('flarum-tags.forum.choose_tags.submit_button')\n            })}\n          </div>\n        </div>\n      </div>,\n\n      <div className=\"Modal-footer\">\n        <ul className=\"TagDiscussionModal-list SelectTagList\">\n          {tags\n            .filter(tag => filter || !tag.parent() || this.selected.indexOf(tag.parent()) !== -1)\n            .map(tag => (\n              <li data-index={tag.id()}\n                className={classList({\n                  pinned: tag.position() !== null,\n                  child: !!tag.parent(),\n                  colored: !!tag.color(),\n                  selected: this.selected.indexOf(tag) !== -1,\n                  active: this.index === tag\n                })}\n                style={{color: tag.color()}}\n                onmouseover={() => this.index = tag}\n                onclick={this.toggleTag.bind(this, tag)}\n              >\n                {tagIcon(tag)}\n                <span className=\"SelectTagListItem-name\">\n                  {highlight(tag.name(), filter)}\n                </span>\n                {tag.description()\n                  ? (\n                    <span className=\"SelectTagListItem-description\">\n                      {tag.description()}\n                    </span>\n                  ) : ''}\n              </li>\n            ))}\n        </ul>\n      </div>\n    ];\n  }\n\n  toggleTag(tag) {\n    const index = this.selected.indexOf(tag);\n\n    if (index !== -1) {\n      this.removeTag(tag);\n    } else {\n      this.addTag(tag);\n    }\n\n    if (this.filter()) {\n      this.filter('');\n      this.index = this.tags[0];\n    }\n\n    this.onready();\n  }\n\n  select(e) {\n    // Ctrl + Enter submits the selection, just Enter completes the current entry\n    if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\n      if (this.selected.length) {\n        this.$('form').submit();\n      }\n    } else {\n      this.getItem(this.index)[0].dispatchEvent(new Event('click'));\n    }\n  }\n\n  selectableItems() {\n    return this.$('.TagDiscussionModal-list > li');\n  }\n\n  getCurrentNumericIndex() {\n    return this.selectableItems().index(\n      this.getItem(this.index)\n    );\n  }\n\n  getItem(index) {\n    return this.selectableItems().filter(`[data-index=\"${index.id()}\"]`);\n  }\n\n  setIndex(index, scrollToItem) {\n    const $items = this.selectableItems();\n    const $dropdown = $items.parent();\n\n    if (index < 0) {\n      index = $items.length - 1;\n    } else if (index >= $items.length) {\n      index = 0;\n    }\n\n    const $item = $items.eq(index);\n\n    this.index = app.store.getById('tags', $item.attr('data-index'));\n\n    m.redraw();\n\n    if (scrollToItem) {\n      const dropdownScroll = $dropdown.scrollTop();\n      const dropdownTop = $dropdown.offset().top;\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\n      const itemTop = $item.offset().top;\n      const itemBottom = itemTop + $item.outerHeight();\n\n      let scrollTop;\n      if (itemTop < dropdownTop) {\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\n      } else if (itemBottom > dropdownBottom) {\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\n      }\n\n      if (typeof scrollTop !== 'undefined') {\n        $dropdown.stop(true).animate({scrollTop}, 100);\n      }\n    }\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const discussion = this.props.discussion;\n    const tags = this.selected;\n\n    if (discussion) {\n      discussion.save({relationships: {tags}})\n        .then(() => {\n          if (app.current instanceof DiscussionPage) {\n            app.current.stream.update();\n          }\n          m.redraw();\n        });\n    }\n\n    if (this.props.onsubmit) this.props.onsubmit(tags);\n\n    app.modal.close();\n\n    m.redraw.strategy('none');\n  }\n}\n","import { extend } from 'flarum/extend';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\n\nimport TagDiscussionModal from './components/TagDiscussionModal';\n\nexport default function() {\n  // Add a control allowing the discussion to be moved to another category.\n  extend(DiscussionControls, 'moderationControls', function(items, discussion) {\n    if (discussion.canTag()) {\n      items.add('tags', Button.component({\n        children: app.translator.trans('flarum-tags.forum.discussion_controls.edit_tags_button'),\n        icon: 'fas fa-tag',\n        onclick: () => app.modal.show(new TagDiscussionModal({discussion}))\n      }));\n    }\n  });\n}\n","import { extend, override } from 'flarum/extend';\nimport IndexPage from 'flarum/components/IndexPage';\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\n\nimport TagDiscussionModal from './components/TagDiscussionModal';\nimport tagsLabel from '../common/helpers/tagsLabel';\n\nexport default function() {\n  extend(IndexPage.prototype, 'newDiscussionAction', function(promise) {\n    const tag = app.store.getBy('tags', 'slug', this.params().tags);\n\n    if (tag) {\n      const parent = tag.parent();\n      const tags = parent ? [parent, tag] : [tag];\n      promise.then(component => component.tags = tags);\n    }\n  });\n\n  // Add tag-selection abilities to the discussion composer.\n  DiscussionComposer.prototype.tags = [];\n  DiscussionComposer.prototype.chooseTags = function() {\n    app.modal.show(\n      new TagDiscussionModal({\n        selectedTags: this.tags.slice(0),\n        onsubmit: tags => {\n          this.tags = tags;\n          this.$('textarea').focus();\n        }\n      })\n    );\n  };\n\n  // Add a tag-selection menu to the discussion composer's header, after the\n  // title.\n  extend(DiscussionComposer.prototype, 'headerItems', function(items) {\n    items.add('tags', (\n      <a className=\"DiscussionComposer-changeTags\" onclick={this.chooseTags.bind(this)}>\n        {this.tags.length\n          ? tagsLabel(this.tags)\n          : <span className=\"TagLabel untagged\">{app.translator.trans('flarum-tags.forum.composer_discussion.choose_tags_link')}</span>}\n      </a>\n    ), 10);\n  });\n\n  override(DiscussionComposer.prototype, 'onsubmit', function(original) {\n    const chosenTags = this.tags;\n    const chosenPrimaryTags = chosenTags.filter(tag => tag.position() !== null && !tag.isChild());\n    const chosenSecondaryTags = chosenTags.filter(tag => tag.position() === null);\n    if (!chosenTags.length\n      || (chosenPrimaryTags.length < app.forum.attribute('minPrimaryTags'))\n      || (chosenSecondaryTags.length < app.forum.attribute('minSecondaryTags'))) {\n      app.modal.show(\n        new TagDiscussionModal({\n          selectedTags: chosenTags,\n          onsubmit: tags => {\n            this.tags = tags;\n            original();\n          }\n        })\n      );\n    } else {\n      original();\n    }\n  });\n\n  // Add the selected tags as data to submit to the server.\n  extend(DiscussionComposer.prototype, 'data', function(data) {\n    data.relationships = data.relationships || {};\n    data.relationships.tags = this.tags;\n  });\n}\n","import compat from '../common/compat';\n\nimport addTagFilter from './addTagFilter';\nimport addTagControl from './addTagControl';\nimport TagHero from './components/TagHero';\nimport TagDiscussionModal from './components/TagDiscussionModal';\nimport TagsPage from './components/TagsPage';\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\nimport TagLinkButton from './components/TagLinkButton';\nimport addTagList from './addTagList';\nimport addTagLabels from './addTagLabels';\nimport addTagComposer from './addTagComposer';\n\nexport default Object.assign(compat, {\n  'tags/addTagFilter': addTagFilter,\n  'tags/addTagControl': addTagControl,\n  'tags/components/TagHero': TagHero,\n  'tags/components/TagDiscussionModal': TagDiscussionModal,\n  'tags/components/TagsPage': TagsPage,\n  'tags/components/DiscussionTaggedPost': DiscussionTaggedPost,\n  'tags/components/TagLinkButton': TagLinkButton,\n  'tags/addTagList': addTagList,\n  'tags/addTagLabels': addTagLabels,\n  'tags/addTagComposer': addTagComposer,\n});\n","import Model from 'flarum/Model';\nimport Discussion from 'flarum/models/Discussion';\nimport IndexPage from 'flarum/components/IndexPage';\n\nimport Tag from '../common/models/Tag';\nimport TagsPage from './components/TagsPage';\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\n\nimport addTagList from './addTagList';\nimport addTagFilter from './addTagFilter';\nimport addTagLabels from './addTagLabels';\nimport addTagControl from './addTagControl';\nimport addTagComposer from './addTagComposer';\n\napp.initializers.add('flarum-tags', function(app) {\n  app.routes.tags = {path: '/tags', component: TagsPage.component()};\n  app.routes.tag = {path: '/t/:tags', component: IndexPage.component()};\n\n  app.route.tag = tag => app.route('tag', {tags: tag.slug()});\n\n  app.postComponents.discussionTagged = DiscussionTaggedPost;\n\n  app.store.models.tags = Tag;\n\n  Discussion.prototype.tags = Model.hasMany('tags');\n  Discussion.prototype.canTag = Model.attribute('canTag');\n\n  addTagList();\n  addTagFilter();\n  addTagLabels();\n  addTagControl();\n  addTagComposer();\n});\n\n\n// Expose compat API\nimport tagsCompat from './compat';\nimport { compat } from '@flarum/core/forum';\n\nObject.assign(compat, tagsCompat);","module.exports = flarum.core.compat['helpers/listItems'];","module.exports = flarum.core.compat['helpers/humanTime'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/Separator'];","module.exports = flarum.core.compat['components/DiscussionList'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/DiscussionListItem'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['utils/classList'];","module.exports = flarum.core.compat['utils/extractText'];","module.exports = flarum.core.compat['utils/KeyboardNavigatable'];","/*\n * This file is part of Flarum.\n *\n * (c) Toby Zerner <toby.zerner@gmail.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nexport * from './src/common';\nexport * from './src/forum';\n"],"sourceRoot":""}